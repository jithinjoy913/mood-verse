function wz(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in t)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var Oi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function M1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function xz(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var r=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,r.get?r:{enumerable:!0,get:function(){return t[s]}})}),n}var gA={exports:{}},V1={},yA={exports:{}},ct={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var of=Symbol.for("react.element"),bz=Symbol.for("react.portal"),Iz=Symbol.for("react.fragment"),Sz=Symbol.for("react.strict_mode"),Tz=Symbol.for("react.profiler"),Cz=Symbol.for("react.provider"),kz=Symbol.for("react.context"),Ez=Symbol.for("react.forward_ref"),_z=Symbol.for("react.suspense"),Nz=Symbol.for("react.memo"),$z=Symbol.for("react.lazy"),Bk=Symbol.iterator;function Az(t){return t===null||typeof t!="object"?null:(t=Bk&&t[Bk]||t["@@iterator"],typeof t=="function"?t:null)}var vA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},wA=Object.assign,xA={};function Lh(t,e,n){this.props=t,this.context=e,this.refs=xA,this.updater=n||vA}Lh.prototype.isReactComponent={};Lh.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Lh.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function bA(){}bA.prototype=Lh.prototype;function Wb(t,e,n){this.props=t,this.context=e,this.refs=xA,this.updater=n||vA}var jb=Wb.prototype=new bA;jb.constructor=Wb;wA(jb,Lh.prototype);jb.isPureReactComponent=!0;var Uk=Array.isArray,IA=Object.prototype.hasOwnProperty,Gb={current:null},SA={key:!0,ref:!0,__self:!0,__source:!0};function TA(t,e,n){var s,r={},i=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)IA.call(e,s)&&!SA.hasOwnProperty(s)&&(r[s]=e[s]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];r.children=l}if(t&&t.defaultProps)for(s in a=t.defaultProps,a)r[s]===void 0&&(r[s]=a[s]);return{$$typeof:of,type:t,key:i,ref:o,props:r,_owner:Gb.current}}function Rz(t,e){return{$$typeof:of,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Hb(t){return typeof t=="object"&&t!==null&&t.$$typeof===of}function Dz(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Wk=/\/+/g;function xw(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Dz(""+t.key):e.toString(36)}function jg(t,e,n,s,r){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case of:case bz:o=!0}}if(o)return o=t,r=r(o),t=s===""?"."+xw(o,0):s,Uk(r)?(n="",t!=null&&(n=t.replace(Wk,"$&/")+"/"),jg(r,e,n,"",function(u){return u})):r!=null&&(Hb(r)&&(r=Rz(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(Wk,"$&/")+"/")+t)),e.push(r)),1;if(o=0,s=s===""?".":s+":",Uk(t))for(var a=0;a<t.length;a++){i=t[a];var l=s+xw(i,a);o+=jg(i,e,n,l,r)}else if(l=Az(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=s+xw(i,a++),o+=jg(i,e,n,l,r);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function og(t,e,n){if(t==null)return t;var s=[],r=0;return jg(t,s,"","",function(i){return e.call(n,i,r++)}),s}function Oz(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Zs={current:null},Gg={transition:null},Pz={ReactCurrentDispatcher:Zs,ReactCurrentBatchConfig:Gg,ReactCurrentOwner:Gb};function CA(){throw Error("act(...) is not supported in production builds of React.")}ct.Children={map:og,forEach:function(t,e,n){og(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return og(t,function(){e++}),e},toArray:function(t){return og(t,function(e){return e})||[]},only:function(t){if(!Hb(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ct.Component=Lh;ct.Fragment=Iz;ct.Profiler=Tz;ct.PureComponent=Wb;ct.StrictMode=Sz;ct.Suspense=_z;ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pz;ct.act=CA;ct.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=wA({},t.props),r=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Gb.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)IA.call(e,l)&&!SA.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];s.children=a}return{$$typeof:of,type:t.type,key:r,ref:i,props:s,_owner:o}};ct.createContext=function(t){return t={$$typeof:kz,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Cz,_context:t},t.Consumer=t};ct.createElement=TA;ct.createFactory=function(t){var e=TA.bind(null,t);return e.type=t,e};ct.createRef=function(){return{current:null}};ct.forwardRef=function(t){return{$$typeof:Ez,render:t}};ct.isValidElement=Hb;ct.lazy=function(t){return{$$typeof:$z,_payload:{_status:-1,_result:t},_init:Oz}};ct.memo=function(t,e){return{$$typeof:Nz,type:t,compare:e===void 0?null:e}};ct.startTransition=function(t){var e=Gg.transition;Gg.transition={};try{t()}finally{Gg.transition=e}};ct.unstable_act=CA;ct.useCallback=function(t,e){return Zs.current.useCallback(t,e)};ct.useContext=function(t){return Zs.current.useContext(t)};ct.useDebugValue=function(){};ct.useDeferredValue=function(t){return Zs.current.useDeferredValue(t)};ct.useEffect=function(t,e){return Zs.current.useEffect(t,e)};ct.useId=function(){return Zs.current.useId()};ct.useImperativeHandle=function(t,e,n){return Zs.current.useImperativeHandle(t,e,n)};ct.useInsertionEffect=function(t,e){return Zs.current.useInsertionEffect(t,e)};ct.useLayoutEffect=function(t,e){return Zs.current.useLayoutEffect(t,e)};ct.useMemo=function(t,e){return Zs.current.useMemo(t,e)};ct.useReducer=function(t,e,n){return Zs.current.useReducer(t,e,n)};ct.useRef=function(t){return Zs.current.useRef(t)};ct.useState=function(t){return Zs.current.useState(t)};ct.useSyncExternalStore=function(t,e,n){return Zs.current.useSyncExternalStore(t,e,n)};ct.useTransition=function(){return Zs.current.useTransition()};ct.version="18.3.1";yA.exports=ct;var kt=yA.exports;const Fz=M1(kt);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lz=kt,Mz=Symbol.for("react.element"),Vz=Symbol.for("react.fragment"),zz=Object.prototype.hasOwnProperty,Bz=Lz.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Uz={key:!0,ref:!0,__self:!0,__source:!0};function kA(t,e,n){var s,r={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)zz.call(e,s)&&!Uz.hasOwnProperty(s)&&(r[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:Mz,type:t,key:i,ref:o,props:r,_owner:Bz.current}}V1.Fragment=Vz;V1.jsx=kA;V1.jsxs=kA;gA.exports=V1;var oe=gA.exports,EA={exports:{}},Mr={},_A={exports:{}},NA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(q,J){var ie=q.length;q.push(J);e:for(;0<ie;){var he=ie-1>>>1,de=q[he];if(0<r(de,J))q[he]=J,q[ie]=de,ie=he;else break e}}function n(q){return q.length===0?null:q[0]}function s(q){if(q.length===0)return null;var J=q[0],ie=q.pop();if(ie!==J){q[0]=ie;e:for(var he=0,de=q.length,pe=de>>>1;he<pe;){var xe=2*(he+1)-1,ye=q[xe],Ie=xe+1,$e=q[Ie];if(0>r(ye,ie))Ie<de&&0>r($e,ye)?(q[he]=$e,q[Ie]=ie,he=Ie):(q[he]=ye,q[xe]=ie,he=xe);else if(Ie<de&&0>r($e,ie))q[he]=$e,q[Ie]=ie,he=Ie;else break e}}return J}function r(q,J){var ie=q.sortIndex-J.sortIndex;return ie!==0?ie:q.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,h=null,d=3,p=!1,f=!1,m=!1,v=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(q){for(var J=n(u);J!==null;){if(J.callback===null)s(u);else if(J.startTime<=q)s(u),J.sortIndex=J.expirationTime,e(l,J);else break;J=n(u)}}function I(q){if(m=!1,b(q),!f)if(n(l)!==null)f=!0,ne(k);else{var J=n(u);J!==null&&le(I,J.startTime-q)}}function k(q,J){f=!1,m&&(m=!1,y(T),T=-1),p=!0;var ie=d;try{for(b(J),h=n(l);h!==null&&(!(h.expirationTime>J)||q&&!P());){var he=h.callback;if(typeof he=="function"){h.callback=null,d=h.priorityLevel;var de=he(h.expirationTime<=J);J=t.unstable_now(),typeof de=="function"?h.callback=de:h===n(l)&&s(l),b(J)}else s(l);h=n(l)}if(h!==null)var pe=!0;else{var xe=n(u);xe!==null&&le(I,xe.startTime-J),pe=!1}return pe}finally{h=null,d=ie,p=!1}}var R=!1,C=null,T=-1,N=5,$=-1;function P(){return!(t.unstable_now()-$<N)}function V(){if(C!==null){var q=t.unstable_now();$=q;var J=!0;try{J=C(!0,q)}finally{J?O():(R=!1,C=null)}}else R=!1}var O;if(typeof w=="function")O=function(){w(V)};else if(typeof MessageChannel<"u"){var Q=new MessageChannel,Z=Q.port2;Q.port1.onmessage=V,O=function(){Z.postMessage(null)}}else O=function(){v(V,0)};function ne(q){C=q,R||(R=!0,O())}function le(q,J){T=v(function(){q(t.unstable_now())},J)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(q){q.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,ne(k))},t.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<q?Math.floor(1e3/q):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(q){switch(d){case 1:case 2:case 3:var J=3;break;default:J=d}var ie=d;d=J;try{return q()}finally{d=ie}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(q,J){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var ie=d;d=q;try{return J()}finally{d=ie}},t.unstable_scheduleCallback=function(q,J,ie){var he=t.unstable_now();switch(typeof ie=="object"&&ie!==null?(ie=ie.delay,ie=typeof ie=="number"&&0<ie?he+ie:he):ie=he,q){case 1:var de=-1;break;case 2:de=250;break;case 5:de=1073741823;break;case 4:de=1e4;break;default:de=5e3}return de=ie+de,q={id:c++,callback:J,priorityLevel:q,startTime:ie,expirationTime:de,sortIndex:-1},ie>he?(q.sortIndex=ie,e(u,q),n(l)===null&&q===n(u)&&(m?(y(T),T=-1):m=!0,le(I,ie-he))):(q.sortIndex=de,e(l,q),f||p||(f=!0,ne(k))),q},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(q){var J=d;return function(){var ie=d;d=J;try{return q.apply(this,arguments)}finally{d=ie}}}})(NA);_A.exports=NA;var Wz=_A.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jz=kt,Pr=Wz;function we(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var $A=new Set,vp={};function qu(t,e){hh(t,e),hh(t+"Capture",e)}function hh(t,e){for(vp[t]=e,t=0;t<e.length;t++)$A.add(e[t])}var Yo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Nx=Object.prototype.hasOwnProperty,Gz=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,jk={},Gk={};function Hz(t){return Nx.call(Gk,t)?!0:Nx.call(jk,t)?!1:Gz.test(t)?Gk[t]=!0:(jk[t]=!0,!1)}function qz(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Kz(t,e,n,s){if(e===null||typeof e>"u"||qz(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function er(t,e,n,s,r,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var vs={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){vs[t]=new er(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];vs[e]=new er(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){vs[t]=new er(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){vs[t]=new er(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){vs[t]=new er(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){vs[t]=new er(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){vs[t]=new er(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){vs[t]=new er(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){vs[t]=new er(t,5,!1,t.toLowerCase(),null,!1,!1)});var qb=/[\-:]([a-z])/g;function Kb(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(qb,Kb);vs[e]=new er(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(qb,Kb);vs[e]=new er(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(qb,Kb);vs[e]=new er(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){vs[t]=new er(t,1,!1,t.toLowerCase(),null,!1,!1)});vs.xlinkHref=new er("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){vs[t]=new er(t,1,!1,t.toLowerCase(),null,!0,!0)});function Xb(t,e,n,s){var r=vs.hasOwnProperty(e)?vs[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Kz(e,n,r,s)&&(n=null),s||r===null?Hz(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,s=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var la=jz.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ag=Symbol.for("react.element"),Oc=Symbol.for("react.portal"),Pc=Symbol.for("react.fragment"),Yb=Symbol.for("react.strict_mode"),$x=Symbol.for("react.profiler"),AA=Symbol.for("react.provider"),RA=Symbol.for("react.context"),Qb=Symbol.for("react.forward_ref"),Ax=Symbol.for("react.suspense"),Rx=Symbol.for("react.suspense_list"),Jb=Symbol.for("react.memo"),Ea=Symbol.for("react.lazy"),DA=Symbol.for("react.offscreen"),Hk=Symbol.iterator;function $d(t){return t===null||typeof t!="object"?null:(t=Hk&&t[Hk]||t["@@iterator"],typeof t=="function"?t:null)}var dn=Object.assign,bw;function Wd(t){if(bw===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);bw=e&&e[1]||""}return`
`+bw+t}var Iw=!1;function Sw(t,e){if(!t||Iw)return"";Iw=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var s=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){s=u}t.call(e.prototype)}else{try{throw Error()}catch(u){s=u}t()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),i=s.stack.split(`
`),o=r.length-1,a=i.length-1;1<=o&&0<=a&&r[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==i[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{Iw=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Wd(t):""}function Xz(t){switch(t.tag){case 5:return Wd(t.type);case 16:return Wd("Lazy");case 13:return Wd("Suspense");case 19:return Wd("SuspenseList");case 0:case 2:case 15:return t=Sw(t.type,!1),t;case 11:return t=Sw(t.type.render,!1),t;case 1:return t=Sw(t.type,!0),t;default:return""}}function Dx(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Pc:return"Fragment";case Oc:return"Portal";case $x:return"Profiler";case Yb:return"StrictMode";case Ax:return"Suspense";case Rx:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case RA:return(t.displayName||"Context")+".Consumer";case AA:return(t._context.displayName||"Context")+".Provider";case Qb:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Jb:return e=t.displayName||null,e!==null?e:Dx(t.type)||"Memo";case Ea:e=t._payload,t=t._init;try{return Dx(t(e))}catch{}}return null}function Yz(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Dx(e);case 8:return e===Yb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function tl(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function OA(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Qz(t){var e=OA(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){s=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function lg(t){t._valueTracker||(t._valueTracker=Qz(t))}function PA(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=OA(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function my(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ox(t,e){var n=e.checked;return dn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function qk(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=tl(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function FA(t,e){e=e.checked,e!=null&&Xb(t,"checked",e,!1)}function Px(t,e){FA(t,e);var n=tl(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Fx(t,e.type,n):e.hasOwnProperty("defaultValue")&&Fx(t,e.type,tl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Kk(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Fx(t,e,n){(e!=="number"||my(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var jd=Array.isArray;function Kc(t,e,n,s){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&s&&(t[n].defaultSelected=!0)}else{for(n=""+tl(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,s&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Lx(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(we(91));return dn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Xk(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(we(92));if(jd(n)){if(1<n.length)throw Error(we(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:tl(n)}}function LA(t,e){var n=tl(e.value),s=tl(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function Yk(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function MA(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Mx(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?MA(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ug,VA=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ug=ug||document.createElement("div"),ug.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ug.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function wp(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var np={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Jz=["Webkit","ms","Moz","O"];Object.keys(np).forEach(function(t){Jz.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),np[e]=np[t]})});function zA(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||np.hasOwnProperty(t)&&np[t]?(""+e).trim():e+"px"}function BA(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=zA(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,r):t[n]=r}}var Zz=dn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Vx(t,e){if(e){if(Zz[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(we(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(we(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(we(61))}if(e.style!=null&&typeof e.style!="object")throw Error(we(62))}}function zx(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Bx=null;function Zb(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ux=null,Xc=null,Yc=null;function Qk(t){if(t=uf(t)){if(typeof Ux!="function")throw Error(we(280));var e=t.stateNode;e&&(e=j1(e),Ux(t.stateNode,t.type,e))}}function UA(t){Xc?Yc?Yc.push(t):Yc=[t]:Xc=t}function WA(){if(Xc){var t=Xc,e=Yc;if(Yc=Xc=null,Qk(t),e)for(t=0;t<e.length;t++)Qk(e[t])}}function jA(t,e){return t(e)}function GA(){}var Tw=!1;function HA(t,e,n){if(Tw)return t(e,n);Tw=!0;try{return jA(t,e,n)}finally{Tw=!1,(Xc!==null||Yc!==null)&&(GA(),WA())}}function xp(t,e){var n=t.stateNode;if(n===null)return null;var s=j1(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(we(231,e,typeof n));return n}var Wx=!1;if(Yo)try{var Ad={};Object.defineProperty(Ad,"passive",{get:function(){Wx=!0}}),window.addEventListener("test",Ad,Ad),window.removeEventListener("test",Ad,Ad)}catch{Wx=!1}function eB(t,e,n,s,r,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(c){this.onError(c)}}var sp=!1,gy=null,yy=!1,jx=null,tB={onError:function(t){sp=!0,gy=t}};function nB(t,e,n,s,r,i,o,a,l){sp=!1,gy=null,eB.apply(tB,arguments)}function sB(t,e,n,s,r,i,o,a,l){if(nB.apply(this,arguments),sp){if(sp){var u=gy;sp=!1,gy=null}else throw Error(we(198));yy||(yy=!0,jx=u)}}function Ku(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function qA(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Jk(t){if(Ku(t)!==t)throw Error(we(188))}function rB(t){var e=t.alternate;if(!e){if(e=Ku(t),e===null)throw Error(we(188));return e!==t?null:t}for(var n=t,s=e;;){var r=n.return;if(r===null)break;var i=r.alternate;if(i===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===n)return Jk(r),t;if(i===s)return Jk(r),e;i=i.sibling}throw Error(we(188))}if(n.return!==s.return)n=r,s=i;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,s=i;break}if(a===s){o=!0,s=r,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,s=r;break}if(a===s){o=!0,s=i,n=r;break}a=a.sibling}if(!o)throw Error(we(189))}}if(n.alternate!==s)throw Error(we(190))}if(n.tag!==3)throw Error(we(188));return n.stateNode.current===n?t:e}function KA(t){return t=rB(t),t!==null?XA(t):null}function XA(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=XA(t);if(e!==null)return e;t=t.sibling}return null}var YA=Pr.unstable_scheduleCallback,Zk=Pr.unstable_cancelCallback,iB=Pr.unstable_shouldYield,oB=Pr.unstable_requestPaint,Sn=Pr.unstable_now,aB=Pr.unstable_getCurrentPriorityLevel,eI=Pr.unstable_ImmediatePriority,QA=Pr.unstable_UserBlockingPriority,vy=Pr.unstable_NormalPriority,lB=Pr.unstable_LowPriority,JA=Pr.unstable_IdlePriority,z1=null,mo=null;function uB(t){if(mo&&typeof mo.onCommitFiberRoot=="function")try{mo.onCommitFiberRoot(z1,t,void 0,(t.current.flags&128)===128)}catch{}}var Pi=Math.clz32?Math.clz32:dB,cB=Math.log,hB=Math.LN2;function dB(t){return t>>>=0,t===0?32:31-(cB(t)/hB|0)|0}var cg=64,hg=4194304;function Gd(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function wy(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,r=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?s=Gd(a):(i&=o,i!==0&&(s=Gd(i)))}else o=n&~r,o!==0?s=Gd(o):i!==0&&(s=Gd(i));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,i=e&-e,r>=i||r===16&&(i&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-Pi(e),r=1<<n,s|=t[n],e&=~r;return s}function pB(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fB(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,r=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-Pi(i),a=1<<o,l=r[o];l===-1?(!(a&n)||a&s)&&(r[o]=pB(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function Gx(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function ZA(){var t=cg;return cg<<=1,!(cg&4194240)&&(cg=64),t}function Cw(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function af(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Pi(e),t[e]=n}function mB(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Pi(n),i=1<<r;e[r]=0,s[r]=-1,t[r]=-1,n&=~i}}function tI(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-Pi(n),r=1<<s;r&e|t[s]&e&&(t[s]|=e),n&=~r}}var Rt=0;function e3(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var t3,nI,n3,s3,r3,Hx=!1,dg=[],Ba=null,Ua=null,Wa=null,bp=new Map,Ip=new Map,$a=[],gB="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function eE(t,e){switch(t){case"focusin":case"focusout":Ba=null;break;case"dragenter":case"dragleave":Ua=null;break;case"mouseover":case"mouseout":Wa=null;break;case"pointerover":case"pointerout":bp.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ip.delete(e.pointerId)}}function Rd(t,e,n,s,r,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[r]},e!==null&&(e=uf(e),e!==null&&nI(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function yB(t,e,n,s,r){switch(e){case"focusin":return Ba=Rd(Ba,t,e,n,s,r),!0;case"dragenter":return Ua=Rd(Ua,t,e,n,s,r),!0;case"mouseover":return Wa=Rd(Wa,t,e,n,s,r),!0;case"pointerover":var i=r.pointerId;return bp.set(i,Rd(bp.get(i)||null,t,e,n,s,r)),!0;case"gotpointercapture":return i=r.pointerId,Ip.set(i,Rd(Ip.get(i)||null,t,e,n,s,r)),!0}return!1}function i3(t){var e=ru(t.target);if(e!==null){var n=Ku(e);if(n!==null){if(e=n.tag,e===13){if(e=qA(n),e!==null){t.blockedOn=e,r3(t.priority,function(){n3(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Hg(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=qx(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);Bx=s,n.target.dispatchEvent(s),Bx=null}else return e=uf(n),e!==null&&nI(e),t.blockedOn=n,!1;e.shift()}return!0}function tE(t,e,n){Hg(t)&&n.delete(e)}function vB(){Hx=!1,Ba!==null&&Hg(Ba)&&(Ba=null),Ua!==null&&Hg(Ua)&&(Ua=null),Wa!==null&&Hg(Wa)&&(Wa=null),bp.forEach(tE),Ip.forEach(tE)}function Dd(t,e){t.blockedOn===e&&(t.blockedOn=null,Hx||(Hx=!0,Pr.unstable_scheduleCallback(Pr.unstable_NormalPriority,vB)))}function Sp(t){function e(r){return Dd(r,t)}if(0<dg.length){Dd(dg[0],t);for(var n=1;n<dg.length;n++){var s=dg[n];s.blockedOn===t&&(s.blockedOn=null)}}for(Ba!==null&&Dd(Ba,t),Ua!==null&&Dd(Ua,t),Wa!==null&&Dd(Wa,t),bp.forEach(e),Ip.forEach(e),n=0;n<$a.length;n++)s=$a[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<$a.length&&(n=$a[0],n.blockedOn===null);)i3(n),n.blockedOn===null&&$a.shift()}var Qc=la.ReactCurrentBatchConfig,xy=!0;function wB(t,e,n,s){var r=Rt,i=Qc.transition;Qc.transition=null;try{Rt=1,sI(t,e,n,s)}finally{Rt=r,Qc.transition=i}}function xB(t,e,n,s){var r=Rt,i=Qc.transition;Qc.transition=null;try{Rt=4,sI(t,e,n,s)}finally{Rt=r,Qc.transition=i}}function sI(t,e,n,s){if(xy){var r=qx(t,e,n,s);if(r===null)Pw(t,e,s,by,n),eE(t,s);else if(yB(r,t,e,n,s))s.stopPropagation();else if(eE(t,s),e&4&&-1<gB.indexOf(t)){for(;r!==null;){var i=uf(r);if(i!==null&&t3(i),i=qx(t,e,n,s),i===null&&Pw(t,e,s,by,n),i===r)break;r=i}r!==null&&s.stopPropagation()}else Pw(t,e,s,null,n)}}var by=null;function qx(t,e,n,s){if(by=null,t=Zb(s),t=ru(t),t!==null)if(e=Ku(t),e===null)t=null;else if(n=e.tag,n===13){if(t=qA(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return by=t,null}function o3(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(aB()){case eI:return 1;case QA:return 4;case vy:case lB:return 16;case JA:return 536870912;default:return 16}default:return 16}}var Fa=null,rI=null,qg=null;function a3(){if(qg)return qg;var t,e=rI,n=e.length,s,r="value"in Fa?Fa.value:Fa.textContent,i=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(s=1;s<=o&&e[n-s]===r[i-s];s++);return qg=r.slice(t,1<s?1-s:void 0)}function Kg(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function pg(){return!0}function nE(){return!1}function Vr(t){function e(n,s,r,i,o){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?pg:nE,this.isPropagationStopped=nE,this}return dn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=pg)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=pg)},persist:function(){},isPersistent:pg}),e}var Mh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},iI=Vr(Mh),lf=dn({},Mh,{view:0,detail:0}),bB=Vr(lf),kw,Ew,Od,B1=dn({},lf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:oI,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Od&&(Od&&t.type==="mousemove"?(kw=t.screenX-Od.screenX,Ew=t.screenY-Od.screenY):Ew=kw=0,Od=t),kw)},movementY:function(t){return"movementY"in t?t.movementY:Ew}}),sE=Vr(B1),IB=dn({},B1,{dataTransfer:0}),SB=Vr(IB),TB=dn({},lf,{relatedTarget:0}),_w=Vr(TB),CB=dn({},Mh,{animationName:0,elapsedTime:0,pseudoElement:0}),kB=Vr(CB),EB=dn({},Mh,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),_B=Vr(EB),NB=dn({},Mh,{data:0}),rE=Vr(NB),$B={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},AB={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},RB={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function DB(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=RB[t])?!!e[t]:!1}function oI(){return DB}var OB=dn({},lf,{key:function(t){if(t.key){var e=$B[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Kg(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?AB[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:oI,charCode:function(t){return t.type==="keypress"?Kg(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Kg(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),PB=Vr(OB),FB=dn({},B1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),iE=Vr(FB),LB=dn({},lf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:oI}),MB=Vr(LB),VB=dn({},Mh,{propertyName:0,elapsedTime:0,pseudoElement:0}),zB=Vr(VB),BB=dn({},B1,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),UB=Vr(BB),WB=[9,13,27,32],aI=Yo&&"CompositionEvent"in window,rp=null;Yo&&"documentMode"in document&&(rp=document.documentMode);var jB=Yo&&"TextEvent"in window&&!rp,l3=Yo&&(!aI||rp&&8<rp&&11>=rp),oE=" ",aE=!1;function u3(t,e){switch(t){case"keyup":return WB.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function c3(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Fc=!1;function GB(t,e){switch(t){case"compositionend":return c3(e);case"keypress":return e.which!==32?null:(aE=!0,oE);case"textInput":return t=e.data,t===oE&&aE?null:t;default:return null}}function HB(t,e){if(Fc)return t==="compositionend"||!aI&&u3(t,e)?(t=a3(),qg=rI=Fa=null,Fc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return l3&&e.locale!=="ko"?null:e.data;default:return null}}var qB={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function lE(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!qB[t.type]:e==="textarea"}function h3(t,e,n,s){UA(s),e=Iy(e,"onChange"),0<e.length&&(n=new iI("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var ip=null,Tp=null;function KB(t){I3(t,0)}function U1(t){var e=Vc(t);if(PA(e))return t}function XB(t,e){if(t==="change")return e}var d3=!1;if(Yo){var Nw;if(Yo){var $w="oninput"in document;if(!$w){var uE=document.createElement("div");uE.setAttribute("oninput","return;"),$w=typeof uE.oninput=="function"}Nw=$w}else Nw=!1;d3=Nw&&(!document.documentMode||9<document.documentMode)}function cE(){ip&&(ip.detachEvent("onpropertychange",p3),Tp=ip=null)}function p3(t){if(t.propertyName==="value"&&U1(Tp)){var e=[];h3(e,Tp,t,Zb(t)),HA(KB,e)}}function YB(t,e,n){t==="focusin"?(cE(),ip=e,Tp=n,ip.attachEvent("onpropertychange",p3)):t==="focusout"&&cE()}function QB(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return U1(Tp)}function JB(t,e){if(t==="click")return U1(e)}function ZB(t,e){if(t==="input"||t==="change")return U1(e)}function e5(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var zi=typeof Object.is=="function"?Object.is:e5;function Cp(t,e){if(zi(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!Nx.call(e,r)||!zi(t[r],e[r]))return!1}return!0}function hE(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function dE(t,e){var n=hE(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=hE(n)}}function f3(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?f3(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function m3(){for(var t=window,e=my();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=my(t.document)}return e}function lI(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function t5(t){var e=m3(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&f3(n.ownerDocument.documentElement,n)){if(s!==null&&lI(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,i=Math.min(s.start,r);s=s.end===void 0?i:Math.min(s.end,r),!t.extend&&i>s&&(r=s,s=i,i=r),r=dE(n,i);var o=dE(n,s);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),i>s?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var n5=Yo&&"documentMode"in document&&11>=document.documentMode,Lc=null,Kx=null,op=null,Xx=!1;function pE(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Xx||Lc==null||Lc!==my(s)||(s=Lc,"selectionStart"in s&&lI(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),op&&Cp(op,s)||(op=s,s=Iy(Kx,"onSelect"),0<s.length&&(e=new iI("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=Lc)))}function fg(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Mc={animationend:fg("Animation","AnimationEnd"),animationiteration:fg("Animation","AnimationIteration"),animationstart:fg("Animation","AnimationStart"),transitionend:fg("Transition","TransitionEnd")},Aw={},g3={};Yo&&(g3=document.createElement("div").style,"AnimationEvent"in window||(delete Mc.animationend.animation,delete Mc.animationiteration.animation,delete Mc.animationstart.animation),"TransitionEvent"in window||delete Mc.transitionend.transition);function W1(t){if(Aw[t])return Aw[t];if(!Mc[t])return t;var e=Mc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in g3)return Aw[t]=e[n];return t}var y3=W1("animationend"),v3=W1("animationiteration"),w3=W1("animationstart"),x3=W1("transitionend"),b3=new Map,fE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wl(t,e){b3.set(t,e),qu(e,[t])}for(var Rw=0;Rw<fE.length;Rw++){var Dw=fE[Rw],s5=Dw.toLowerCase(),r5=Dw[0].toUpperCase()+Dw.slice(1);wl(s5,"on"+r5)}wl(y3,"onAnimationEnd");wl(v3,"onAnimationIteration");wl(w3,"onAnimationStart");wl("dblclick","onDoubleClick");wl("focusin","onFocus");wl("focusout","onBlur");wl(x3,"onTransitionEnd");hh("onMouseEnter",["mouseout","mouseover"]);hh("onMouseLeave",["mouseout","mouseover"]);hh("onPointerEnter",["pointerout","pointerover"]);hh("onPointerLeave",["pointerout","pointerover"]);qu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));qu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));qu("onBeforeInput",["compositionend","keypress","textInput","paste"]);qu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));qu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));qu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),i5=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hd));function mE(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,sB(s,e,void 0,t),t.currentTarget=null}function I3(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],r=s.event;s=s.listeners;e:{var i=void 0;if(e)for(var o=s.length-1;0<=o;o--){var a=s[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&r.isPropagationStopped())break e;mE(r,a,u),i=l}else for(o=0;o<s.length;o++){if(a=s[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&r.isPropagationStopped())break e;mE(r,a,u),i=l}}}if(yy)throw t=jx,yy=!1,jx=null,t}function Yt(t,e){var n=e[e2];n===void 0&&(n=e[e2]=new Set);var s=t+"__bubble";n.has(s)||(S3(e,t,2,!1),n.add(s))}function Ow(t,e,n){var s=0;e&&(s|=4),S3(n,t,s,e)}var mg="_reactListening"+Math.random().toString(36).slice(2);function kp(t){if(!t[mg]){t[mg]=!0,$A.forEach(function(n){n!=="selectionchange"&&(i5.has(n)||Ow(n,!1,t),Ow(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[mg]||(e[mg]=!0,Ow("selectionchange",!1,e))}}function S3(t,e,n,s){switch(o3(e)){case 1:var r=wB;break;case 4:r=xB;break;default:r=sI}n=r.bind(null,e,n,t),r=void 0,!Wx||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Pw(t,e,n,s,r){var i=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var a=s.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=s.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=ru(a),o===null)return;if(l=o.tag,l===5||l===6){s=i=o;continue e}a=a.parentNode}}s=s.return}HA(function(){var u=i,c=Zb(n),h=[];e:{var d=b3.get(t);if(d!==void 0){var p=iI,f=t;switch(t){case"keypress":if(Kg(n)===0)break e;case"keydown":case"keyup":p=PB;break;case"focusin":f="focus",p=_w;break;case"focusout":f="blur",p=_w;break;case"beforeblur":case"afterblur":p=_w;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=sE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=SB;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=MB;break;case y3:case v3:case w3:p=kB;break;case x3:p=zB;break;case"scroll":p=bB;break;case"wheel":p=UB;break;case"copy":case"cut":case"paste":p=_B;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=iE}var m=(e&4)!==0,v=!m&&t==="scroll",y=m?d!==null?d+"Capture":null:d;m=[];for(var w=u,b;w!==null;){b=w;var I=b.stateNode;if(b.tag===5&&I!==null&&(b=I,y!==null&&(I=xp(w,y),I!=null&&m.push(Ep(w,I,b)))),v)break;w=w.return}0<m.length&&(d=new p(d,f,null,n,c),h.push({event:d,listeners:m}))}}if(!(e&7)){e:{if(d=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",d&&n!==Bx&&(f=n.relatedTarget||n.fromElement)&&(ru(f)||f[Qo]))break e;if((p||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,p?(f=n.relatedTarget||n.toElement,p=u,f=f?ru(f):null,f!==null&&(v=Ku(f),f!==v||f.tag!==5&&f.tag!==6)&&(f=null)):(p=null,f=u),p!==f)){if(m=sE,I="onMouseLeave",y="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(m=iE,I="onPointerLeave",y="onPointerEnter",w="pointer"),v=p==null?d:Vc(p),b=f==null?d:Vc(f),d=new m(I,w+"leave",p,n,c),d.target=v,d.relatedTarget=b,I=null,ru(c)===u&&(m=new m(y,w+"enter",f,n,c),m.target=b,m.relatedTarget=v,I=m),v=I,p&&f)t:{for(m=p,y=f,w=0,b=m;b;b=Tc(b))w++;for(b=0,I=y;I;I=Tc(I))b++;for(;0<w-b;)m=Tc(m),w--;for(;0<b-w;)y=Tc(y),b--;for(;w--;){if(m===y||y!==null&&m===y.alternate)break t;m=Tc(m),y=Tc(y)}m=null}else m=null;p!==null&&gE(h,d,p,m,!1),f!==null&&v!==null&&gE(h,v,f,m,!0)}}e:{if(d=u?Vc(u):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var k=XB;else if(lE(d))if(d3)k=ZB;else{k=QB;var R=YB}else(p=d.nodeName)&&p.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(k=JB);if(k&&(k=k(t,u))){h3(h,k,n,c);break e}R&&R(t,d,u),t==="focusout"&&(R=d._wrapperState)&&R.controlled&&d.type==="number"&&Fx(d,"number",d.value)}switch(R=u?Vc(u):window,t){case"focusin":(lE(R)||R.contentEditable==="true")&&(Lc=R,Kx=u,op=null);break;case"focusout":op=Kx=Lc=null;break;case"mousedown":Xx=!0;break;case"contextmenu":case"mouseup":case"dragend":Xx=!1,pE(h,n,c);break;case"selectionchange":if(n5)break;case"keydown":case"keyup":pE(h,n,c)}var C;if(aI)e:{switch(t){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else Fc?u3(t,n)&&(T="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(T="onCompositionStart");T&&(l3&&n.locale!=="ko"&&(Fc||T!=="onCompositionStart"?T==="onCompositionEnd"&&Fc&&(C=a3()):(Fa=c,rI="value"in Fa?Fa.value:Fa.textContent,Fc=!0)),R=Iy(u,T),0<R.length&&(T=new rE(T,t,null,n,c),h.push({event:T,listeners:R}),C?T.data=C:(C=c3(n),C!==null&&(T.data=C)))),(C=jB?GB(t,n):HB(t,n))&&(u=Iy(u,"onBeforeInput"),0<u.length&&(c=new rE("onBeforeInput","beforeinput",null,n,c),h.push({event:c,listeners:u}),c.data=C))}I3(h,e)})}function Ep(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Iy(t,e){for(var n=e+"Capture",s=[];t!==null;){var r=t,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=xp(t,n),i!=null&&s.unshift(Ep(t,i,r)),i=xp(t,e),i!=null&&s.push(Ep(t,i,r))),t=t.return}return s}function Tc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function gE(t,e,n,s,r){for(var i=e._reactName,o=[];n!==null&&n!==s;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===s)break;a.tag===5&&u!==null&&(a=u,r?(l=xp(n,i),l!=null&&o.unshift(Ep(n,l,a))):r||(l=xp(n,i),l!=null&&o.push(Ep(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var o5=/\r\n?/g,a5=/\u0000|\uFFFD/g;function yE(t){return(typeof t=="string"?t:""+t).replace(o5,`
`).replace(a5,"")}function gg(t,e,n){if(e=yE(e),yE(t)!==e&&n)throw Error(we(425))}function Sy(){}var Yx=null,Qx=null;function Jx(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Zx=typeof setTimeout=="function"?setTimeout:void 0,l5=typeof clearTimeout=="function"?clearTimeout:void 0,vE=typeof Promise=="function"?Promise:void 0,u5=typeof queueMicrotask=="function"?queueMicrotask:typeof vE<"u"?function(t){return vE.resolve(null).then(t).catch(c5)}:Zx;function c5(t){setTimeout(function(){throw t})}function Fw(t,e){var n=e,s=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){t.removeChild(r),Sp(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);Sp(e)}function ja(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function wE(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Vh=Math.random().toString(36).slice(2),po="__reactFiber$"+Vh,_p="__reactProps$"+Vh,Qo="__reactContainer$"+Vh,e2="__reactEvents$"+Vh,h5="__reactListeners$"+Vh,d5="__reactHandles$"+Vh;function ru(t){var e=t[po];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Qo]||n[po]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=wE(t);t!==null;){if(n=t[po])return n;t=wE(t)}return e}t=n,n=t.parentNode}return null}function uf(t){return t=t[po]||t[Qo],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Vc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(we(33))}function j1(t){return t[_p]||null}var t2=[],zc=-1;function xl(t){return{current:t}}function Qt(t){0>zc||(t.current=t2[zc],t2[zc]=null,zc--)}function jt(t,e){zc++,t2[zc]=t.current,t.current=e}var nl={},Ds=xl(nl),dr=xl(!1),wu=nl;function dh(t,e){var n=t.type.contextTypes;if(!n)return nl;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in n)r[i]=e[i];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function pr(t){return t=t.childContextTypes,t!=null}function Ty(){Qt(dr),Qt(Ds)}function xE(t,e,n){if(Ds.current!==nl)throw Error(we(168));jt(Ds,e),jt(dr,n)}function T3(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error(we(108,Yz(t)||"Unknown",r));return dn({},n,s)}function Cy(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||nl,wu=Ds.current,jt(Ds,t),jt(dr,dr.current),!0}function bE(t,e,n){var s=t.stateNode;if(!s)throw Error(we(169));n?(t=T3(t,e,wu),s.__reactInternalMemoizedMergedChildContext=t,Qt(dr),Qt(Ds),jt(Ds,t)):Qt(dr),jt(dr,n)}var Po=null,G1=!1,Lw=!1;function C3(t){Po===null?Po=[t]:Po.push(t)}function p5(t){G1=!0,C3(t)}function bl(){if(!Lw&&Po!==null){Lw=!0;var t=0,e=Rt;try{var n=Po;for(Rt=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}Po=null,G1=!1}catch(r){throw Po!==null&&(Po=Po.slice(t+1)),YA(eI,bl),r}finally{Rt=e,Lw=!1}}return null}var Bc=[],Uc=0,ky=null,Ey=0,qr=[],Kr=0,xu=null,zo=1,Bo="";function Yl(t,e){Bc[Uc++]=Ey,Bc[Uc++]=ky,ky=t,Ey=e}function k3(t,e,n){qr[Kr++]=zo,qr[Kr++]=Bo,qr[Kr++]=xu,xu=t;var s=zo;t=Bo;var r=32-Pi(s)-1;s&=~(1<<r),n+=1;var i=32-Pi(e)+r;if(30<i){var o=r-r%5;i=(s&(1<<o)-1).toString(32),s>>=o,r-=o,zo=1<<32-Pi(e)+r|n<<r|s,Bo=i+t}else zo=1<<i|n<<r|s,Bo=t}function uI(t){t.return!==null&&(Yl(t,1),k3(t,1,0))}function cI(t){for(;t===ky;)ky=Bc[--Uc],Bc[Uc]=null,Ey=Bc[--Uc],Bc[Uc]=null;for(;t===xu;)xu=qr[--Kr],qr[Kr]=null,Bo=qr[--Kr],qr[Kr]=null,zo=qr[--Kr],qr[Kr]=null}var Dr=null,$r=null,sn=!1,Ei=null;function E3(t,e){var n=Qr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function IE(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Dr=t,$r=ja(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Dr=t,$r=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=xu!==null?{id:zo,overflow:Bo}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Qr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Dr=t,$r=null,!0):!1;default:return!1}}function n2(t){return(t.mode&1)!==0&&(t.flags&128)===0}function s2(t){if(sn){var e=$r;if(e){var n=e;if(!IE(t,e)){if(n2(t))throw Error(we(418));e=ja(n.nextSibling);var s=Dr;e&&IE(t,e)?E3(s,n):(t.flags=t.flags&-4097|2,sn=!1,Dr=t)}}else{if(n2(t))throw Error(we(418));t.flags=t.flags&-4097|2,sn=!1,Dr=t}}}function SE(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Dr=t}function yg(t){if(t!==Dr)return!1;if(!sn)return SE(t),sn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Jx(t.type,t.memoizedProps)),e&&(e=$r)){if(n2(t))throw _3(),Error(we(418));for(;e;)E3(t,e),e=ja(e.nextSibling)}if(SE(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(we(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){$r=ja(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}$r=null}}else $r=Dr?ja(t.stateNode.nextSibling):null;return!0}function _3(){for(var t=$r;t;)t=ja(t.nextSibling)}function ph(){$r=Dr=null,sn=!1}function hI(t){Ei===null?Ei=[t]:Ei.push(t)}var f5=la.ReactCurrentBatchConfig;function Pd(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(we(309));var s=n.stateNode}if(!s)throw Error(we(147,t));var r=s,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=r.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(we(284));if(!n._owner)throw Error(we(290,t))}return t}function vg(t,e){throw t=Object.prototype.toString.call(e),Error(we(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function TE(t){var e=t._init;return e(t._payload)}function N3(t){function e(y,w){if(t){var b=y.deletions;b===null?(y.deletions=[w],y.flags|=16):b.push(w)}}function n(y,w){if(!t)return null;for(;w!==null;)e(y,w),w=w.sibling;return null}function s(y,w){for(y=new Map;w!==null;)w.key!==null?y.set(w.key,w):y.set(w.index,w),w=w.sibling;return y}function r(y,w){return y=Ka(y,w),y.index=0,y.sibling=null,y}function i(y,w,b){return y.index=b,t?(b=y.alternate,b!==null?(b=b.index,b<w?(y.flags|=2,w):b):(y.flags|=2,w)):(y.flags|=1048576,w)}function o(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,w,b,I){return w===null||w.tag!==6?(w=jw(b,y.mode,I),w.return=y,w):(w=r(w,b),w.return=y,w)}function l(y,w,b,I){var k=b.type;return k===Pc?c(y,w,b.props.children,I,b.key):w!==null&&(w.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Ea&&TE(k)===w.type)?(I=r(w,b.props),I.ref=Pd(y,w,b),I.return=y,I):(I=ty(b.type,b.key,b.props,null,y.mode,I),I.ref=Pd(y,w,b),I.return=y,I)}function u(y,w,b,I){return w===null||w.tag!==4||w.stateNode.containerInfo!==b.containerInfo||w.stateNode.implementation!==b.implementation?(w=Gw(b,y.mode,I),w.return=y,w):(w=r(w,b.children||[]),w.return=y,w)}function c(y,w,b,I,k){return w===null||w.tag!==7?(w=pu(b,y.mode,I,k),w.return=y,w):(w=r(w,b),w.return=y,w)}function h(y,w,b){if(typeof w=="string"&&w!==""||typeof w=="number")return w=jw(""+w,y.mode,b),w.return=y,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case ag:return b=ty(w.type,w.key,w.props,null,y.mode,b),b.ref=Pd(y,null,w),b.return=y,b;case Oc:return w=Gw(w,y.mode,b),w.return=y,w;case Ea:var I=w._init;return h(y,I(w._payload),b)}if(jd(w)||$d(w))return w=pu(w,y.mode,b,null),w.return=y,w;vg(y,w)}return null}function d(y,w,b,I){var k=w!==null?w.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return k!==null?null:a(y,w,""+b,I);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case ag:return b.key===k?l(y,w,b,I):null;case Oc:return b.key===k?u(y,w,b,I):null;case Ea:return k=b._init,d(y,w,k(b._payload),I)}if(jd(b)||$d(b))return k!==null?null:c(y,w,b,I,null);vg(y,b)}return null}function p(y,w,b,I,k){if(typeof I=="string"&&I!==""||typeof I=="number")return y=y.get(b)||null,a(w,y,""+I,k);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case ag:return y=y.get(I.key===null?b:I.key)||null,l(w,y,I,k);case Oc:return y=y.get(I.key===null?b:I.key)||null,u(w,y,I,k);case Ea:var R=I._init;return p(y,w,b,R(I._payload),k)}if(jd(I)||$d(I))return y=y.get(b)||null,c(w,y,I,k,null);vg(w,I)}return null}function f(y,w,b,I){for(var k=null,R=null,C=w,T=w=0,N=null;C!==null&&T<b.length;T++){C.index>T?(N=C,C=null):N=C.sibling;var $=d(y,C,b[T],I);if($===null){C===null&&(C=N);break}t&&C&&$.alternate===null&&e(y,C),w=i($,w,T),R===null?k=$:R.sibling=$,R=$,C=N}if(T===b.length)return n(y,C),sn&&Yl(y,T),k;if(C===null){for(;T<b.length;T++)C=h(y,b[T],I),C!==null&&(w=i(C,w,T),R===null?k=C:R.sibling=C,R=C);return sn&&Yl(y,T),k}for(C=s(y,C);T<b.length;T++)N=p(C,y,T,b[T],I),N!==null&&(t&&N.alternate!==null&&C.delete(N.key===null?T:N.key),w=i(N,w,T),R===null?k=N:R.sibling=N,R=N);return t&&C.forEach(function(P){return e(y,P)}),sn&&Yl(y,T),k}function m(y,w,b,I){var k=$d(b);if(typeof k!="function")throw Error(we(150));if(b=k.call(b),b==null)throw Error(we(151));for(var R=k=null,C=w,T=w=0,N=null,$=b.next();C!==null&&!$.done;T++,$=b.next()){C.index>T?(N=C,C=null):N=C.sibling;var P=d(y,C,$.value,I);if(P===null){C===null&&(C=N);break}t&&C&&P.alternate===null&&e(y,C),w=i(P,w,T),R===null?k=P:R.sibling=P,R=P,C=N}if($.done)return n(y,C),sn&&Yl(y,T),k;if(C===null){for(;!$.done;T++,$=b.next())$=h(y,$.value,I),$!==null&&(w=i($,w,T),R===null?k=$:R.sibling=$,R=$);return sn&&Yl(y,T),k}for(C=s(y,C);!$.done;T++,$=b.next())$=p(C,y,T,$.value,I),$!==null&&(t&&$.alternate!==null&&C.delete($.key===null?T:$.key),w=i($,w,T),R===null?k=$:R.sibling=$,R=$);return t&&C.forEach(function(V){return e(y,V)}),sn&&Yl(y,T),k}function v(y,w,b,I){if(typeof b=="object"&&b!==null&&b.type===Pc&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case ag:e:{for(var k=b.key,R=w;R!==null;){if(R.key===k){if(k=b.type,k===Pc){if(R.tag===7){n(y,R.sibling),w=r(R,b.props.children),w.return=y,y=w;break e}}else if(R.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Ea&&TE(k)===R.type){n(y,R.sibling),w=r(R,b.props),w.ref=Pd(y,R,b),w.return=y,y=w;break e}n(y,R);break}else e(y,R);R=R.sibling}b.type===Pc?(w=pu(b.props.children,y.mode,I,b.key),w.return=y,y=w):(I=ty(b.type,b.key,b.props,null,y.mode,I),I.ref=Pd(y,w,b),I.return=y,y=I)}return o(y);case Oc:e:{for(R=b.key;w!==null;){if(w.key===R)if(w.tag===4&&w.stateNode.containerInfo===b.containerInfo&&w.stateNode.implementation===b.implementation){n(y,w.sibling),w=r(w,b.children||[]),w.return=y,y=w;break e}else{n(y,w);break}else e(y,w);w=w.sibling}w=Gw(b,y.mode,I),w.return=y,y=w}return o(y);case Ea:return R=b._init,v(y,w,R(b._payload),I)}if(jd(b))return f(y,w,b,I);if($d(b))return m(y,w,b,I);vg(y,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,w!==null&&w.tag===6?(n(y,w.sibling),w=r(w,b),w.return=y,y=w):(n(y,w),w=jw(b,y.mode,I),w.return=y,y=w),o(y)):n(y,w)}return v}var fh=N3(!0),$3=N3(!1),_y=xl(null),Ny=null,Wc=null,dI=null;function pI(){dI=Wc=Ny=null}function fI(t){var e=_y.current;Qt(_y),t._currentValue=e}function r2(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function Jc(t,e){Ny=t,dI=Wc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(ur=!0),t.firstContext=null)}function li(t){var e=t._currentValue;if(dI!==t)if(t={context:t,memoizedValue:e,next:null},Wc===null){if(Ny===null)throw Error(we(308));Wc=t,Ny.dependencies={lanes:0,firstContext:t}}else Wc=Wc.next=t;return e}var iu=null;function mI(t){iu===null?iu=[t]:iu.push(t)}function A3(t,e,n,s){var r=e.interleaved;return r===null?(n.next=n,mI(e)):(n.next=r.next,r.next=n),e.interleaved=n,Jo(t,s)}function Jo(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var _a=!1;function gI(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function R3(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function jo(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ga(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,bt&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,Jo(t,n)}return r=s.interleaved,r===null?(e.next=e,mI(s)):(e.next=r.next,r.next=e),s.interleaved=e,Jo(t,n)}function Xg(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,tI(t,n)}}function CE(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?r=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?r=i=e:i=i.next=e}else r=i=e;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function $y(t,e,n,s){var r=t.updateQueue;_a=!1;var i=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var c=t.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(i!==null){var h=r.baseState;o=0,c=u=l=null,a=i;do{var d=a.lane,p=a.eventTime;if((s&d)===d){c!==null&&(c=c.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=t,m=a;switch(d=e,p=n,m.tag){case 1:if(f=m.payload,typeof f=="function"){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=m.payload,d=typeof f=="function"?f.call(p,h,d):f,d==null)break e;h=dn({},h,d);break e;case 2:_a=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,d=r.effects,d===null?r.effects=[a]:d.push(a))}else p={eventTime:p,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=p,l=h):c=c.next=p,o|=d;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;d=a,a=d.next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}while(!0);if(c===null&&(l=h),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else i===null&&(r.shared.lanes=0);Iu|=o,t.lanes=o,t.memoizedState=h}}function kE(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(we(191,r));r.call(s)}}}var cf={},go=xl(cf),Np=xl(cf),$p=xl(cf);function ou(t){if(t===cf)throw Error(we(174));return t}function yI(t,e){switch(jt($p,e),jt(Np,t),jt(go,cf),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Mx(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Mx(e,t)}Qt(go),jt(go,e)}function mh(){Qt(go),Qt(Np),Qt($p)}function D3(t){ou($p.current);var e=ou(go.current),n=Mx(e,t.type);e!==n&&(jt(Np,t),jt(go,n))}function vI(t){Np.current===t&&(Qt(go),Qt(Np))}var ln=xl(0);function Ay(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Mw=[];function wI(){for(var t=0;t<Mw.length;t++)Mw[t]._workInProgressVersionPrimary=null;Mw.length=0}var Yg=la.ReactCurrentDispatcher,Vw=la.ReactCurrentBatchConfig,bu=0,cn=null,Vn=null,Kn=null,Ry=!1,ap=!1,Ap=0,m5=0;function Ts(){throw Error(we(321))}function xI(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!zi(t[n],e[n]))return!1;return!0}function bI(t,e,n,s,r,i){if(bu=i,cn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Yg.current=t===null||t.memoizedState===null?w5:x5,t=n(s,r),ap){i=0;do{if(ap=!1,Ap=0,25<=i)throw Error(we(301));i+=1,Kn=Vn=null,e.updateQueue=null,Yg.current=b5,t=n(s,r)}while(ap)}if(Yg.current=Dy,e=Vn!==null&&Vn.next!==null,bu=0,Kn=Vn=cn=null,Ry=!1,e)throw Error(we(300));return t}function II(){var t=Ap!==0;return Ap=0,t}function oo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Kn===null?cn.memoizedState=Kn=t:Kn=Kn.next=t,Kn}function ui(){if(Vn===null){var t=cn.alternate;t=t!==null?t.memoizedState:null}else t=Vn.next;var e=Kn===null?cn.memoizedState:Kn.next;if(e!==null)Kn=e,Vn=t;else{if(t===null)throw Error(we(310));Vn=t,t={memoizedState:Vn.memoizedState,baseState:Vn.baseState,baseQueue:Vn.baseQueue,queue:Vn.queue,next:null},Kn===null?cn.memoizedState=Kn=t:Kn=Kn.next=t}return Kn}function Rp(t,e){return typeof e=="function"?e(t):e}function zw(t){var e=ui(),n=e.queue;if(n===null)throw Error(we(311));n.lastRenderedReducer=t;var s=Vn,r=s.baseQueue,i=n.pending;if(i!==null){if(r!==null){var o=r.next;r.next=i.next,i.next=o}s.baseQueue=r=i,n.pending=null}if(r!==null){i=r.next,s=s.baseState;var a=o=null,l=null,u=i;do{var c=u.lane;if((bu&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:t(s,u.action);else{var h={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=h,o=s):l=l.next=h,cn.lanes|=c,Iu|=c}u=u.next}while(u!==null&&u!==i);l===null?o=s:l.next=a,zi(s,e.memoizedState)||(ur=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=l,n.lastRenderedState=s}if(t=n.interleaved,t!==null){r=t;do i=r.lane,cn.lanes|=i,Iu|=i,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Bw(t){var e=ui(),n=e.queue;if(n===null)throw Error(we(311));n.lastRenderedReducer=t;var s=n.dispatch,r=n.pending,i=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do i=t(i,o.action),o=o.next;while(o!==r);zi(i,e.memoizedState)||(ur=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,s]}function O3(){}function P3(t,e){var n=cn,s=ui(),r=e(),i=!zi(s.memoizedState,r);if(i&&(s.memoizedState=r,ur=!0),s=s.queue,SI(M3.bind(null,n,s,t),[t]),s.getSnapshot!==e||i||Kn!==null&&Kn.memoizedState.tag&1){if(n.flags|=2048,Dp(9,L3.bind(null,n,s,r,e),void 0,null),Zn===null)throw Error(we(349));bu&30||F3(n,e,r)}return r}function F3(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=cn.updateQueue,e===null?(e={lastEffect:null,stores:null},cn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function L3(t,e,n,s){e.value=n,e.getSnapshot=s,V3(e)&&z3(t)}function M3(t,e,n){return n(function(){V3(e)&&z3(t)})}function V3(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!zi(t,n)}catch{return!0}}function z3(t){var e=Jo(t,1);e!==null&&Fi(e,t,1,-1)}function EE(t){var e=oo();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Rp,lastRenderedState:t},e.queue=t,t=t.dispatch=v5.bind(null,cn,t),[e.memoizedState,t]}function Dp(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=cn.updateQueue,e===null?(e={lastEffect:null,stores:null},cn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function B3(){return ui().memoizedState}function Qg(t,e,n,s){var r=oo();cn.flags|=t,r.memoizedState=Dp(1|e,n,void 0,s===void 0?null:s)}function H1(t,e,n,s){var r=ui();s=s===void 0?null:s;var i=void 0;if(Vn!==null){var o=Vn.memoizedState;if(i=o.destroy,s!==null&&xI(s,o.deps)){r.memoizedState=Dp(e,n,i,s);return}}cn.flags|=t,r.memoizedState=Dp(1|e,n,i,s)}function _E(t,e){return Qg(8390656,8,t,e)}function SI(t,e){return H1(2048,8,t,e)}function U3(t,e){return H1(4,2,t,e)}function W3(t,e){return H1(4,4,t,e)}function j3(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function G3(t,e,n){return n=n!=null?n.concat([t]):null,H1(4,4,j3.bind(null,e,t),n)}function TI(){}function H3(t,e){var n=ui();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&xI(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function q3(t,e){var n=ui();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&xI(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function K3(t,e,n){return bu&21?(zi(n,e)||(n=ZA(),cn.lanes|=n,Iu|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,ur=!0),t.memoizedState=n)}function g5(t,e){var n=Rt;Rt=n!==0&&4>n?n:4,t(!0);var s=Vw.transition;Vw.transition={};try{t(!1),e()}finally{Rt=n,Vw.transition=s}}function X3(){return ui().memoizedState}function y5(t,e,n){var s=qa(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},Y3(t))Q3(e,n);else if(n=A3(t,e,n,s),n!==null){var r=Ks();Fi(n,t,s,r),J3(n,e,s)}}function v5(t,e,n){var s=qa(t),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(Y3(t))Q3(e,r);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(r.hasEagerState=!0,r.eagerState=a,zi(a,o)){var l=e.interleaved;l===null?(r.next=r,mI(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=A3(t,e,r,s),n!==null&&(r=Ks(),Fi(n,t,s,r),J3(n,e,s))}}function Y3(t){var e=t.alternate;return t===cn||e!==null&&e===cn}function Q3(t,e){ap=Ry=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function J3(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,tI(t,n)}}var Dy={readContext:li,useCallback:Ts,useContext:Ts,useEffect:Ts,useImperativeHandle:Ts,useInsertionEffect:Ts,useLayoutEffect:Ts,useMemo:Ts,useReducer:Ts,useRef:Ts,useState:Ts,useDebugValue:Ts,useDeferredValue:Ts,useTransition:Ts,useMutableSource:Ts,useSyncExternalStore:Ts,useId:Ts,unstable_isNewReconciler:!1},w5={readContext:li,useCallback:function(t,e){return oo().memoizedState=[t,e===void 0?null:e],t},useContext:li,useEffect:_E,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Qg(4194308,4,j3.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Qg(4194308,4,t,e)},useInsertionEffect:function(t,e){return Qg(4,2,t,e)},useMemo:function(t,e){var n=oo();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=oo();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=y5.bind(null,cn,t),[s.memoizedState,t]},useRef:function(t){var e=oo();return t={current:t},e.memoizedState=t},useState:EE,useDebugValue:TI,useDeferredValue:function(t){return oo().memoizedState=t},useTransition:function(){var t=EE(!1),e=t[0];return t=g5.bind(null,t[1]),oo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=cn,r=oo();if(sn){if(n===void 0)throw Error(we(407));n=n()}else{if(n=e(),Zn===null)throw Error(we(349));bu&30||F3(s,e,n)}r.memoizedState=n;var i={value:n,getSnapshot:e};return r.queue=i,_E(M3.bind(null,s,i,t),[t]),s.flags|=2048,Dp(9,L3.bind(null,s,i,n,e),void 0,null),n},useId:function(){var t=oo(),e=Zn.identifierPrefix;if(sn){var n=Bo,s=zo;n=(s&~(1<<32-Pi(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=Ap++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=m5++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},x5={readContext:li,useCallback:H3,useContext:li,useEffect:SI,useImperativeHandle:G3,useInsertionEffect:U3,useLayoutEffect:W3,useMemo:q3,useReducer:zw,useRef:B3,useState:function(){return zw(Rp)},useDebugValue:TI,useDeferredValue:function(t){var e=ui();return K3(e,Vn.memoizedState,t)},useTransition:function(){var t=zw(Rp)[0],e=ui().memoizedState;return[t,e]},useMutableSource:O3,useSyncExternalStore:P3,useId:X3,unstable_isNewReconciler:!1},b5={readContext:li,useCallback:H3,useContext:li,useEffect:SI,useImperativeHandle:G3,useInsertionEffect:U3,useLayoutEffect:W3,useMemo:q3,useReducer:Bw,useRef:B3,useState:function(){return Bw(Rp)},useDebugValue:TI,useDeferredValue:function(t){var e=ui();return Vn===null?e.memoizedState=t:K3(e,Vn.memoizedState,t)},useTransition:function(){var t=Bw(Rp)[0],e=ui().memoizedState;return[t,e]},useMutableSource:O3,useSyncExternalStore:P3,useId:X3,unstable_isNewReconciler:!1};function Ci(t,e){if(t&&t.defaultProps){e=dn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function i2(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:dn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var q1={isMounted:function(t){return(t=t._reactInternals)?Ku(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=Ks(),r=qa(t),i=jo(s,r);i.payload=e,n!=null&&(i.callback=n),e=Ga(t,i,r),e!==null&&(Fi(e,t,r,s),Xg(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=Ks(),r=qa(t),i=jo(s,r);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Ga(t,i,r),e!==null&&(Fi(e,t,r,s),Xg(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ks(),s=qa(t),r=jo(n,s);r.tag=2,e!=null&&(r.callback=e),e=Ga(t,r,s),e!==null&&(Fi(e,t,s,n),Xg(e,t,s))}};function NE(t,e,n,s,r,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,i,o):e.prototype&&e.prototype.isPureReactComponent?!Cp(n,s)||!Cp(r,i):!0}function Z3(t,e,n){var s=!1,r=nl,i=e.contextType;return typeof i=="object"&&i!==null?i=li(i):(r=pr(e)?wu:Ds.current,s=e.contextTypes,i=(s=s!=null)?dh(t,r):nl),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=q1,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=i),e}function $E(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&q1.enqueueReplaceState(e,e.state,null)}function o2(t,e,n,s){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},gI(t);var i=e.contextType;typeof i=="object"&&i!==null?r.context=li(i):(i=pr(e)?wu:Ds.current,r.context=dh(t,i)),r.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(i2(t,e,i,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&q1.enqueueReplaceState(r,r.state,null),$y(t,n,r,s),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function gh(t,e){try{var n="",s=e;do n+=Xz(s),s=s.return;while(s);var r=n}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:r,digest:null}}function Uw(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function a2(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var I5=typeof WeakMap=="function"?WeakMap:Map;function eR(t,e,n){n=jo(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){Py||(Py=!0,y2=s),a2(t,e)},n}function tR(t,e,n){n=jo(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;n.payload=function(){return s(r)},n.callback=function(){a2(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){a2(t,e),typeof s!="function"&&(Ha===null?Ha=new Set([this]):Ha.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function AE(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new I5;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(n)||(r.add(n),t=F5.bind(null,t,e,n),e.then(t,t))}function RE(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function DE(t,e,n,s,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=jo(-1,1),e.tag=2,Ga(n,e,1))),n.lanes|=1),t)}var S5=la.ReactCurrentOwner,ur=!1;function js(t,e,n,s){e.child=t===null?$3(e,null,n,s):fh(e,t.child,n,s)}function OE(t,e,n,s,r){n=n.render;var i=e.ref;return Jc(e,r),s=bI(t,e,n,s,i,r),n=II(),t!==null&&!ur?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Zo(t,e,r)):(sn&&n&&uI(e),e.flags|=1,js(t,e,s,r),e.child)}function PE(t,e,n,s,r){if(t===null){var i=n.type;return typeof i=="function"&&!RI(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,nR(t,e,i,s,r)):(t=ty(n.type,null,s,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&r)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:Cp,n(o,s)&&t.ref===e.ref)return Zo(t,e,r)}return e.flags|=1,t=Ka(i,s),t.ref=e.ref,t.return=e,e.child=t}function nR(t,e,n,s,r){if(t!==null){var i=t.memoizedProps;if(Cp(i,s)&&t.ref===e.ref)if(ur=!1,e.pendingProps=s=i,(t.lanes&r)!==0)t.flags&131072&&(ur=!0);else return e.lanes=t.lanes,Zo(t,e,r)}return l2(t,e,n,s,r)}function sR(t,e,n){var s=e.pendingProps,r=s.children,i=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},jt(Gc,_r),_r|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,jt(Gc,_r),_r|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,jt(Gc,_r),_r|=s}else i!==null?(s=i.baseLanes|n,e.memoizedState=null):s=n,jt(Gc,_r),_r|=s;return js(t,e,r,n),e.child}function rR(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function l2(t,e,n,s,r){var i=pr(n)?wu:Ds.current;return i=dh(e,i),Jc(e,r),n=bI(t,e,n,s,i,r),s=II(),t!==null&&!ur?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Zo(t,e,r)):(sn&&s&&uI(e),e.flags|=1,js(t,e,n,r),e.child)}function FE(t,e,n,s,r){if(pr(n)){var i=!0;Cy(e)}else i=!1;if(Jc(e,r),e.stateNode===null)Jg(t,e),Z3(e,n,s),o2(e,n,s,r),s=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=li(u):(u=pr(n)?wu:Ds.current,u=dh(e,u));var c=n.getDerivedStateFromProps,h=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==s||l!==u)&&$E(e,o,s,u),_a=!1;var d=e.memoizedState;o.state=d,$y(e,s,o,r),l=e.memoizedState,a!==s||d!==l||dr.current||_a?(typeof c=="function"&&(i2(e,n,c,s),l=e.memoizedState),(a=_a||NE(e,n,a,s,d,l,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),o.props=s,o.state=l,o.context=u,s=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,R3(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:Ci(e.type,a),o.props=u,h=e.pendingProps,d=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=li(l):(l=pr(n)?wu:Ds.current,l=dh(e,l));var p=n.getDerivedStateFromProps;(c=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||d!==l)&&$E(e,o,s,l),_a=!1,d=e.memoizedState,o.state=d,$y(e,s,o,r);var f=e.memoizedState;a!==h||d!==f||dr.current||_a?(typeof p=="function"&&(i2(e,n,p,s),f=e.memoizedState),(u=_a||NE(e,n,u,s,d,f,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,f,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,f,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=f),o.props=s,o.state=f,o.context=l,s=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),s=!1)}return u2(t,e,n,s,i,r)}function u2(t,e,n,s,r,i){rR(t,e);var o=(e.flags&128)!==0;if(!s&&!o)return r&&bE(e,n,!1),Zo(t,e,i);s=e.stateNode,S5.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&o?(e.child=fh(e,t.child,null,i),e.child=fh(e,null,a,i)):js(t,e,a,i),e.memoizedState=s.state,r&&bE(e,n,!0),e.child}function iR(t){var e=t.stateNode;e.pendingContext?xE(t,e.pendingContext,e.pendingContext!==e.context):e.context&&xE(t,e.context,!1),yI(t,e.containerInfo)}function LE(t,e,n,s,r){return ph(),hI(r),e.flags|=256,js(t,e,n,s),e.child}var c2={dehydrated:null,treeContext:null,retryLane:0};function h2(t){return{baseLanes:t,cachePool:null,transitions:null}}function oR(t,e,n){var s=e.pendingProps,r=ln.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),jt(ln,r&1),t===null)return s2(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,t=s.fallback,i?(s=e.mode,i=e.child,o={mode:"hidden",children:o},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Y1(o,s,0,null),t=pu(t,s,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=h2(n),e.memoizedState=c2,t):CI(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return T5(t,e,o,s,a,r,n);if(i){i=s.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:s.children};return!(o&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=Ka(r,l),s.subtreeFlags=r.subtreeFlags&14680064),a!==null?i=Ka(a,i):(i=pu(i,o,n,null),i.flags|=2),i.return=e,s.return=e,s.sibling=i,e.child=s,s=i,i=e.child,o=t.child.memoizedState,o=o===null?h2(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=c2,s}return i=t.child,t=i.sibling,s=Ka(i,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function CI(t,e){return e=Y1({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function wg(t,e,n,s){return s!==null&&hI(s),fh(e,t.child,null,n),t=CI(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function T5(t,e,n,s,r,i,o){if(n)return e.flags&256?(e.flags&=-257,s=Uw(Error(we(422))),wg(t,e,o,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=s.fallback,r=e.mode,s=Y1({mode:"visible",children:s.children},r,0,null),i=pu(i,r,o,null),i.flags|=2,s.return=e,i.return=e,s.sibling=i,e.child=s,e.mode&1&&fh(e,t.child,null,o),e.child.memoizedState=h2(o),e.memoizedState=c2,i);if(!(e.mode&1))return wg(t,e,o,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var a=s.dgst;return s=a,i=Error(we(419)),s=Uw(i,s,void 0),wg(t,e,o,s)}if(a=(o&t.childLanes)!==0,ur||a){if(s=Zn,s!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|o)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,Jo(t,r),Fi(s,t,r,-1))}return AI(),s=Uw(Error(we(421))),wg(t,e,o,s)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=L5.bind(null,t),r._reactRetry=e,null):(t=i.treeContext,$r=ja(r.nextSibling),Dr=e,sn=!0,Ei=null,t!==null&&(qr[Kr++]=zo,qr[Kr++]=Bo,qr[Kr++]=xu,zo=t.id,Bo=t.overflow,xu=e),e=CI(e,s.children),e.flags|=4096,e)}function ME(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),r2(t.return,e,n)}function Ww(t,e,n,s,r){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=r)}function aR(t,e,n){var s=e.pendingProps,r=s.revealOrder,i=s.tail;if(js(t,e,s.children,n),s=ln.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&ME(t,n,e);else if(t.tag===19)ME(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(jt(ln,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&Ay(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Ww(e,!1,r,n,i);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Ay(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Ww(e,!0,n,null,i);break;case"together":Ww(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Jg(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Zo(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Iu|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(we(153));if(e.child!==null){for(t=e.child,n=Ka(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ka(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function C5(t,e,n){switch(e.tag){case 3:iR(e),ph();break;case 5:D3(e);break;case 1:pr(e.type)&&Cy(e);break;case 4:yI(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;jt(_y,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(jt(ln,ln.current&1),e.flags|=128,null):n&e.child.childLanes?oR(t,e,n):(jt(ln,ln.current&1),t=Zo(t,e,n),t!==null?t.sibling:null);jt(ln,ln.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return aR(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),jt(ln,ln.current),s)break;return null;case 22:case 23:return e.lanes=0,sR(t,e,n)}return Zo(t,e,n)}var lR,d2,uR,cR;lR=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};d2=function(){};uR=function(t,e,n,s){var r=t.memoizedProps;if(r!==s){t=e.stateNode,ou(go.current);var i=null;switch(n){case"input":r=Ox(t,r),s=Ox(t,s),i=[];break;case"select":r=dn({},r,{value:void 0}),s=dn({},s,{value:void 0}),i=[];break;case"textarea":r=Lx(t,r),s=Lx(t,s),i=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=Sy)}Vx(n,s);var o;n=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var a=r[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(vp.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in s){var l=s[u];if(a=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(i||(i=[]),i.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(vp.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Yt("scroll",t),i||a===l||(i=[])):(i=i||[]).push(u,l))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};cR=function(t,e,n,s){n!==s&&(e.flags|=4)};function Fd(t,e){if(!sn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function Cs(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function k5(t,e,n){var s=e.pendingProps;switch(cI(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Cs(e),null;case 1:return pr(e.type)&&Ty(),Cs(e),null;case 3:return s=e.stateNode,mh(),Qt(dr),Qt(Ds),wI(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(yg(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ei!==null&&(x2(Ei),Ei=null))),d2(t,e),Cs(e),null;case 5:vI(e);var r=ou($p.current);if(n=e.type,t!==null&&e.stateNode!=null)uR(t,e,n,s,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(we(166));return Cs(e),null}if(t=ou(go.current),yg(e)){s=e.stateNode,n=e.type;var i=e.memoizedProps;switch(s[po]=e,s[_p]=i,t=(e.mode&1)!==0,n){case"dialog":Yt("cancel",s),Yt("close",s);break;case"iframe":case"object":case"embed":Yt("load",s);break;case"video":case"audio":for(r=0;r<Hd.length;r++)Yt(Hd[r],s);break;case"source":Yt("error",s);break;case"img":case"image":case"link":Yt("error",s),Yt("load",s);break;case"details":Yt("toggle",s);break;case"input":qk(s,i),Yt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},Yt("invalid",s);break;case"textarea":Xk(s,i),Yt("invalid",s)}Vx(n,i),r=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?s.textContent!==a&&(i.suppressHydrationWarning!==!0&&gg(s.textContent,a,t),r=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&gg(s.textContent,a,t),r=["children",""+a]):vp.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Yt("scroll",s)}switch(n){case"input":lg(s),Kk(s,i,!0);break;case"textarea":lg(s),Yk(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=Sy)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=MA(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=o.createElement(n,{is:s.is}):(t=o.createElement(n),n==="select"&&(o=t,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):t=o.createElementNS(t,n),t[po]=e,t[_p]=s,lR(t,e,!1,!1),e.stateNode=t;e:{switch(o=zx(n,s),n){case"dialog":Yt("cancel",t),Yt("close",t),r=s;break;case"iframe":case"object":case"embed":Yt("load",t),r=s;break;case"video":case"audio":for(r=0;r<Hd.length;r++)Yt(Hd[r],t);r=s;break;case"source":Yt("error",t),r=s;break;case"img":case"image":case"link":Yt("error",t),Yt("load",t),r=s;break;case"details":Yt("toggle",t),r=s;break;case"input":qk(t,s),r=Ox(t,s),Yt("invalid",t);break;case"option":r=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},r=dn({},s,{value:void 0}),Yt("invalid",t);break;case"textarea":Xk(t,s),r=Lx(t,s),Yt("invalid",t);break;default:r=s}Vx(n,r),a=r;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?BA(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&VA(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&wp(t,l):typeof l=="number"&&wp(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(vp.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Yt("scroll",t):l!=null&&Xb(t,i,l,o))}switch(n){case"input":lg(t),Kk(t,s,!1);break;case"textarea":lg(t),Yk(t);break;case"option":s.value!=null&&t.setAttribute("value",""+tl(s.value));break;case"select":t.multiple=!!s.multiple,i=s.value,i!=null?Kc(t,!!s.multiple,i,!1):s.defaultValue!=null&&Kc(t,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Sy)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Cs(e),null;case 6:if(t&&e.stateNode!=null)cR(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(we(166));if(n=ou($p.current),ou(go.current),yg(e)){if(s=e.stateNode,n=e.memoizedProps,s[po]=e,(i=s.nodeValue!==n)&&(t=Dr,t!==null))switch(t.tag){case 3:gg(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&gg(s.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[po]=e,e.stateNode=s}return Cs(e),null;case 13:if(Qt(ln),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(sn&&$r!==null&&e.mode&1&&!(e.flags&128))_3(),ph(),e.flags|=98560,i=!1;else if(i=yg(e),s!==null&&s.dehydrated!==null){if(t===null){if(!i)throw Error(we(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(we(317));i[po]=e}else ph(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Cs(e),i=!1}else Ei!==null&&(x2(Ei),Ei=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||ln.current&1?Bn===0&&(Bn=3):AI())),e.updateQueue!==null&&(e.flags|=4),Cs(e),null);case 4:return mh(),d2(t,e),t===null&&kp(e.stateNode.containerInfo),Cs(e),null;case 10:return fI(e.type._context),Cs(e),null;case 17:return pr(e.type)&&Ty(),Cs(e),null;case 19:if(Qt(ln),i=e.memoizedState,i===null)return Cs(e),null;if(s=(e.flags&128)!==0,o=i.rendering,o===null)if(s)Fd(i,!1);else{if(Bn!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Ay(t),o!==null){for(e.flags|=128,Fd(i,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)i=n,t=s,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return jt(ln,ln.current&1|2),e.child}t=t.sibling}i.tail!==null&&Sn()>yh&&(e.flags|=128,s=!0,Fd(i,!1),e.lanes=4194304)}else{if(!s)if(t=Ay(o),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Fd(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!sn)return Cs(e),null}else 2*Sn()-i.renderingStartTime>yh&&n!==1073741824&&(e.flags|=128,s=!0,Fd(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Sn(),e.sibling=null,n=ln.current,jt(ln,s?n&1|2:n&1),e):(Cs(e),null);case 22:case 23:return $I(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?_r&1073741824&&(Cs(e),e.subtreeFlags&6&&(e.flags|=8192)):Cs(e),null;case 24:return null;case 25:return null}throw Error(we(156,e.tag))}function E5(t,e){switch(cI(e),e.tag){case 1:return pr(e.type)&&Ty(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return mh(),Qt(dr),Qt(Ds),wI(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return vI(e),null;case 13:if(Qt(ln),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(we(340));ph()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Qt(ln),null;case 4:return mh(),null;case 10:return fI(e.type._context),null;case 22:case 23:return $I(),null;case 24:return null;default:return null}}var xg=!1,Ns=!1,_5=typeof WeakSet=="function"?WeakSet:Set,Ae=null;function jc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){gn(t,e,s)}else n.current=null}function p2(t,e,n){try{n()}catch(s){gn(t,e,s)}}var VE=!1;function N5(t,e){if(Yx=xy,t=m3(),lI(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,u=0,c=0,h=t,d=null;t:for(;;){for(var p;h!==n||r!==0&&h.nodeType!==3||(a=o+r),h!==i||s!==0&&h.nodeType!==3||(l=o+s),h.nodeType===3&&(o+=h.nodeValue.length),(p=h.firstChild)!==null;)d=h,h=p;for(;;){if(h===t)break t;if(d===n&&++u===r&&(a=o),d===i&&++c===s&&(l=o),(p=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=p}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Qx={focusedElem:t,selectionRange:n},xy=!1,Ae=e;Ae!==null;)if(e=Ae,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ae=t;else for(;Ae!==null;){e=Ae;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var m=f.memoizedProps,v=f.memoizedState,y=e.stateNode,w=y.getSnapshotBeforeUpdate(e.elementType===e.type?m:Ci(e.type,m),v);y.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(we(163))}}catch(I){gn(e,e.return,I)}if(t=e.sibling,t!==null){t.return=e.return,Ae=t;break}Ae=e.return}return f=VE,VE=!1,f}function lp(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&t)===t){var i=r.destroy;r.destroy=void 0,i!==void 0&&p2(e,n,i)}r=r.next}while(r!==s)}}function K1(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function f2(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function hR(t){var e=t.alternate;e!==null&&(t.alternate=null,hR(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[po],delete e[_p],delete e[e2],delete e[h5],delete e[d5])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function dR(t){return t.tag===5||t.tag===3||t.tag===4}function zE(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||dR(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function m2(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Sy));else if(s!==4&&(t=t.child,t!==null))for(m2(t,e,n),t=t.sibling;t!==null;)m2(t,e,n),t=t.sibling}function g2(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(g2(t,e,n),t=t.sibling;t!==null;)g2(t,e,n),t=t.sibling}var hs=null,ki=!1;function Ca(t,e,n){for(n=n.child;n!==null;)pR(t,e,n),n=n.sibling}function pR(t,e,n){if(mo&&typeof mo.onCommitFiberUnmount=="function")try{mo.onCommitFiberUnmount(z1,n)}catch{}switch(n.tag){case 5:Ns||jc(n,e);case 6:var s=hs,r=ki;hs=null,Ca(t,e,n),hs=s,ki=r,hs!==null&&(ki?(t=hs,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):hs.removeChild(n.stateNode));break;case 18:hs!==null&&(ki?(t=hs,n=n.stateNode,t.nodeType===8?Fw(t.parentNode,n):t.nodeType===1&&Fw(t,n),Sp(t)):Fw(hs,n.stateNode));break;case 4:s=hs,r=ki,hs=n.stateNode.containerInfo,ki=!0,Ca(t,e,n),hs=s,ki=r;break;case 0:case 11:case 14:case 15:if(!Ns&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var i=r,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&p2(n,e,o),r=r.next}while(r!==s)}Ca(t,e,n);break;case 1:if(!Ns&&(jc(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(a){gn(n,e,a)}Ca(t,e,n);break;case 21:Ca(t,e,n);break;case 22:n.mode&1?(Ns=(s=Ns)||n.memoizedState!==null,Ca(t,e,n),Ns=s):Ca(t,e,n);break;default:Ca(t,e,n)}}function BE(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new _5),e.forEach(function(s){var r=M5.bind(null,t,s);n.has(s)||(n.add(s),s.then(r,r))})}}function Ii(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:hs=a.stateNode,ki=!1;break e;case 3:hs=a.stateNode.containerInfo,ki=!0;break e;case 4:hs=a.stateNode.containerInfo,ki=!0;break e}a=a.return}if(hs===null)throw Error(we(160));pR(i,o,r),hs=null,ki=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(u){gn(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)fR(e,t),e=e.sibling}function fR(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ii(e,t),io(t),s&4){try{lp(3,t,t.return),K1(3,t)}catch(m){gn(t,t.return,m)}try{lp(5,t,t.return)}catch(m){gn(t,t.return,m)}}break;case 1:Ii(e,t),io(t),s&512&&n!==null&&jc(n,n.return);break;case 5:if(Ii(e,t),io(t),s&512&&n!==null&&jc(n,n.return),t.flags&32){var r=t.stateNode;try{wp(r,"")}catch(m){gn(t,t.return,m)}}if(s&4&&(r=t.stateNode,r!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&FA(r,i),zx(a,o);var u=zx(a,i);for(o=0;o<l.length;o+=2){var c=l[o],h=l[o+1];c==="style"?BA(r,h):c==="dangerouslySetInnerHTML"?VA(r,h):c==="children"?wp(r,h):Xb(r,c,h,u)}switch(a){case"input":Px(r,i);break;case"textarea":LA(r,i);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?Kc(r,!!i.multiple,p,!1):d!==!!i.multiple&&(i.defaultValue!=null?Kc(r,!!i.multiple,i.defaultValue,!0):Kc(r,!!i.multiple,i.multiple?[]:"",!1))}r[_p]=i}catch(m){gn(t,t.return,m)}}break;case 6:if(Ii(e,t),io(t),s&4){if(t.stateNode===null)throw Error(we(162));r=t.stateNode,i=t.memoizedProps;try{r.nodeValue=i}catch(m){gn(t,t.return,m)}}break;case 3:if(Ii(e,t),io(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{Sp(e.containerInfo)}catch(m){gn(t,t.return,m)}break;case 4:Ii(e,t),io(t);break;case 13:Ii(e,t),io(t),r=t.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(_I=Sn())),s&4&&BE(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(Ns=(u=Ns)||c,Ii(e,t),Ns=u):Ii(e,t),io(t),s&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&t.mode&1)for(Ae=t,c=t.child;c!==null;){for(h=Ae=c;Ae!==null;){switch(d=Ae,p=d.child,d.tag){case 0:case 11:case 14:case 15:lp(4,d,d.return);break;case 1:jc(d,d.return);var f=d.stateNode;if(typeof f.componentWillUnmount=="function"){s=d,n=d.return;try{e=s,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(m){gn(s,n,m)}}break;case 5:jc(d,d.return);break;case 22:if(d.memoizedState!==null){WE(h);continue}}p!==null?(p.return=d,Ae=p):WE(h)}c=c.sibling}e:for(c=null,h=t;;){if(h.tag===5){if(c===null){c=h;try{r=h.stateNode,u?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=zA("display",o))}catch(m){gn(t,t.return,m)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(m){gn(t,t.return,m)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Ii(e,t),io(t),s&4&&BE(t);break;case 21:break;default:Ii(e,t),io(t)}}function io(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(dR(n)){var s=n;break e}n=n.return}throw Error(we(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(wp(r,""),s.flags&=-33);var i=zE(t);g2(t,i,r);break;case 3:case 4:var o=s.stateNode.containerInfo,a=zE(t);m2(t,a,o);break;default:throw Error(we(161))}}catch(l){gn(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function $5(t,e,n){Ae=t,mR(t)}function mR(t,e,n){for(var s=(t.mode&1)!==0;Ae!==null;){var r=Ae,i=r.child;if(r.tag===22&&s){var o=r.memoizedState!==null||xg;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||Ns;a=xg;var u=Ns;if(xg=o,(Ns=l)&&!u)for(Ae=r;Ae!==null;)o=Ae,l=o.child,o.tag===22&&o.memoizedState!==null?jE(r):l!==null?(l.return=o,Ae=l):jE(r);for(;i!==null;)Ae=i,mR(i),i=i.sibling;Ae=r,xg=a,Ns=u}UE(t)}else r.subtreeFlags&8772&&i!==null?(i.return=r,Ae=i):UE(t)}}function UE(t){for(;Ae!==null;){var e=Ae;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ns||K1(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!Ns)if(n===null)s.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Ci(e.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&kE(e,i,s);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}kE(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&Sp(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(we(163))}Ns||e.flags&512&&f2(e)}catch(d){gn(e,e.return,d)}}if(e===t){Ae=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ae=n;break}Ae=e.return}}function WE(t){for(;Ae!==null;){var e=Ae;if(e===t){Ae=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ae=n;break}Ae=e.return}}function jE(t){for(;Ae!==null;){var e=Ae;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{K1(4,e)}catch(l){gn(e,n,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(l){gn(e,r,l)}}var i=e.return;try{f2(e)}catch(l){gn(e,i,l)}break;case 5:var o=e.return;try{f2(e)}catch(l){gn(e,o,l)}}}catch(l){gn(e,e.return,l)}if(e===t){Ae=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ae=a;break}Ae=e.return}}var A5=Math.ceil,Oy=la.ReactCurrentDispatcher,kI=la.ReactCurrentOwner,ri=la.ReactCurrentBatchConfig,bt=0,Zn=null,_n=null,ms=0,_r=0,Gc=xl(0),Bn=0,Op=null,Iu=0,X1=0,EI=0,up=null,ar=null,_I=0,yh=1/0,Oo=null,Py=!1,y2=null,Ha=null,bg=!1,La=null,Fy=0,cp=0,v2=null,Zg=-1,ey=0;function Ks(){return bt&6?Sn():Zg!==-1?Zg:Zg=Sn()}function qa(t){return t.mode&1?bt&2&&ms!==0?ms&-ms:f5.transition!==null?(ey===0&&(ey=ZA()),ey):(t=Rt,t!==0||(t=window.event,t=t===void 0?16:o3(t.type)),t):1}function Fi(t,e,n,s){if(50<cp)throw cp=0,v2=null,Error(we(185));af(t,n,s),(!(bt&2)||t!==Zn)&&(t===Zn&&(!(bt&2)&&(X1|=n),Bn===4&&Aa(t,ms)),fr(t,s),n===1&&bt===0&&!(e.mode&1)&&(yh=Sn()+500,G1&&bl()))}function fr(t,e){var n=t.callbackNode;fB(t,e);var s=wy(t,t===Zn?ms:0);if(s===0)n!==null&&Zk(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&Zk(n),e===1)t.tag===0?p5(GE.bind(null,t)):C3(GE.bind(null,t)),u5(function(){!(bt&6)&&bl()}),n=null;else{switch(e3(s)){case 1:n=eI;break;case 4:n=QA;break;case 16:n=vy;break;case 536870912:n=JA;break;default:n=vy}n=SR(n,gR.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function gR(t,e){if(Zg=-1,ey=0,bt&6)throw Error(we(327));var n=t.callbackNode;if(Zc()&&t.callbackNode!==n)return null;var s=wy(t,t===Zn?ms:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=Ly(t,s);else{e=s;var r=bt;bt|=2;var i=vR();(Zn!==t||ms!==e)&&(Oo=null,yh=Sn()+500,du(t,e));do try{O5();break}catch(a){yR(t,a)}while(!0);pI(),Oy.current=i,bt=r,_n!==null?e=0:(Zn=null,ms=0,e=Bn)}if(e!==0){if(e===2&&(r=Gx(t),r!==0&&(s=r,e=w2(t,r))),e===1)throw n=Op,du(t,0),Aa(t,s),fr(t,Sn()),n;if(e===6)Aa(t,s);else{if(r=t.current.alternate,!(s&30)&&!R5(r)&&(e=Ly(t,s),e===2&&(i=Gx(t),i!==0&&(s=i,e=w2(t,i))),e===1))throw n=Op,du(t,0),Aa(t,s),fr(t,Sn()),n;switch(t.finishedWork=r,t.finishedLanes=s,e){case 0:case 1:throw Error(we(345));case 2:Ql(t,ar,Oo);break;case 3:if(Aa(t,s),(s&130023424)===s&&(e=_I+500-Sn(),10<e)){if(wy(t,0)!==0)break;if(r=t.suspendedLanes,(r&s)!==s){Ks(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Zx(Ql.bind(null,t,ar,Oo),e);break}Ql(t,ar,Oo);break;case 4:if(Aa(t,s),(s&4194240)===s)break;for(e=t.eventTimes,r=-1;0<s;){var o=31-Pi(s);i=1<<o,o=e[o],o>r&&(r=o),s&=~i}if(s=r,s=Sn()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*A5(s/1960))-s,10<s){t.timeoutHandle=Zx(Ql.bind(null,t,ar,Oo),s);break}Ql(t,ar,Oo);break;case 5:Ql(t,ar,Oo);break;default:throw Error(we(329))}}}return fr(t,Sn()),t.callbackNode===n?gR.bind(null,t):null}function w2(t,e){var n=up;return t.current.memoizedState.isDehydrated&&(du(t,e).flags|=256),t=Ly(t,e),t!==2&&(e=ar,ar=n,e!==null&&x2(e)),t}function x2(t){ar===null?ar=t:ar.push.apply(ar,t)}function R5(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],i=r.getSnapshot;r=r.value;try{if(!zi(i(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Aa(t,e){for(e&=~EI,e&=~X1,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Pi(e),s=1<<n;t[n]=-1,e&=~s}}function GE(t){if(bt&6)throw Error(we(327));Zc();var e=wy(t,0);if(!(e&1))return fr(t,Sn()),null;var n=Ly(t,e);if(t.tag!==0&&n===2){var s=Gx(t);s!==0&&(e=s,n=w2(t,s))}if(n===1)throw n=Op,du(t,0),Aa(t,e),fr(t,Sn()),n;if(n===6)throw Error(we(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ql(t,ar,Oo),fr(t,Sn()),null}function NI(t,e){var n=bt;bt|=1;try{return t(e)}finally{bt=n,bt===0&&(yh=Sn()+500,G1&&bl())}}function Su(t){La!==null&&La.tag===0&&!(bt&6)&&Zc();var e=bt;bt|=1;var n=ri.transition,s=Rt;try{if(ri.transition=null,Rt=1,t)return t()}finally{Rt=s,ri.transition=n,bt=e,!(bt&6)&&bl()}}function $I(){_r=Gc.current,Qt(Gc)}function du(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,l5(n)),_n!==null)for(n=_n.return;n!==null;){var s=n;switch(cI(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Ty();break;case 3:mh(),Qt(dr),Qt(Ds),wI();break;case 5:vI(s);break;case 4:mh();break;case 13:Qt(ln);break;case 19:Qt(ln);break;case 10:fI(s.type._context);break;case 22:case 23:$I()}n=n.return}if(Zn=t,_n=t=Ka(t.current,null),ms=_r=e,Bn=0,Op=null,EI=X1=Iu=0,ar=up=null,iu!==null){for(e=0;e<iu.length;e++)if(n=iu[e],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,i=n.pending;if(i!==null){var o=i.next;i.next=r,s.next=o}n.pending=s}iu=null}return t}function yR(t,e){do{var n=_n;try{if(pI(),Yg.current=Dy,Ry){for(var s=cn.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}Ry=!1}if(bu=0,Kn=Vn=cn=null,ap=!1,Ap=0,kI.current=null,n===null||n.return===null){Bn=1,Op=e,_n=null;break}e:{var i=t,o=n.return,a=n,l=e;if(e=ms,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var p=RE(o);if(p!==null){p.flags&=-257,DE(p,o,a,i,e),p.mode&1&&AE(i,u,e),e=p,l=u;var f=e.updateQueue;if(f===null){var m=new Set;m.add(l),e.updateQueue=m}else f.add(l);break e}else{if(!(e&1)){AE(i,u,e),AI();break e}l=Error(we(426))}}else if(sn&&a.mode&1){var v=RE(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),DE(v,o,a,i,e),hI(gh(l,a));break e}}i=l=gh(l,a),Bn!==4&&(Bn=2),up===null?up=[i]:up.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=eR(i,l,e);CE(i,y);break e;case 1:a=l;var w=i.type,b=i.stateNode;if(!(i.flags&128)&&(typeof w.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Ha===null||!Ha.has(b)))){i.flags|=65536,e&=-e,i.lanes|=e;var I=tR(i,a,e);CE(i,I);break e}}i=i.return}while(i!==null)}xR(n)}catch(k){e=k,_n===n&&n!==null&&(_n=n=n.return);continue}break}while(!0)}function vR(){var t=Oy.current;return Oy.current=Dy,t===null?Dy:t}function AI(){(Bn===0||Bn===3||Bn===2)&&(Bn=4),Zn===null||!(Iu&268435455)&&!(X1&268435455)||Aa(Zn,ms)}function Ly(t,e){var n=bt;bt|=2;var s=vR();(Zn!==t||ms!==e)&&(Oo=null,du(t,e));do try{D5();break}catch(r){yR(t,r)}while(!0);if(pI(),bt=n,Oy.current=s,_n!==null)throw Error(we(261));return Zn=null,ms=0,Bn}function D5(){for(;_n!==null;)wR(_n)}function O5(){for(;_n!==null&&!iB();)wR(_n)}function wR(t){var e=IR(t.alternate,t,_r);t.memoizedProps=t.pendingProps,e===null?xR(t):_n=e,kI.current=null}function xR(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=E5(n,e),n!==null){n.flags&=32767,_n=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Bn=6,_n=null;return}}else if(n=k5(n,e,_r),n!==null){_n=n;return}if(e=e.sibling,e!==null){_n=e;return}_n=e=t}while(e!==null);Bn===0&&(Bn=5)}function Ql(t,e,n){var s=Rt,r=ri.transition;try{ri.transition=null,Rt=1,P5(t,e,n,s)}finally{ri.transition=r,Rt=s}return null}function P5(t,e,n,s){do Zc();while(La!==null);if(bt&6)throw Error(we(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(we(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(mB(t,i),t===Zn&&(_n=Zn=null,ms=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||bg||(bg=!0,SR(vy,function(){return Zc(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=ri.transition,ri.transition=null;var o=Rt;Rt=1;var a=bt;bt|=4,kI.current=null,N5(t,n),fR(n,t),t5(Qx),xy=!!Yx,Qx=Yx=null,t.current=n,$5(n),oB(),bt=a,Rt=o,ri.transition=i}else t.current=n;if(bg&&(bg=!1,La=t,Fy=r),i=t.pendingLanes,i===0&&(Ha=null),uB(n.stateNode),fr(t,Sn()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(Py)throw Py=!1,t=y2,y2=null,t;return Fy&1&&t.tag!==0&&Zc(),i=t.pendingLanes,i&1?t===v2?cp++:(cp=0,v2=t):cp=0,bl(),null}function Zc(){if(La!==null){var t=e3(Fy),e=ri.transition,n=Rt;try{if(ri.transition=null,Rt=16>t?16:t,La===null)var s=!1;else{if(t=La,La=null,Fy=0,bt&6)throw Error(we(331));var r=bt;for(bt|=4,Ae=t.current;Ae!==null;){var i=Ae,o=i.child;if(Ae.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(Ae=u;Ae!==null;){var c=Ae;switch(c.tag){case 0:case 11:case 15:lp(8,c,i)}var h=c.child;if(h!==null)h.return=c,Ae=h;else for(;Ae!==null;){c=Ae;var d=c.sibling,p=c.return;if(hR(c),c===u){Ae=null;break}if(d!==null){d.return=p,Ae=d;break}Ae=p}}}var f=i.alternate;if(f!==null){var m=f.child;if(m!==null){f.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(m!==null)}}Ae=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Ae=o;else e:for(;Ae!==null;){if(i=Ae,i.flags&2048)switch(i.tag){case 0:case 11:case 15:lp(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,Ae=y;break e}Ae=i.return}}var w=t.current;for(Ae=w;Ae!==null;){o=Ae;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,Ae=b;else e:for(o=w;Ae!==null;){if(a=Ae,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:K1(9,a)}}catch(k){gn(a,a.return,k)}if(a===o){Ae=null;break e}var I=a.sibling;if(I!==null){I.return=a.return,Ae=I;break e}Ae=a.return}}if(bt=r,bl(),mo&&typeof mo.onPostCommitFiberRoot=="function")try{mo.onPostCommitFiberRoot(z1,t)}catch{}s=!0}return s}finally{Rt=n,ri.transition=e}}return!1}function HE(t,e,n){e=gh(n,e),e=eR(t,e,1),t=Ga(t,e,1),e=Ks(),t!==null&&(af(t,1,e),fr(t,e))}function gn(t,e,n){if(t.tag===3)HE(t,t,n);else for(;e!==null;){if(e.tag===3){HE(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Ha===null||!Ha.has(s))){t=gh(n,t),t=tR(e,t,1),e=Ga(e,t,1),t=Ks(),e!==null&&(af(e,1,t),fr(e,t));break}}e=e.return}}function F5(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=Ks(),t.pingedLanes|=t.suspendedLanes&n,Zn===t&&(ms&n)===n&&(Bn===4||Bn===3&&(ms&130023424)===ms&&500>Sn()-_I?du(t,0):EI|=n),fr(t,e)}function bR(t,e){e===0&&(t.mode&1?(e=hg,hg<<=1,!(hg&130023424)&&(hg=4194304)):e=1);var n=Ks();t=Jo(t,e),t!==null&&(af(t,e,n),fr(t,n))}function L5(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),bR(t,n)}function M5(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(we(314))}s!==null&&s.delete(e),bR(t,n)}var IR;IR=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||dr.current)ur=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return ur=!1,C5(t,e,n);ur=!!(t.flags&131072)}else ur=!1,sn&&e.flags&1048576&&k3(e,Ey,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;Jg(t,e),t=e.pendingProps;var r=dh(e,Ds.current);Jc(e,n),r=bI(null,e,s,t,r,n);var i=II();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,pr(s)?(i=!0,Cy(e)):i=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,gI(e),r.updater=q1,e.stateNode=r,r._reactInternals=e,o2(e,s,t,n),e=u2(null,e,s,!0,i,n)):(e.tag=0,sn&&i&&uI(e),js(null,e,r,n),e=e.child),e;case 16:s=e.elementType;e:{switch(Jg(t,e),t=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=z5(s),t=Ci(s,t),r){case 0:e=l2(null,e,s,t,n);break e;case 1:e=FE(null,e,s,t,n);break e;case 11:e=OE(null,e,s,t,n);break e;case 14:e=PE(null,e,s,Ci(s.type,t),n);break e}throw Error(we(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ci(s,r),l2(t,e,s,r,n);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ci(s,r),FE(t,e,s,r,n);case 3:e:{if(iR(e),t===null)throw Error(we(387));s=e.pendingProps,i=e.memoizedState,r=i.element,R3(t,e),$y(e,s,null,n);var o=e.memoizedState;if(s=o.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){r=gh(Error(we(423)),e),e=LE(t,e,s,n,r);break e}else if(s!==r){r=gh(Error(we(424)),e),e=LE(t,e,s,n,r);break e}else for($r=ja(e.stateNode.containerInfo.firstChild),Dr=e,sn=!0,Ei=null,n=$3(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ph(),s===r){e=Zo(t,e,n);break e}js(t,e,s,n)}e=e.child}return e;case 5:return D3(e),t===null&&s2(e),s=e.type,r=e.pendingProps,i=t!==null?t.memoizedProps:null,o=r.children,Jx(s,r)?o=null:i!==null&&Jx(s,i)&&(e.flags|=32),rR(t,e),js(t,e,o,n),e.child;case 6:return t===null&&s2(e),null;case 13:return oR(t,e,n);case 4:return yI(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=fh(e,null,s,n):js(t,e,s,n),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ci(s,r),OE(t,e,s,r,n);case 7:return js(t,e,e.pendingProps,n),e.child;case 8:return js(t,e,e.pendingProps.children,n),e.child;case 12:return js(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,i=e.memoizedProps,o=r.value,jt(_y,s._currentValue),s._currentValue=o,i!==null)if(zi(i.value,o)){if(i.children===r.children&&!dr.current){e=Zo(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===s){if(i.tag===1){l=jo(-1,n&-n),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),r2(i.return,n,e),a.lanes|=n;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(we(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),r2(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}js(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,Jc(e,n),r=li(r),s=s(r),e.flags|=1,js(t,e,s,n),e.child;case 14:return s=e.type,r=Ci(s,e.pendingProps),r=Ci(s.type,r),PE(t,e,s,r,n);case 15:return nR(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ci(s,r),Jg(t,e),e.tag=1,pr(s)?(t=!0,Cy(e)):t=!1,Jc(e,n),Z3(e,s,r),o2(e,s,r,n),u2(null,e,s,!0,t,n);case 19:return aR(t,e,n);case 22:return sR(t,e,n)}throw Error(we(156,e.tag))};function SR(t,e){return YA(t,e)}function V5(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qr(t,e,n,s){return new V5(t,e,n,s)}function RI(t){return t=t.prototype,!(!t||!t.isReactComponent)}function z5(t){if(typeof t=="function")return RI(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Qb)return 11;if(t===Jb)return 14}return 2}function Ka(t,e){var n=t.alternate;return n===null?(n=Qr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function ty(t,e,n,s,r,i){var o=2;if(s=t,typeof t=="function")RI(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Pc:return pu(n.children,r,i,e);case Yb:o=8,r|=8;break;case $x:return t=Qr(12,n,e,r|2),t.elementType=$x,t.lanes=i,t;case Ax:return t=Qr(13,n,e,r),t.elementType=Ax,t.lanes=i,t;case Rx:return t=Qr(19,n,e,r),t.elementType=Rx,t.lanes=i,t;case DA:return Y1(n,r,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case AA:o=10;break e;case RA:o=9;break e;case Qb:o=11;break e;case Jb:o=14;break e;case Ea:o=16,s=null;break e}throw Error(we(130,t==null?t:typeof t,""))}return e=Qr(o,n,e,r),e.elementType=t,e.type=s,e.lanes=i,e}function pu(t,e,n,s){return t=Qr(7,t,s,e),t.lanes=n,t}function Y1(t,e,n,s){return t=Qr(22,t,s,e),t.elementType=DA,t.lanes=n,t.stateNode={isHidden:!1},t}function jw(t,e,n){return t=Qr(6,t,null,e),t.lanes=n,t}function Gw(t,e,n){return e=Qr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function B5(t,e,n,s,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Cw(0),this.expirationTimes=Cw(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cw(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function DI(t,e,n,s,r,i,o,a,l){return t=new B5(t,e,n,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Qr(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},gI(i),t}function U5(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Oc,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function TR(t){if(!t)return nl;t=t._reactInternals;e:{if(Ku(t)!==t||t.tag!==1)throw Error(we(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(pr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(we(171))}if(t.tag===1){var n=t.type;if(pr(n))return T3(t,n,e)}return e}function CR(t,e,n,s,r,i,o,a,l){return t=DI(n,s,!0,t,r,i,o,a,l),t.context=TR(null),n=t.current,s=Ks(),r=qa(n),i=jo(s,r),i.callback=e??null,Ga(n,i,r),t.current.lanes=r,af(t,r,s),fr(t,s),t}function Q1(t,e,n,s){var r=e.current,i=Ks(),o=qa(r);return n=TR(n),e.context===null?e.context=n:e.pendingContext=n,e=jo(i,o),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=Ga(r,e,o),t!==null&&(Fi(t,r,o,i),Xg(t,r,o)),o}function My(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function qE(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function OI(t,e){qE(t,e),(t=t.alternate)&&qE(t,e)}function W5(){return null}var kR=typeof reportError=="function"?reportError:function(t){console.error(t)};function PI(t){this._internalRoot=t}J1.prototype.render=PI.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(we(409));Q1(t,e,null,null)};J1.prototype.unmount=PI.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Su(function(){Q1(null,t,null,null)}),e[Qo]=null}};function J1(t){this._internalRoot=t}J1.prototype.unstable_scheduleHydration=function(t){if(t){var e=s3();t={blockedOn:null,target:t,priority:e};for(var n=0;n<$a.length&&e!==0&&e<$a[n].priority;n++);$a.splice(n,0,t),n===0&&i3(t)}};function FI(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Z1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function KE(){}function j5(t,e,n,s,r){if(r){if(typeof s=="function"){var i=s;s=function(){var u=My(o);i.call(u)}}var o=CR(e,s,t,0,null,!1,!1,"",KE);return t._reactRootContainer=o,t[Qo]=o.current,kp(t.nodeType===8?t.parentNode:t),Su(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof s=="function"){var a=s;s=function(){var u=My(l);a.call(u)}}var l=DI(t,0,!1,null,null,!1,!1,"",KE);return t._reactRootContainer=l,t[Qo]=l.current,kp(t.nodeType===8?t.parentNode:t),Su(function(){Q1(e,l,n,s)}),l}function e0(t,e,n,s,r){var i=n._reactRootContainer;if(i){var o=i;if(typeof r=="function"){var a=r;r=function(){var l=My(o);a.call(l)}}Q1(e,o,t,r)}else o=j5(n,e,t,r,s);return My(o)}t3=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Gd(e.pendingLanes);n!==0&&(tI(e,n|1),fr(e,Sn()),!(bt&6)&&(yh=Sn()+500,bl()))}break;case 13:Su(function(){var s=Jo(t,1);if(s!==null){var r=Ks();Fi(s,t,1,r)}}),OI(t,1)}};nI=function(t){if(t.tag===13){var e=Jo(t,134217728);if(e!==null){var n=Ks();Fi(e,t,134217728,n)}OI(t,134217728)}};n3=function(t){if(t.tag===13){var e=qa(t),n=Jo(t,e);if(n!==null){var s=Ks();Fi(n,t,e,s)}OI(t,e)}};s3=function(){return Rt};r3=function(t,e){var n=Rt;try{return Rt=t,e()}finally{Rt=n}};Ux=function(t,e,n){switch(e){case"input":if(Px(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var r=j1(s);if(!r)throw Error(we(90));PA(s),Px(s,r)}}}break;case"textarea":LA(t,n);break;case"select":e=n.value,e!=null&&Kc(t,!!n.multiple,e,!1)}};jA=NI;GA=Su;var G5={usingClientEntryPoint:!1,Events:[uf,Vc,j1,UA,WA,NI]},Ld={findFiberByHostInstance:ru,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},H5={bundleType:Ld.bundleType,version:Ld.version,rendererPackageName:Ld.rendererPackageName,rendererConfig:Ld.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:la.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=KA(t),t===null?null:t.stateNode},findFiberByHostInstance:Ld.findFiberByHostInstance||W5,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ig=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ig.isDisabled&&Ig.supportsFiber)try{z1=Ig.inject(H5),mo=Ig}catch{}}Mr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=G5;Mr.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!FI(e))throw Error(we(200));return U5(t,e,null,n)};Mr.createRoot=function(t,e){if(!FI(t))throw Error(we(299));var n=!1,s="",r=kR;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=DI(t,1,!1,null,null,n,!1,s,r),t[Qo]=e.current,kp(t.nodeType===8?t.parentNode:t),new PI(e)};Mr.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(we(188)):(t=Object.keys(t).join(","),Error(we(268,t)));return t=KA(e),t=t===null?null:t.stateNode,t};Mr.flushSync=function(t){return Su(t)};Mr.hydrate=function(t,e,n){if(!Z1(e))throw Error(we(200));return e0(null,t,e,!0,n)};Mr.hydrateRoot=function(t,e,n){if(!FI(t))throw Error(we(405));var s=n!=null&&n.hydratedSources||null,r=!1,i="",o=kR;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=CR(e,null,t,1,n??null,r,!1,i,o),t[Qo]=e.current,kp(t),s)for(t=0;t<s.length;t++)n=s[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new J1(e)};Mr.render=function(t,e,n){if(!Z1(e))throw Error(we(200));return e0(null,t,e,!1,n)};Mr.unmountComponentAtNode=function(t){if(!Z1(t))throw Error(we(40));return t._reactRootContainer?(Su(function(){e0(null,null,t,!1,function(){t._reactRootContainer=null,t[Qo]=null})}),!0):!1};Mr.unstable_batchedUpdates=NI;Mr.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!Z1(n))throw Error(we(200));if(t==null||t._reactInternals===void 0)throw Error(we(38));return e0(t,e,n,!1,s)};Mr.version="18.3.1-next-f1338f8080-20240426";function ER(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ER)}catch(t){console.error(t)}}ER(),EA.exports=Mr;var q5=EA.exports,_R,XE=q5;_R=XE.createRoot,XE.hydrateRoot;const K5={BASE_URL:"/mood-verse/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxZWdncnR3Y3Vmd25ld3F6bmRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzkxMTQ2NjksImV4cCI6MjA1NDY5MDY2OX0.jsmwa0aOuReuRaLHhreDvYqEpphvR39TUipryjkJzS4",VITE_SUPABASE_URL:"https://lqeggrtwcufwnewqzndq.supabase.co"},YE=t=>{let e;const n=new Set,s=(c,h)=>{const d=typeof c=="function"?c(e):c;if(!Object.is(d,e)){const p=e;e=h??(typeof d!="object"||d===null)?d:Object.assign({},e,d),n.forEach(f=>f(e,p))}},r=()=>e,l={setState:s,getState:r,getInitialState:()=>u,subscribe:c=>(n.add(c),()=>n.delete(c)),destroy:()=>{(K5?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},u=e=t(s,r,l);return l},X5=t=>t?YE(t):YE;var NR={exports:{}},$R={},AR={exports:{}},RR={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vh=kt;function Y5(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Q5=typeof Object.is=="function"?Object.is:Y5,J5=vh.useState,Z5=vh.useEffect,eU=vh.useLayoutEffect,tU=vh.useDebugValue;function nU(t,e){var n=e(),s=J5({inst:{value:n,getSnapshot:e}}),r=s[0].inst,i=s[1];return eU(function(){r.value=n,r.getSnapshot=e,Hw(r)&&i({inst:r})},[t,n,e]),Z5(function(){return Hw(r)&&i({inst:r}),t(function(){Hw(r)&&i({inst:r})})},[t]),tU(n),n}function Hw(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Q5(t,n)}catch{return!0}}function sU(t,e){return e()}var rU=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?sU:nU;RR.useSyncExternalStore=vh.useSyncExternalStore!==void 0?vh.useSyncExternalStore:rU;AR.exports=RR;var iU=AR.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t0=kt,oU=iU;function aU(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var lU=typeof Object.is=="function"?Object.is:aU,uU=oU.useSyncExternalStore,cU=t0.useRef,hU=t0.useEffect,dU=t0.useMemo,pU=t0.useDebugValue;$R.useSyncExternalStoreWithSelector=function(t,e,n,s,r){var i=cU(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=dU(function(){function l(p){if(!u){if(u=!0,c=p,p=s(p),r!==void 0&&o.hasValue){var f=o.value;if(r(f,p))return h=f}return h=p}if(f=h,lU(c,p))return f;var m=s(p);return r!==void 0&&r(f,m)?(c=p,f):(c=p,h=m)}var u=!1,c,h,d=n===void 0?null:n;return[function(){return l(e())},d===null?void 0:function(){return l(d())}]},[e,n,s,r]);var a=uU(t,i[0],i[1]);return hU(function(){o.hasValue=!0,o.value=a},[a]),pU(a),a};NR.exports=$R;var fU=NR.exports;const mU=M1(fU),DR={BASE_URL:"/mood-verse/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxZWdncnR3Y3Vmd25ld3F6bmRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzkxMTQ2NjksImV4cCI6MjA1NDY5MDY2OX0.jsmwa0aOuReuRaLHhreDvYqEpphvR39TUipryjkJzS4",VITE_SUPABASE_URL:"https://lqeggrtwcufwnewqzndq.supabase.co"},{useDebugValue:gU}=Fz,{useSyncExternalStoreWithSelector:yU}=mU;let QE=!1;const vU=t=>t;function wU(t,e=vU,n){(DR?"production":void 0)!=="production"&&n&&!QE&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),QE=!0);const s=yU(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return gU(s),s}const JE=t=>{(DR?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof t=="function"?X5(t):t,n=(s,r)=>wU(e,s,r);return Object.assign(n,e),n},xU=t=>t?JE(t):JE,bU=()=>{};var ZE={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OR=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=r&63|128):(r&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(t.charCodeAt(++s)&1023),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=r&63|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=r&63|128)}return e},IU=function(t){const e=[];let n=0,s=0;for(;n<t.length;){const r=t[n++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=t[n++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=t[n++],o=t[n++],a=t[n++],l=((r&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=t[n++],o=t[n++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},PR={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<t.length;r+=3){const i=t[r],o=r+1<t.length,a=o?t[r+1]:0,l=r+2<t.length,u=l?t[r+2]:0,c=i>>2,h=(i&3)<<4|a>>4;let d=(a&15)<<2|u>>6,p=u&63;l||(p=64,o||(d=64)),s.push(n[c],n[h],n[d],n[p])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(OR(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):IU(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<t.length;){const i=n[t.charAt(r++)],a=r<t.length?n[t.charAt(r)]:0;++r;const u=r<t.length?n[t.charAt(r)]:64;++r;const h=r<t.length?n[t.charAt(r)]:64;if(++r,i==null||a==null||u==null||h==null)throw new SU;const d=i<<2|a>>4;if(s.push(d),u!==64){const p=a<<4&240|u>>2;if(s.push(p),h!==64){const f=u<<6&192|h;s.push(f)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class SU extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const TU=function(t){const e=OR(t);return PR.encodeByteArray(e,!0)},Vy=function(t){return TU(t).replace(/\./g,"")},FR=function(t){try{return PR.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CU(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kU=()=>CU().__FIREBASE_DEFAULTS__,EU=()=>{if(typeof process>"u"||typeof ZE>"u")return;const t=ZE.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},_U=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&FR(t[1]);return e&&JSON.parse(e)},n0=()=>{try{return bU()||kU()||EU()||_U()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},LR=t=>{var e,n;return(n=(e=n0())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},NU=t=>{const e=LR(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),s]:[e.substring(0,n),s]},MR=()=>{var t;return(t=n0())===null||t===void 0?void 0:t.config},VR=t=>{var e;return(e=n0())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $U{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,s)=>{n?this.reject(n):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AU(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},s=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[Vy(JSON.stringify(n)),Vy(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Os(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function RU(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Os())}function DU(){var t;const e=(t=n0())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function OU(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function zR(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function PU(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function FU(){const t=Os();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function LU(){return!DU()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function BR(){try{return typeof indexedDB=="object"}catch{return!1}}function UR(){return new Promise((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var i;e(((i=r.error)===null||i===void 0?void 0:i.message)||"")}}catch(n){e(n)}})}function MU(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VU="FirebaseError";class qi extends Error{constructor(e,n,s){super(n),this.code=e,this.customData=s,this.name=VU,Object.setPrototypeOf(this,qi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Xu.prototype.create)}}class Xu{constructor(e,n,s){this.service=e,this.serviceName=n,this.errors=s}create(e,...n){const s=n[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?zU(i,s):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new qi(r,a,s)}}function zU(t,e){return t.replace(BU,(n,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const BU=/\{\$([^}]+)}/g;function UU(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function sl(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const r of n){if(!s.includes(r))return!1;const i=t[r],o=e[r];if(e_(i)&&e_(o)){if(!sl(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!n.includes(r))return!1;return!0}function e_(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hf(t){const e=[];for(const[n,s]of Object.entries(t))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function qd(t){const e={};return t.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[r,i]=s.split("=");e[decodeURIComponent(r)]=decodeURIComponent(i)}}),e}function Kd(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function WU(t,e){const n=new jU(t,e);return n.subscribe.bind(n)}class jU{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,s){let r;if(e===void 0&&n===void 0&&s===void 0)throw new Error("Missing Observer.");GU(e,["next","error","complete"])?r=e:r={next:e,error:n,complete:s},r.next===void 0&&(r.next=qw),r.error===void 0&&(r.error=qw),r.complete===void 0&&(r.complete=qw);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function GU(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function qw(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HU=1e3,qU=2,KU=4*60*60*1e3,XU=.5;function t_(t,e=HU,n=qU){const s=e*Math.pow(n,t),r=Math.round(XU*s*(Math.random()-.5)*2);return Math.min(KU,s+r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xs(t){return t&&t._delegate?t._delegate:t}class Bi{constructor(e,n,s){this.name=e,this.instanceFactory=n,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jl="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YU{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const s=new $U;if(this.instancesDeferred.set(n,s),this.isInitialized(n)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:n});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(JU(e))try{this.getOrInitializeService({instanceIdentifier:Jl})}catch{}for(const[n,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=Jl){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Jl){return this.instances.has(e)}getOptions(e=Jl){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:n});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);s===a&&o.resolve(r)}return r}onInit(e,n){var s;const r=this.normalizeInstanceIdentifier(n),i=(s=this.onInitCallbacks.get(r))!==null&&s!==void 0?s:new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const s=this.onInitCallbacks.get(n);if(s)for(const r of s)try{r(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:QU(e),options:n}),this.instances.set(e,s),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Jl){return this.component?this.component.multipleInstances?e:Jl:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function QU(t){return t===Jl?void 0:t}function JU(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZU{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new YU(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var dt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(dt||(dt={}));const e9={debug:dt.DEBUG,verbose:dt.VERBOSE,info:dt.INFO,warn:dt.WARN,error:dt.ERROR,silent:dt.SILENT},t9=dt.INFO,n9={[dt.DEBUG]:"log",[dt.VERBOSE]:"log",[dt.INFO]:"info",[dt.WARN]:"warn",[dt.ERROR]:"error"},s9=(t,e,...n)=>{if(e<t.logLevel)return;const s=new Date().toISOString(),r=n9[e];if(r)console[r](`[${s}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let s0=class{constructor(e){this.name=e,this._logLevel=t9,this._logHandler=s9,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in dt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?e9[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,dt.DEBUG,...e),this._logHandler(this,dt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,dt.VERBOSE,...e),this._logHandler(this,dt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,dt.INFO,...e),this._logHandler(this,dt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,dt.WARN,...e),this._logHandler(this,dt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,dt.ERROR,...e),this._logHandler(this,dt.ERROR,...e)}};const r9=(t,e)=>e.some(n=>t instanceof n);let n_,s_;function i9(){return n_||(n_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function o9(){return s_||(s_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const WR=new WeakMap,b2=new WeakMap,jR=new WeakMap,Kw=new WeakMap,LI=new WeakMap;function a9(t){const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(Xa(t.result)),r()},o=()=>{s(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&WR.set(n,t)}).catch(()=>{}),LI.set(e,t),e}function l9(t){if(b2.has(t))return;const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),r()},o=()=>{s(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});b2.set(t,e)}let I2={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return b2.get(t);if(e==="objectStoreNames")return t.objectStoreNames||jR.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Xa(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function u9(t){I2=t(I2)}function c9(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const s=t.call(Xw(this),e,...n);return jR.set(s,e.sort?e.sort():[e]),Xa(s)}:o9().includes(t)?function(...e){return t.apply(Xw(this),e),Xa(WR.get(this))}:function(...e){return Xa(t.apply(Xw(this),e))}}function h9(t){return typeof t=="function"?c9(t):(t instanceof IDBTransaction&&l9(t),r9(t,i9())?new Proxy(t,I2):t)}function Xa(t){if(t instanceof IDBRequest)return a9(t);if(Kw.has(t))return Kw.get(t);const e=h9(t);return e!==t&&(Kw.set(t,e),LI.set(e,t)),e}const Xw=t=>LI.get(t);function GR(t,e,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(t,e),a=Xa(o);return s&&o.addEventListener("upgradeneeded",l=>{s(Xa(o.result),l.oldVersion,l.newVersion,Xa(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const d9=["get","getKey","getAll","getAllKeys","count"],p9=["put","add","delete","clear"],Yw=new Map;function r_(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Yw.get(e))return Yw.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,r=p9.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(r||d9.includes(n)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let u=l.store;return s&&(u=u.index(a.shift())),(await Promise.all([u[n](...a),r&&l.done]))[0]};return Yw.set(e,i),i}u9(t=>({...t,get:(e,n,s)=>r_(e,n)||t.get(e,n,s),has:(e,n)=>!!r_(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f9{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(m9(n)){const s=n.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(n=>n).join(" ")}}function m9(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const S2="@firebase/app",i_="0.11.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ea=new s0("@firebase/app"),g9="@firebase/app-compat",y9="@firebase/analytics-compat",v9="@firebase/analytics",w9="@firebase/app-check-compat",x9="@firebase/app-check",b9="@firebase/auth",I9="@firebase/auth-compat",S9="@firebase/database",T9="@firebase/data-connect",C9="@firebase/database-compat",k9="@firebase/functions",E9="@firebase/functions-compat",_9="@firebase/installations",N9="@firebase/installations-compat",$9="@firebase/messaging",A9="@firebase/messaging-compat",R9="@firebase/performance",D9="@firebase/performance-compat",O9="@firebase/remote-config",P9="@firebase/remote-config-compat",F9="@firebase/storage",L9="@firebase/storage-compat",M9="@firebase/firestore",V9="@firebase/vertexai",z9="@firebase/firestore-compat",B9="firebase",U9="11.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T2="[DEFAULT]",W9={[S2]:"fire-core",[g9]:"fire-core-compat",[v9]:"fire-analytics",[y9]:"fire-analytics-compat",[x9]:"fire-app-check",[w9]:"fire-app-check-compat",[b9]:"fire-auth",[I9]:"fire-auth-compat",[S9]:"fire-rtdb",[T9]:"fire-data-connect",[C9]:"fire-rtdb-compat",[k9]:"fire-fn",[E9]:"fire-fn-compat",[_9]:"fire-iid",[N9]:"fire-iid-compat",[$9]:"fire-fcm",[A9]:"fire-fcm-compat",[R9]:"fire-perf",[D9]:"fire-perf-compat",[O9]:"fire-rc",[P9]:"fire-rc-compat",[F9]:"fire-gcs",[L9]:"fire-gcs-compat",[M9]:"fire-fst",[z9]:"fire-fst-compat",[V9]:"fire-vertex","fire-js":"fire-js",[B9]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zy=new Map,j9=new Map,C2=new Map;function o_(t,e){try{t.container.addComponent(e)}catch(n){ea.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function So(t){const e=t.name;if(C2.has(e))return ea.debug(`There were multiple attempts to register component ${e}.`),!1;C2.set(e,t);for(const n of zy.values())o_(n,t);for(const n of j9.values())o_(n,t);return!0}function Yu(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Xr(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G9={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ya=new Xu("app","Firebase",G9);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H9{constructor(e,n,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Bi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ya.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zh=U9;function HR(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const s=Object.assign({name:T2,automaticDataCollectionEnabled:!1},e),r=s.name;if(typeof r!="string"||!r)throw Ya.create("bad-app-name",{appName:String(r)});if(n||(n=MR()),!n)throw Ya.create("no-options");const i=zy.get(r);if(i){if(sl(n,i.options)&&sl(s,i.config))return i;throw Ya.create("duplicate-app",{appName:r})}const o=new ZU(r);for(const l of C2.values())o.addComponent(l);const a=new H9(n,s,o);return zy.set(r,a),a}function MI(t=T2){const e=zy.get(t);if(!e&&t===T2&&MR())return HR();if(!e)throw Ya.create("no-app",{appName:t});return e}function ii(t,e,n){var s;let r=(s=W9[t])!==null&&s!==void 0?s:t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${r}" with version "${e}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ea.warn(a.join(" "));return}So(new Bi(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q9="firebase-heartbeat-database",K9=1,Pp="firebase-heartbeat-store";let Qw=null;function qR(){return Qw||(Qw=GR(q9,K9,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Pp)}catch(n){console.warn(n)}}}}).catch(t=>{throw Ya.create("idb-open",{originalErrorMessage:t.message})})),Qw}async function X9(t){try{const n=(await qR()).transaction(Pp),s=await n.objectStore(Pp).get(KR(t));return await n.done,s}catch(e){if(e instanceof qi)ea.warn(e.message);else{const n=Ya.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ea.warn(n.message)}}}async function a_(t,e){try{const s=(await qR()).transaction(Pp,"readwrite");await s.objectStore(Pp).put(e,KR(t)),await s.done}catch(n){if(n instanceof qi)ea.warn(n.message);else{const s=Ya.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});ea.warn(s.message)}}}function KR(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y9=1024,Q9=30;class J9{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new eW(n),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,n;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=l_();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:r}),this._heartbeatsCache.heartbeats.length>Q9){const o=tW(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){ea.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=l_(),{heartbeatsToSend:s,unsentEntries:r}=Z9(this._heartbeatsCache.heartbeats),i=Vy(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=n,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return ea.warn(n),""}}}function l_(){return new Date().toISOString().substring(0,10)}function Z9(t,e=Y9){const n=[];let s=t.slice();for(const r of t){const i=n.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),u_(n)>e){i.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),u_(n)>e){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}class eW{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return BR()?UR().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await X9(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const r=await this.read();return a_(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const r=await this.read();return a_(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function u_(t){return Vy(JSON.stringify({version:2,heartbeats:t})).length}function tW(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let s=1;s<t.length;s++)t[s].date<n&&(n=t[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nW(t){So(new Bi("platform-logger",e=>new f9(e),"PRIVATE")),So(new Bi("heartbeat",e=>new J9(e),"PRIVATE")),ii(S2,i_,t),ii(S2,i_,"esm2017"),ii("fire-js","")}nW("");function VI(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n}function XR(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const sW=XR,YR=new Xu("auth","Firebase",XR());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const By=new s0("@firebase/auth");function rW(t,...e){By.logLevel<=dt.WARN&&By.warn(`Auth (${zh}): ${t}`,...e)}function ny(t,...e){By.logLevel<=dt.ERROR&&By.error(`Auth (${zh}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ui(t,...e){throw zI(t,...e)}function yo(t,...e){return zI(t,...e)}function QR(t,e,n){const s=Object.assign(Object.assign({},sW()),{[e]:n});return new Xu("auth","Firebase",s).create(e,{appName:t.name})}function Go(t){return QR(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function zI(t,...e){if(typeof t!="string"){const n=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=t.name),t._errorFactory.create(n,...s)}return YR.create(t,...e)}function qe(t,e,...n){if(!t)throw zI(e,...n)}function Uo(t){const e="INTERNAL ASSERTION FAILED: "+t;throw ny(e),new Error(e)}function ta(t,e){t||Uo(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k2(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function iW(){return c_()==="http:"||c_()==="https:"}function c_(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oW(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(iW()||zR()||"connection"in navigator)?navigator.onLine:!0}function aW(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class df{constructor(e,n){this.shortDelay=e,this.longDelay=n,ta(n>e,"Short delay should be less than long delay!"),this.isMobile=RU()||PU()}get(){return oW()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BI(t,e){ta(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JR{static initialize(e,n,s){this.fetchImpl=e,n&&(this.headersImpl=n),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Uo("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Uo("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Uo("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lW={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uW=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],cW=new df(3e4,6e4);function Il(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Sl(t,e,n,s,r={}){return ZR(t,r,async()=>{let i={},o={};s&&(e==="GET"?o=s:i={body:JSON.stringify(s)});const a=hf(Object.assign({key:t.config.apiKey},o)).slice(1),l=await t._getAdditionalHeaders();l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode);const u=Object.assign({method:e,headers:l},i);return OU()||(u.referrerPolicy="no-referrer"),JR.fetch()(await e4(t,t.config.apiHost,n,a),u)})}async function ZR(t,e,n){t._canInitEmulator=!1;const s=Object.assign(Object.assign({},lW),e);try{const r=new dW(t),i=await Promise.race([n(),r.promise]);r.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Sg(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Sg(t,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Sg(t,"email-already-in-use",o);if(l==="USER_DISABLED")throw Sg(t,"user-disabled",o);const c=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw QR(t,c,u);Ui(t,c)}}catch(r){if(r instanceof qi)throw r;Ui(t,"network-request-failed",{message:String(r)})}}async function pf(t,e,n,s,r={}){const i=await Sl(t,e,n,s,r);return"mfaPendingCredential"in i&&Ui(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function e4(t,e,n,s){const r=`${e}${n}?${s}`,i=t,o=i.config.emulator?BI(t.config,r):`${t.config.apiScheme}://${r}`;return uW.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function hW(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class dW{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,s)=>{this.timer=setTimeout(()=>s(yo(this.auth,"network-request-failed")),cW.get())})}}function Sg(t,e,n){const s={appName:t.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const r=yo(t,e,s);return r.customData._tokenResponse=n,r}function h_(t){return t!==void 0&&t.enterprise!==void 0}class pW{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return hW(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function fW(t,e){return Sl(t,"GET","/v2/recaptchaConfig",Il(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mW(t,e){return Sl(t,"POST","/v1/accounts:delete",e)}async function Uy(t,e){return Sl(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hp(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function gW(t,e=!1){const n=Xs(t),s=await n.getIdToken(e),r=UI(s);qe(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:r,token:s,authTime:hp(Jw(r.auth_time)),issuedAtTime:hp(Jw(r.iat)),expirationTime:hp(Jw(r.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Jw(t){return Number(t)*1e3}function UI(t){const[e,n,s]=t.split(".");if(e===void 0||n===void 0||s===void 0)return ny("JWT malformed, contained fewer than 3 sections"),null;try{const r=FR(n);return r?JSON.parse(r):(ny("Failed to decode base64 JWT payload"),null)}catch(r){return ny("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function d_(t){const e=UI(t);return qe(e,"internal-error"),qe(typeof e.exp<"u","internal-error"),qe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fp(t,e,n=!1){if(n)return e;try{return await e}catch(s){throw s instanceof qi&&yW(s)&&t.auth.currentUser===t&&await t.auth.signOut(),s}}function yW({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vW{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const r=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E2{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=hp(this.lastLoginAt),this.creationTime=hp(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wy(t){var e;const n=t.auth,s=await t.getIdToken(),r=await Fp(t,Uy(n,{idToken:s}));qe(r==null?void 0:r.users.length,n,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?t4(i.providerUserInfo):[],a=xW(t.providerData,o),l=t.isAnonymous,u=!(t.email&&i.passwordHash)&&!(a!=null&&a.length),c=l?u:!1,h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new E2(i.createdAt,i.lastLoginAt),isAnonymous:c};Object.assign(t,h)}async function wW(t){const e=Xs(t);await Wy(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function xW(t,e){return[...t.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function t4(t){return t.map(e=>{var{providerId:n}=e,s=VI(e,["providerId"]);return{providerId:n,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bW(t,e){const n=await ZR(t,{},async()=>{const s=hf({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=t.config,o=await e4(t,r,"/v1/token",`key=${i}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",JR.fetch()(o,{method:"POST",headers:a,body:s})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function IW(t,e){return Sl(t,"POST","/v2/accounts:revokeToken",Il(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){qe(e.idToken,"internal-error"),qe(typeof e.idToken<"u","internal-error"),qe(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):d_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){qe(e.length!==0,"internal-error");const n=d_(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(qe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:s,refreshToken:r,expiresIn:i}=await bW(e,n);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,n,s){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,n){const{refreshToken:s,accessToken:r,expirationTime:i}=n,o=new eh;return s&&(qe(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(qe(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),i&&(qe(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new eh,this.toJSON())}_performRefresh(){return Uo("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ka(t,e){qe(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Ri{constructor(e){var{uid:n,auth:s,stsTokenManager:r}=e,i=VI(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new vW(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=s,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new E2(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Fp(this,this.stsTokenManager.getToken(this.auth,e));return qe(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return gW(this,e)}reload(){return wW(this)}_assign(e){this!==e&&(qe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Ri(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){qe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),n&&await Wy(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Xr(this.auth.app))return Promise.reject(Go(this.auth));const e=await this.getIdToken();return await Fp(this,mW(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var s,r,i,o,a,l,u,c;const h=(s=n.displayName)!==null&&s!==void 0?s:void 0,d=(r=n.email)!==null&&r!==void 0?r:void 0,p=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,f=(o=n.photoURL)!==null&&o!==void 0?o:void 0,m=(a=n.tenantId)!==null&&a!==void 0?a:void 0,v=(l=n._redirectEventId)!==null&&l!==void 0?l:void 0,y=(u=n.createdAt)!==null&&u!==void 0?u:void 0,w=(c=n.lastLoginAt)!==null&&c!==void 0?c:void 0,{uid:b,emailVerified:I,isAnonymous:k,providerData:R,stsTokenManager:C}=n;qe(b&&C,e,"internal-error");const T=eh.fromJSON(this.name,C);qe(typeof b=="string",e,"internal-error"),ka(h,e.name),ka(d,e.name),qe(typeof I=="boolean",e,"internal-error"),qe(typeof k=="boolean",e,"internal-error"),ka(p,e.name),ka(f,e.name),ka(m,e.name),ka(v,e.name),ka(y,e.name),ka(w,e.name);const N=new Ri({uid:b,auth:e,email:d,emailVerified:I,displayName:h,isAnonymous:k,photoURL:f,phoneNumber:p,tenantId:m,stsTokenManager:T,createdAt:y,lastLoginAt:w});return R&&Array.isArray(R)&&(N.providerData=R.map($=>Object.assign({},$))),v&&(N._redirectEventId=v),N}static async _fromIdTokenResponse(e,n,s=!1){const r=new eh;r.updateFromServerResponse(n);const i=new Ri({uid:n.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await Wy(i),i}static async _fromGetAccountInfoResponse(e,n,s){const r=n.users[0];qe(r.localId!==void 0,"internal-error");const i=r.providerUserInfo!==void 0?t4(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!(i!=null&&i.length),a=new eh;a.updateFromIdToken(s);const l=new Ri({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new E2(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p_=new Map;function Wo(t){ta(t instanceof Function,"Expected a class definition");let e=p_.get(t);return e?(ta(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,p_.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n4{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}n4.type="NONE";const f_=n4;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sy(t,e,n){return`firebase:${t}:${e}:${n}`}class th{constructor(e,n,s){this.persistence=e,this.auth=n,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=sy(this.userKey,r.apiKey,i),this.fullPersistenceKey=sy("persistence",r.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Uy(this.auth,{idToken:e}).catch(()=>{});return n?Ri._fromGetAccountInfoResponse(this.auth,n,e):null}return Ri._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,s="authUser"){if(!n.length)return new th(Wo(f_),e,s);const r=(await Promise.all(n.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=r[0]||Wo(f_);const o=sy(s,e.config.apiKey,e.name);let a=null;for(const u of n)try{const c=await u._get(o);if(c){let h;if(typeof c=="string"){const d=await Uy(e,{idToken:c}).catch(()=>{});if(!d)break;h=await Ri._fromGetAccountInfoResponse(e,d,c)}else h=Ri._fromJSON(e,c);u!==i&&(a=h),i=u;break}}catch{}const l=r.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new th(i,e,s):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(n.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new th(i,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m_(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(o4(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(s4(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(l4(e))return"Blackberry";if(u4(e))return"Webos";if(r4(e))return"Safari";if((e.includes("chrome/")||i4(e))&&!e.includes("edge/"))return"Chrome";if(a4(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=t.match(n);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function s4(t=Os()){return/firefox\//i.test(t)}function r4(t=Os()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function i4(t=Os()){return/crios\//i.test(t)}function o4(t=Os()){return/iemobile/i.test(t)}function a4(t=Os()){return/android/i.test(t)}function l4(t=Os()){return/blackberry/i.test(t)}function u4(t=Os()){return/webos/i.test(t)}function WI(t=Os()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function SW(t=Os()){var e;return WI(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function TW(){return FU()&&document.documentMode===10}function c4(t=Os()){return WI(t)||a4(t)||u4(t)||l4(t)||/windows phone/i.test(t)||o4(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h4(t,e=[]){let n;switch(t){case"Browser":n=m_(Os());break;case"Worker":n=`${m_(Os())}-${t}`;break;default:n=t}const s=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${zh}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CW{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const s=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});s.onAbort=n,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const s of this.queue)await s(e),s.onAbort&&n.push(s.onAbort)}catch(s){n.reverse();for(const r of n)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kW(t,e={}){return Sl(t,"GET","/v2/passwordPolicy",Il(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EW=6;class _W{constructor(e){var n,s,r,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:EW,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(r=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&r!==void 0?r:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,s,r,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(n=l.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),l.isValid&&(l.isValid=(s=l.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(r=l.containsLowercaseLetter)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,n){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(n.meetsMinPasswordLength=e.length>=s),r&&(n.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(n,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,n,s,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NW{constructor(e,n,s,r){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new g_(this),this.idTokenSubscription=new g_(this),this.beforeStateQueue=new CW(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=YR,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Wo(n)),this._initializationPromise=this.queue(async()=>{var s,r,i;if(!this._deleted&&(this.persistenceManager=await th.create(this,e),(s=this._resolvePersistenceManagerAvailable)===null||s===void 0||s.call(this),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Uy(this,{idToken:e}),s=await Ri._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(s)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(Xr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let r=s,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return qe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Wy(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=aW()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Xr(this.app))return Promise.reject(Go(this));const n=e?Xs(e):null;return n&&qe(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&qe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Xr(this.app)?Promise.reject(Go(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Xr(this.app)?Promise.reject(Go(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Wo(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await kW(this),n=new _W(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Xu("auth","Firebase",e())}onAuthStateChanged(e,n,s){return this.registerStateListener(this.authStateSubscription,e,n,s)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,s){return this.registerStateListener(this.idTokenSubscription,e,n,s)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(s.tenantId=this.tenantId),await IW(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const s=await this.getOrInitRedirectPersistenceManager(n);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Wo(e)||this._popupRedirectResolver;qe(n,this,"argument-error"),this.redirectPersistenceManager=await th.create(this,[Wo(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,s;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,s,r){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(qe(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const l=e.addObserver(n,s,r);return()=>{o=!0,l()}}else{const l=e.addObserver(n);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return qe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=h4(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(n["X-Firebase-Client"]=s);const r=await this._getAppCheckToken();return r&&(n["X-Firebase-AppCheck"]=r),n}async _getAppCheckToken(){var e;if(Xr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&rW(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Qu(t){return Xs(t)}class g_{constructor(e){this.auth=e,this.observer=null,this.addObserver=WU(n=>this.observer=n)}get next(){return qe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r0={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function $W(t){r0=t}function d4(t){return r0.loadJS(t)}function AW(){return r0.recaptchaEnterpriseScript}function RW(){return r0.gapiScript}function DW(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class OW{constructor(){this.enterprise=new PW}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class PW{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const FW="recaptcha-enterprise",p4="NO_RECAPTCHA";class LW{constructor(e){this.type=FW,this.auth=Qu(e)}async verify(e="verify",n=!1){async function s(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{fW(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new pW(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function r(i,o,a){const l=window.grecaptcha;h_(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(p4)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new OW().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{s(this.auth).then(a=>{if(!n&&h_(window.grecaptcha))r(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=AW();l.length!==0&&(l+=a),d4(l).then(()=>{r(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function y_(t,e,n,s=!1,r=!1){const i=new LW(t);let o;if(r)o=p4;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const a=Object.assign({},e);if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return s?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function _2(t,e,n,s,r){var i;if(!((i=t._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await y_(t,e,n,n==="getOobCode");return s(t,o)}else return s(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await y_(t,e,n,n==="getOobCode");return s(t,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MW(t,e){const n=Yu(t,"auth");if(n.isInitialized()){const r=n.getImmediate(),i=n.getOptions();if(sl(i,e??{}))return r;Ui(r,"already-initialized")}return n.initialize({options:e})}function VW(t,e){const n=(e==null?void 0:e.persistence)||[],s=(Array.isArray(n)?n:[n]).map(Wo);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function zW(t,e,n){const s=Qu(t);qe(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!1,i=f4(e),{host:o,port:a}=BW(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},c=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!s._canInitEmulator){qe(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),qe(sl(u,s.config.emulator)&&sl(c,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=u,s.emulatorConfig=c,s.settings.appVerificationDisabledForTesting=!0,UW()}function f4(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function BW(t){const e=f4(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:v_(s.substr(i.length+1))}}else{const[i,o]=s.split(":");return{host:i,port:v_(o)}}}function v_(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function UW(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jI{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Uo("not implemented")}_getIdTokenResponse(e){return Uo("not implemented")}_linkToIdToken(e,n){return Uo("not implemented")}_getReauthenticationResolver(e){return Uo("not implemented")}}async function WW(t,e){return Sl(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jW(t,e){return pf(t,"POST","/v1/accounts:signInWithPassword",Il(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GW(t,e){return pf(t,"POST","/v1/accounts:signInWithEmailLink",Il(t,e))}async function HW(t,e){return pf(t,"POST","/v1/accounts:signInWithEmailLink",Il(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lp extends jI{constructor(e,n,s,r=null){super("password",s),this._email=e,this._password=n,this._tenantId=r}static _fromEmailAndPassword(e,n){return new Lp(e,n,"password")}static _fromEmailAndCode(e,n,s=null){return new Lp(e,n,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _2(e,n,"signInWithPassword",jW);case"emailLink":return GW(e,{email:this._email,oobCode:this._password});default:Ui(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const s={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _2(e,s,"signUpPassword",WW);case"emailLink":return HW(e,{idToken:n,email:this._email,oobCode:this._password});default:Ui(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nh(t,e){return pf(t,"POST","/v1/accounts:signInWithIdp",Il(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qW="http://localhost";class Tu extends jI{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Tu(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Ui("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r}=n,i=VI(n,["providerId","signInMethod"]);if(!s||!r)return null;const o=new Tu(s,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return nh(e,n)}_linkToIdToken(e,n){const s=this.buildRequest();return s.idToken=n,nh(e,s)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,nh(e,n)}buildRequest(){const e={requestUri:qW,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=hf(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KW(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function XW(t){const e=qd(Kd(t)).link,n=e?qd(Kd(e)).deep_link_id:null,s=qd(Kd(t)).deep_link_id;return(s?qd(Kd(s)).link:null)||s||n||e||t}class GI{constructor(e){var n,s,r,i,o,a;const l=qd(Kd(e)),u=(n=l.apiKey)!==null&&n!==void 0?n:null,c=(s=l.oobCode)!==null&&s!==void 0?s:null,h=KW((r=l.mode)!==null&&r!==void 0?r:null);qe(u&&c&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=c,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const n=XW(e);try{return new GI(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bh{constructor(){this.providerId=Bh.PROVIDER_ID}static credential(e,n){return Lp._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const s=GI.parseLink(n);return qe(s,"argument-error"),Lp._fromEmailAndCode(e,s.code,s.tenantId)}}Bh.PROVIDER_ID="password";Bh.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Bh.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m4{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ff extends m4{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra extends ff{constructor(){super("facebook.com")}static credential(e){return Tu._fromParams({providerId:Ra.PROVIDER_ID,signInMethod:Ra.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ra.credentialFromTaggedObject(e)}static credentialFromError(e){return Ra.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ra.credential(e.oauthAccessToken)}catch{return null}}}Ra.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ra.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Da extends ff{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Tu._fromParams({providerId:Da.PROVIDER_ID,signInMethod:Da.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Da.credentialFromTaggedObject(e)}static credentialFromError(e){return Da.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:s}=e;if(!n&&!s)return null;try{return Da.credential(n,s)}catch{return null}}}Da.GOOGLE_SIGN_IN_METHOD="google.com";Da.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa extends ff{constructor(){super("github.com")}static credential(e){return Tu._fromParams({providerId:Oa.PROVIDER_ID,signInMethod:Oa.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Oa.credentialFromTaggedObject(e)}static credentialFromError(e){return Oa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Oa.credential(e.oauthAccessToken)}catch{return null}}}Oa.GITHUB_SIGN_IN_METHOD="github.com";Oa.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa extends ff{constructor(){super("twitter.com")}static credential(e,n){return Tu._fromParams({providerId:Pa.PROVIDER_ID,signInMethod:Pa.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Pa.credentialFromTaggedObject(e)}static credentialFromError(e){return Pa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:s}=e;if(!n||!s)return null;try{return Pa.credential(n,s)}catch{return null}}}Pa.TWITTER_SIGN_IN_METHOD="twitter.com";Pa.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YW(t,e){return pf(t,"POST","/v1/accounts:signUp",Il(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,s,r=!1){const i=await Ri._fromIdTokenResponse(e,s,r),o=w_(s);return new Cu({user:i,providerId:o,_tokenResponse:s,operationType:n})}static async _forOperation(e,n,s){await e._updateTokensIfNecessary(s,!0);const r=w_(s);return new Cu({user:e,providerId:r,_tokenResponse:s,operationType:n})}}function w_(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jy extends qi{constructor(e,n,s,r){var i;super(n.code,n.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,jy.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,n,s,r){return new jy(e,n,s,r)}}function g4(t,e,n,s){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?jy._fromErrorAndOperation(t,i,e,s):i})}async function QW(t,e,n=!1){const s=await Fp(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Cu._forOperation(t,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JW(t,e,n=!1){const{auth:s}=t;if(Xr(s.app))return Promise.reject(Go(s));const r="reauthenticate";try{const i=await Fp(t,g4(s,r,e,t),n);qe(i.idToken,s,"internal-error");const o=UI(i.idToken);qe(o,s,"internal-error");const{sub:a}=o;return qe(t.uid===a,s,"user-mismatch"),Cu._forOperation(t,r,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Ui(s,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y4(t,e,n=!1){if(Xr(t.app))return Promise.reject(Go(t));const s="signIn",r=await g4(t,s,e),i=await Cu._fromIdTokenResponse(t,s,r);return n||await t._updateCurrentUser(i.user),i}async function ZW(t,e){return y4(Qu(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v4(t){const e=Qu(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function e8(t,e,n){if(Xr(t.app))return Promise.reject(Go(t));const s=Qu(t),o=await _2(s,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",YW).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&v4(t),l}),a=await Cu._fromIdTokenResponse(s,"signIn",o);return await s._updateCurrentUser(a.user),a}function t8(t,e,n){return Xr(t.app)?Promise.reject(Go(t)):ZW(Xs(t),Bh.credential(e,n)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&v4(t),s})}function n8(t,e,n,s){return Xs(t).onIdTokenChanged(e,n,s)}function s8(t,e,n){return Xs(t).beforeAuthStateChanged(e,n)}function r8(t,e,n,s){return Xs(t).onAuthStateChanged(e,n,s)}function i8(t){return Xs(t).signOut()}const Gy="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w4{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Gy,"1"),this.storage.removeItem(Gy),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o8=1e3,a8=10;class x4 extends w4{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=c4(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const s=this.storage.getItem(n),r=this.localCache[n];s!==r&&e(n,r,s)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;n?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(s);!n&&this.localCache[s]===o||this.notifyListeners(s,o)},i=this.storage.getItem(s);TW()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,a8):r()}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:s}),!0)})},o8)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}x4.type="LOCAL";const l8=x4;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b4 extends w4{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}b4.type="SESSION";const I4=b4;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u8(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(r=>r.isListeningto(e));if(n)return n;const s=new i0(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:s,eventType:r,data:i}=n.data,o=this.handlersMap[r];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(o).map(async u=>u(n.origin,i)),l=await u8(a);n.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}i0.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HI(t="",e=10){let n="";for(let s=0;s<e;s++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c8{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=HI("",20);r.port1.start();const c=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(h){const d=h;if(d.data.eventId===u)switch(d.data.status){case"ack":clearTimeout(c),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(d.data.response);break;default:clearTimeout(c),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:n},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vo(){return window}function h8(t){vo().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S4(){return typeof vo().WorkerGlobalScope<"u"&&typeof vo().importScripts=="function"}async function d8(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function p8(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function f8(){return S4()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T4="firebaseLocalStorageDb",m8=1,Hy="firebaseLocalStorage",C4="fbase_key";class mf{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function o0(t,e){return t.transaction([Hy],e?"readwrite":"readonly").objectStore(Hy)}function g8(){const t=indexedDB.deleteDatabase(T4);return new mf(t).toPromise()}function N2(){const t=indexedDB.open(T4,m8);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const s=t.result;try{s.createObjectStore(Hy,{keyPath:C4})}catch(r){n(r)}}),t.addEventListener("success",async()=>{const s=t.result;s.objectStoreNames.contains(Hy)?e(s):(s.close(),await g8(),e(await N2()))})})}async function x_(t,e,n){const s=o0(t,!0).put({[C4]:e,value:n});return new mf(s).toPromise()}async function y8(t,e){const n=o0(t,!1).get(e),s=await new mf(n).toPromise();return s===void 0?null:s.value}function b_(t,e){const n=o0(t,!0).delete(e);return new mf(n).toPromise()}const v8=800,w8=3;class k4{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await N2(),this.db)}async _withRetries(e){let n=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(n++>w8)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return S4()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=i0._getInstance(f8()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await d8(),!this.activeServiceWorker)return;this.sender=new c8(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((n=s[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||p8()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await N2();return await x_(e,Gy,"1"),await b_(e,Gy),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(s=>x_(s,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(s=>y8(s,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>b_(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=o0(r,!1).getAll();return new mf(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),n.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),n.push(r));return n}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),v8)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}k4.type="LOCAL";const x8=k4;new df(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b8(t,e){return e?Wo(e):(qe(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qI extends jI{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return nh(e,this._buildIdpRequest())}_linkToIdToken(e,n){return nh(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return nh(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function I8(t){return y4(t.auth,new qI(t),t.bypassAuthState)}function S8(t){const{auth:e,user:n}=t;return qe(n,e,"internal-error"),JW(n,new qI(t),t.bypassAuthState)}async function T8(t){const{auth:e,user:n}=t;return qe(n,e,"internal-error"),QW(n,new qI(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E4{constructor(e,n,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:s,postBody:r,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:n,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return I8;case"linkViaPopup":case"linkViaRedirect":return T8;case"reauthViaPopup":case"reauthViaRedirect":return S8;default:Ui(this.auth,"internal-error")}}resolve(e){ta(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ta(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C8=new df(2e3,1e4);class Hc extends E4{constructor(e,n,s,r,i){super(e,n,r,i),this.provider=s,this.authWindow=null,this.pollId=null,Hc.currentPopupAction&&Hc.currentPopupAction.cancel(),Hc.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return qe(e,this.auth,"internal-error"),e}async onExecution(){ta(this.filter.length===1,"Popup operations only handle one event");const e=HI();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(yo(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(yo(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Hc.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,s;if(!((s=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(yo(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,C8.get())};e()}}Hc.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k8="pendingRedirect",ry=new Map;class E8 extends E4{constructor(e,n,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,s),this.eventId=null}async execute(){let e=ry.get(this.auth._key());if(!e){try{const s=await _8(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(n){e=()=>Promise.reject(n)}ry.set(this.auth._key(),e)}return this.bypassAuthState||ry.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function _8(t,e){const n=A8(e),s=$8(t);if(!await s._isAvailable())return!1;const r=await s._get(n)==="true";return await s._remove(n),r}function N8(t,e){ry.set(t._key(),e)}function $8(t){return Wo(t._redirectPersistence)}function A8(t){return sy(k8,t.config.apiKey,t.name)}async function R8(t,e,n=!1){if(Xr(t.app))return Promise.reject(Go(t));const s=Qu(t),r=b8(s,e),o=await new E8(s,r,n).execute();return o&&!n&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D8=10*60*1e3;class O8{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(n=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!P8(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var s;if(e.error&&!_4(e)){const r=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";n.onError(yo(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const s=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=D8&&this.cachedEventUids.clear(),this.cachedEventUids.has(I_(e))}saveEventToCache(e){this.cachedEventUids.add(I_(e)),this.lastProcessedEventTime=Date.now()}}function I_(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function _4({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function P8(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return _4(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F8(t,e={}){return Sl(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L8=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,M8=/^https?/;async function V8(t){if(t.config.emulator)return;const{authorizedDomains:e}=await F8(t);for(const n of e)try{if(z8(n))return}catch{}Ui(t,"unauthorized-domain")}function z8(t){const e=k2(),{protocol:n,hostname:s}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&s===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===s}if(!M8.test(n))return!1;if(L8.test(t))return s===t;const r=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B8=new df(3e4,6e4);function S_(){const t=vo().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function U8(t){return new Promise((e,n)=>{var s,r,i;function o(){S_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{S_(),n(yo(t,"network-request-failed"))},timeout:B8.get()})}if(!((r=(s=vo().gapi)===null||s===void 0?void 0:s.iframes)===null||r===void 0)&&r.Iframe)e(gapi.iframes.getContext());else if(!((i=vo().gapi)===null||i===void 0)&&i.load)o();else{const a=DW("iframefcb");return vo()[a]=()=>{gapi.load?o():n(yo(t,"network-request-failed"))},d4(`${RW()}?onload=${a}`).catch(l=>n(l))}}).catch(e=>{throw iy=null,e})}let iy=null;function W8(t){return iy=iy||U8(t),iy}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j8=new df(5e3,15e3),G8="__/auth/iframe",H8="emulator/auth/iframe",q8={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},K8=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function X8(t){const e=t.config;qe(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?BI(e,H8):`https://${t.config.authDomain}/${G8}`,s={apiKey:e.apiKey,appName:t.name,v:zh},r=K8.get(t.config.apiHost);r&&(s.eid=r);const i=t._getFrameworks();return i.length&&(s.fw=i.join(",")),`${n}?${hf(s).slice(1)}`}async function Y8(t){const e=await W8(t),n=vo().gapi;return qe(n,t,"internal-error"),e.open({where:document.body,url:X8(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:q8,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const o=yo(t,"network-request-failed"),a=vo().setTimeout(()=>{i(o)},j8.get());function l(){vo().clearTimeout(a),r(s)}s.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q8={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},J8=500,Z8=600,e7="_blank",t7="http://localhost";class T_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function n7(t,e,n,s=J8,r=Z8){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l=Object.assign(Object.assign({},Q8),{width:s.toString(),height:r.toString(),top:i,left:o}),u=Os().toLowerCase();n&&(a=i4(u)?e7:n),s4(u)&&(e=e||t7,l.scrollbars="yes");const c=Object.entries(l).reduce((d,[p,f])=>`${d}${p}=${f},`,"");if(SW(u)&&a!=="_self")return s7(e||"",a),new T_(null);const h=window.open(e||"",a,c);qe(h,t,"popup-blocked");try{h.focus()}catch{}return new T_(h)}function s7(t,e){const n=document.createElement("a");n.href=t,n.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r7="__/auth/handler",i7="emulator/auth/handler",o7=encodeURIComponent("fac");async function C_(t,e,n,s,r,i){qe(t.config.authDomain,t,"auth-domain-config-required"),qe(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:s,v:zh,eventId:r};if(e instanceof m4){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",UU(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,h]of Object.entries({}))o[c]=h}if(e instanceof ff){const c=e.getScopes().filter(h=>h!=="");c.length>0&&(o.scopes=c.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const c of Object.keys(a))a[c]===void 0&&delete a[c];const l=await t._getAppCheckToken(),u=l?`#${o7}=${encodeURIComponent(l)}`:"";return`${a7(t)}?${hf(a).slice(1)}${u}`}function a7({config:t}){return t.emulator?BI(t,i7):`https://${t.authDomain}/${r7}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zw="webStorageSupport";class l7{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=I4,this._completeRedirectFn=R8,this._overrideRedirectResult=N8}async _openPopup(e,n,s,r){var i;ta((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await C_(e,n,s,k2(),r);return n7(e,o,HI())}async _openRedirect(e,n,s,r){await this._originValidation(e);const i=await C_(e,n,s,k2(),r);return h8(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:r,promise:i}=this.eventManagers[n];return r?Promise.resolve(r):(ta(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[n]={promise:s},s.catch(()=>{delete this.eventManagers[n]}),s}async initAndGetManager(e){const n=await Y8(e),s=new O8(e);return n.register("authEvent",r=>(qe(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=n,s}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Zw,{type:Zw},r=>{var i;const o=(i=r==null?void 0:r[0])===null||i===void 0?void 0:i[Zw];o!==void 0&&n(!!o),Ui(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=V8(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return c4()||r4()||WI()}}const u7=l7;var k_="@firebase/auth",E_="1.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c7{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){qe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h7(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function d7(t){So(new Bi("auth",(e,{options:n})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;qe(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:h4(t)},u=new NW(s,r,i,l);return VW(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,s)=>{e.getProvider("auth-internal").initialize()})),So(new Bi("auth-internal",e=>{const n=Qu(e.getProvider("auth").getImmediate());return(s=>new c7(s))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),ii(k_,E_,h7(t)),ii(k_,E_,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p7=5*60,f7=VR("authIdTokenMaxAge")||p7;let __=null;const m7=t=>async e=>{const n=e&&await e.getIdTokenResult(),s=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(s&&s>f7)return;const r=n==null?void 0:n.token;__!==r&&(__=r,await fetch(t,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function g7(t=MI()){const e=Yu(t,"auth");if(e.isInitialized())return e.getImmediate();const n=MW(t,{popupRedirectResolver:u7,persistence:[x8,l8,I4]}),s=VR("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(s,location.origin);if(location.origin===i.origin){const o=m7(i.toString());s8(n,o,()=>o(n.currentUser)),n8(n,a=>o(a))}}const r=LR("auth");return r&&zW(n,`http://${r}`),n}function y7(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}$W({loadJS(t){return new Promise((e,n)=>{const s=document.createElement("script");s.setAttribute("src",t),s.onload=e,s.onerror=r=>{const i=yo("internal-error");i.customData=r,n(i)},s.type="text/javascript",s.charset="UTF-8",y7().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});d7("Browser");var v7="firebase",w7="11.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ii(v7,w7,"app");var N_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var KI;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(C,T){function N(){}N.prototype=T.prototype,C.D=T.prototype,C.prototype=new N,C.prototype.constructor=C,C.C=function($,P,V){for(var O=Array(arguments.length-2),Q=2;Q<arguments.length;Q++)O[Q-2]=arguments[Q];return T.prototype[P].apply($,O)}}function n(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(s,n),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(C,T,N){N||(N=0);var $=Array(16);if(typeof T=="string")for(var P=0;16>P;++P)$[P]=T.charCodeAt(N++)|T.charCodeAt(N++)<<8|T.charCodeAt(N++)<<16|T.charCodeAt(N++)<<24;else for(P=0;16>P;++P)$[P]=T[N++]|T[N++]<<8|T[N++]<<16|T[N++]<<24;T=C.g[0],N=C.g[1],P=C.g[2];var V=C.g[3],O=T+(V^N&(P^V))+$[0]+3614090360&4294967295;T=N+(O<<7&4294967295|O>>>25),O=V+(P^T&(N^P))+$[1]+3905402710&4294967295,V=T+(O<<12&4294967295|O>>>20),O=P+(N^V&(T^N))+$[2]+606105819&4294967295,P=V+(O<<17&4294967295|O>>>15),O=N+(T^P&(V^T))+$[3]+3250441966&4294967295,N=P+(O<<22&4294967295|O>>>10),O=T+(V^N&(P^V))+$[4]+4118548399&4294967295,T=N+(O<<7&4294967295|O>>>25),O=V+(P^T&(N^P))+$[5]+1200080426&4294967295,V=T+(O<<12&4294967295|O>>>20),O=P+(N^V&(T^N))+$[6]+2821735955&4294967295,P=V+(O<<17&4294967295|O>>>15),O=N+(T^P&(V^T))+$[7]+4249261313&4294967295,N=P+(O<<22&4294967295|O>>>10),O=T+(V^N&(P^V))+$[8]+1770035416&4294967295,T=N+(O<<7&4294967295|O>>>25),O=V+(P^T&(N^P))+$[9]+2336552879&4294967295,V=T+(O<<12&4294967295|O>>>20),O=P+(N^V&(T^N))+$[10]+4294925233&4294967295,P=V+(O<<17&4294967295|O>>>15),O=N+(T^P&(V^T))+$[11]+2304563134&4294967295,N=P+(O<<22&4294967295|O>>>10),O=T+(V^N&(P^V))+$[12]+1804603682&4294967295,T=N+(O<<7&4294967295|O>>>25),O=V+(P^T&(N^P))+$[13]+4254626195&4294967295,V=T+(O<<12&4294967295|O>>>20),O=P+(N^V&(T^N))+$[14]+2792965006&4294967295,P=V+(O<<17&4294967295|O>>>15),O=N+(T^P&(V^T))+$[15]+1236535329&4294967295,N=P+(O<<22&4294967295|O>>>10),O=T+(P^V&(N^P))+$[1]+4129170786&4294967295,T=N+(O<<5&4294967295|O>>>27),O=V+(N^P&(T^N))+$[6]+3225465664&4294967295,V=T+(O<<9&4294967295|O>>>23),O=P+(T^N&(V^T))+$[11]+643717713&4294967295,P=V+(O<<14&4294967295|O>>>18),O=N+(V^T&(P^V))+$[0]+3921069994&4294967295,N=P+(O<<20&4294967295|O>>>12),O=T+(P^V&(N^P))+$[5]+3593408605&4294967295,T=N+(O<<5&4294967295|O>>>27),O=V+(N^P&(T^N))+$[10]+38016083&4294967295,V=T+(O<<9&4294967295|O>>>23),O=P+(T^N&(V^T))+$[15]+3634488961&4294967295,P=V+(O<<14&4294967295|O>>>18),O=N+(V^T&(P^V))+$[4]+3889429448&4294967295,N=P+(O<<20&4294967295|O>>>12),O=T+(P^V&(N^P))+$[9]+568446438&4294967295,T=N+(O<<5&4294967295|O>>>27),O=V+(N^P&(T^N))+$[14]+3275163606&4294967295,V=T+(O<<9&4294967295|O>>>23),O=P+(T^N&(V^T))+$[3]+4107603335&4294967295,P=V+(O<<14&4294967295|O>>>18),O=N+(V^T&(P^V))+$[8]+1163531501&4294967295,N=P+(O<<20&4294967295|O>>>12),O=T+(P^V&(N^P))+$[13]+2850285829&4294967295,T=N+(O<<5&4294967295|O>>>27),O=V+(N^P&(T^N))+$[2]+4243563512&4294967295,V=T+(O<<9&4294967295|O>>>23),O=P+(T^N&(V^T))+$[7]+1735328473&4294967295,P=V+(O<<14&4294967295|O>>>18),O=N+(V^T&(P^V))+$[12]+2368359562&4294967295,N=P+(O<<20&4294967295|O>>>12),O=T+(N^P^V)+$[5]+4294588738&4294967295,T=N+(O<<4&4294967295|O>>>28),O=V+(T^N^P)+$[8]+2272392833&4294967295,V=T+(O<<11&4294967295|O>>>21),O=P+(V^T^N)+$[11]+1839030562&4294967295,P=V+(O<<16&4294967295|O>>>16),O=N+(P^V^T)+$[14]+4259657740&4294967295,N=P+(O<<23&4294967295|O>>>9),O=T+(N^P^V)+$[1]+2763975236&4294967295,T=N+(O<<4&4294967295|O>>>28),O=V+(T^N^P)+$[4]+1272893353&4294967295,V=T+(O<<11&4294967295|O>>>21),O=P+(V^T^N)+$[7]+4139469664&4294967295,P=V+(O<<16&4294967295|O>>>16),O=N+(P^V^T)+$[10]+3200236656&4294967295,N=P+(O<<23&4294967295|O>>>9),O=T+(N^P^V)+$[13]+681279174&4294967295,T=N+(O<<4&4294967295|O>>>28),O=V+(T^N^P)+$[0]+3936430074&4294967295,V=T+(O<<11&4294967295|O>>>21),O=P+(V^T^N)+$[3]+3572445317&4294967295,P=V+(O<<16&4294967295|O>>>16),O=N+(P^V^T)+$[6]+76029189&4294967295,N=P+(O<<23&4294967295|O>>>9),O=T+(N^P^V)+$[9]+3654602809&4294967295,T=N+(O<<4&4294967295|O>>>28),O=V+(T^N^P)+$[12]+3873151461&4294967295,V=T+(O<<11&4294967295|O>>>21),O=P+(V^T^N)+$[15]+530742520&4294967295,P=V+(O<<16&4294967295|O>>>16),O=N+(P^V^T)+$[2]+3299628645&4294967295,N=P+(O<<23&4294967295|O>>>9),O=T+(P^(N|~V))+$[0]+4096336452&4294967295,T=N+(O<<6&4294967295|O>>>26),O=V+(N^(T|~P))+$[7]+1126891415&4294967295,V=T+(O<<10&4294967295|O>>>22),O=P+(T^(V|~N))+$[14]+2878612391&4294967295,P=V+(O<<15&4294967295|O>>>17),O=N+(V^(P|~T))+$[5]+4237533241&4294967295,N=P+(O<<21&4294967295|O>>>11),O=T+(P^(N|~V))+$[12]+1700485571&4294967295,T=N+(O<<6&4294967295|O>>>26),O=V+(N^(T|~P))+$[3]+2399980690&4294967295,V=T+(O<<10&4294967295|O>>>22),O=P+(T^(V|~N))+$[10]+4293915773&4294967295,P=V+(O<<15&4294967295|O>>>17),O=N+(V^(P|~T))+$[1]+2240044497&4294967295,N=P+(O<<21&4294967295|O>>>11),O=T+(P^(N|~V))+$[8]+1873313359&4294967295,T=N+(O<<6&4294967295|O>>>26),O=V+(N^(T|~P))+$[15]+4264355552&4294967295,V=T+(O<<10&4294967295|O>>>22),O=P+(T^(V|~N))+$[6]+2734768916&4294967295,P=V+(O<<15&4294967295|O>>>17),O=N+(V^(P|~T))+$[13]+1309151649&4294967295,N=P+(O<<21&4294967295|O>>>11),O=T+(P^(N|~V))+$[4]+4149444226&4294967295,T=N+(O<<6&4294967295|O>>>26),O=V+(N^(T|~P))+$[11]+3174756917&4294967295,V=T+(O<<10&4294967295|O>>>22),O=P+(T^(V|~N))+$[2]+718787259&4294967295,P=V+(O<<15&4294967295|O>>>17),O=N+(V^(P|~T))+$[9]+3951481745&4294967295,C.g[0]=C.g[0]+T&4294967295,C.g[1]=C.g[1]+(P+(O<<21&4294967295|O>>>11))&4294967295,C.g[2]=C.g[2]+P&4294967295,C.g[3]=C.g[3]+V&4294967295}s.prototype.u=function(C,T){T===void 0&&(T=C.length);for(var N=T-this.blockSize,$=this.B,P=this.h,V=0;V<T;){if(P==0)for(;V<=N;)r(this,C,V),V+=this.blockSize;if(typeof C=="string"){for(;V<T;)if($[P++]=C.charCodeAt(V++),P==this.blockSize){r(this,$),P=0;break}}else for(;V<T;)if($[P++]=C[V++],P==this.blockSize){r(this,$),P=0;break}}this.h=P,this.o+=T},s.prototype.v=function(){var C=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);C[0]=128;for(var T=1;T<C.length-8;++T)C[T]=0;var N=8*this.o;for(T=C.length-8;T<C.length;++T)C[T]=N&255,N/=256;for(this.u(C),C=Array(16),T=N=0;4>T;++T)for(var $=0;32>$;$+=8)C[N++]=this.g[T]>>>$&255;return C};function i(C,T){var N=a;return Object.prototype.hasOwnProperty.call(N,C)?N[C]:N[C]=T(C)}function o(C,T){this.h=T;for(var N=[],$=!0,P=C.length-1;0<=P;P--){var V=C[P]|0;$&&V==T||(N[P]=V,$=!1)}this.g=N}var a={};function l(C){return-128<=C&&128>C?i(C,function(T){return new o([T|0],0>T?-1:0)}):new o([C|0],0>C?-1:0)}function u(C){if(isNaN(C)||!isFinite(C))return h;if(0>C)return v(u(-C));for(var T=[],N=1,$=0;C>=N;$++)T[$]=C/N|0,N*=4294967296;return new o(T,0)}function c(C,T){if(C.length==0)throw Error("number format error: empty string");if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(C.charAt(0)=="-")return v(c(C.substring(1),T));if(0<=C.indexOf("-"))throw Error('number format error: interior "-" character');for(var N=u(Math.pow(T,8)),$=h,P=0;P<C.length;P+=8){var V=Math.min(8,C.length-P),O=parseInt(C.substring(P,P+V),T);8>V?(V=u(Math.pow(T,V)),$=$.j(V).add(u(O))):($=$.j(N),$=$.add(u(O)))}return $}var h=l(0),d=l(1),p=l(16777216);t=o.prototype,t.m=function(){if(m(this))return-v(this).m();for(var C=0,T=1,N=0;N<this.g.length;N++){var $=this.i(N);C+=(0<=$?$:4294967296+$)*T,T*=4294967296}return C},t.toString=function(C){if(C=C||10,2>C||36<C)throw Error("radix out of range: "+C);if(f(this))return"0";if(m(this))return"-"+v(this).toString(C);for(var T=u(Math.pow(C,6)),N=this,$="";;){var P=I(N,T).g;N=y(N,P.j(T));var V=((0<N.g.length?N.g[0]:N.h)>>>0).toString(C);if(N=P,f(N))return V+$;for(;6>V.length;)V="0"+V;$=V+$}},t.i=function(C){return 0>C?0:C<this.g.length?this.g[C]:this.h};function f(C){if(C.h!=0)return!1;for(var T=0;T<C.g.length;T++)if(C.g[T]!=0)return!1;return!0}function m(C){return C.h==-1}t.l=function(C){return C=y(this,C),m(C)?-1:f(C)?0:1};function v(C){for(var T=C.g.length,N=[],$=0;$<T;$++)N[$]=~C.g[$];return new o(N,~C.h).add(d)}t.abs=function(){return m(this)?v(this):this},t.add=function(C){for(var T=Math.max(this.g.length,C.g.length),N=[],$=0,P=0;P<=T;P++){var V=$+(this.i(P)&65535)+(C.i(P)&65535),O=(V>>>16)+(this.i(P)>>>16)+(C.i(P)>>>16);$=O>>>16,V&=65535,O&=65535,N[P]=O<<16|V}return new o(N,N[N.length-1]&-2147483648?-1:0)};function y(C,T){return C.add(v(T))}t.j=function(C){if(f(this)||f(C))return h;if(m(this))return m(C)?v(this).j(v(C)):v(v(this).j(C));if(m(C))return v(this.j(v(C)));if(0>this.l(p)&&0>C.l(p))return u(this.m()*C.m());for(var T=this.g.length+C.g.length,N=[],$=0;$<2*T;$++)N[$]=0;for($=0;$<this.g.length;$++)for(var P=0;P<C.g.length;P++){var V=this.i($)>>>16,O=this.i($)&65535,Q=C.i(P)>>>16,Z=C.i(P)&65535;N[2*$+2*P]+=O*Z,w(N,2*$+2*P),N[2*$+2*P+1]+=V*Z,w(N,2*$+2*P+1),N[2*$+2*P+1]+=O*Q,w(N,2*$+2*P+1),N[2*$+2*P+2]+=V*Q,w(N,2*$+2*P+2)}for($=0;$<T;$++)N[$]=N[2*$+1]<<16|N[2*$];for($=T;$<2*T;$++)N[$]=0;return new o(N,0)};function w(C,T){for(;(C[T]&65535)!=C[T];)C[T+1]+=C[T]>>>16,C[T]&=65535,T++}function b(C,T){this.g=C,this.h=T}function I(C,T){if(f(T))throw Error("division by zero");if(f(C))return new b(h,h);if(m(C))return T=I(v(C),T),new b(v(T.g),v(T.h));if(m(T))return T=I(C,v(T)),new b(v(T.g),T.h);if(30<C.g.length){if(m(C)||m(T))throw Error("slowDivide_ only works with positive integers.");for(var N=d,$=T;0>=$.l(C);)N=k(N),$=k($);var P=R(N,1),V=R($,1);for($=R($,2),N=R(N,2);!f($);){var O=V.add($);0>=O.l(C)&&(P=P.add(N),V=O),$=R($,1),N=R(N,1)}return T=y(C,P.j(T)),new b(P,T)}for(P=h;0<=C.l(T);){for(N=Math.max(1,Math.floor(C.m()/T.m())),$=Math.ceil(Math.log(N)/Math.LN2),$=48>=$?1:Math.pow(2,$-48),V=u(N),O=V.j(T);m(O)||0<O.l(C);)N-=$,V=u(N),O=V.j(T);f(V)&&(V=d),P=P.add(V),C=y(C,O)}return new b(P,C)}t.A=function(C){return I(this,C).h},t.and=function(C){for(var T=Math.max(this.g.length,C.g.length),N=[],$=0;$<T;$++)N[$]=this.i($)&C.i($);return new o(N,this.h&C.h)},t.or=function(C){for(var T=Math.max(this.g.length,C.g.length),N=[],$=0;$<T;$++)N[$]=this.i($)|C.i($);return new o(N,this.h|C.h)},t.xor=function(C){for(var T=Math.max(this.g.length,C.g.length),N=[],$=0;$<T;$++)N[$]=this.i($)^C.i($);return new o(N,this.h^C.h)};function k(C){for(var T=C.g.length+1,N=[],$=0;$<T;$++)N[$]=C.i($)<<1|C.i($-1)>>>31;return new o(N,C.h)}function R(C,T){var N=T>>5;T%=32;for(var $=C.g.length-N,P=[],V=0;V<$;V++)P[V]=0<T?C.i(V+N)>>>T|C.i(V+N+1)<<32-T:C.i(V+N);return new o(P,C.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=c,KI=o}).apply(typeof N_<"u"?N_:typeof self<"u"?self:typeof window<"u"?window:{});var Tg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var N4,Xd,$4,oy,$2,A4,R4,D4;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(g,S,A){return g==Array.prototype||g==Object.prototype||(g[S]=A.value),g};function n(g){g=[typeof globalThis=="object"&&globalThis,g,typeof window=="object"&&window,typeof self=="object"&&self,typeof Tg=="object"&&Tg];for(var S=0;S<g.length;++S){var A=g[S];if(A&&A.Math==Math)return A}throw Error("Cannot find global object")}var s=n(this);function r(g,S){if(S)e:{var A=s;g=g.split(".");for(var z=0;z<g.length-1;z++){var ee=g[z];if(!(ee in A))break e;A=A[ee]}g=g[g.length-1],z=A[g],S=S(z),S!=z&&S!=null&&e(A,g,{configurable:!0,writable:!0,value:S})}}function i(g,S){g instanceof String&&(g+="");var A=0,z=!1,ee={next:function(){if(!z&&A<g.length){var ue=A++;return{value:S(ue,g[ue]),done:!1}}return z=!0,{done:!0,value:void 0}}};return ee[Symbol.iterator]=function(){return ee},ee}r("Array.prototype.values",function(g){return g||function(){return i(this,function(S,A){return A})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(g){var S=typeof g;return S=S!="object"?S:g?Array.isArray(g)?"array":S:"null",S=="array"||S=="object"&&typeof g.length=="number"}function u(g){var S=typeof g;return S=="object"&&g!=null||S=="function"}function c(g,S,A){return g.call.apply(g.bind,arguments)}function h(g,S,A){if(!g)throw Error();if(2<arguments.length){var z=Array.prototype.slice.call(arguments,2);return function(){var ee=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(ee,z),g.apply(S,ee)}}return function(){return g.apply(S,arguments)}}function d(g,S,A){return d=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?c:h,d.apply(null,arguments)}function p(g,S){var A=Array.prototype.slice.call(arguments,1);return function(){var z=A.slice();return z.push.apply(z,arguments),g.apply(this,z)}}function f(g,S){function A(){}A.prototype=S.prototype,g.aa=S.prototype,g.prototype=new A,g.prototype.constructor=g,g.Qb=function(z,ee,ue){for(var Te=Array(arguments.length-2),Bt=2;Bt<arguments.length;Bt++)Te[Bt-2]=arguments[Bt];return S.prototype[ee].apply(z,Te)}}function m(g){const S=g.length;if(0<S){const A=Array(S);for(let z=0;z<S;z++)A[z]=g[z];return A}return[]}function v(g,S){for(let A=1;A<arguments.length;A++){const z=arguments[A];if(l(z)){const ee=g.length||0,ue=z.length||0;g.length=ee+ue;for(let Te=0;Te<ue;Te++)g[ee+Te]=z[Te]}else g.push(z)}}class y{constructor(S,A){this.i=S,this.j=A,this.h=0,this.g=null}get(){let S;return 0<this.h?(this.h--,S=this.g,this.g=S.next,S.next=null):S=this.i(),S}}function w(g){return/^[\s\xa0]*$/.test(g)}function b(){var g=a.navigator;return g&&(g=g.userAgent)?g:""}function I(g){return I[" "](g),g}I[" "]=function(){};var k=b().indexOf("Gecko")!=-1&&!(b().toLowerCase().indexOf("webkit")!=-1&&b().indexOf("Edge")==-1)&&!(b().indexOf("Trident")!=-1||b().indexOf("MSIE")!=-1)&&b().indexOf("Edge")==-1;function R(g,S,A){for(const z in g)S.call(A,g[z],z,g)}function C(g,S){for(const A in g)S.call(void 0,g[A],A,g)}function T(g){const S={};for(const A in g)S[A]=g[A];return S}const N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(g,S){let A,z;for(let ee=1;ee<arguments.length;ee++){z=arguments[ee];for(A in z)g[A]=z[A];for(let ue=0;ue<N.length;ue++)A=N[ue],Object.prototype.hasOwnProperty.call(z,A)&&(g[A]=z[A])}}function P(g){var S=1;g=g.split(":");const A=[];for(;0<S&&g.length;)A.push(g.shift()),S--;return g.length&&A.push(g.join(":")),A}function V(g){a.setTimeout(()=>{throw g},0)}function O(){var g=J;let S=null;return g.g&&(S=g.g,g.g=g.g.next,g.g||(g.h=null),S.next=null),S}class Q{constructor(){this.h=this.g=null}add(S,A){const z=Z.get();z.set(S,A),this.h?this.h.next=z:this.g=z,this.h=z}}var Z=new y(()=>new ne,g=>g.reset());class ne{constructor(){this.next=this.g=this.h=null}set(S,A){this.h=S,this.g=A,this.next=null}reset(){this.next=this.g=this.h=null}}let le,q=!1,J=new Q,ie=()=>{const g=a.Promise.resolve(void 0);le=()=>{g.then(he)}};var he=()=>{for(var g;g=O();){try{g.h.call(g.g)}catch(A){V(A)}var S=Z;S.j(g),100>S.h&&(S.h++,g.next=S.g,S.g=g)}q=!1};function de(){this.s=this.s,this.C=this.C}de.prototype.s=!1,de.prototype.ma=function(){this.s||(this.s=!0,this.N())},de.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function pe(g,S){this.type=g,this.g=this.target=S,this.defaultPrevented=!1}pe.prototype.h=function(){this.defaultPrevented=!0};var xe=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var g=!1,S=Object.defineProperty({},"passive",{get:function(){g=!0}});try{const A=()=>{};a.addEventListener("test",A,S),a.removeEventListener("test",A,S)}catch{}return g}();function ye(g,S){if(pe.call(this,g?g.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,g){var A=this.type=g.type,z=g.changedTouches&&g.changedTouches.length?g.changedTouches[0]:null;if(this.target=g.target||g.srcElement,this.g=S,S=g.relatedTarget){if(k){e:{try{I(S.nodeName);var ee=!0;break e}catch{}ee=!1}ee||(S=null)}}else A=="mouseover"?S=g.fromElement:A=="mouseout"&&(S=g.toElement);this.relatedTarget=S,z?(this.clientX=z.clientX!==void 0?z.clientX:z.pageX,this.clientY=z.clientY!==void 0?z.clientY:z.pageY,this.screenX=z.screenX||0,this.screenY=z.screenY||0):(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0),this.button=g.button,this.key=g.key||"",this.ctrlKey=g.ctrlKey,this.altKey=g.altKey,this.shiftKey=g.shiftKey,this.metaKey=g.metaKey,this.pointerId=g.pointerId||0,this.pointerType=typeof g.pointerType=="string"?g.pointerType:Ie[g.pointerType]||"",this.state=g.state,this.i=g,g.defaultPrevented&&ye.aa.h.call(this)}}f(ye,pe);var Ie={2:"touch",3:"pen",4:"mouse"};ye.prototype.h=function(){ye.aa.h.call(this);var g=this.i;g.preventDefault?g.preventDefault():g.returnValue=!1};var $e="closure_listenable_"+(1e6*Math.random()|0),ze=0;function Me(g,S,A,z,ee){this.listener=g,this.proxy=null,this.src=S,this.type=A,this.capture=!!z,this.ha=ee,this.key=++ze,this.da=this.fa=!1}function Ue(g){g.da=!0,g.listener=null,g.proxy=null,g.src=null,g.ha=null}function Ke(g){this.src=g,this.g={},this.h=0}Ke.prototype.add=function(g,S,A,z,ee){var ue=g.toString();g=this.g[ue],g||(g=this.g[ue]=[],this.h++);var Te=nt(g,S,z,ee);return-1<Te?(S=g[Te],A||(S.fa=!1)):(S=new Me(S,this.src,ue,!!z,ee),S.fa=A,g.push(S)),S};function Je(g,S){var A=S.type;if(A in g.g){var z=g.g[A],ee=Array.prototype.indexOf.call(z,S,void 0),ue;(ue=0<=ee)&&Array.prototype.splice.call(z,ee,1),ue&&(Ue(S),g.g[A].length==0&&(delete g.g[A],g.h--))}}function nt(g,S,A,z){for(var ee=0;ee<g.length;++ee){var ue=g[ee];if(!ue.da&&ue.listener==S&&ue.capture==!!A&&ue.ha==z)return ee}return-1}var _t="closure_lm_"+(1e6*Math.random()|0),yt={};function ht(g,S,A,z,ee){if(Array.isArray(S)){for(var ue=0;ue<S.length;ue++)ht(g,S[ue],A,z,ee);return null}return A=Vs(A),g&&g[$e]?g.K(S,A,u(z)?!!z.capture:!!z,ee):Nt(g,S,A,!1,z,ee)}function Nt(g,S,A,z,ee,ue){if(!S)throw Error("Invalid event type");var Te=u(ee)?!!ee.capture:!!ee,Bt=Mn(g);if(Bt||(g[_t]=Bt=new Ke(g)),A=Bt.add(S,A,z,Te,ue),A.proxy)return A;if(z=St(),A.proxy=z,z.src=g,z.listener=A,g.addEventListener)xe||(ee=Te),ee===void 0&&(ee=!1),g.addEventListener(S.toString(),z,ee);else if(g.attachEvent)g.attachEvent(tr(S.toString()),z);else if(g.addListener&&g.removeListener)g.addListener(z);else throw Error("addEventListener and attachEvent are unavailable.");return A}function St(){function g(A){return S.call(g.src,g.listener,A)}const S=Ln;return g}function Ot(g,S,A,z,ee){if(Array.isArray(S))for(var ue=0;ue<S.length;ue++)Ot(g,S[ue],A,z,ee);else z=u(z)?!!z.capture:!!z,A=Vs(A),g&&g[$e]?(g=g.i,S=String(S).toString(),S in g.g&&(ue=g.g[S],A=nt(ue,A,z,ee),-1<A&&(Ue(ue[A]),Array.prototype.splice.call(ue,A,1),ue.length==0&&(delete g.g[S],g.h--)))):g&&(g=Mn(g))&&(S=g.g[S.toString()],g=-1,S&&(g=nt(S,A,z,ee)),(A=-1<g?S[g]:null)&&Pt(A))}function Pt(g){if(typeof g!="number"&&g&&!g.da){var S=g.src;if(S&&S[$e])Je(S.i,g);else{var A=g.type,z=g.proxy;S.removeEventListener?S.removeEventListener(A,z,g.capture):S.detachEvent?S.detachEvent(tr(A),z):S.addListener&&S.removeListener&&S.removeListener(z),(A=Mn(S))?(Je(A,g),A.h==0&&(A.src=null,S[_t]=null)):Ue(g)}}}function tr(g){return g in yt?yt[g]:yt[g]="on"+g}function Ln(g,S){if(g.da)g=!0;else{S=new ye(S,this);var A=g.listener,z=g.ha||g.src;g.fa&&Pt(g),g=A.call(z,S)}return g}function Mn(g){return g=g[_t],g instanceof Ke?g:null}var Hn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Vs(g){return typeof g=="function"?g:(g[Hn]||(g[Hn]=function(S){return g.handleEvent(S)}),g[Hn])}function Tt(){de.call(this),this.i=new Ke(this),this.M=this,this.F=null}f(Tt,de),Tt.prototype[$e]=!0,Tt.prototype.removeEventListener=function(g,S,A,z){Ot(this,g,S,A,z)};function $t(g,S){var A,z=g.F;if(z)for(A=[];z;z=z.F)A.push(z);if(g=g.M,z=S.type||S,typeof S=="string")S=new pe(S,g);else if(S instanceof pe)S.target=S.target||g;else{var ee=S;S=new pe(z,g),$(S,ee)}if(ee=!0,A)for(var ue=A.length-1;0<=ue;ue--){var Te=S.g=A[ue];ee=zs(Te,z,!0,S)&&ee}if(Te=S.g=g,ee=zs(Te,z,!0,S)&&ee,ee=zs(Te,z,!1,S)&&ee,A)for(ue=0;ue<A.length;ue++)Te=S.g=A[ue],ee=zs(Te,z,!1,S)&&ee}Tt.prototype.N=function(){if(Tt.aa.N.call(this),this.i){var g=this.i,S;for(S in g.g){for(var A=g.g[S],z=0;z<A.length;z++)Ue(A[z]);delete g.g[S],g.h--}}this.F=null},Tt.prototype.K=function(g,S,A,z){return this.i.add(String(g),S,!1,A,z)},Tt.prototype.L=function(g,S,A,z){return this.i.add(String(g),S,!0,A,z)};function zs(g,S,A,z){if(S=g.i.g[String(S)],!S)return!0;S=S.concat();for(var ee=!0,ue=0;ue<S.length;++ue){var Te=S[ue];if(Te&&!Te.da&&Te.capture==A){var Bt=Te.listener,cs=Te.ha||Te.src;Te.fa&&Je(g.i,Te),ee=Bt.call(cs,z)!==!1&&ee}}return ee&&!z.defaultPrevented}function Bs(g,S,A){if(typeof g=="function")A&&(g=d(g,A));else if(g&&typeof g.handleEvent=="function")g=d(g.handleEvent,g);else throw Error("Invalid listener argument");return 2147483647<Number(S)?-1:a.setTimeout(g,S||0)}function fa(g){g.g=Bs(()=>{g.g=null,g.i&&(g.i=!1,fa(g))},g.l);const S=g.h;g.h=null,g.m.apply(null,S)}class Qi extends de{constructor(S,A){super(),this.m=S,this.l=A,this.h=null,this.i=!1,this.g=null}j(S){this.h=arguments,this.g?this.i=!0:fa(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ji(g){de.call(this),this.h=g,this.g={}}f(Ji,de);var Zi=[];function eo(g){R(g.g,function(S,A){this.g.hasOwnProperty(A)&&Pt(S)},g),g.g={}}Ji.prototype.N=function(){Ji.aa.N.call(this),eo(this)},Ji.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var gi=a.JSON.stringify,ld=a.JSON.parse,Um=class{stringify(g){return a.JSON.stringify(g,void 0)}parse(g){return a.JSON.parse(g,void 0)}};function ma(){}ma.prototype.h=null;function ud(g){return g.h||(g.h=g.i())}function cd(){}var ga={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Us(){pe.call(this,"d")}f(Us,pe);function an(){pe.call(this,"c")}f(an,pe);var to={},Cr=null;function Ro(){return Cr=Cr||new Tt}to.La="serverreachability";function hd(g){pe.call(this,to.La,g)}f(hd,pe);function ya(g){const S=Ro();$t(S,new hd(S))}to.STAT_EVENT="statevent";function dd(g,S){pe.call(this,to.STAT_EVENT,g),this.stat=S}f(dd,pe);function as(g){const S=Ro();$t(S,new dd(S,g))}to.Ma="timingevent";function pd(g,S){pe.call(this,to.Ma,g),this.size=S}f(pd,pe);function va(g,S){if(typeof g!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){g()},S)}function wa(){this.g=!0}wa.prototype.xa=function(){this.g=!1};function cw(g,S,A,z,ee,ue){g.info(function(){if(g.g)if(ue)for(var Te="",Bt=ue.split("&"),cs=0;cs<Bt.length;cs++){var It=Bt[cs].split("=");if(1<It.length){var Is=It[0];It=It[1];var Ss=Is.split("_");Te=2<=Ss.length&&Ss[1]=="type"?Te+(Is+"="+It+"&"):Te+(Is+"=redacted&")}}else Te=null;else Te=ue;return"XMLHTTP REQ ("+z+") [attempt "+ee+"]: "+S+`
`+A+`
`+Te})}function hw(g,S,A,z,ee,ue,Te){g.info(function(){return"XMLHTTP RESP ("+z+") [ attempt "+ee+"]: "+S+`
`+A+`
`+ue+" "+Te})}function yi(g,S,A,z){g.info(function(){return"XMLHTTP TEXT ("+S+"): "+dc(g,A)+(z?" "+z:"")})}function Wm(g,S){g.info(function(){return"TIMEOUT: "+S})}wa.prototype.info=function(){};function dc(g,S){if(!g.g)return S;if(!S)return null;try{var A=JSON.parse(S);if(A){for(g=0;g<A.length;g++)if(Array.isArray(A[g])){var z=A[g];if(!(2>z.length)){var ee=z[1];if(Array.isArray(ee)&&!(1>ee.length)){var ue=ee[0];if(ue!="noop"&&ue!="stop"&&ue!="close")for(var Te=1;Te<ee.length;Te++)ee[Te]=""}}}}return gi(A)}catch{return S}}var Fl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},fd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},xa;function Ll(){}f(Ll,ma),Ll.prototype.g=function(){return new XMLHttpRequest},Ll.prototype.i=function(){return{}},xa=new Ll;function vi(g,S,A,z){this.j=g,this.i=S,this.l=A,this.R=z||1,this.U=new Ji(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new jm}function jm(){this.i=null,this.g="",this.h=!1}var Gm={},pc={};function ba(g,S,A){g.L=1,g.v=Sa(Ur(S)),g.m=A,g.P=!0,md(g,null)}function md(g,S){g.F=Date.now(),fc(g),g.A=Ur(g.v);var A=g.A,z=g.R;Array.isArray(z)||(z=[String(z)]),Td(A.i,"t",z),g.C=0,A=g.j.J,g.h=new jm,g.g=mt(g.j,A?S:null,!g.m),0<g.O&&(g.M=new Qi(d(g.Y,g,g.g),g.O)),S=g.U,A=g.g,z=g.ca;var ee="readystatechange";Array.isArray(ee)||(ee&&(Zi[0]=ee.toString()),ee=Zi);for(var ue=0;ue<ee.length;ue++){var Te=ht(A,ee[ue],z||S.handleEvent,!1,S.h||S);if(!Te)break;S.g[Te.key]=Te}S=g.H?T(g.H):{},g.m?(g.u||(g.u="POST"),S["Content-Type"]="application/x-www-form-urlencoded",g.g.ea(g.A,g.u,g.m,S)):(g.u="GET",g.g.ea(g.A,g.u,null,S)),ya(),cw(g.i,g.u,g.A,g.l,g.R,g.m)}vi.prototype.ca=function(g){g=g.target;const S=this.M;S&&xi(g)==3?S.j():this.Y(g)},vi.prototype.Y=function(g){try{if(g==this.g)e:{const Ss=xi(this.g);var S=this.g.Ba();const Sc=this.g.Z();if(!(3>Ss)&&(Ss!=3||this.g&&(this.h.h||this.g.oa()||Nd(this.g)))){this.J||Ss!=4||S==7||(S==8||0>=Sc?ya(3):ya(2)),yd(this);var A=this.g.Z();this.X=A;t:if(gd(this)){var z=Nd(this.g);g="";var ee=z.length,ue=xi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){no(this),Ml(this);var Te="";break t}this.h.i=new a.TextDecoder}for(S=0;S<ee;S++)this.h.h=!0,g+=this.h.i.decode(z[S],{stream:!(ue&&S==ee-1)});z.length=0,this.h.g+=g,this.C=0,Te=this.h.g}else Te=this.g.oa();if(this.o=A==200,hw(this.i,this.u,this.A,this.l,this.R,Ss,A),this.o){if(this.T&&!this.K){t:{if(this.g){var Bt,cs=this.g;if((Bt=cs.g?cs.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!w(Bt)){var It=Bt;break t}}It=null}if(A=It)yi(this.i,this.l,A,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,mc(this,A);else{this.o=!1,this.s=3,as(12),no(this),Ml(this);break e}}if(this.P){A=!0;let bi;for(;!this.J&&this.C<Te.length;)if(bi=Hm(this,Te),bi==pc){Ss==4&&(this.s=4,as(14),A=!1),yi(this.i,this.l,null,"[Incomplete Response]");break}else if(bi==Gm){this.s=4,as(15),yi(this.i,this.l,Te,"[Invalid Chunk]"),A=!1;break}else yi(this.i,this.l,bi,null),mc(this,bi);if(gd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ss!=4||Te.length!=0||this.h.h||(this.s=1,as(16),A=!1),this.o=this.o&&A,!A)yi(this.i,this.l,Te,"[Invalid Chunked Response]"),no(this),Ml(this);else if(0<Te.length&&!this.W){this.W=!0;var Is=this.j;Is.g==this&&Is.ba&&!Is.M&&(Is.j.info("Great, no buffering proxy detected. Bytes received: "+Te.length),Fe(Is),Is.M=!0,as(11))}}else yi(this.i,this.l,Te,null),mc(this,Te);Ss==4&&no(this),this.o&&!this.J&&(Ss==4?Lt(this.j,this):(this.o=!1,fc(this)))}else x(this.g),A==400&&0<Te.indexOf("Unknown SID")?(this.s=3,as(12)):(this.s=0,as(13)),no(this),Ml(this)}}}catch{}finally{}};function gd(g){return g.g?g.u=="GET"&&g.L!=2&&g.j.Ca:!1}function Hm(g,S){var A=g.C,z=S.indexOf(`
`,A);return z==-1?pc:(A=Number(S.substring(A,z)),isNaN(A)?Gm:(z+=1,z+A>S.length?pc:(S=S.slice(z,z+A),g.C=z+A,S)))}vi.prototype.cancel=function(){this.J=!0,no(this)};function fc(g){g.S=Date.now()+g.I,qm(g,g.I)}function qm(g,S){if(g.B!=null)throw Error("WatchDog timer not null");g.B=va(d(g.ba,g),S)}function yd(g){g.B&&(a.clearTimeout(g.B),g.B=null)}vi.prototype.ba=function(){this.B=null;const g=Date.now();0<=g-this.S?(Wm(this.i,this.A),this.L!=2&&(ya(),as(17)),no(this),this.s=2,Ml(this)):qm(this,this.S-g)};function Ml(g){g.j.G==0||g.J||Lt(g.j,g)}function no(g){yd(g);var S=g.M;S&&typeof S.ma=="function"&&S.ma(),g.M=null,eo(g.U),g.g&&(S=g.g,g.g=null,S.abort(),S.ma())}function mc(g,S){try{var A=g.j;if(A.G!=0&&(A.g==g||gc(A.h,g))){if(!g.K&&gc(A.h,g)&&A.G==3){try{var z=A.Da.g.parse(S)}catch{z=null}if(Array.isArray(z)&&z.length==3){var ee=z;if(ee[0]==0){e:if(!A.u){if(A.g)if(A.g.F+3e3<g.F)at(A),B(A);else break e;We(A),as(18)}}else A.za=ee[1],0<A.za-A.T&&37500>ee[2]&&A.F&&A.v==0&&!A.C&&(A.C=va(d(A.Za,A),6e3));if(1>=Ym(A.h)&&A.ca){try{A.ca()}catch{}A.ca=void 0}}else Xt(A,11)}else if((g.K||A.g==g)&&at(A),!w(S))for(ee=A.Da.g.parse(S),S=0;S<ee.length;S++){let It=ee[S];if(A.T=It[0],It=It[1],A.G==2)if(It[0]=="c"){A.K=It[1],A.ia=It[2];const Is=It[3];Is!=null&&(A.la=Is,A.j.info("VER="+A.la));const Ss=It[4];Ss!=null&&(A.Aa=Ss,A.j.info("SVER="+A.Aa));const Sc=It[5];Sc!=null&&typeof Sc=="number"&&0<Sc&&(z=1.5*Sc,A.L=z,A.j.info("backChannelRequestTimeoutMs_="+z)),z=A;const bi=g.g;if(bi){const ig=bi.g?bi.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ig){var ue=z.h;ue.g||ig.indexOf("spdy")==-1&&ig.indexOf("quic")==-1&&ig.indexOf("h2")==-1||(ue.j=ue.l,ue.g=new Set,ue.h&&(yc(ue,ue.h),ue.h=null))}if(z.D){const ww=bi.g?bi.g.getResponseHeader("X-HTTP-Session-Id"):null;ww&&(z.ya=ww,Ft(z.I,z.D,ww))}}A.G=3,A.l&&A.l.ua(),A.ba&&(A.R=Date.now()-g.F,A.j.info("Handshake RTT: "+A.R+"ms")),z=A;var Te=g;if(z.qa=us(z,z.J?z.ia:null,z.W),Te.K){vc(z.h,Te);var Bt=Te,cs=z.L;cs&&(Bt.I=cs),Bt.B&&(yd(Bt),fc(Bt)),z.g=Te}else He(z);0<A.i.length&&G(A)}else It[0]!="stop"&&It[0]!="close"||Xt(A,7);else A.G==3&&(It[0]=="stop"||It[0]=="close"?It[0]=="stop"?Xt(A,7):M(A):It[0]!="noop"&&A.l&&A.l.ta(It),A.v=0)}}ya(4)}catch{}}var dw=class{constructor(g,S){this.g=g,this.map=S}};function Km(g){this.l=g||10,a.PerformanceNavigationTiming?(g=a.performance.getEntriesByType("navigation"),g=0<g.length&&(g[0].nextHopProtocol=="hq"||g[0].nextHopProtocol=="h2")):g=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=g?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Xm(g){return g.h?!0:g.g?g.g.size>=g.j:!1}function Ym(g){return g.h?1:g.g?g.g.size:0}function gc(g,S){return g.h?g.h==S:g.g?g.g.has(S):!1}function yc(g,S){g.g?g.g.add(S):g.h=S}function vc(g,S){g.h&&g.h==S?g.h=null:g.g&&g.g.has(S)&&g.g.delete(S)}Km.prototype.cancel=function(){if(this.i=vd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const g of this.g.values())g.cancel();this.g.clear()}};function vd(g){if(g.h!=null)return g.i.concat(g.h.D);if(g.g!=null&&g.g.size!==0){let S=g.i;for(const A of g.g.values())S=S.concat(A.D);return S}return m(g.i)}function wd(g){if(g.V&&typeof g.V=="function")return g.V();if(typeof Map<"u"&&g instanceof Map||typeof Set<"u"&&g instanceof Set)return Array.from(g.values());if(typeof g=="string")return g.split("");if(l(g)){for(var S=[],A=g.length,z=0;z<A;z++)S.push(g[z]);return S}S=[],A=0;for(z in g)S[A++]=g[z];return S}function Vl(g){if(g.na&&typeof g.na=="function")return g.na();if(!g.V||typeof g.V!="function"){if(typeof Map<"u"&&g instanceof Map)return Array.from(g.keys());if(!(typeof Set<"u"&&g instanceof Set)){if(l(g)||typeof g=="string"){var S=[];g=g.length;for(var A=0;A<g;A++)S.push(A);return S}S=[],A=0;for(const z in g)S[A++]=z;return S}}}function nr(g,S){if(g.forEach&&typeof g.forEach=="function")g.forEach(S,void 0);else if(l(g)||typeof g=="string")Array.prototype.forEach.call(g,S,void 0);else for(var A=Vl(g),z=wd(g),ee=z.length,ue=0;ue<ee;ue++)S.call(void 0,z[ue],A&&A[ue],g)}var Qm=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function pw(g,S){if(g){g=g.split("&");for(var A=0;A<g.length;A++){var z=g[A].indexOf("="),ee=null;if(0<=z){var ue=g[A].substring(0,z);ee=g[A].substring(z+1)}else ue=g[A];S(ue,ee?decodeURIComponent(ee.replace(/\+/g," ")):"")}}}function so(g){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,g instanceof so){this.h=g.h,ls(this,g.j),this.o=g.o,this.g=g.g,zl(this,g.s),this.l=g.l;var S=g.i,A=new Ta;A.i=S.i,S.g&&(A.g=new Map(S.g),A.h=S.h),Ia(this,A),this.m=g.m}else g&&(S=String(g).match(Qm))?(this.h=!1,ls(this,S[1]||"",!0),this.o=Bl(S[2]||""),this.g=Bl(S[3]||"",!0),zl(this,S[4]),this.l=Bl(S[5]||"",!0),Ia(this,S[6]||"",!0),this.m=Bl(S[7]||"")):(this.h=!1,this.i=new Ta(null,this.h))}so.prototype.toString=function(){var g=[],S=this.j;S&&g.push(Ul(S,xd,!0),":");var A=this.g;return(A||S=="file")&&(g.push("//"),(S=this.o)&&g.push(Ul(S,xd,!0),"@"),g.push(encodeURIComponent(String(A)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A=this.s,A!=null&&g.push(":",String(A))),(A=this.l)&&(this.g&&A.charAt(0)!="/"&&g.push("/"),g.push(Ul(A,A.charAt(0)=="/"?fw:Jm,!0))),(A=this.i.toString())&&g.push("?",A),(A=this.m)&&g.push("#",Ul(A,bd)),g.join("")};function Ur(g){return new so(g)}function ls(g,S,A){g.j=A?Bl(S,!0):S,g.j&&(g.j=g.j.replace(/:$/,""))}function zl(g,S){if(S){if(S=Number(S),isNaN(S)||0>S)throw Error("Bad port number "+S);g.s=S}else g.s=null}function Ia(g,S,A){S instanceof Ta?(g.i=S,Zm(g.i,g.h)):(A||(S=Ul(S,mw)),g.i=new Ta(S,g.h))}function Ft(g,S,A){g.i.set(S,A)}function Sa(g){return Ft(g,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),g}function Bl(g,S){return g?S?decodeURI(g.replace(/%25/g,"%2525")):decodeURIComponent(g):""}function Ul(g,S,A){return typeof g=="string"?(g=encodeURI(g).replace(S,wc),A&&(g=g.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g):null}function wc(g){return g=g.charCodeAt(0),"%"+(g>>4&15).toString(16)+(g&15).toString(16)}var xd=/[#\/\?@]/g,Jm=/[#\?:]/g,fw=/[#\?]/g,mw=/[#\?@]/g,bd=/#/g;function Ta(g,S){this.h=this.g=null,this.i=g||null,this.j=!!S}function wi(g){g.g||(g.g=new Map,g.h=0,g.i&&pw(g.i,function(S,A){g.add(decodeURIComponent(S.replace(/\+/g," ")),A)}))}t=Ta.prototype,t.add=function(g,S){wi(this),this.i=null,g=Do(this,g);var A=this.g.get(g);return A||this.g.set(g,A=[]),A.push(S),this.h+=1,this};function Id(g,S){wi(g),S=Do(g,S),g.g.has(S)&&(g.i=null,g.h-=g.g.get(S).length,g.g.delete(S))}function Sd(g,S){return wi(g),S=Do(g,S),g.g.has(S)}t.forEach=function(g,S){wi(this),this.g.forEach(function(A,z){A.forEach(function(ee){g.call(S,ee,z,this)},this)},this)},t.na=function(){wi(this);const g=Array.from(this.g.values()),S=Array.from(this.g.keys()),A=[];for(let z=0;z<S.length;z++){const ee=g[z];for(let ue=0;ue<ee.length;ue++)A.push(S[z])}return A},t.V=function(g){wi(this);let S=[];if(typeof g=="string")Sd(this,g)&&(S=S.concat(this.g.get(Do(this,g))));else{g=Array.from(this.g.values());for(let A=0;A<g.length;A++)S=S.concat(g[A])}return S},t.set=function(g,S){return wi(this),this.i=null,g=Do(this,g),Sd(this,g)&&(this.h-=this.g.get(g).length),this.g.set(g,[S]),this.h+=1,this},t.get=function(g,S){return g?(g=this.V(g),0<g.length?String(g[0]):S):S};function Td(g,S,A){Id(g,S),0<A.length&&(g.i=null,g.g.set(Do(g,S),m(A)),g.h+=A.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const g=[],S=Array.from(this.g.keys());for(var A=0;A<S.length;A++){var z=S[A];const ue=encodeURIComponent(String(z)),Te=this.V(z);for(z=0;z<Te.length;z++){var ee=ue;Te[z]!==""&&(ee+="="+encodeURIComponent(String(Te[z]))),g.push(ee)}}return this.i=g.join("&")};function Do(g,S){return S=String(S),g.j&&(S=S.toLowerCase()),S}function Zm(g,S){S&&!g.j&&(wi(g),g.i=null,g.g.forEach(function(A,z){var ee=z.toLowerCase();z!=ee&&(Id(this,z),Td(this,ee,A))},g)),g.j=S}function gw(g,S){const A=new wa;if(a.Image){const z=new Image;z.onload=p(ro,A,"TestLoadImage: loaded",!0,S,z),z.onerror=p(ro,A,"TestLoadImage: error",!1,S,z),z.onabort=p(ro,A,"TestLoadImage: abort",!1,S,z),z.ontimeout=p(ro,A,"TestLoadImage: timeout",!1,S,z),a.setTimeout(function(){z.ontimeout&&z.ontimeout()},1e4),z.src=g}else S(!1)}function eg(g,S){const A=new wa,z=new AbortController,ee=setTimeout(()=>{z.abort(),ro(A,"TestPingServer: timeout",!1,S)},1e4);fetch(g,{signal:z.signal}).then(ue=>{clearTimeout(ee),ue.ok?ro(A,"TestPingServer: ok",!0,S):ro(A,"TestPingServer: server error",!1,S)}).catch(()=>{clearTimeout(ee),ro(A,"TestPingServer: error",!1,S)})}function ro(g,S,A,z,ee){try{ee&&(ee.onload=null,ee.onerror=null,ee.onabort=null,ee.ontimeout=null),z(A)}catch{}}function yw(){this.g=new Um}function Cd(g,S,A){const z=A||"";try{nr(g,function(ee,ue){let Te=ee;u(ee)&&(Te=gi(ee)),S.push(z+ue+"="+encodeURIComponent(Te))})}catch(ee){throw S.push(z+"type="+encodeURIComponent("_badmap")),ee}}function Wl(g){this.l=g.Ub||null,this.j=g.eb||!1}f(Wl,ma),Wl.prototype.g=function(){return new xc(this.l,this.j)},Wl.prototype.i=function(g){return function(){return g}}({});function xc(g,S){Tt.call(this),this.D=g,this.o=S,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}f(xc,Tt),t=xc.prototype,t.open=function(g,S){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=g,this.A=S,this.readyState=1,Gl(this)},t.send=function(g){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const S={headers:this.u,method:this.B,credentials:this.m,cache:void 0};g&&(S.body=g),(this.D||a).fetch(new Request(this.A,S)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,jl(this)),this.readyState=0},t.Sa=function(g){if(this.g&&(this.l=g,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=g.headers,this.readyState=2,Gl(this)),this.g&&(this.readyState=3,Gl(this),this.g)))if(this.responseType==="arraybuffer")g.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in g){if(this.j=g.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;tg(this)}else g.text().then(this.Ra.bind(this),this.ga.bind(this))};function tg(g){g.j.read().then(g.Pa.bind(g)).catch(g.ga.bind(g))}t.Pa=function(g){if(this.g){if(this.o&&g.value)this.response.push(g.value);else if(!this.o){var S=g.value?g.value:new Uint8Array(0);(S=this.v.decode(S,{stream:!g.done}))&&(this.response=this.responseText+=S)}g.done?jl(this):Gl(this),this.readyState==3&&tg(this)}},t.Ra=function(g){this.g&&(this.response=this.responseText=g,jl(this))},t.Qa=function(g){this.g&&(this.response=g,jl(this))},t.ga=function(){this.g&&jl(this)};function jl(g){g.readyState=4,g.l=null,g.j=null,g.v=null,Gl(g)}t.setRequestHeader=function(g,S){this.u.append(g,S)},t.getResponseHeader=function(g){return this.h&&this.h.get(g.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const g=[],S=this.h.entries();for(var A=S.next();!A.done;)A=A.value,g.push(A[0]+": "+A[1]),A=S.next();return g.join(`\r
`)};function Gl(g){g.onreadystatechange&&g.onreadystatechange.call(g)}Object.defineProperty(xc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(g){this.m=g?"include":"same-origin"}});function kd(g){let S="";return R(g,function(A,z){S+=z,S+=":",S+=A,S+=`\r
`}),S}function Ed(g,S,A){e:{for(z in A){var z=!1;break e}z=!0}z||(A=kd(A),typeof g=="string"?A!=null&&encodeURIComponent(String(A)):Ft(g,S,A))}function en(g){Tt.call(this),this.headers=new Map,this.o=g||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}f(en,Tt);var _d=/^https?$/i,vw=["POST","PUT"];t=en.prototype,t.Ha=function(g){this.J=g},t.ea=function(g,S,A,z){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+g);S=S?S.toUpperCase():"GET",this.D=g,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xa.g(),this.v=this.o?ud(this.o):ud(xa),this.g.onreadystatechange=d(this.Ea,this);try{this.B=!0,this.g.open(S,String(g),!0),this.B=!1}catch(ue){ng(this,ue);return}if(g=A||"",A=new Map(this.headers),z)if(Object.getPrototypeOf(z)===Object.prototype)for(var ee in z)A.set(ee,z[ee]);else if(typeof z.keys=="function"&&typeof z.get=="function")for(const ue of z.keys())A.set(ue,z.get(ue));else throw Error("Unknown input type for opt_headers: "+String(z));z=Array.from(A.keys()).find(ue=>ue.toLowerCase()=="content-type"),ee=a.FormData&&g instanceof a.FormData,!(0<=Array.prototype.indexOf.call(vw,S,void 0))||z||ee||A.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ue,Te]of A)this.g.setRequestHeader(ue,Te);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{rg(this),this.u=!0,this.g.send(g),this.u=!1}catch(ue){ng(this,ue)}};function ng(g,S){g.h=!1,g.g&&(g.j=!0,g.g.abort(),g.j=!1),g.l=S,g.m=5,sg(g),bc(g)}function sg(g){g.A||(g.A=!0,$t(g,"complete"),$t(g,"error"))}t.abort=function(g){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=g||7,$t(this,"complete"),$t(this,"abort"),bc(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),bc(this,!0)),en.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Hl(this):this.bb())},t.bb=function(){Hl(this)};function Hl(g){if(g.h&&typeof o<"u"&&(!g.v[1]||xi(g)!=4||g.Z()!=2)){if(g.u&&xi(g)==4)Bs(g.Ea,0,g);else if($t(g,"readystatechange"),xi(g)==4){g.h=!1;try{const Te=g.Z();e:switch(Te){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var S=!0;break e;default:S=!1}var A;if(!(A=S)){var z;if(z=Te===0){var ee=String(g.D).match(Qm)[1]||null;!ee&&a.self&&a.self.location&&(ee=a.self.location.protocol.slice(0,-1)),z=!_d.test(ee?ee.toLowerCase():"")}A=z}if(A)$t(g,"complete"),$t(g,"success");else{g.m=6;try{var ue=2<xi(g)?g.g.statusText:""}catch{ue=""}g.l=ue+" ["+g.Z()+"]",sg(g)}}finally{bc(g)}}}}function bc(g,S){if(g.g){rg(g);const A=g.g,z=g.v[0]?()=>{}:null;g.g=null,g.v=null,S||$t(g,"ready");try{A.onreadystatechange=z}catch{}}}function rg(g){g.I&&(a.clearTimeout(g.I),g.I=null)}t.isActive=function(){return!!this.g};function xi(g){return g.g?g.g.readyState:0}t.Z=function(){try{return 2<xi(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(g){if(this.g){var S=this.g.responseText;return g&&S.indexOf(g)==0&&(S=S.substring(g.length)),ld(S)}};function Nd(g){try{if(!g.g)return null;if("response"in g.g)return g.g.response;switch(g.H){case"":case"text":return g.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in g.g)return g.g.mozResponseArrayBuffer}return null}catch{return null}}function x(g){const S={};g=(g.g&&2<=xi(g)&&g.g.getAllResponseHeaders()||"").split(`\r
`);for(let z=0;z<g.length;z++){if(w(g[z]))continue;var A=P(g[z]);const ee=A[0];if(A=A[1],typeof A!="string")continue;A=A.trim();const ue=S[ee]||[];S[ee]=ue,ue.push(A)}C(S,function(z){return z.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function _(g,S,A){return A&&A.internalChannelParams&&A.internalChannelParams[g]||S}function D(g){this.Aa=0,this.i=[],this.j=new wa,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=_("failFast",!1,g),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=_("baseRetryDelayMs",5e3,g),this.cb=_("retryDelaySeedMs",1e4,g),this.Wa=_("forwardChannelMaxRetries",2,g),this.wa=_("forwardChannelRequestTimeoutMs",2e4,g),this.pa=g&&g.xmlHttpFactory||void 0,this.Xa=g&&g.Tb||void 0,this.Ca=g&&g.useFetchStreams||!1,this.L=void 0,this.J=g&&g.supportsCrossDomainXhr||!1,this.K="",this.h=new Km(g&&g.concurrentRequestLimit),this.Da=new yw,this.P=g&&g.fastHandshake||!1,this.O=g&&g.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=g&&g.Rb||!1,g&&g.xa&&this.j.xa(),g&&g.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&g&&g.detectBufferingProxy||!1,this.ja=void 0,g&&g.longPollingTimeout&&0<g.longPollingTimeout&&(this.ja=g.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=D.prototype,t.la=8,t.G=1,t.connect=function(g,S,A,z){as(0),this.W=g,this.H=S||{},A&&z!==void 0&&(this.H.OSID=A,this.H.OAID=z),this.F=this.X,this.I=us(this,null,this.W),G(this)};function M(g){if(X(g),g.G==3){var S=g.U++,A=Ur(g.I);if(Ft(A,"SID",g.K),Ft(A,"RID",S),Ft(A,"TYPE","terminate"),ve(g,A),S=new vi(g,g.j,S),S.L=2,S.v=Sa(Ur(A)),A=!1,a.navigator&&a.navigator.sendBeacon)try{A=a.navigator.sendBeacon(S.v.toString(),"")}catch{}!A&&a.Image&&(new Image().src=S.v,A=!0),A||(S.g=mt(S.j,null),S.g.ea(S.v)),S.F=Date.now(),fc(S)}Ws(g)}function B(g){g.g&&(Fe(g),g.g.cancel(),g.g=null)}function X(g){B(g),g.u&&(a.clearTimeout(g.u),g.u=null),at(g),g.h.cancel(),g.s&&(typeof g.s=="number"&&a.clearTimeout(g.s),g.s=null)}function G(g){if(!Xm(g.h)&&!g.s){g.s=!0;var S=g.Ga;le||ie(),q||(le(),q=!0),J.add(S,g),g.B=0}}function se(g,S){return Ym(g.h)>=g.h.j-(g.s?1:0)?!1:g.s?(g.i=S.D.concat(g.i),!0):g.G==1||g.G==2||g.B>=(g.Va?0:g.Wa)?!1:(g.s=va(d(g.Ga,g,S),At(g,g.B)),g.B++,!0)}t.Ga=function(g){if(this.s)if(this.s=null,this.G==1){if(!g){this.U=Math.floor(1e5*Math.random()),g=this.U++;const ee=new vi(this,this.j,g);let ue=this.o;if(this.S&&(ue?(ue=T(ue),$(ue,this.S)):ue=this.S),this.m!==null||this.O||(ee.H=ue,ue=null),this.P)e:{for(var S=0,A=0;A<this.i.length;A++){t:{var z=this.i[A];if("__data__"in z.map&&(z=z.map.__data__,typeof z=="string")){z=z.length;break t}z=void 0}if(z===void 0)break;if(S+=z,4096<S){S=A;break e}if(S===4096||A===this.i.length-1){S=A+1;break e}}S=1e3}else S=1e3;S=Re(this,ee,S),A=Ur(this.I),Ft(A,"RID",g),Ft(A,"CVER",22),this.D&&Ft(A,"X-HTTP-Session-Id",this.D),ve(this,A),ue&&(this.O?S="headers="+encodeURIComponent(String(kd(ue)))+"&"+S:this.m&&Ed(A,this.m,ue)),yc(this.h,ee),this.Ua&&Ft(A,"TYPE","init"),this.P?(Ft(A,"$req",S),Ft(A,"SID","null"),ee.T=!0,ba(ee,A,null)):ba(ee,A,S),this.G=2}}else this.G==3&&(g?ce(this,g):this.i.length==0||Xm(this.h)||ce(this))};function ce(g,S){var A;S?A=S.l:A=g.U++;const z=Ur(g.I);Ft(z,"SID",g.K),Ft(z,"RID",A),Ft(z,"AID",g.T),ve(g,z),g.m&&g.o&&Ed(z,g.m,g.o),A=new vi(g,g.j,A,g.B+1),g.m===null&&(A.H=g.o),S&&(g.i=S.D.concat(g.i)),S=Re(g,A,1e3),A.I=Math.round(.5*g.wa)+Math.round(.5*g.wa*Math.random()),yc(g.h,A),ba(A,z,S)}function ve(g,S){g.H&&R(g.H,function(A,z){Ft(S,z,A)}),g.l&&nr({},function(A,z){Ft(S,z,A)})}function Re(g,S,A){A=Math.min(g.i.length,A);var z=g.l?d(g.l.Na,g.l,g):null;e:{var ee=g.i;let ue=-1;for(;;){const Te=["count="+A];ue==-1?0<A?(ue=ee[0].g,Te.push("ofs="+ue)):ue=0:Te.push("ofs="+ue);let Bt=!0;for(let cs=0;cs<A;cs++){let It=ee[cs].g;const Is=ee[cs].map;if(It-=ue,0>It)ue=Math.max(0,ee[cs].g-100),Bt=!1;else try{Cd(Is,Te,"req"+It+"_")}catch{z&&z(Is)}}if(Bt){z=Te.join("&");break e}}}return g=g.i.splice(0,A),S.D=g,z}function He(g){if(!g.g&&!g.u){g.Y=1;var S=g.Fa;le||ie(),q||(le(),q=!0),J.add(S,g),g.v=0}}function We(g){return g.g||g.u||3<=g.v?!1:(g.Y++,g.u=va(d(g.Fa,g),At(g,g.v)),g.v++,!0)}t.Fa=function(){if(this.u=null,Ze(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var g=2*this.R;this.j.info("BP detection timer enabled: "+g),this.A=va(d(this.ab,this),g)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,as(10),B(this),Ze(this))};function Fe(g){g.A!=null&&(a.clearTimeout(g.A),g.A=null)}function Ze(g){g.g=new vi(g,g.j,"rpc",g.Y),g.m===null&&(g.g.H=g.o),g.g.O=0;var S=Ur(g.qa);Ft(S,"RID","rpc"),Ft(S,"SID",g.K),Ft(S,"AID",g.T),Ft(S,"CI",g.F?"0":"1"),!g.F&&g.ja&&Ft(S,"TO",g.ja),Ft(S,"TYPE","xmlhttp"),ve(g,S),g.m&&g.o&&Ed(S,g.m,g.o),g.L&&(g.g.I=g.L);var A=g.g;g=g.ia,A.L=1,A.v=Sa(Ur(S)),A.m=null,A.P=!0,md(A,g)}t.Za=function(){this.C!=null&&(this.C=null,B(this),We(this),as(19))};function at(g){g.C!=null&&(a.clearTimeout(g.C),g.C=null)}function Lt(g,S){var A=null;if(g.g==S){at(g),Fe(g),g.g=null;var z=2}else if(gc(g.h,S))A=S.D,vc(g.h,S),z=1;else return;if(g.G!=0){if(S.o)if(z==1){A=S.m?S.m.length:0,S=Date.now()-S.F;var ee=g.B;z=Ro(),$t(z,new pd(z,A)),G(g)}else He(g);else if(ee=S.s,ee==3||ee==0&&0<S.X||!(z==1&&se(g,S)||z==2&&We(g)))switch(A&&0<A.length&&(S=g.h,S.i=S.i.concat(A)),ee){case 1:Xt(g,5);break;case 4:Xt(g,10);break;case 3:Xt(g,6);break;default:Xt(g,2)}}}function At(g,S){let A=g.Ta+Math.floor(Math.random()*g.cb);return g.isActive()||(A*=2),A*S}function Xt(g,S){if(g.j.info("Error code "+S),S==2){var A=d(g.fb,g),z=g.Xa;const ee=!z;z=new so(z||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ls(z,"https"),Sa(z),ee?gw(z.toString(),A):eg(z.toString(),A)}else as(2);g.G=0,g.l&&g.l.sa(S),Ws(g),X(g)}t.fb=function(g){g?(this.j.info("Successfully pinged google.com"),as(2)):(this.j.info("Failed to ping google.com"),as(1))};function Ws(g){if(g.G=0,g.ka=[],g.l){const S=vd(g.h);(S.length!=0||g.i.length!=0)&&(v(g.ka,S),v(g.ka,g.i),g.h.i.length=0,m(g.i),g.i.length=0),g.l.ra()}}function us(g,S,A){var z=A instanceof so?Ur(A):new so(A);if(z.g!="")S&&(z.g=S+"."+z.g),zl(z,z.s);else{var ee=a.location;z=ee.protocol,S=S?S+"."+ee.hostname:ee.hostname,ee=+ee.port;var ue=new so(null);z&&ls(ue,z),S&&(ue.g=S),ee&&zl(ue,ee),A&&(ue.l=A),z=ue}return A=g.D,S=g.ya,A&&S&&Ft(z,A,S),Ft(z,"VER",g.la),ve(g,z),z}function mt(g,S,A){if(S&&!g.J)throw Error("Can't create secondary domain capable XhrIo object.");return S=g.Ca&&!g.pa?new en(new Wl({eb:A})):new en(g.pa),S.Ha(g.J),S}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function fn(){}t=fn.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function kr(){}kr.prototype.g=function(g,S){return new Er(g,S)};function Er(g,S){Tt.call(this),this.g=new D(S),this.l=g,this.h=S&&S.messageUrlParams||null,g=S&&S.messageHeaders||null,S&&S.clientProtocolHeaderRequired&&(g?g["X-Client-Protocol"]="webchannel":g={"X-Client-Protocol":"webchannel"}),this.g.o=g,g=S&&S.initMessageHeaders||null,S&&S.messageContentType&&(g?g["X-WebChannel-Content-Type"]=S.messageContentType:g={"X-WebChannel-Content-Type":S.messageContentType}),S&&S.va&&(g?g["X-WebChannel-Client-Profile"]=S.va:g={"X-WebChannel-Client-Profile":S.va}),this.g.S=g,(g=S&&S.Sb)&&!w(g)&&(this.g.m=g),this.v=S&&S.supportsCrossDomainXhr||!1,this.u=S&&S.sendRawJson||!1,(S=S&&S.httpSessionIdParam)&&!w(S)&&(this.g.D=S,g=this.h,g!==null&&S in g&&(g=this.h,S in g&&delete g[S])),this.j=new Ic(this)}f(Er,Tt),Er.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Er.prototype.close=function(){M(this.g)},Er.prototype.o=function(g){var S=this.g;if(typeof g=="string"){var A={};A.__data__=g,g=A}else this.u&&(A={},A.__data__=gi(g),g=A);S.i.push(new dw(S.Ya++,g)),S.G==3&&G(S)},Er.prototype.N=function(){this.g.l=null,delete this.j,M(this.g),delete this.g,Er.aa.N.call(this)};function Vk(g){Us.call(this),g.__headers__&&(this.headers=g.__headers__,this.statusCode=g.__status__,delete g.__headers__,delete g.__status__);var S=g.__sm__;if(S){e:{for(const A in S){g=A;break e}g=void 0}(this.i=g)&&(g=this.i,S=S!==null&&g in S?S[g]:void 0),this.data=S}else this.data=g}f(Vk,Us);function zk(){an.call(this),this.status=1}f(zk,an);function Ic(g){this.g=g}f(Ic,fn),Ic.prototype.ua=function(){$t(this.g,"a")},Ic.prototype.ta=function(g){$t(this.g,new Vk(g))},Ic.prototype.sa=function(g){$t(this.g,new zk)},Ic.prototype.ra=function(){$t(this.g,"b")},kr.prototype.createWebChannel=kr.prototype.g,Er.prototype.send=Er.prototype.o,Er.prototype.open=Er.prototype.m,Er.prototype.close=Er.prototype.close,D4=function(){return new kr},R4=function(){return Ro()},A4=to,$2={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Fl.NO_ERROR=0,Fl.TIMEOUT=8,Fl.HTTP_ERROR=6,oy=Fl,fd.COMPLETE="complete",$4=fd,cd.EventType=ga,ga.OPEN="a",ga.CLOSE="b",ga.ERROR="c",ga.MESSAGE="d",Tt.prototype.listen=Tt.prototype.K,Xd=cd,en.prototype.listenOnce=en.prototype.L,en.prototype.getLastError=en.prototype.Ka,en.prototype.getLastErrorCode=en.prototype.Ba,en.prototype.getStatus=en.prototype.Z,en.prototype.getResponseJson=en.prototype.Oa,en.prototype.getResponseText=en.prototype.oa,en.prototype.send=en.prototype.ea,en.prototype.setWithCredentials=en.prototype.Ha,N4=en}).apply(typeof Tg<"u"?Tg:typeof self<"u"?self:typeof window<"u"?window:{});const $_="@firebase/firestore",A_="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Es.UNAUTHENTICATED=new Es(null),Es.GOOGLE_CREDENTIALS=new Es("google-credentials-uid"),Es.FIRST_PARTY=new Es("first-party-uid"),Es.MOCK_USER=new Es("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Uh="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ku=new s0("@firebase/firestore");function _c(){return ku.logLevel}function Le(t,...e){if(ku.logLevel<=dt.DEBUG){const n=e.map(XI);ku.debug(`Firestore (${Uh}): ${t}`,...n)}}function Eu(t,...e){if(ku.logLevel<=dt.ERROR){const n=e.map(XI);ku.error(`Firestore (${Uh}): ${t}`,...n)}}function a0(t,...e){if(ku.logLevel<=dt.WARN){const n=e.map(XI);ku.warn(`Firestore (${Uh}): ${t}`,...n)}}function XI(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lt(t="Unexpected state"){const e=`FIRESTORE (${Uh}) INTERNAL ASSERTION FAILED: `+t;throw Eu(e),new Error(e)}function vn(t,e){t||lt()}function Kt(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const be={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Xe extends qi{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fu{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O4{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class x7{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Es.UNAUTHENTICATED))}shutdown(){}}class b7{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class I7{constructor(e){this.t=e,this.currentUser=Es.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){vn(this.o===void 0);let s=this.i;const r=l=>this.i!==s?(s=this.i,n(l)):Promise.resolve();let i=new fu;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new fu,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await r(this.currentUser)})},a=l=>{Le("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(Le("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new fu)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(s=>this.i!==e?(Le("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(vn(typeof s.accessToken=="string"),new O4(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return vn(e===null||typeof e=="string"),new Es(e)}}class S7{constructor(e,n,s){this.l=e,this.h=n,this.P=s,this.type="FirstParty",this.user=Es.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class T7{constructor(e,n,s){this.l=e,this.h=n,this.P=s}getToken(){return Promise.resolve(new S7(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(Es.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class R_{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class C7{constructor(e,n){this.A=n,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Xr(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,n){vn(this.o===void 0);const s=i=>{i.error!=null&&Le("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,Le("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>s(i))};const r=i=>{Le("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?r(i):Le("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new R_(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(vn(typeof n.token=="string"),this.R=n.token,new R_(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k7(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let s=0;s<t;s++)n[s]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E7(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P4{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=k7(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<n&&(s+=e.charAt(r[i]%62))}return s}}function xt(t,e){return t<e?-1:t>e?1:0}function A2(t,e){let n=0;for(;n<t.length&&n<e.length;){const s=t.codePointAt(n),r=e.codePointAt(n);if(s!==r){if(s<128&&r<128)return xt(s,r);{const i=E7(),o=_7(i.encode(D_(t,n)),i.encode(D_(e,n)));return o!==0?o:xt(s,r)}}n+=s>65535?2:1}return xt(t.length,e.length)}function D_(t,e){return t.codePointAt(e)>65535?t.substring(e,e+2):t.substring(e,e+1)}function _7(t,e){for(let n=0;n<t.length&&n<e.length;++n)if(t[n]!==e[n])return xt(t[n],e[n]);return xt(t.length,e.length)}function wh(t,e,n){return t.length===e.length&&t.every((s,r)=>n(s,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O_=-62135596800,P_=1e6;class es{static now(){return es.fromMillis(Date.now())}static fromDate(e){return es.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),s=Math.floor((e-1e3*n)*P_);return new es(n,s)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Xe(be.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Xe(be.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<O_)throw new Xe(be.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Xe(be.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/P_}_compareTo(e){return this.seconds===e.seconds?xt(this.nanoseconds,e.nanoseconds):xt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-O_;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{static fromTimestamp(e){return new tn(e)}static min(){return new tn(new es(0,0))}static max(){return new tn(new es(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F_="__name__";class lo{constructor(e,n,s){n===void 0?n=0:n>e.length&&lt(),s===void 0?s=e.length-n:s>e.length-n&&lt(),this.segments=e,this.offset=n,this.len=s}get length(){return this.len}isEqual(e){return lo.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof lo?e.forEach(s=>{n.push(s)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,s=this.limit();n<s;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const s=Math.min(e.length,n.length);for(let r=0;r<s;r++){const i=lo.compareSegments(e.get(r),n.get(r));if(i!==0)return i}return xt(e.length,n.length)}static compareSegments(e,n){const s=lo.isNumericId(e),r=lo.isNumericId(n);return s&&!r?-1:!s&&r?1:s&&r?lo.extractNumericId(e).compare(lo.extractNumericId(n)):A2(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return KI.fromString(e.substring(4,e.length-2))}}class En extends lo{construct(e,n,s){return new En(e,n,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const s of e){if(s.indexOf("//")>=0)throw new Xe(be.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);n.push(...s.split("/").filter(r=>r.length>0))}return new En(n)}static emptyPath(){return new En([])}}const N7=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class fs extends lo{construct(e,n,s){return new fs(e,n,s)}static isValidIdentifier(e){return N7.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),fs.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===F_}static keyField(){return new fs([F_])}static fromServerFormat(e){const n=[];let s="",r=0;const i=()=>{if(s.length===0)throw new Xe(be.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(s),s=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new Xe(be.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Xe(be.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(s+=a,r++):(i(),r++)}if(i(),o)throw new Xe(be.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new fs(n)}static emptyPath(){return new fs([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ot{constructor(e){this.path=e}static fromPath(e){return new ot(En.fromString(e))}static fromName(e){return new ot(En.fromString(e).popFirst(5))}static empty(){return new ot(En.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&En.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return En.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ot(new En(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mp=-1;function $7(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,r=tn.fromTimestamp(s===1e9?new es(n+1,0):new es(n,s));return new rl(r,ot.empty(),e)}function A7(t){return new rl(t.readTime,t.key,Mp)}class rl{constructor(e,n,s){this.readTime=e,this.documentKey=n,this.largestBatchId=s}static min(){return new rl(tn.min(),ot.empty(),Mp)}static max(){return new rl(tn.max(),ot.empty(),Mp)}}function R7(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=ot.comparator(t.documentKey,e.documentKey),n!==0?n:xt(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D7="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class O7{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YI(t){if(t.code!==be.FAILED_PRECONDITION||t.message!==D7)throw t;Le("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class me{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&lt(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new me((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(n,i).next(s,r)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof me?n:me.resolve(n)}catch(n){return me.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):me.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):me.reject(n)}static resolve(e){return new me((n,s)=>{n(e)})}static reject(e){return new me((n,s)=>{s(e)})}static waitFor(e){return new me((n,s)=>{let r=0,i=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++i,o&&i===r&&n()},l=>s(l))}),o=!0,i===r&&n()})}static or(e){let n=me.resolve(!1);for(const s of e)n=n.next(r=>r?me.resolve(r):s());return n}static forEach(e,n){const s=[];return e.forEach((r,i)=>{s.push(n.call(this,r,i))}),this.waitFor(s)}static mapArray(e,n){return new me((s,r)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;n(e[u]).next(c=>{o[u]=c,++a,a===i&&s(o)},c=>r(c))}})}static doWhile(e,n){return new me((s,r)=>{const i=()=>{e()===!0?n().next(()=>{i()},r):s()};i()})}}function P7(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function gf(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QI{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=s=>this.oe(s),this._e=s=>n.writeSequenceNumber(s))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}QI.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JI=-1;function ZI(t){return t==null}function qy(t){return t===0&&1/t==-1/0}function F7(t){return typeof t=="number"&&Number.isInteger(t)&&!qy(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F4="";function L7(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=L_(e)),e=M7(t.get(n),e);return L_(e)}function M7(t,e){let n=e;const s=t.length;for(let r=0;r<s;r++){const i=t.charAt(r);switch(i){case"\0":n+="";break;case F4:n+="";break;default:n+=i}}return n}function L_(t){return t+F4+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M_(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Wh(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function L4(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr{constructor(e,n){this.comparator=e,this.root=n||ds.EMPTY}insert(e,n){return new yr(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ds.BLACK,null,null))}remove(e){return new yr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ds.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(s===0)return n.value;s<0?n=n.left:s>0&&(n=n.right)}return null}indexOf(e){let n=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return n+s.left.size;r<0?s=s.left:(n+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,s)=>(e(n,s),!1))}toString(){const e=[];return this.inorderTraversal((n,s)=>(e.push(`${n}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Cg(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Cg(this.root,e,this.comparator,!1)}getReverseIterator(){return new Cg(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Cg(this.root,e,this.comparator,!0)}}class Cg{constructor(e,n,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?s(e.key,n):1,n&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ds{constructor(e,n,s,r,i){this.key=e,this.value=n,this.color=s??ds.RED,this.left=r??ds.EMPTY,this.right=i??ds.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,s,r,i){return new ds(e??this.key,n??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,n,s),null):i===0?r.copy(null,n,null,null,null):r.copy(null,null,null,null,r.right.insert(e,n,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ds.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let s,r=this;if(n(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),n(e,r.key)===0){if(r.right.isEmpty())return ds.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ds.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ds.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw lt();const e=this.left.check();if(e!==this.right.check())throw lt();return e+(this.isRed()?0:1)}}ds.EMPTY=null,ds.RED=!0,ds.BLACK=!1;ds.EMPTY=new class{constructor(){this.size=0}get key(){throw lt()}get value(){throw lt()}get color(){throw lt()}get left(){throw lt()}get right(){throw lt()}copy(e,n,s,r,i){return this}insert(e,n,s){return new ds(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e){this.comparator=e,this.data=new yr(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,s)=>(e(n),!1))}forEachInRange(e,n){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;n(r.key)}}forEachWhile(e,n){let s;for(s=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new V_(this.data.getIterator())}getIteratorFrom(e){return new V_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(s=>{n=n.add(s)}),n}isEqual(e){if(!(e instanceof gs)||this.size!==e.size)return!1;const n=this.data.getIterator(),s=e.data.getIterator();for(;n.hasNext();){const r=n.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new gs(this.comparator);return n.data=e,n}}class V_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(e){this.fields=e,e.sort(fs.comparator)}static empty(){return new Di([])}unionWith(e){let n=new gs(fs.comparator);for(const s of this.fields)n=n.add(s);for(const s of e)n=n.add(s);return new Di(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return wh(this.fields,e.fields,(n,s)=>n.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V7 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new V7("Invalid base64 string: "+i):i}}(e);return new To(n)}static fromUint8Array(e){const n=function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i}(e);return new To(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const s=new Uint8Array(n.length);for(let r=0;r<n.length;r++)s[r]=n.charCodeAt(r);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return xt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}To.EMPTY_BYTE_STRING=new To("");const z7=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _u(t){if(vn(!!t),typeof t=="string"){let e=0;const n=z7.exec(t);if(vn(!!n),n[1]){let r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:ps(t.seconds),nanos:ps(t.nanos)}}function ps(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function xh(t){return typeof t=="string"?To.fromBase64String(t):To.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M4="server_timestamp",V4="__type__",z4="__previous_value__",B4="__local_write_time__";function eS(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{})[V4])===null||n===void 0?void 0:n.stringValue)===M4}function tS(t){const e=t.mapValue.fields[z4];return eS(e)?tS(e):e}function Ky(t){const e=_u(t.mapValue.fields[B4].timestampValue);return new es(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B7{constructor(e,n,s,r,i,o,a,l,u){this.databaseId=e,this.appId=n,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u}}const Xy="(default)";class Yy{constructor(e,n){this.projectId=e,this.database=n||Xy}static empty(){return new Yy("","")}get isDefaultDatabase(){return this.database===Xy}isEqual(e){return e instanceof Yy&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U4="__type__",W4="__max__",kg={mapValue:{fields:{__type__:{stringValue:W4}}}},j4="__vector__",R2="value";function Nu(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?eS(t)?4:W7(t)?9007199254740991:U7(t)?10:11:lt()}function Co(t,e){if(t===e)return!0;const n=Nu(t);if(n!==Nu(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ky(t).isEqual(Ky(e));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=_u(r.timestampValue),a=_u(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(r,i){return xh(r.bytesValue).isEqual(xh(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(r,i){return ps(r.geoPointValue.latitude)===ps(i.geoPointValue.latitude)&&ps(r.geoPointValue.longitude)===ps(i.geoPointValue.longitude)}(t,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return ps(r.integerValue)===ps(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=ps(r.doubleValue),a=ps(i.doubleValue);return o===a?qy(o)===qy(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return wh(t.arrayValue.values||[],e.arrayValue.values||[],Co);case 10:case 11:return function(r,i){const o=r.mapValue.fields||{},a=i.mapValue.fields||{};if(M_(o)!==M_(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Co(o[l],a[l])))return!1;return!0}(t,e);default:return lt()}}function Vp(t,e){return(t.values||[]).find(n=>Co(n,e))!==void 0}function bh(t,e){if(t===e)return 0;const n=Nu(t),s=Nu(e);if(n!==s)return xt(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return xt(t.booleanValue,e.booleanValue);case 2:return function(i,o){const a=ps(i.integerValue||i.doubleValue),l=ps(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(t,e);case 3:return z_(t.timestampValue,e.timestampValue);case 4:return z_(Ky(t),Ky(e));case 5:return A2(t.stringValue,e.stringValue);case 6:return function(i,o){const a=xh(i),l=xh(o);return a.compareTo(l)}(t.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const c=xt(a[u],l[u]);if(c!==0)return c}return xt(a.length,l.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,o){const a=xt(ps(i.latitude),ps(o.latitude));return a!==0?a:xt(ps(i.longitude),ps(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return B_(t.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,u,c;const h=i.fields||{},d=o.fields||{},p=(a=h[R2])===null||a===void 0?void 0:a.arrayValue,f=(l=d[R2])===null||l===void 0?void 0:l.arrayValue,m=xt(((u=p==null?void 0:p.values)===null||u===void 0?void 0:u.length)||0,((c=f==null?void 0:f.values)===null||c===void 0?void 0:c.length)||0);return m!==0?m:B_(p,f)}(t.mapValue,e.mapValue);case 11:return function(i,o){if(i===kg.mapValue&&o===kg.mapValue)return 0;if(i===kg.mapValue)return 1;if(o===kg.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},c=Object.keys(u);l.sort(),c.sort();for(let h=0;h<l.length&&h<c.length;++h){const d=A2(l[h],c[h]);if(d!==0)return d;const p=bh(a[l[h]],u[c[h]]);if(p!==0)return p}return xt(l.length,c.length)}(t.mapValue,e.mapValue);default:throw lt()}}function z_(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return xt(t,e);const n=_u(t),s=_u(e),r=xt(n.seconds,s.seconds);return r!==0?r:xt(n.nanos,s.nanos)}function B_(t,e){const n=t.values||[],s=e.values||[];for(let r=0;r<n.length&&r<s.length;++r){const i=bh(n[r],s[r]);if(i)return i}return xt(n.length,s.length)}function Ih(t){return D2(t)}function D2(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const s=_u(n);return`time(${s.seconds},${s.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return xh(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return ot.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let s="[",r=!0;for(const i of n.values||[])r?r=!1:s+=",",s+=D2(i);return s+"]"}(t.arrayValue):"mapValue"in t?function(n){const s=Object.keys(n.fields||{}).sort();let r="{",i=!0;for(const o of s)i?i=!1:r+=",",r+=`${o}:${D2(n.fields[o])}`;return r+"}"}(t.mapValue):lt()}function ay(t){switch(Nu(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=tS(t);return e?16+ay(e):16;case 5:return 2*t.stringValue.length;case 6:return xh(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(s){return(s.values||[]).reduce((r,i)=>r+ay(i),0)}(t.arrayValue);case 10:case 11:return function(s){let r=0;return Wh(s.fields,(i,o)=>{r+=i.length+ay(o)}),r}(t.mapValue);default:throw lt()}}function O2(t){return!!t&&"integerValue"in t}function nS(t){return!!t&&"arrayValue"in t}function ly(t){return!!t&&"mapValue"in t}function U7(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{})[U4])===null||n===void 0?void 0:n.stringValue)===j4}function dp(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Wh(t.mapValue.fields,(n,s)=>e.mapValue.fields[n]=dp(s)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=dp(t.arrayValue.values[n]);return e}return Object.assign({},t)}function W7(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===W4}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai{constructor(e){this.value=e}static empty(){return new Ai({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let s=0;s<e.length-1;++s)if(n=(n.mapValue.fields||{})[e.get(s)],!ly(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=dp(n)}setAll(e){let n=fs.emptyPath(),s={},r=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const l=this.getFieldsMap(n);this.applyChanges(l,s,r),s={},r=[],n=a.popLast()}o?s[a.lastSegment()]=dp(o):r.push(a.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,s,r)}delete(e){const n=this.field(e.popLast());ly(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Co(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=n.mapValue.fields[e.get(s)];ly(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},n.mapValue.fields[e.get(s)]=r),n=r}return n.mapValue.fields}applyChanges(e,n,s){Wh(n,(r,i)=>e[r]=i);for(const r of s)delete e[r]}clone(){return new Ai(dp(this.value))}}function G4(t){const e=[];return Wh(t.fields,(n,s)=>{const r=new fs([n]);if(ly(s)){const i=G4(s.mapValue).fields;if(i.length===0)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)}),new Di(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(e,n,s,r,i,o,a){this.key=e,this.documentType=n,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new _i(e,0,tn.min(),tn.min(),tn.min(),Ai.empty(),0)}static newFoundDocument(e,n,s,r){return new _i(e,1,n,tn.min(),s,r,0)}static newNoDocument(e,n){return new _i(e,2,n,tn.min(),tn.min(),Ai.empty(),0)}static newUnknownDocument(e,n){return new _i(e,3,n,tn.min(),tn.min(),Ai.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(tn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ai.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ai.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=tn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof _i&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new _i(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qy{constructor(e,n){this.position=e,this.inclusive=n}}function U_(t,e,n){let s=0;for(let r=0;r<t.position.length;r++){const i=e[r],o=t.position[r];if(i.field.isKeyField()?s=ot.comparator(ot.fromName(o.referenceValue),n.key):s=bh(o,n.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function W_(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Co(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jy{constructor(e,n="asc"){this.field=e,this.dir=n}}function j7(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4{}class Yn extends H4{constructor(e,n,s){super(),this.field=e,this.op=n,this.value=s}static create(e,n,s){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,s):new H7(e,n,s):n==="array-contains"?new X7(e,s):n==="in"?new Y7(e,s):n==="not-in"?new Q7(e,s):n==="array-contains-any"?new J7(e,s):new Yn(e,n,s)}static createKeyFieldInFilter(e,n,s){return n==="in"?new q7(e,s):new K7(e,s)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(bh(n,this.value)):n!==null&&Nu(this.value)===Nu(n)&&this.matchesComparison(bh(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return lt()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class il extends H4{constructor(e,n){super(),this.filters=e,this.op=n,this.ce=null}static create(e,n){return new il(e,n)}matches(e){return q4(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function q4(t){return t.op==="and"}function K4(t){return G7(t)&&q4(t)}function G7(t){for(const e of t.filters)if(e instanceof il)return!1;return!0}function P2(t){if(t instanceof Yn)return t.field.canonicalString()+t.op.toString()+Ih(t.value);if(K4(t))return t.filters.map(e=>P2(e)).join(",");{const e=t.filters.map(n=>P2(n)).join(",");return`${t.op}(${e})`}}function X4(t,e){return t instanceof Yn?function(s,r){return r instanceof Yn&&s.op===r.op&&s.field.isEqual(r.field)&&Co(s.value,r.value)}(t,e):t instanceof il?function(s,r){return r instanceof il&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce((i,o,a)=>i&&X4(o,r.filters[a]),!0):!1}(t,e):void lt()}function Y4(t){return t instanceof Yn?function(n){return`${n.field.canonicalString()} ${n.op} ${Ih(n.value)}`}(t):t instanceof il?function(n){return n.op.toString()+" {"+n.getFilters().map(Y4).join(" ,")+"}"}(t):"Filter"}class H7 extends Yn{constructor(e,n,s){super(e,n,s),this.key=ot.fromName(s.referenceValue)}matches(e){const n=ot.comparator(e.key,this.key);return this.matchesComparison(n)}}class q7 extends Yn{constructor(e,n){super(e,"in",n),this.keys=Q4("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class K7 extends Yn{constructor(e,n){super(e,"not-in",n),this.keys=Q4("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function Q4(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(s=>ot.fromName(s.referenceValue))}class X7 extends Yn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return nS(n)&&Vp(n.arrayValue,this.value)}}class Y7 extends Yn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Vp(this.value.arrayValue,n)}}class Q7 extends Yn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Vp(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!Vp(this.value.arrayValue,n)}}class J7 extends Yn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!nS(n)||!n.arrayValue.values)&&n.arrayValue.values.some(s=>Vp(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z7{constructor(e,n=null,s=[],r=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.le=null}}function j_(t,e=null,n=[],s=[],r=null,i=null,o=null){return new Z7(t,e,n,s,r,i,o)}function sS(t){const e=Kt(t);if(e.le===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(s=>P2(s)).join(","),n+="|ob:",n+=e.orderBy.map(s=>function(i){return i.field.canonicalString()+i.dir}(s)).join(","),ZI(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(s=>Ih(s)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(s=>Ih(s)).join(",")),e.le=n}return e.le}function rS(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!j7(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!X4(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!W_(t.startAt,e.startAt)&&W_(t.endAt,e.endAt)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l0{constructor(e,n=null,s=[],r=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function ej(t,e,n,s,r,i,o,a){return new l0(t,e,n,s,r,i,o,a)}function tj(t){return new l0(t)}function G_(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function nj(t){return t.collectionGroup!==null}function pp(t){const e=Kt(t);if(e.he===null){e.he=[];const n=new Set;for(const i of e.explicitOrderBy)e.he.push(i),n.add(i.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new gs(fs.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.he.push(new Jy(i,s))}),n.has(fs.keyField().canonicalString())||e.he.push(new Jy(fs.keyField(),s))}return e.he}function mu(t){const e=Kt(t);return e.Pe||(e.Pe=sj(e,pp(t))),e.Pe}function sj(t,e){if(t.limitType==="F")return j_(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(r=>{const i=r.dir==="desc"?"asc":"desc";return new Jy(r.field,i)});const n=t.endAt?new Qy(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new Qy(t.startAt.position,t.startAt.inclusive):null;return j_(t.path,t.collectionGroup,e,t.filters,t.limit,n,s)}}function F2(t,e,n){return new l0(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function J4(t,e){return rS(mu(t),mu(e))&&t.limitType===e.limitType}function Z4(t){return`${sS(mu(t))}|lt:${t.limitType}`}function Md(t){return`Query(target=${function(n){let s=n.path.canonicalString();return n.collectionGroup!==null&&(s+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(s+=`, filters: [${n.filters.map(r=>Y4(r)).join(", ")}]`),ZI(n.limit)||(s+=", limit: "+n.limit),n.orderBy.length>0&&(s+=`, orderBy: [${n.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),n.startAt&&(s+=", startAt: ",s+=n.startAt.inclusive?"b:":"a:",s+=n.startAt.position.map(r=>Ih(r)).join(",")),n.endAt&&(s+=", endAt: ",s+=n.endAt.inclusive?"a:":"b:",s+=n.endAt.position.map(r=>Ih(r)).join(",")),`Target(${s})`}(mu(t))}; limitType=${t.limitType})`}function iS(t,e){return e.isFoundDocument()&&function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):ot.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)}(t,e)&&function(s,r){for(const i of pp(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0}(t,e)&&function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0}(t,e)&&function(s,r){return!(s.startAt&&!function(o,a,l){const u=U_(o,a,l);return o.inclusive?u<=0:u<0}(s.startAt,pp(s),r)||s.endAt&&!function(o,a,l){const u=U_(o,a,l);return o.inclusive?u>=0:u>0}(s.endAt,pp(s),r))}(t,e)}function rj(t){return(e,n)=>{let s=!1;for(const r of pp(t)){const i=ij(r,e,n);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function ij(t,e,n){const s=t.field.isKeyField()?ot.comparator(e.key,n.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?bh(l,u):lt()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return lt()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ju{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),s=this.inner[n];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,n]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,n]);r.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),s=this.inner[n];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[n]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Wh(this.inner,(n,s)=>{for(const[r,i]of s)e(r,i)})}isEmpty(){return L4(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oj=new yr(ot.comparator);function Zy(){return oj}const eD=new yr(ot.comparator);function Eg(...t){let e=eD;for(const n of t)e=e.insert(n.key,n);return e}function tD(t){let e=eD;return t.forEach((n,s)=>e=e.insert(n,s.overlayedDocument)),e}function au(){return fp()}function nD(){return fp()}function fp(){return new Ju(t=>t.toString(),(t,e)=>t.isEqual(e))}const aj=new yr(ot.comparator),lj=new gs(ot.comparator);function $s(...t){let e=lj;for(const n of t)e=e.add(n);return e}const uj=new gs(xt);function cj(){return uj}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oS(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qy(e)?"-0":e}}function sD(t){return{integerValue:""+t}}function hj(t,e){return F7(e)?sD(e):oS(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0{constructor(){this._=void 0}}function dj(t,e,n){return t instanceof e1?function(r,i){const o={fields:{[V4]:{stringValue:M4},[B4]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&eS(i)&&(i=tS(i)),i&&(o.fields[z4]=i),{mapValue:o}}(n,e):t instanceof zp?iD(t,e):t instanceof Bp?oD(t,e):function(r,i){const o=rD(r,i),a=H_(o)+H_(r.Ie);return O2(o)&&O2(r.Ie)?sD(a):oS(r.serializer,a)}(t,e)}function pj(t,e,n){return t instanceof zp?iD(t,e):t instanceof Bp?oD(t,e):n}function rD(t,e){return t instanceof t1?function(s){return O2(s)||function(i){return!!i&&"doubleValue"in i}(s)}(e)?e:{integerValue:0}:null}class e1 extends u0{}class zp extends u0{constructor(e){super(),this.elements=e}}function iD(t,e){const n=aD(e);for(const s of t.elements)n.some(r=>Co(r,s))||n.push(s);return{arrayValue:{values:n}}}class Bp extends u0{constructor(e){super(),this.elements=e}}function oD(t,e){let n=aD(e);for(const s of t.elements)n=n.filter(r=>!Co(r,s));return{arrayValue:{values:n}}}class t1 extends u0{constructor(e,n){super(),this.serializer=e,this.Ie=n}}function H_(t){return ps(t.integerValue||t.doubleValue)}function aD(t){return nS(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function fj(t,e){return t.field.isEqual(e.field)&&function(s,r){return s instanceof zp&&r instanceof zp||s instanceof Bp&&r instanceof Bp?wh(s.elements,r.elements,Co):s instanceof t1&&r instanceof t1?Co(s.Ie,r.Ie):s instanceof e1&&r instanceof e1}(t.transform,e.transform)}class mj{constructor(e,n){this.version=e,this.transformResults=n}}class Ho{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Ho}static exists(e){return new Ho(void 0,e)}static updateTime(e){return new Ho(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function uy(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class c0{}function lD(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new cD(t.key,Ho.none()):new yf(t.key,t.data,Ho.none());{const n=t.data,s=Ai.empty();let r=new gs(fs.comparator);for(let i of e.fields)if(!r.has(i)){let o=n.field(i);o===null&&i.length>1&&(i=i.popLast(),o=n.field(i)),o===null?s.delete(i):s.set(i,o),r=r.add(i)}return new Zu(t.key,s,new Di(r.toArray()),Ho.none())}}function gj(t,e,n){t instanceof yf?function(r,i,o){const a=r.value.clone(),l=K_(r.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof Zu?function(r,i,o){if(!uy(r.precondition,i))return void i.convertToUnknownDocument(o.version);const a=K_(r.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(uD(r)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,n):function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function mp(t,e,n,s){return t instanceof yf?function(i,o,a,l){if(!uy(i.precondition,o))return a;const u=i.value.clone(),c=X_(i.fieldTransforms,l,o);return u.setAll(c),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(t,e,n,s):t instanceof Zu?function(i,o,a,l){if(!uy(i.precondition,o))return a;const u=X_(i.fieldTransforms,l,o),c=o.data;return c.setAll(uD(i)),c.setAll(u),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(t,e,n,s):function(i,o,a){return uy(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function yj(t,e){let n=null;for(const s of t.fieldTransforms){const r=e.data.field(s.field),i=rD(s.transform,r||null);i!=null&&(n===null&&(n=Ai.empty()),n.set(s.field,i))}return n||null}function q_(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&wh(s,r,(i,o)=>fj(i,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class yf extends c0{constructor(e,n,s,r=[]){super(),this.key=e,this.value=n,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Zu extends c0{constructor(e,n,s,r,i=[]){super(),this.key=e,this.data=n,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function uD(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}}),e}function K_(t,e,n){const s=new Map;vn(t.length===n.length);for(let r=0;r<n.length;r++){const i=t[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,pj(o,a,n[r]))}return s}function X_(t,e,n){const s=new Map;for(const r of t){const i=r.transform,o=n.data.field(r.field);s.set(r.field,dj(i,o,e))}return s}class cD extends c0{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class vj extends c0{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wj{constructor(e,n,s,r){this.batchId=e,this.localWriteTime=n,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,n){const s=n.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&gj(i,e,s[r])}}applyToLocalView(e,n){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(n=mp(s,e,n,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(n=mp(s,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const s=nD();return this.mutations.forEach(r=>{const i=e.get(r.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=n.has(r.key)?null:a;const l=lD(o,a);l!==null&&s.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(tn.min())}),s}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),$s())}isEqual(e){return this.batchId===e.batchId&&wh(this.mutations,e.mutations,(n,s)=>q_(n,s))&&wh(this.baseMutations,e.baseMutations,(n,s)=>q_(n,s))}}class aS{constructor(e,n,s,r){this.batch=e,this.commitVersion=n,this.mutationResults=s,this.docVersions=r}static from(e,n,s){vn(e.mutations.length===s.length);let r=function(){return aj}();const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new aS(e,n,s,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xj{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Cn,vt;function bj(t){switch(t){case be.OK:return lt();case be.CANCELLED:case be.UNKNOWN:case be.DEADLINE_EXCEEDED:case be.RESOURCE_EXHAUSTED:case be.INTERNAL:case be.UNAVAILABLE:case be.UNAUTHENTICATED:return!1;case be.INVALID_ARGUMENT:case be.NOT_FOUND:case be.ALREADY_EXISTS:case be.PERMISSION_DENIED:case be.FAILED_PRECONDITION:case be.ABORTED:case be.OUT_OF_RANGE:case be.UNIMPLEMENTED:case be.DATA_LOSS:return!0;default:return lt()}}function Ij(t){if(t===void 0)return Eu("GRPC error has no .code"),be.UNKNOWN;switch(t){case Cn.OK:return be.OK;case Cn.CANCELLED:return be.CANCELLED;case Cn.UNKNOWN:return be.UNKNOWN;case Cn.DEADLINE_EXCEEDED:return be.DEADLINE_EXCEEDED;case Cn.RESOURCE_EXHAUSTED:return be.RESOURCE_EXHAUSTED;case Cn.INTERNAL:return be.INTERNAL;case Cn.UNAVAILABLE:return be.UNAVAILABLE;case Cn.UNAUTHENTICATED:return be.UNAUTHENTICATED;case Cn.INVALID_ARGUMENT:return be.INVALID_ARGUMENT;case Cn.NOT_FOUND:return be.NOT_FOUND;case Cn.ALREADY_EXISTS:return be.ALREADY_EXISTS;case Cn.PERMISSION_DENIED:return be.PERMISSION_DENIED;case Cn.FAILED_PRECONDITION:return be.FAILED_PRECONDITION;case Cn.ABORTED:return be.ABORTED;case Cn.OUT_OF_RANGE:return be.OUT_OF_RANGE;case Cn.UNIMPLEMENTED:return be.UNIMPLEMENTED;case Cn.DATA_LOSS:return be.DATA_LOSS;default:return lt()}}(vt=Cn||(Cn={}))[vt.OK=0]="OK",vt[vt.CANCELLED=1]="CANCELLED",vt[vt.UNKNOWN=2]="UNKNOWN",vt[vt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",vt[vt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",vt[vt.NOT_FOUND=5]="NOT_FOUND",vt[vt.ALREADY_EXISTS=6]="ALREADY_EXISTS",vt[vt.PERMISSION_DENIED=7]="PERMISSION_DENIED",vt[vt.UNAUTHENTICATED=16]="UNAUTHENTICATED",vt[vt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",vt[vt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",vt[vt.ABORTED=10]="ABORTED",vt[vt.OUT_OF_RANGE=11]="OUT_OF_RANGE",vt[vt.UNIMPLEMENTED=12]="UNIMPLEMENTED",vt[vt.INTERNAL=13]="INTERNAL",vt[vt.UNAVAILABLE=14]="UNAVAILABLE",vt[vt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new KI([4294967295,4294967295],0);class Sj{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function L2(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Tj(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Cj(t,e){return L2(t,e.toTimestamp())}function sh(t){return vn(!!t),tn.fromTimestamp(function(n){const s=_u(n);return new es(s.seconds,s.nanos)}(t))}function hD(t,e){return M2(t,e).canonicalString()}function M2(t,e){const n=function(r){return new En(["projects",r.projectId,"databases",r.database])}(t).child("documents");return e===void 0?n:n.child(e)}function kj(t){const e=En.fromString(t);return vn(Oj(e)),e}function V2(t,e){return hD(t.databaseId,e.path)}function Ej(t){const e=kj(t);return e.length===4?En.emptyPath():Nj(e)}function _j(t){return new En(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Nj(t){return vn(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Y_(t,e,n){return{name:V2(t,e),fields:n.value.mapValue.fields}}function $j(t,e){let n;if(e instanceof yf)n={update:Y_(t,e.key,e.value)};else if(e instanceof cD)n={delete:V2(t,e.key)};else if(e instanceof Zu)n={update:Y_(t,e.key,e.data),updateMask:Dj(e.fieldMask)};else{if(!(e instanceof vj))return lt();n={verify:V2(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(s=>function(i,o){const a=o.transform;if(a instanceof e1)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof zp)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Bp)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof t1)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw lt()}(0,s))),e.precondition.isNone||(n.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:Cj(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:lt()}(t,e.precondition)),n}function Aj(t,e){return t&&t.length>0?(vn(e!==void 0),t.map(n=>function(r,i){let o=r.updateTime?sh(r.updateTime):sh(i);return o.isEqual(tn.min())&&(o=sh(i)),new mj(o,r.transformResults||[])}(n,e))):[]}function Rj(t){let e=Ej(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let r=null;if(s>0){vn(s===1);const c=n.from[0];c.allDescendants?r=c.collectionId:e=e.child(c.collectionId)}let i=[];n.where&&(i=function(h){const d=dD(h);return d instanceof il&&K4(d)?d.getFilters():[d]}(n.where));let o=[];n.orderBy&&(o=function(h){return h.map(d=>function(f){return new Jy(Nc(f.field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(f.direction))}(d))}(n.orderBy));let a=null;n.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,ZI(d)?null:d}(n.limit));let l=null;n.startAt&&(l=function(h){const d=!!h.before,p=h.values||[];return new Qy(p,d)}(n.startAt));let u=null;return n.endAt&&(u=function(h){const d=!h.before,p=h.values||[];return new Qy(p,d)}(n.endAt)),ej(e,r,o,i,a,"F",l,u)}function dD(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const s=Nc(n.unaryFilter.field);return Yn.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=Nc(n.unaryFilter.field);return Yn.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Nc(n.unaryFilter.field);return Yn.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Nc(n.unaryFilter.field);return Yn.create(o,"!=",{nullValue:"NULL_VALUE"});default:return lt()}}(t):t.fieldFilter!==void 0?function(n){return Yn.create(Nc(n.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return lt()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return il.create(n.compositeFilter.filters.map(s=>dD(s)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return lt()}}(n.compositeFilter.op))}(t):lt()}function Nc(t){return fs.fromServerFormat(t.fieldPath)}function Dj(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function Oj(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pj{constructor(e){this.Tt=e}}function Fj(t){const e=Rj({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?F2(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lj{constructor(){this.Tn=new Mj}addToCollectionParentIndex(e,n){return this.Tn.add(n),me.resolve()}getCollectionParents(e,n){return me.resolve(this.Tn.getEntries(n))}addFieldIndex(e,n){return me.resolve()}deleteFieldIndex(e,n){return me.resolve()}deleteAllFieldIndexes(e){return me.resolve()}createTargetIndexes(e,n){return me.resolve()}getDocumentsMatchingTarget(e,n){return me.resolve(null)}getIndexType(e,n){return me.resolve(0)}getFieldIndexes(e,n){return me.resolve([])}getNextCollectionGroupToUpdate(e){return me.resolve(null)}getMinOffset(e,n){return me.resolve(rl.min())}getMinOffsetFromCollectionGroup(e,n){return me.resolve(rl.min())}updateCollectionGroup(e,n,s){return me.resolve()}updateIndexEntries(e,n){return me.resolve()}}class Mj{constructor(){this.index={}}add(e){const n=e.lastSegment(),s=e.popLast(),r=this.index[n]||new gs(En.comparator),i=!r.has(s);return this.index[n]=r.add(s),i}has(e){const n=e.lastSegment(),s=e.popLast(),r=this.index[n];return r&&r.has(s)}getEntries(e){return(this.index[e]||new gs(En.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},pD=41943040;class or{static withCacheSize(e){return new or(e,or.DEFAULT_COLLECTION_PERCENTILE,or.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */or.DEFAULT_COLLECTION_PERCENTILE=10,or.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,or.DEFAULT=new or(pD,or.DEFAULT_COLLECTION_PERCENTILE,or.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),or.DISABLED=new or(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sh{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new Sh(0)}static Kn(){return new Sh(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J_="LruGarbageCollector",Vj=1048576;function Z_([t,e],[n,s]){const r=xt(t,n);return r===0?xt(e,s):r}class zj{constructor(e){this.Hn=e,this.buffer=new gs(Z_),this.Jn=0}Yn(){return++this.Jn}Zn(e){const n=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(n);else{const s=this.buffer.last();Z_(n,s)<0&&(this.buffer=this.buffer.delete(s).add(n))}}get maxValue(){return this.buffer.last()[0]}}class Bj{constructor(e,n,s){this.garbageCollector=e,this.asyncQueue=n,this.localStore=s,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){Le(J_,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){gf(n)?Le(J_,"Ignoring IndexedDB error during garbage collection: ",n):await YI(n)}await this.er(3e5)})}}class Uj{constructor(e,n){this.tr=e,this.params=n}calculateTargetCount(e,n){return this.tr.nr(e).next(s=>Math.floor(n/100*s))}nthSequenceNumber(e,n){if(n===0)return me.resolve(QI.ae);const s=new zj(n);return this.tr.forEachTarget(e,r=>s.Zn(r.sequenceNumber)).next(()=>this.tr.rr(e,r=>s.Zn(r))).next(()=>s.maxValue)}removeTargets(e,n,s){return this.tr.removeTargets(e,n,s)}removeOrphanedDocuments(e,n){return this.tr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Le("LruGarbageCollector","Garbage collection skipped; disabled"),me.resolve(Q_)):this.getCacheSize(e).next(s=>s<this.params.cacheSizeCollectionThreshold?(Le("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Q_):this.ir(e,n))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,n){let s,r,i,o,a,l,u;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(Le("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),r=this.params.maximumSequenceNumbersToCollect):r=h,o=Date.now(),this.nthSequenceNumber(e,r))).next(h=>(s=h,a=Date.now(),this.removeTargets(e,s,n))).next(h=>(i=h,l=Date.now(),this.removeOrphanedDocuments(e,s))).next(h=>(u=Date.now(),_c()<=dt.DEBUG&&Le("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-c}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${h} documents in `+(u-l)+`ms
Total Duration: ${u-c}ms`),me.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:h})))}}function Wj(t,e){return new Uj(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jj{constructor(){this.changes=new Ju(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,_i.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const s=this.changes.get(n);return s!==void 0?me.resolve(s):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gj{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hj{constructor(e,n,s,r){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,n){let s=null;return this.documentOverlayCache.getOverlay(e,n).next(r=>(s=r,this.remoteDocumentCache.getEntry(e,n))).next(r=>(s!==null&&mp(s.mutation,r,Di.empty(),es.now()),r))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(s=>this.getLocalViewOfDocuments(e,s,$s()).next(()=>s))}getLocalViewOfDocuments(e,n,s=$s()){const r=au();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,s).next(i=>{let o=Eg();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const s=au();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,$s()))}populateOverlays(e,n,s){const r=[];return s.forEach(i=>{n.has(i)||r.push(i)}),this.documentOverlayCache.getOverlays(e,r).next(i=>{i.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,s,r){let i=Zy();const o=fp(),a=function(){return fp()}();return n.forEach((l,u)=>{const c=s.get(u.key);r.has(u.key)&&(c===void 0||c.mutation instanceof Zu)?i=i.insert(u.key,u):c!==void 0?(o.set(u.key,c.mutation.getFieldMask()),mp(c.mutation,u,c.mutation.getFieldMask(),es.now())):o.set(u.key,Di.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,c)=>o.set(u,c)),n.forEach((u,c)=>{var h;return a.set(u,new Gj(c,(h=o.get(u))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,n){const s=fp();let r=new yr((o,a)=>o-a),i=$s();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=n.get(l);if(u===null)return;let c=s.get(l)||Di.empty();c=a.applyToLocalView(u,c),s.set(l,c);const h=(r.get(a.batchId)||$s()).add(l);r=r.insert(a.batchId,h)})}).next(()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,c=l.value,h=nD();c.forEach(d=>{if(!i.has(d)){const p=lD(n.get(d),s.get(d));p!==null&&h.set(d,p),i=i.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,h))}return me.waitFor(o)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,n,s,r){return function(o){return ot.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):nj(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,s,r):this.getDocumentsMatchingCollectionQuery(e,n,s,r)}getNextDocuments(e,n,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,s,r).next(i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,s.largestBatchId,r-i.size):me.resolve(au());let a=Mp,l=i;return o.next(u=>me.forEach(u,(c,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(c)?me.resolve():this.remoteDocumentCache.getEntry(e,c).next(d=>{l=l.insert(c,d)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,$s())).next(c=>({batchId:a,changes:tD(c)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new ot(n)).next(s=>{let r=Eg();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r})}getDocumentsMatchingCollectionGroupQuery(e,n,s,r){const i=n.collectionGroup;let o=Eg();return this.indexManager.getCollectionParents(e,i).next(a=>me.forEach(a,l=>{const u=function(h,d){return new l0(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,s,r).next(c=>{c.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,s.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,s,i,r))).next(o=>{i.forEach((l,u)=>{const c=u.getKey();o.get(c)===null&&(o=o.insert(c,_i.newInvalidDocument(c)))});let a=Eg();return o.forEach((l,u)=>{const c=i.get(l);c!==void 0&&mp(c.mutation,u,Di.empty(),es.now()),iS(n,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qj{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,n){return me.resolve(this.dr.get(n))}saveBundleMetadata(e,n){return this.dr.set(n.id,function(r){return{id:r.id,version:r.version,createTime:sh(r.createTime)}}(n)),me.resolve()}getNamedQuery(e,n){return me.resolve(this.Ar.get(n))}saveNamedQuery(e,n){return this.Ar.set(n.name,function(r){return{name:r.name,query:Fj(r.bundledQuery),readTime:sh(r.readTime)}}(n)),me.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kj{constructor(){this.overlays=new yr(ot.comparator),this.Rr=new Map}getOverlay(e,n){return me.resolve(this.overlays.get(n))}getOverlays(e,n){const s=au();return me.forEach(n,r=>this.getOverlay(e,r).next(i=>{i!==null&&s.set(r,i)})).next(()=>s)}saveOverlays(e,n,s){return s.forEach((r,i)=>{this.Et(e,n,i)}),me.resolve()}removeOverlaysForBatchId(e,n,s){const r=this.Rr.get(s);return r!==void 0&&(r.forEach(i=>this.overlays=this.overlays.remove(i)),this.Rr.delete(s)),me.resolve()}getOverlaysForCollection(e,n,s){const r=au(),i=n.length+1,o=new ot(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>s&&r.set(l.getKey(),l)}return me.resolve(r)}getOverlaysForCollectionGroup(e,n,s,r){let i=new yr((u,c)=>u-c);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>s){let c=i.get(u.largestBatchId);c===null&&(c=au(),i=i.insert(u.largestBatchId,c)),c.set(u.getKey(),u)}}const a=au(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,c)=>a.set(u,c)),!(a.size()>=r)););return me.resolve(a)}Et(e,n,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.Rr.get(r.largestBatchId).delete(s.key);this.Rr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new xj(n,s));let i=this.Rr.get(n);i===void 0&&(i=$s(),this.Rr.set(n,i)),this.Rr.set(n,i.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xj{constructor(){this.sessionToken=To.EMPTY_BYTE_STRING}getSessionToken(e){return me.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,me.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lS{constructor(){this.Vr=new gs(qn.mr),this.gr=new gs(qn.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,n){const s=new qn(e,n);this.Vr=this.Vr.add(s),this.gr=this.gr.add(s)}yr(e,n){e.forEach(s=>this.addReference(s,n))}removeReference(e,n){this.wr(new qn(e,n))}Sr(e,n){e.forEach(s=>this.removeReference(s,n))}br(e){const n=new ot(new En([])),s=new qn(n,e),r=new qn(n,e+1),i=[];return this.gr.forEachInRange([s,r],o=>{this.wr(o),i.push(o.key)}),i}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const n=new ot(new En([])),s=new qn(n,e),r=new qn(n,e+1);let i=$s();return this.gr.forEachInRange([s,r],o=>{i=i.add(o.key)}),i}containsKey(e){const n=new qn(e,0),s=this.Vr.firstAfterOrEqual(n);return s!==null&&e.isEqual(s.key)}}class qn{constructor(e,n){this.key=e,this.Cr=n}static mr(e,n){return ot.comparator(e.key,n.key)||xt(e.Cr,n.Cr)}static pr(e,n){return xt(e.Cr,n.Cr)||ot.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yj{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Fr=1,this.Mr=new gs(qn.mr)}checkEmpty(e){return me.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,s,r){const i=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new wj(i,n,s,r);this.mutationQueue.push(o);for(const a of r)this.Mr=this.Mr.add(new qn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return me.resolve(o)}lookupMutationBatch(e,n){return me.resolve(this.Or(n))}getNextMutationBatchAfterBatchId(e,n){const s=n+1,r=this.Nr(s),i=r<0?0:r;return me.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return me.resolve(this.mutationQueue.length===0?JI:this.Fr-1)}getAllMutationBatches(e){return me.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const s=new qn(n,0),r=new qn(n,Number.POSITIVE_INFINITY),i=[];return this.Mr.forEachInRange([s,r],o=>{const a=this.Or(o.Cr);i.push(a)}),me.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let s=new gs(xt);return n.forEach(r=>{const i=new qn(r,0),o=new qn(r,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([i,o],a=>{s=s.add(a.Cr)})}),me.resolve(this.Br(s))}getAllMutationBatchesAffectingQuery(e,n){const s=n.path,r=s.length+1;let i=s;ot.isDocumentKey(i)||(i=i.child(""));const o=new qn(new ot(i),0);let a=new gs(xt);return this.Mr.forEachWhile(l=>{const u=l.key.path;return!!s.isPrefixOf(u)&&(u.length===r&&(a=a.add(l.Cr)),!0)},o),me.resolve(this.Br(a))}Br(e){const n=[];return e.forEach(s=>{const r=this.Or(s);r!==null&&n.push(r)}),n}removeMutationBatch(e,n){vn(this.Lr(n.batchId,"removed")===0),this.mutationQueue.shift();let s=this.Mr;return me.forEach(n.mutations,r=>{const i=new qn(r.key,n.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Mr=s})}qn(e){}containsKey(e,n){const s=new qn(n,0),r=this.Mr.firstAfterOrEqual(s);return me.resolve(n.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,me.resolve()}Lr(e,n){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const n=this.Nr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qj{constructor(e){this.kr=e,this.docs=function(){return new yr(ot.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const s=n.key,r=this.docs.get(s),i=r?r.size:0,o=this.kr(n);return this.docs=this.docs.insert(s,{document:n.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const s=this.docs.get(n);return me.resolve(s?s.document.mutableCopy():_i.newInvalidDocument(n))}getEntries(e,n){let s=Zy();return n.forEach(r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():_i.newInvalidDocument(r))}),me.resolve(s)}getDocumentsMatchingQuery(e,n,s,r){let i=Zy();const o=n.path,a=new ot(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:c}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||R7(A7(c),s)<=0||(r.has(c.key)||iS(n,c))&&(i=i.insert(c.key,c.mutableCopy()))}return me.resolve(i)}getAllFromCollectionGroup(e,n,s,r){lt()}qr(e,n){return me.forEach(this.docs,s=>n(s))}newChangeBuffer(e){return new Jj(this)}getSize(e){return me.resolve(this.size)}}class Jj extends jj{constructor(e){super(),this.Ir=e}applyChanges(e){const n=[];return this.changes.forEach((s,r)=>{r.isValidDocument()?n.push(this.Ir.addEntry(e,r)):this.Ir.removeEntry(s)}),me.waitFor(n)}getFromCache(e,n){return this.Ir.getEntry(e,n)}getAllFromCache(e,n){return this.Ir.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zj{constructor(e){this.persistence=e,this.Qr=new Ju(n=>sS(n),rS),this.lastRemoteSnapshotVersion=tn.min(),this.highestTargetId=0,this.$r=0,this.Ur=new lS,this.targetCount=0,this.Kr=Sh.Un()}forEachTarget(e,n){return this.Qr.forEach((s,r)=>n(r)),me.resolve()}getLastRemoteSnapshotVersion(e){return me.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return me.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),me.resolve(this.highestTargetId)}setTargetsMetadata(e,n,s){return s&&(this.lastRemoteSnapshotVersion=s),n>this.$r&&(this.$r=n),me.resolve()}zn(e){this.Qr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.Kr=new Sh(n),this.highestTargetId=n),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,n){return this.zn(n),this.targetCount+=1,me.resolve()}updateTargetData(e,n){return this.zn(n),me.resolve()}removeTargetData(e,n){return this.Qr.delete(n.target),this.Ur.br(n.targetId),this.targetCount-=1,me.resolve()}removeTargets(e,n,s){let r=0;const i=[];return this.Qr.forEach((o,a)=>{a.sequenceNumber<=n&&s.get(a.targetId)===null&&(this.Qr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),me.waitFor(i).next(()=>r)}getTargetCount(e){return me.resolve(this.targetCount)}getTargetData(e,n){const s=this.Qr.get(n)||null;return me.resolve(s)}addMatchingKeys(e,n,s){return this.Ur.yr(n,s),me.resolve()}removeMatchingKeys(e,n,s){this.Ur.Sr(n,s);const r=this.persistence.referenceDelegate,i=[];return r&&n.forEach(o=>{i.push(r.markPotentiallyOrphaned(e,o))}),me.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this.Ur.br(n),me.resolve()}getMatchingKeysForTargetId(e,n){const s=this.Ur.vr(n);return me.resolve(s)}containsKey(e,n){return me.resolve(this.Ur.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fD{constructor(e,n){this.Wr={},this.overlays={},this.Gr=new QI(0),this.zr=!1,this.zr=!0,this.jr=new Xj,this.referenceDelegate=e(this),this.Hr=new Zj(this),this.indexManager=new Lj,this.remoteDocumentCache=function(r){return new Qj(r)}(s=>this.referenceDelegate.Jr(s)),this.serializer=new Pj(n),this.Yr=new qj(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new Kj,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let s=this.Wr[e.toKey()];return s||(s=new Yj(n,this.referenceDelegate),this.Wr[e.toKey()]=s),s}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,n,s){Le("MemoryPersistence","Starting transaction:",e);const r=new eG(this.Gr.next());return this.referenceDelegate.Zr(),s(r).next(i=>this.referenceDelegate.Xr(r).next(()=>i)).toPromise().then(i=>(r.raiseOnCommittedEvent(),i))}ei(e,n){return me.or(Object.values(this.Wr).map(s=>()=>s.containsKey(e,n)))}}class eG extends O7{constructor(e){super(),this.currentSequenceNumber=e}}class uS{constructor(e){this.persistence=e,this.ti=new lS,this.ni=null}static ri(e){return new uS(e)}get ii(){if(this.ni)return this.ni;throw lt()}addReference(e,n,s){return this.ti.addReference(s,n),this.ii.delete(s.toString()),me.resolve()}removeReference(e,n,s){return this.ti.removeReference(s,n),this.ii.add(s.toString()),me.resolve()}markPotentiallyOrphaned(e,n){return this.ii.add(n.toString()),me.resolve()}removeTarget(e,n){this.ti.br(n.targetId).forEach(r=>this.ii.add(r.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,n.targetId).next(r=>{r.forEach(i=>this.ii.add(i.toString()))}).next(()=>s.removeTargetData(e,n))}Zr(){this.ni=new Set}Xr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return me.forEach(this.ii,s=>{const r=ot.fromPath(s);return this.si(e,r).next(i=>{i||n.removeEntry(r,tn.min())})}).next(()=>(this.ni=null,n.apply(e)))}updateLimboDocument(e,n){return this.si(e,n).next(s=>{s?this.ii.delete(n.toString()):this.ii.add(n.toString())})}Jr(e){return 0}si(e,n){return me.or([()=>me.resolve(this.ti.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.ei(e,n)])}}class n1{constructor(e,n){this.persistence=e,this.oi=new Ju(s=>L7(s.path),(s,r)=>s.isEqual(r)),this.garbageCollector=Wj(this,n)}static ri(e,n){return new n1(e,n)}Zr(){}Xr(e){return me.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}nr(e){const n=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(s=>n.next(r=>s+r))}sr(e){let n=0;return this.rr(e,s=>{n++}).next(()=>n)}rr(e,n){return me.forEach(this.oi,(s,r)=>this.ar(e,s,r).next(i=>i?me.resolve():n(r)))}removeTargets(e,n,s){return this.persistence.getTargetCache().removeTargets(e,n,s)}removeOrphanedDocuments(e,n){let s=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.qr(e,o=>this.ar(e,o,n).next(a=>{a||(s++,i.removeEntry(o,tn.min()))})).next(()=>i.apply(e)).next(()=>s)}markPotentiallyOrphaned(e,n){return this.oi.set(n,e.currentSequenceNumber),me.resolve()}removeTarget(e,n){const s=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,n,s){return this.oi.set(s,e.currentSequenceNumber),me.resolve()}removeReference(e,n,s){return this.oi.set(s,e.currentSequenceNumber),me.resolve()}updateLimboDocument(e,n){return this.oi.set(n,e.currentSequenceNumber),me.resolve()}Jr(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=ay(e.data.value)),n}ar(e,n,s){return me.or([()=>this.persistence.ei(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const r=this.oi.get(n);return me.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cS{constructor(e,n,s,r){this.targetId=e,this.fromCache=n,this.Hi=s,this.Ji=r}static Yi(e,n){let s=$s(),r=$s();for(const i of n.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new cS(e,n.fromCache,s,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tG{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nG{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return LU()?8:P7(Os())>0?6:4}()}initialize(e,n){this.ns=e,this.indexManager=n,this.Zi=!0}getDocumentsMatchingQuery(e,n,s,r){const i={result:null};return this.rs(e,n).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ss(e,n,r,s).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new tG;return this._s(e,n,o).next(a=>{if(i.result=a,this.Xi)return this.us(e,n,o,a.size)})}).next(()=>i.result)}us(e,n,s,r){return s.documentReadCount<this.es?(_c()<=dt.DEBUG&&Le("QueryEngine","SDK will not create cache indexes for query:",Md(n),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),me.resolve()):(_c()<=dt.DEBUG&&Le("QueryEngine","Query:",Md(n),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.ts*r?(_c()<=dt.DEBUG&&Le("QueryEngine","The SDK decides to create cache indexes for query:",Md(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,mu(n))):me.resolve())}rs(e,n){if(G_(n))return me.resolve(null);let s=mu(n);return this.indexManager.getIndexType(e,s).next(r=>r===0?null:(n.limit!==null&&r===1&&(n=F2(n,null,"F"),s=mu(n)),this.indexManager.getDocumentsMatchingTarget(e,s).next(i=>{const o=$s(...i);return this.ns.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,s).next(l=>{const u=this.cs(n,a);return this.ls(n,u,o,l.readTime)?this.rs(e,F2(n,null,"F")):this.hs(e,u,n,l)}))})))}ss(e,n,s,r){return G_(n)||r.isEqual(tn.min())?me.resolve(null):this.ns.getDocuments(e,s).next(i=>{const o=this.cs(n,i);return this.ls(n,o,s,r)?me.resolve(null):(_c()<=dt.DEBUG&&Le("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Md(n)),this.hs(e,o,n,$7(r,Mp)).next(a=>a))})}cs(e,n){let s=new gs(rj(e));return n.forEach((r,i)=>{iS(e,i)&&(s=s.add(i))}),s}ls(e,n,s,r){if(e.limit===null)return!1;if(s.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}_s(e,n,s){return _c()<=dt.DEBUG&&Le("QueryEngine","Using full collection scan to execute query:",Md(n)),this.ns.getDocumentsMatchingQuery(e,n,rl.min(),s)}hs(e,n,s,r){return this.ns.getDocumentsMatchingQuery(e,s,r).next(i=>(n.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sG="LocalStore";class rG{constructor(e,n,s,r){this.persistence=e,this.Ps=n,this.serializer=r,this.Ts=new yr(xt),this.Is=new Ju(i=>sS(i),rS),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(s)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Hj(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ts))}}function iG(t,e,n,s){return new rG(t,e,n,s)}async function mD(t,e){const n=Kt(t);return await n.persistence.runTransaction("Handle user change","readonly",s=>{let r;return n.mutationQueue.getAllMutationBatches(s).next(i=>(r=i,n.As(e),n.mutationQueue.getAllMutationBatches(s))).next(i=>{const o=[],a=[];let l=$s();for(const u of r){o.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}for(const u of i){a.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}return n.localDocuments.getDocuments(s,l).next(u=>({Rs:u,removedBatchIds:o,addedBatchIds:a}))})})}function oG(t,e){const n=Kt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const r=e.batch.keys(),i=n.ds.newChangeBuffer({trackRemovals:!0});return function(a,l,u,c){const h=u.batch,d=h.keys();let p=me.resolve();return d.forEach(f=>{p=p.next(()=>c.getEntry(l,f)).next(m=>{const v=u.docVersions.get(f);vn(v!==null),m.version.compareTo(v)<0&&(h.applyToRemoteDocument(m,u),m.isValidDocument()&&(m.setReadTime(u.commitVersion),c.addEntry(m)))})}),p.next(()=>a.mutationQueue.removeMutationBatch(l,h))}(n,s,e,i).next(()=>i.apply(s)).next(()=>n.mutationQueue.performConsistencyCheck(s)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(a){let l=$s();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>n.localDocuments.getDocuments(s,r))})}function aG(t){const e=Kt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Hr.getLastRemoteSnapshotVersion(n))}function lG(t,e){const n=Kt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=JI),n.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}class eN{constructor(){this.activeTargetIds=cj()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class uG{constructor(){this.ho=new eN,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,s){}addLocalQueryTarget(e,n=!0){return n&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,n,s){this.Po[e]=n}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new eN,Promise.resolve()}handleUserChange(e,n,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cG{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tN="ConnectivityMonitor";class nN{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){Le(tN,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){Le(tN,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _g=null;function z2(){return _g===null?_g=function(){return 268435456+Math.round(2147483648*Math.random())}():_g++,"0x"+_g.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ex="RestConnection",hG={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class dG{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.po=n+"://"+e.host,this.yo=`projects/${s}/databases/${r}`,this.wo=this.databaseId.database===Xy?`project_id=${s}`:`project_id=${s}&database_id=${r}`}So(e,n,s,r,i){const o=z2(),a=this.bo(e,n.toUriEncodedString());Le(ex,`Sending RPC '${e}' ${o}:`,a,s);const l={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(l,r,i),this.vo(e,a,l,s).then(u=>(Le(ex,`Received RPC '${e}' ${o}: `,u),u),u=>{throw a0(ex,`RPC '${e}' ${o} failed with error: `,u,"url: ",a,"request:",s),u})}Co(e,n,s,r,i,o){return this.So(e,n,s,r,i)}Do(e,n,s){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Uh}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((r,i)=>e[i]=r),s&&s.headers.forEach((r,i)=>e[i]=r)}bo(e,n){const s=hG[e];return`${this.po}/v1/${n}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pG{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ks="WebChannelConnection";class fG extends dG{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,n,s,r){const i=z2();return new Promise((o,a)=>{const l=new N4;l.setWithCredentials(!0),l.listenOnce($4.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case oy.NO_ERROR:const c=l.getResponseJson();Le(ks,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(c)),o(c);break;case oy.TIMEOUT:Le(ks,`RPC '${e}' ${i} timed out`),a(new Xe(be.DEADLINE_EXCEEDED,"Request time out"));break;case oy.HTTP_ERROR:const h=l.getStatus();if(Le(ks,`RPC '${e}' ${i} failed with status:`,h,"response text:",l.getResponseText()),h>0){let d=l.getResponseJson();Array.isArray(d)&&(d=d[0]);const p=d==null?void 0:d.error;if(p&&p.status&&p.message){const f=function(v){const y=v.toLowerCase().replace(/_/g,"-");return Object.values(be).indexOf(y)>=0?y:be.UNKNOWN}(p.status);a(new Xe(f,p.message))}else a(new Xe(be.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new Xe(be.UNAVAILABLE,"Connection failed."));break;default:lt()}}finally{Le(ks,`RPC '${e}' ${i} completed.`)}});const u=JSON.stringify(r);Le(ks,`RPC '${e}' ${i} sending request:`,r),l.send(n,"POST",u,s,15)})}Wo(e,n,s){const r=z2(),i=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=D4(),a=R4(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Do(l.initMessageHeaders,n,s),l.encodeInitMessageHeaders=!0;const c=i.join("");Le(ks,`Creating RPC '${e}' stream ${r}: ${c}`,l);const h=o.createWebChannel(c,l);let d=!1,p=!1;const f=new pG({Fo:v=>{p?Le(ks,`Not sending because RPC '${e}' stream ${r} is closed:`,v):(d||(Le(ks,`Opening RPC '${e}' stream ${r} transport.`),h.open(),d=!0),Le(ks,`RPC '${e}' stream ${r} sending:`,v),h.send(v))},Mo:()=>h.close()}),m=(v,y,w)=>{v.listen(y,b=>{try{w(b)}catch(I){setTimeout(()=>{throw I},0)}})};return m(h,Xd.EventType.OPEN,()=>{p||(Le(ks,`RPC '${e}' stream ${r} transport opened.`),f.Qo())}),m(h,Xd.EventType.CLOSE,()=>{p||(p=!0,Le(ks,`RPC '${e}' stream ${r} transport closed`),f.Uo())}),m(h,Xd.EventType.ERROR,v=>{p||(p=!0,a0(ks,`RPC '${e}' stream ${r} transport errored:`,v),f.Uo(new Xe(be.UNAVAILABLE,"The operation could not be completed")))}),m(h,Xd.EventType.MESSAGE,v=>{var y;if(!p){const w=v.data[0];vn(!!w);const b=w,I=(b==null?void 0:b.error)||((y=b[0])===null||y===void 0?void 0:y.error);if(I){Le(ks,`RPC '${e}' stream ${r} received error:`,I);const k=I.status;let R=function(N){const $=Cn[N];if($!==void 0)return Ij($)}(k),C=I.message;R===void 0&&(R=be.INTERNAL,C="Unknown error status: "+k+" with message "+I.message),p=!0,f.Uo(new Xe(R,C)),h.close()}else Le(ks,`RPC '${e}' stream ${r} received:`,w),f.Ko(w)}}),m(a,A4.STAT_EVENT,v=>{v.stat===$2.PROXY?Le(ks,`RPC '${e}' stream ${r} detected buffering proxy`):v.stat===$2.NOPROXY&&Le(ks,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{f.$o()},0),f}}function tx(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h0(t){return new Sj(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gD{constructor(e,n,s=1e3,r=1.5,i=6e4){this.Ti=e,this.timerId=n,this.Go=s,this.zo=r,this.jo=i,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const n=Math.floor(this.Ho+this.e_()),s=Math.max(0,Date.now()-this.Yo),r=Math.max(0,n-s);r>0&&Le("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ho} ms, delay with jitter: ${n} ms, last attempt: ${s} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,r,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sN="PersistentStream";class mG{constructor(e,n,s,r,i,o,a,l){this.Ti=e,this.n_=s,this.r_=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new gD(e,n)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,n){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():n&&n.code===be.RESOURCE_EXHAUSTED?(Eu(n.toString()),Eu("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):n&&n.code===be.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(n)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),n=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,r])=>{this.i_===n&&this.V_(s,r)},s=>{e(()=>{const r=new Xe(be.UNKNOWN,"Fetching auth token failed: "+s.message);return this.m_(r)})})}V_(e,n){const s=this.R_(this.i_);this.stream=this.f_(e,n),this.stream.xo(()=>{s(()=>this.listener.xo())}),this.stream.No(()=>{s(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(r=>{s(()=>this.m_(r))}),this.stream.onMessage(r=>{s(()=>++this.__==1?this.g_(r):this.onNext(r))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return Le(sN,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return n=>{this.Ti.enqueueAndForget(()=>this.i_===e?n():(Le(sN,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class gG extends mG{constructor(e,n,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,s,r,o),this.serializer=i}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,n){return this.connection.Wo("Write",e,n)}g_(e){return vn(!!e.streamToken),this.lastStreamToken=e.streamToken,vn(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){vn(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const n=Aj(e.writeResults,e.commitTime),s=sh(e.commitTime);return this.listener.v_(s,n)}C_(){const e={};e.database=_j(this.serializer),this.I_(e)}b_(e){const n={streamToken:this.lastStreamToken,writes:e.map(s=>$j(this.serializer,s))};this.I_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yG{}class vG extends yG{constructor(e,n,s,r){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=s,this.serializer=r,this.F_=!1}M_(){if(this.F_)throw new Xe(be.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,n,s,r){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.So(e,M2(n,s),r,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===be.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Xe(be.UNKNOWN,i.toString())})}Co(e,n,s,r,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Co(e,M2(n,s),r,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===be.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Xe(be.UNKNOWN,o.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class wG{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Eu(n),this.N_=!1):Le("OnlineStateTracker",n)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vf="RemoteStore";class xG{constructor(e,n,s,r,i){this.localStore=e,this.datastore=n,this.asyncQueue=s,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=i,this.z_.To(o=>{s.enqueueAndForget(async()=>{xf(this)&&(Le(vf,"Restarting streams for network reachability change."),await async function(l){const u=Kt(l);u.W_.add(4),await wf(u),u.j_.set("Unknown"),u.W_.delete(4),await d0(u)}(this))})}),this.j_=new wG(s,r)}}async function d0(t){if(xf(t))for(const e of t.G_)await e(!0)}async function wf(t){for(const e of t.G_)await e(!1)}function xf(t){return Kt(t).W_.size===0}async function yD(t,e,n){if(!gf(e))throw e;t.W_.add(1),await wf(t),t.j_.set("Offline"),n||(n=()=>aG(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{Le(vf,"Retrying IndexedDB access"),await n(),t.W_.delete(1),await d0(t)})}function vD(t,e){return e().catch(n=>yD(t,n,e))}async function p0(t){const e=Kt(t),n=ol(e);let s=e.U_.length>0?e.U_[e.U_.length-1].batchId:JI;for(;bG(e);)try{const r=await lG(e.localStore,s);if(r===null){e.U_.length===0&&n.P_();break}s=r.batchId,IG(e,r)}catch(r){await yD(e,r)}wD(e)&&xD(e)}function bG(t){return xf(t)&&t.U_.length<10}function IG(t,e){t.U_.push(e);const n=ol(t);n.c_()&&n.S_&&n.b_(e.mutations)}function wD(t){return xf(t)&&!ol(t).u_()&&t.U_.length>0}function xD(t){ol(t).start()}async function SG(t){ol(t).C_()}async function TG(t){const e=ol(t);for(const n of t.U_)e.b_(n.mutations)}async function CG(t,e,n){const s=t.U_.shift(),r=aS.from(s,e,n);await vD(t,()=>t.remoteSyncer.applySuccessfulWrite(r)),await p0(t)}async function kG(t,e){e&&ol(t).S_&&await async function(s,r){if(function(o){return bj(o)&&o!==be.ABORTED}(r.code)){const i=s.U_.shift();ol(s).h_(),await vD(s,()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r)),await p0(s)}}(t,e),wD(t)&&xD(t)}async function rN(t,e){const n=Kt(t);n.asyncQueue.verifyOperationInProgress(),Le(vf,"RemoteStore received new credentials");const s=xf(n);n.W_.add(3),await wf(n),s&&n.j_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.W_.delete(3),await d0(n)}async function EG(t,e){const n=Kt(t);e?(n.W_.delete(2),await d0(n)):e||(n.W_.add(2),await wf(n),n.j_.set("Unknown"))}function ol(t){return t.Y_||(t.Y_=function(n,s,r){const i=Kt(n);return i.M_(),new gG(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(t.datastore,t.asyncQueue,{xo:()=>Promise.resolve(),No:SG.bind(null,t),Lo:kG.bind(null,t),D_:TG.bind(null,t),v_:CG.bind(null,t)}),t.G_.push(async e=>{e?(t.Y_.h_(),await p0(t)):(await t.Y_.stop(),t.U_.length>0&&(Le(vf,`Stopping write stream with ${t.U_.length} pending writes`),t.U_=[]))})),t.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hS{constructor(e,n,s,r,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new fu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,s,r,i){const o=Date.now()+s,a=new hS(e,n,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Xe(be.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function bD(t,e){if(Eu("AsyncQueue",`${e}: ${t}`),gf(t))return new Xe(be.UNAVAILABLE,`${e}: ${t}`);throw t}class _G{constructor(){this.queries=iN(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(n,s){const r=Kt(n),i=r.queries;r.queries=iN(),i.forEach((o,a)=>{for(const l of a.ta)l.onError(s)})})(this,new Xe(be.ABORTED,"Firestore shutting down"))}}function iN(){return new Ju(t=>Z4(t),J4)}function NG(t){t.ia.forEach(e=>{e.next()})}var oN,aN;(aN=oN||(oN={}))._a="default",aN.Cache="cache";const $G="SyncEngine";class AG{constructor(e,n,s,r,i,o){this.localStore=e,this.remoteStore=n,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.La={},this.ka=new Ju(a=>Z4(a),J4),this.qa=new Map,this.Qa=new Set,this.$a=new yr(ot.comparator),this.Ua=new Map,this.Ka=new lS,this.Wa={},this.Ga=new Map,this.za=Sh.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function RG(t,e,n){const s=FG(t);try{const r=await function(o,a){const l=Kt(o),u=es.now(),c=a.reduce((p,f)=>p.add(f.key),$s());let h,d;return l.persistence.runTransaction("Locally write mutations","readwrite",p=>{let f=Zy(),m=$s();return l.ds.getEntries(p,c).next(v=>{f=v,f.forEach((y,w)=>{w.isValidDocument()||(m=m.add(y))})}).next(()=>l.localDocuments.getOverlayedDocuments(p,f)).next(v=>{h=v;const y=[];for(const w of a){const b=yj(w,h.get(w.key).overlayedDocument);b!=null&&y.push(new Zu(w.key,b,G4(b.value.mapValue),Ho.exists(!0)))}return l.mutationQueue.addMutationBatch(p,u,y,a)}).next(v=>{d=v;const y=v.applyToLocalDocumentSet(h,m);return l.documentOverlayCache.saveOverlays(p,v.batchId,y)})}).then(()=>({batchId:d.batchId,changes:tD(h)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),function(o,a,l){let u=o.Wa[o.currentUser.toKey()];u||(u=new yr(xt)),u=u.insert(a,l),o.Wa[o.currentUser.toKey()]=u}(s,r.batchId,n),await f0(s,r.changes),await p0(s.remoteStore)}catch(r){const i=bD(r,"Failed to persist write");n.reject(i)}}function lN(t,e,n){const s=Kt(t);if(s.isPrimaryClient&&n===0||!s.isPrimaryClient&&n===1){const r=[];s.ka.forEach((i,o)=>{const a=o.view.sa(e);a.snapshot&&r.push(a.snapshot)}),function(o,a){const l=Kt(o);l.onlineState=a;let u=!1;l.queries.forEach((c,h)=>{for(const d of h.ta)d.sa(a)&&(u=!0)}),u&&NG(l)}(s.eventManager,e),r.length&&s.La.p_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function DG(t,e){const n=Kt(t),s=e.batch.batchId;try{const r=await oG(n.localStore,e);SD(n,s,null),ID(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await f0(n,r)}catch(r){await YI(r)}}async function OG(t,e,n){const s=Kt(t);try{const r=await function(o,a){const l=Kt(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return l.mutationQueue.lookupMutationBatch(u,a).next(h=>(vn(h!==null),c=h.keys(),l.mutationQueue.removeMutationBatch(u,h))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,c,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,c)).next(()=>l.localDocuments.getDocuments(u,c))})}(s.localStore,e);SD(s,e,n),ID(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await f0(s,r)}catch(r){await YI(r)}}function ID(t,e){(t.Ga.get(e)||[]).forEach(n=>{n.resolve()}),t.Ga.delete(e)}function SD(t,e,n){const s=Kt(t);let r=s.Wa[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(n?i.reject(n):i.resolve(),r=r.remove(e)),s.Wa[s.currentUser.toKey()]=r}}async function f0(t,e,n){const s=Kt(t),r=[],i=[],o=[];s.ka.isEmpty()||(s.ka.forEach((a,l)=>{o.push(s.Ha(l,e,n).then(u=>{var c;if((u||n)&&s.isPrimaryClient){const h=u?!u.fromCache:(c=void 0)===null||c===void 0?void 0:c.current;s.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(u){r.push(u);const h=cS.Yi(l.targetId,u);i.push(h)}}))}),await Promise.all(o),s.La.p_(r),await async function(l,u){const c=Kt(l);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>me.forEach(u,d=>me.forEach(d.Hi,p=>c.persistence.referenceDelegate.addReference(h,d.targetId,p)).next(()=>me.forEach(d.Ji,p=>c.persistence.referenceDelegate.removeReference(h,d.targetId,p)))))}catch(h){if(!gf(h))throw h;Le(sG,"Failed to update sequence numbers: "+h)}for(const h of u){const d=h.targetId;if(!h.fromCache){const p=c.Ts.get(d),f=p.snapshotVersion,m=p.withLastLimboFreeSnapshotVersion(f);c.Ts=c.Ts.insert(d,m)}}}(s.localStore,i))}async function PG(t,e){const n=Kt(t);if(!n.currentUser.isEqual(e)){Le($G,"User change. New user:",e.toKey());const s=await mD(n.localStore,e);n.currentUser=e,function(i,o){i.Ga.forEach(a=>{a.forEach(l=>{l.reject(new Xe(be.CANCELLED,o))})}),i.Ga.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await f0(n,s.Rs)}}function FG(t){const e=Kt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=DG.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=OG.bind(null,e),e}class s1{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=h0(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,n){return null}nu(e,n){return null}eu(e){return iG(this.persistence,new nG,e.initialUser,this.serializer)}Xa(e){return new fD(uS.ri,this.serializer)}Za(e){return new uG}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}s1.provider={build:()=>new s1};class LG extends s1{constructor(e){super(),this.cacheSizeBytes=e}tu(e,n){vn(this.persistence.referenceDelegate instanceof n1);const s=this.persistence.referenceDelegate.garbageCollector;return new Bj(s,e.asyncQueue,n)}Xa(e){const n=this.cacheSizeBytes!==void 0?or.withCacheSize(this.cacheSizeBytes):or.DEFAULT;return new fD(s=>n1.ri(s,n),this.serializer)}}class B2{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>lN(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=PG.bind(null,this.syncEngine),await EG(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new _G}()}createDatastore(e){const n=h0(e.databaseInfo.databaseId),s=function(i){return new fG(i)}(e.databaseInfo);return function(i,o,a,l){return new vG(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,s,n)}createRemoteStore(e){return function(s,r,i,o,a){return new xG(s,r,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>lN(this.syncEngine,n,0),function(){return nN.D()?new nN:new cG}())}createSyncEngine(e,n){return function(r,i,o,a,l,u,c){const h=new AG(r,i,o,a,l,u);return c&&(h.ja=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(r){const i=Kt(r);Le(vf,"RemoteStore shutting down."),i.W_.add(5),await wf(i),i.z_.shutdown(),i.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}B2.provider={build:()=>new B2};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const al="FirestoreClient";class MG{constructor(e,n,s,r,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=s,this.databaseInfo=r,this.user=Es.UNAUTHENTICATED,this.clientId=P4.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(s,async o=>{Le(al,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(s,o=>(Le(al,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new fu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const s=bD(n,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function nx(t,e){t.asyncQueue.verifyOperationInProgress(),Le(al,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener(async r=>{s.isEqual(r)||(await mD(e.localStore,r),s=r)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function uN(t,e){t.asyncQueue.verifyOperationInProgress();const n=await VG(t);Le(al,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(s=>rN(e.remoteStore,s)),t.setAppCheckTokenChangeListener((s,r)=>rN(e.remoteStore,r)),t._onlineComponents=e}async function VG(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Le(al,"Using user provided OfflineComponentProvider");try{await nx(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(r){return r.name==="FirebaseError"?r.code===be.FAILED_PRECONDITION||r.code===be.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(n))throw n;a0("Error using user provided cache. Falling back to memory cache: "+n),await nx(t,new s1)}}else Le(al,"Using default OfflineComponentProvider"),await nx(t,new LG(void 0));return t._offlineComponents}async function zG(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Le(al,"Using user provided OnlineComponentProvider"),await uN(t,t._uninitializedComponentsProvider._online)):(Le(al,"Using default OnlineComponentProvider"),await uN(t,new B2))),t._onlineComponents}function BG(t){return zG(t).then(e=>e.syncEngine)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TD(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cN=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UG(t,e,n){if(!n)throw new Xe(be.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function WG(t,e,n,s){if(e===!0&&s===!0)throw new Xe(be.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function hN(t){if(!ot.isDocumentKey(t))throw new Xe(be.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function dS(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":lt()}function U2(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Xe(be.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=dS(t);throw new Xe(be.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CD="firestore.googleapis.com",dN=!0;class pN{constructor(e){var n,s;if(e.host===void 0){if(e.ssl!==void 0)throw new Xe(be.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=CD,this.ssl=dN}else this.host=e.host,this.ssl=(n=e.ssl)!==null&&n!==void 0?n:dN;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=pD;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Vj)throw new Xe(be.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}WG("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=TD((s=e.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Xe(be.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Xe(be.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Xe(be.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,r){return s.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class pS{constructor(e,n,s,r){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pN({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Xe(be.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Xe(be.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pN(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new x7;switch(s.type){case"firstParty":return new T7(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new Xe(be.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const s=cN.get(n);s&&(Le("ComponentProvider","Removing Datastore"),cN.delete(n),s.terminate())}(this),Promise.resolve()}}function jG(t,e,n,s={}){var r;const i=(t=U2(t,pS))._getSettings(),o=Object.assign(Object.assign({},i),{emulatorOptions:t._getEmulatorOptions()}),a=`${e}:${n}`;i.host!==CD&&i.host!==a&&a0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l=Object.assign(Object.assign({},i),{host:a,ssl:!1,emulatorOptions:s});if(!sl(l,o)&&(t._setSettings(l),s.mockUserToken)){let u,c;if(typeof s.mockUserToken=="string")u=s.mockUserToken,c=Es.MOCK_USER;else{u=AU(s.mockUserToken,(r=t._app)===null||r===void 0?void 0:r.options.projectId);const h=s.mockUserToken.sub||s.mockUserToken.user_id;if(!h)throw new Xe(be.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Es(h)}t._authCredentials=new b7(new O4(u,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fS{constructor(e,n,s){this.converter=n,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new fS(this.firestore,e,this._query)}}class qo{constructor(e,n,s){this.converter=n,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Up(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new qo(this.firestore,e,this._key)}}class Up extends fS{constructor(e,n,s){super(e,n,tj(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new qo(this.firestore,null,new ot(e))}withConverter(e){return new Up(this.firestore,e,this._path)}}function GG(t,e,...n){if(t=Xs(t),arguments.length===1&&(e=P4.newId()),UG("doc","path",e),t instanceof pS){const s=En.fromString(e,...n);return hN(s),new qo(t,null,new ot(s))}{if(!(t instanceof qo||t instanceof Up))throw new Xe(be.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(En.fromString(e,...n));return hN(s),new qo(t.firestore,t instanceof Up?t.converter:null,new ot(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fN="AsyncQueue";class mN{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new gD(this,"async_queue_retry"),this.Su=()=>{const s=tx();s&&Le(fN,"Visibility state changed to "+s.visibilityState),this.a_.t_()},this.bu=e;const n=tx();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const n=tx();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const n=new fu;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!gf(e))throw e;Le(fN,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const n=this.bu.then(()=>(this.pu=!0,e().catch(s=>{this.gu=s,this.pu=!1;const r=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(s);throw Eu("INTERNAL UNHANDLED ERROR: ",r),s}).then(s=>(this.pu=!1,s))));return this.bu=n,n}enqueueAfterDelay(e,n,s){this.Du(),this.wu.indexOf(e)>-1&&(n=0);const r=hS.createAndSchedule(this,e,n,s,i=>this.Fu(i));return this.fu.push(r),r}Du(){this.gu&&lt()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const n of this.fu)if(n.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((n,s)=>n.targetTimeMs-s.targetTimeMs);for(const n of this.fu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const n=this.fu.indexOf(e);this.fu.splice(n,1)}}class kD extends pS{constructor(e,n,s,r){super(e,n,s,r),this.type="firestore",this._queue=new mN,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new mN(e),this._firestoreClient=void 0,await e}}}function HG(t,e){const n=typeof t=="object"?t:MI(),s=typeof t=="string"?t:Xy,r=Yu(n,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=NU("firestore");i&&jG(r,...i)}return r}function qG(t){if(t._terminated)throw new Xe(be.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||KG(t),t._firestoreClient}function KG(t){var e,n,s;const r=t._freezeSettings(),i=function(a,l,u,c){return new B7(a,l,u,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,TD(c.experimentalLongPollingOptions),c.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,r);t._componentsProvider||!((n=r.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((s=r.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(t._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),t._firestoreClient=new MG(t._authCredentials,t._appCheckCredentials,t._queue,i,t._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wp{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Wp(To.fromBase64String(e))}catch(n){throw new Xe(be.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Wp(To.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ED{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Xe(be.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new fs(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _D{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ND{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Xe(be.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Xe(be.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return xt(this._lat,e._lat)||xt(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $D{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(s,r){if(s.length!==r.length)return!1;for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XG=/^__.*__$/;class YG{constructor(e,n,s){this.data=e,this.fieldMask=n,this.fieldTransforms=s}toMutation(e,n){return this.fieldMask!==null?new Zu(e,this.data,this.fieldMask,n,this.fieldTransforms):new yf(e,this.data,n,this.fieldTransforms)}}function AD(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw lt()}}class mS{constructor(e,n,s,r,i,o){this.settings=e,this.databaseId=n,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.Bu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new mS(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var n;const s=(n=this.path)===null||n===void 0?void 0:n.child(e),r=this.ku({path:s,Qu:!1});return r.$u(e),r}Uu(e){var n;const s=(n=this.path)===null||n===void 0?void 0:n.child(e),r=this.ku({path:s,Qu:!1});return r.Bu(),r}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return r1(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(AD(this.Lu)&&XG.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class QG{constructor(e,n,s){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=s||h0(e)}ju(e,n,s,r=!1){return new mS({Lu:e,methodName:n,zu:s,path:fs.emptyPath(),Qu:!1,Gu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function JG(t){const e=t._freezeSettings(),n=h0(t._databaseId);return new QG(t._databaseId,!!e.ignoreUndefinedProperties,n)}function ZG(t,e,n,s,r,i={}){const o=t.ju(i.merge||i.mergeFields?2:0,e,n,r);PD("Data must be an object, but it was:",o,s);const a=DD(s,o);let l,u;if(i.merge)l=new Di(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const c=[];for(const h of i.mergeFields){const d=eH(e,h,n);if(!o.contains(d))throw new Xe(be.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);sH(c,d)||c.push(d)}l=new Di(c),u=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,u=o.fieldTransforms;return new YG(new Ai(a),l,u)}function RD(t,e){if(OD(t=Xs(t)))return PD("Unsupported field value:",e,t),DD(t,e);if(t instanceof _D)return function(s,r){if(!AD(r.Lu))throw r.Wu(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Wu(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(s,r){const i=[];let o=0;for(const a of s){let l=RD(a,r.Ku(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(t,e)}return function(s,r){if((s=Xs(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return hj(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=es.fromDate(s);return{timestampValue:L2(r.serializer,i)}}if(s instanceof es){const i=new es(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:L2(r.serializer,i)}}if(s instanceof ND)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Wp)return{bytesValue:Tj(r.serializer,s._byteString)};if(s instanceof qo){const i=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(i))throw r.Wu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:hD(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof $D)return function(o,a){return{mapValue:{fields:{[U4]:{stringValue:j4},[R2]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Wu("VectorValues must only contain numeric values.");return oS(a.serializer,u)})}}}}}}(s,r);throw r.Wu(`Unsupported field value: ${dS(s)}`)}(t,e)}function DD(t,e){const n={};return L4(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Wh(t,(s,r)=>{const i=RD(r,e.qu(s));i!=null&&(n[s]=i)}),{mapValue:{fields:n}}}function OD(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof es||t instanceof ND||t instanceof Wp||t instanceof qo||t instanceof _D||t instanceof $D)}function PD(t,e,n){if(!OD(n)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(n)){const s=dS(n);throw s==="an object"?e.Wu(t+" a custom object"):e.Wu(t+" "+s)}}function eH(t,e,n){if((e=Xs(e))instanceof ED)return e._internalPath;if(typeof e=="string")return nH(t,e);throw r1("Field path arguments must be of type string or ",t,!1,void 0,n)}const tH=new RegExp("[~\\*/\\[\\]]");function nH(t,e,n){if(e.search(tH)>=0)throw r1(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new ED(...e.split("."))._internalPath}catch{throw r1(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function r1(t,e,n,s,r){const i=s&&!s.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${s}`),o&&(l+=` in document ${r}`),l+=")"),new Xe(be.INVALID_ARGUMENT,a+t+l)}function sH(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rH(t,e,n){let s;return s=t?t.toFirestore(e):e,s}function iH(t,e,n){t=U2(t,qo);const s=U2(t.firestore,kD),r=rH(t.converter,e);return oH(s,[ZG(JG(s),"setDoc",t._key,r,t.converter!==null,n).toMutation(t._key,Ho.none())])}function oH(t,e){return function(s,r){const i=new fu;return s.asyncQueue.enqueueAndForget(async()=>RG(await BG(s),r,i)),i.promise}(qG(t),e)}(function(e,n=!0){(function(r){Uh=r})(zh),So(new Bi("firestore",(s,{instanceIdentifier:r,options:i})=>{const o=s.getProvider("app").getImmediate(),a=new kD(new I7(s.getProvider("auth-internal")),new C7(o,s.getProvider("app-check-internal")),function(u,c){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new Xe(be.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Yy(u.options.projectId,c)}(o,r),o);return i=Object.assign({useFetchStreams:n},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),ii($_,A_,e),ii($_,A_,"esm2017")})();const FD="@firebase/installations",gS="0.6.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LD=1e4,MD=`w:${gS}`,VD="FIS_v2",aH="https://firebaseinstallations.googleapis.com/v1",lH=60*60*1e3,uH="installations",cH="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hH={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},$u=new Xu(uH,cH,hH);function zD(t){return t instanceof qi&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BD({projectId:t}){return`${aH}/projects/${t}/installations`}function UD(t){return{token:t.token,requestStatus:2,expiresIn:pH(t.expiresIn),creationTime:Date.now()}}async function WD(t,e){const s=(await e.json()).error;return $u.create("request-failed",{requestName:t,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}function jD({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function dH(t,{refreshToken:e}){const n=jD(t);return n.append("Authorization",fH(e)),n}async function GD(t){const e=await t();return e.status>=500&&e.status<600?t():e}function pH(t){return Number(t.replace("s","000"))}function fH(t){return`${VD} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mH({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const s=BD(t),r=jD(t),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&r.append("x-firebase-client",u)}const o={fid:n,authVersion:VD,appId:t.appId,sdkVersion:MD},a={method:"POST",headers:r,body:JSON.stringify(o)},l=await GD(()=>fetch(s,a));if(l.ok){const u=await l.json();return{fid:u.fid||n,registrationStatus:2,refreshToken:u.refreshToken,authToken:UD(u.authToken)}}else throw await WD("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HD(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gH(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yH=/^[cdef][\w-]{21}$/,W2="";function vH(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=wH(t);return yH.test(n)?n:W2}catch{return W2}}function wH(t){return gH(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m0(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qD=new Map;function KD(t,e){const n=m0(t);XD(n,e),xH(n,e)}function XD(t,e){const n=qD.get(t);if(n)for(const s of n)s(e)}function xH(t,e){const n=bH();n&&n.postMessage({key:t,fid:e}),IH()}let lu=null;function bH(){return!lu&&"BroadcastChannel"in self&&(lu=new BroadcastChannel("[Firebase] FID Change"),lu.onmessage=t=>{XD(t.data.key,t.data.fid)}),lu}function IH(){qD.size===0&&lu&&(lu.close(),lu=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SH="firebase-installations-database",TH=1,Au="firebase-installations-store";let sx=null;function yS(){return sx||(sx=GR(SH,TH,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Au)}}})),sx}async function i1(t,e){const n=m0(t),r=(await yS()).transaction(Au,"readwrite"),i=r.objectStore(Au),o=await i.get(n);return await i.put(e,n),await r.done,(!o||o.fid!==e.fid)&&KD(t,e.fid),e}async function YD(t){const e=m0(t),s=(await yS()).transaction(Au,"readwrite");await s.objectStore(Au).delete(e),await s.done}async function g0(t,e){const n=m0(t),r=(await yS()).transaction(Au,"readwrite"),i=r.objectStore(Au),o=await i.get(n),a=e(o);return a===void 0?await i.delete(n):await i.put(a,n),await r.done,a&&(!o||o.fid!==a.fid)&&KD(t,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vS(t){let e;const n=await g0(t.appConfig,s=>{const r=CH(s),i=kH(t,r);return e=i.registrationPromise,i.installationEntry});return n.fid===W2?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function CH(t){const e=t||{fid:vH(),registrationStatus:0};return QD(e)}function kH(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const r=Promise.reject($u.create("app-offline"));return{installationEntry:e,registrationPromise:r}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=EH(t,n);return{installationEntry:n,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:_H(t)}:{installationEntry:e}}async function EH(t,e){try{const n=await mH(t,e);return i1(t.appConfig,n)}catch(n){throw zD(n)&&n.customData.serverCode===409?await YD(t.appConfig):await i1(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function _H(t){let e=await gN(t.appConfig);for(;e.registrationStatus===1;)await HD(100),e=await gN(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:s}=await vS(t);return s||n}return e}function gN(t){return g0(t,e=>{if(!e)throw $u.create("installation-not-found");return QD(e)})}function QD(t){return NH(t)?{fid:t.fid,registrationStatus:0}:t}function NH(t){return t.registrationStatus===1&&t.registrationTime+LD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $H({appConfig:t,heartbeatServiceProvider:e},n){const s=AH(t,n),r=dH(t,n),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&r.append("x-firebase-client",u)}const o={installation:{sdkVersion:MD,appId:t.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},l=await GD(()=>fetch(s,a));if(l.ok){const u=await l.json();return UD(u)}else throw await WD("Generate Auth Token",l)}function AH(t,{fid:e}){return`${BD(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wS(t,e=!1){let n;const s=await g0(t.appConfig,i=>{if(!JD(i))throw $u.create("not-registered");const o=i.authToken;if(!e&&OH(o))return i;if(o.requestStatus===1)return n=RH(t,e),i;{if(!navigator.onLine)throw $u.create("app-offline");const a=FH(i);return n=DH(t,a),a}});return n?await n:s.authToken}async function RH(t,e){let n=await yN(t.appConfig);for(;n.authToken.requestStatus===1;)await HD(100),n=await yN(t.appConfig);const s=n.authToken;return s.requestStatus===0?wS(t,e):s}function yN(t){return g0(t,e=>{if(!JD(e))throw $u.create("not-registered");const n=e.authToken;return LH(n)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function DH(t,e){try{const n=await $H(t,e),s=Object.assign(Object.assign({},e),{authToken:n});return await i1(t.appConfig,s),n}catch(n){if(zD(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await YD(t.appConfig);else{const s=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await i1(t.appConfig,s)}throw n}}function JD(t){return t!==void 0&&t.registrationStatus===2}function OH(t){return t.requestStatus===2&&!PH(t)}function PH(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+lH}function FH(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function LH(t){return t.requestStatus===1&&t.requestTime+LD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MH(t){const e=t,{installationEntry:n,registrationPromise:s}=await vS(e);return s?s.catch(console.error):wS(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VH(t,e=!1){const n=t;return await zH(n),(await wS(n,e)).token}async function zH(t){const{registrationPromise:e}=await vS(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BH(t){if(!t||!t.options)throw rx("App Configuration");if(!t.name)throw rx("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw rx(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function rx(t){return $u.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZD="installations",UH="installations-internal",WH=t=>{const e=t.getProvider("app").getImmediate(),n=BH(e),s=Yu(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},jH=t=>{const e=t.getProvider("app").getImmediate(),n=Yu(e,ZD).getImmediate();return{getId:()=>MH(n),getToken:r=>VH(n,r)}};function GH(){So(new Bi(ZD,WH,"PUBLIC")),So(new Bi(UH,jH,"PRIVATE"))}GH();ii(FD,gS);ii(FD,gS,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o1="analytics",HH="firebase_id",qH="origin",KH=60*1e3,XH="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",xS="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mr=new s0("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YH={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Or=new Xu("analytics","Analytics",YH);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QH(t){if(!t.startsWith(xS)){const e=Or.create("invalid-gtag-resource",{gtagURL:t});return mr.warn(e.message),""}return t}function eO(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function JH(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function ZH(t,e){const n=JH("firebase-js-sdk-policy",{createScriptURL:QH}),s=document.createElement("script"),r=`${xS}?l=${t}&id=${e}`;s.src=n?n==null?void 0:n.createScriptURL(r):r,s.async=!0,document.head.appendChild(s)}function eq(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function tq(t,e,n,s,r,i){const o=s[r];try{if(o)await e[o];else{const l=(await eO(n)).find(u=>u.measurementId===r);l&&await e[l.appId]}}catch(a){mr.error(a)}t("config",r,i)}async function nq(t,e,n,s,r){try{let i=[];if(r&&r.send_to){let o=r.send_to;Array.isArray(o)||(o=[o]);const a=await eO(n);for(const l of o){const u=a.find(h=>h.measurementId===l),c=u&&e[u.appId];if(c)i.push(c);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),t("event",s,r||{})}catch(i){mr.error(i)}}function sq(t,e,n,s){async function r(i,...o){try{if(i==="event"){const[a,l]=o;await nq(t,e,n,a,l)}else if(i==="config"){const[a,l]=o;await tq(t,e,n,s,a,l)}else if(i==="consent"){const[a,l]=o;t("consent",a,l)}else if(i==="get"){const[a,l,u]=o;t("get",a,l,u)}else if(i==="set"){const[a]=o;t("set",a)}else t(i,...o)}catch(a){mr.error(a)}}return r}function rq(t,e,n,s,r){let i=function(...o){window[s].push(arguments)};return window[r]&&typeof window[r]=="function"&&(i=window[r]),window[r]=sq(i,t,e,n),{gtagCore:i,wrappedGtag:window[r]}}function iq(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(xS)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oq=30,aq=1e3;class lq{constructor(e={},n=aq){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const tO=new lq;function uq(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function cq(t){var e;const{appId:n,apiKey:s}=t,r={method:"GET",headers:uq(s)},i=XH.replace("{app-id}",n),o=await fetch(i,r);if(o.status!==200&&o.status!==304){let a="";try{const l=await o.json();!((e=l.error)===null||e===void 0)&&e.message&&(a=l.error.message)}catch{}throw Or.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function hq(t,e=tO,n){const{appId:s,apiKey:r,measurementId:i}=t.options;if(!s)throw Or.create("no-app-id");if(!r){if(i)return{measurementId:i,appId:s};throw Or.create("no-api-key")}const o=e.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new fq;return setTimeout(async()=>{a.abort()},KH),nO({appId:s,apiKey:r,measurementId:i},o,a,e)}async function nO(t,{throttleEndTimeMillis:e,backoffCount:n},s,r=tO){var i;const{appId:o,measurementId:a}=t;try{await dq(s,e)}catch(l){if(a)return mr.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:o,measurementId:a};throw l}try{const l=await cq(t);return r.deleteThrottleMetadata(o),l}catch(l){const u=l;if(!pq(u)){if(r.deleteThrottleMetadata(o),a)return mr.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:o,measurementId:a};throw l}const c=Number((i=u==null?void 0:u.customData)===null||i===void 0?void 0:i.httpStatus)===503?t_(n,r.intervalMillis,oq):t_(n,r.intervalMillis),h={throttleEndTimeMillis:Date.now()+c,backoffCount:n+1};return r.setThrottleMetadata(o,h),mr.debug(`Calling attemptFetch again in ${c} millis`),nO(t,h,s,r)}}function dq(t,e){return new Promise((n,s)=>{const r=Math.max(e-Date.now(),0),i=setTimeout(n,r);t.addEventListener(()=>{clearTimeout(i),s(Or.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function pq(t){if(!(t instanceof qi)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class fq{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function mq(t,e,n,s,r){if(r&&r.global){t("event",n,s);return}else{const i=await e,o=Object.assign(Object.assign({},s),{send_to:i});t("event",n,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gq(){if(BR())try{await UR()}catch(t){return mr.warn(Or.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return mr.warn(Or.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function yq(t,e,n,s,r,i,o){var a;const l=hq(t);l.then(p=>{n[p.measurementId]=p.appId,t.options.measurementId&&p.measurementId!==t.options.measurementId&&mr.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${p.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(p=>mr.error(p)),e.push(l);const u=gq().then(p=>{if(p)return s.getId()}),[c,h]=await Promise.all([l,u]);iq(i)||ZH(i,c.measurementId),r("js",new Date);const d=(a=o==null?void 0:o.config)!==null&&a!==void 0?a:{};return d[qH]="firebase",d.update=!0,h!=null&&(d[HH]=h),r("config",c.measurementId,d),c.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vq{constructor(e){this.app=e}_delete(){return delete gp[this.app.options.appId],Promise.resolve()}}let gp={},vN=[];const wN={};let ix="dataLayer",wq="gtag",xN,sO,bN=!1;function xq(){const t=[];if(zR()&&t.push("This is a browser extension environment."),MU()||t.push("Cookies are not available."),t.length>0){const e=t.map((s,r)=>`(${r+1}) ${s}`).join(" "),n=Or.create("invalid-analytics-context",{errorInfo:e});mr.warn(n.message)}}function bq(t,e,n){xq();const s=t.options.appId;if(!s)throw Or.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)mr.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Or.create("no-api-key");if(gp[s]!=null)throw Or.create("already-exists",{id:s});if(!bN){eq(ix);const{wrappedGtag:i,gtagCore:o}=rq(gp,vN,wN,ix,wq);sO=i,xN=o,bN=!0}return gp[s]=yq(t,vN,wN,e,xN,ix,n),new vq(t)}function Iq(t=MI()){t=Xs(t);const e=Yu(t,o1);return e.isInitialized()?e.getImmediate():Sq(t)}function Sq(t,e={}){const n=Yu(t,o1);if(n.isInitialized()){const r=n.getImmediate();if(sl(e,n.getOptions()))return r;throw Or.create("already-initialized")}return n.initialize({options:e})}function Tq(t,e,n,s){t=Xs(t),mq(sO,gp[t.app.options.appId],e,n,s).catch(r=>mr.error(r))}const IN="@firebase/analytics",SN="0.10.12";function Cq(){So(new Bi(o1,(e,{options:n})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();return bq(s,r,n)},"PUBLIC")),So(new Bi("analytics-internal",t,"PRIVATE")),ii(IN,SN),ii(IN,SN,"esm2017");function t(e){try{const n=e.getProvider(o1).getImmediate();return{logEvent:(s,r,i)=>Tq(n,s,r,i)}}catch(n){throw Or.create("interop-component-reg-failed",{reason:n})}}}Cq();const kq={apiKey:"AIzaSyAb3uyZYrGlNHKDMIcdumty_Pc5t8kjD_Q",authDomain:"moodverse-c27ec.firebaseapp.com",projectId:"moodverse-c27ec",storageBucket:"moodverse-c27ec.firebasestorage.app",messagingSenderId:"688460385973",appId:"1:688460385973:web:1a241715094d87435238fc",measurementId:"G-ZM4VPVN9YP"},bS=HR(kq),cy=g7(bS),Eq=HG(bS);Iq(bS);const _q=async(t,e)=>{try{await iH(GG(Eq,"users",t),e),console.log("User data saved successfully:",e)}catch(n){console.error("Error saving user data: ",n)}},rO=xU(t=>({user:null,loading:!1,error:null,signIn:async(e,n)=>{try{t({loading:!0,error:null}),await t8(cy,e,n)}catch(s){t({error:s.message})}finally{t({loading:!1})}},signUp:async(e,n,s,r,i)=>{try{t({loading:!0,error:null}),console.log("Signing up user with email:",e);const a=(await e8(cy,e,n)).user.uid;console.log("User created with ID:",a),await _q(a,{name:s,gender:r,contactNumber:i,email:e})}catch(o){console.error("Error during signup:",o),t({error:o.message})}finally{t({loading:!1})}},signOut:async()=>{try{t({loading:!0,error:null}),await i8(cy)}catch(e){t({error:e.message})}finally{t({loading:!1})}},setUser:e=>t({user:e})}));/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Nq={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $q=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),No=(t,e)=>{const n=kt.forwardRef(({color:s="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:a="",children:l,...u},c)=>kt.createElement("svg",{ref:c,...Nq,width:r,height:r,stroke:s,strokeWidth:o?Number(i)*24/Number(r):i,className:["lucide",`lucide-${$q(t)}`,a].join(" "),...u},[...e.map(([h,d])=>kt.createElement(h,d)),...Array.isArray(l)?l:[l]]));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aq=No("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IS=No("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rq=No("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dq=No("Film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oq=No("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pq=No("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fq=No("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lq=No("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TN=No("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mq=No("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function Vq(){return oe.jsx("div",{className:"fixed inset-0 bg-purple-500 bg-opacity-90 backdrop-blur-sm flex items-center justify-center z-50",children:oe.jsxs("div",{className:"text-center",children:[oe.jsx("div",{className:"w-24 h-24 mb-4 mx-auto",children:oe.jsx("img",{src:"https://raw.githubusercontent.com/n3r4zzurr0/svg-spinners/main/preview/90-ring-with-bg-white.svg",alt:"Loading...",className:"w-full h-full"})}),oe.jsx("h2",{className:"text-white text-xl font-semibold",children:"Welcome to Mood Verse"}),oe.jsx("p",{className:"text-purple-100 mt-2",children:"Getting everything ready for you..."})]})})}function zq(){const[t,e]=kt.useState(!0),[n,s]=kt.useState(""),[r,i]=kt.useState(""),[o,a]=kt.useState(""),[l,u]=kt.useState(""),[c,h]=kt.useState(""),{signIn:d,signUp:p,loading:f,error:m}=rO(),v=async y=>{y.preventDefault(),t?await d(n,r):await p(n,r,o,l,c)};return f?oe.jsx(Vq,{}):oe.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-500 to-pink-500",children:oe.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-xl w-full max-w-md",children:[oe.jsx("h2",{className:"text-3xl font-bold text-center mb-8",children:t?"Welcome Back":"Create Account"}),oe.jsxs("form",{onSubmit:v,className:"space-y-6",children:[oe.jsxs("div",{children:[oe.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),oe.jsx("input",{type:"email",value:n,onChange:y=>s(y.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500",required:!0})]}),oe.jsxs("div",{children:[oe.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),oe.jsx("input",{type:"password",value:r,onChange:y=>i(y.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500",required:!0})]}),!t&&oe.jsxs(oe.Fragment,{children:[oe.jsxs("div",{children:[oe.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),oe.jsx("input",{type:"text",value:o,onChange:y=>a(y.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500",required:!0})]}),oe.jsxs("div",{children:[oe.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Gender"}),oe.jsxs("div",{className:"mt-1",children:[oe.jsxs("label",{className:"inline-flex items-center",children:[oe.jsx("input",{type:"radio",value:"Male",checked:l==="Male",onChange:()=>u("Male"),className:"form-radio text-purple-600",required:!0}),oe.jsx("span",{className:"ml-2",children:"Male"})]}),oe.jsxs("label",{className:"inline-flex items-center ml-4",children:[oe.jsx("input",{type:"radio",value:"Female",checked:l==="Female",onChange:()=>u("Female"),className:"form-radio text-purple-600",required:!0}),oe.jsx("span",{className:"ml-2",children:"Female"})]})]})]}),oe.jsxs("div",{children:[oe.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Contact Number"}),oe.jsx("input",{type:"tel",value:c,onChange:y=>h(y.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500",required:!0})]})]}),m&&oe.jsx("div",{className:"text-red-500 text-sm",children:m}),oe.jsx("button",{type:"submit",disabled:f,className:"w-full flex items-center justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",children:f?oe.jsx(Oq,{className:"animate-spin h-5 w-5"}):t?oe.jsxs(oe.Fragment,{children:[oe.jsx(Pq,{className:"h-5 w-5 mr-2"}),"Sign In"]}):oe.jsxs(oe.Fragment,{children:[oe.jsx(Mq,{className:"h-5 w-5 mr-2"}),"Sign Up"]})})]}),oe.jsx("div",{className:"mt-6 text-center",children:oe.jsx("button",{onClick:()=>e(!t),className:"text-sm text-purple-600 hover:text-purple-500",children:t?"Don't have an account? Sign up":"Already have an account? Sign in"})})]})})}var iO={exports:{}};(function(t,e){(function(s,r){t.exports=r(kt)})(Oi,function(n){return function(s){var r={};function i(o){if(r[o])return r[o].exports;var a=r[o]={i:o,l:!1,exports:{}};return s[o].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=s,i.c=r,i.d=function(o,a,l){i.o(o,a)||Object.defineProperty(o,a,{enumerable:!0,get:l})},i.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i.t=function(o,a){if(a&1&&(o=i(o)),a&8||a&4&&typeof o=="object"&&o&&o.__esModule)return o;var l=Object.create(null);if(i.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:o}),a&2&&typeof o!="string")for(var u in o)i.d(l,u,(function(c){return o[c]}).bind(null,u));return l},i.n=function(o){var a=o&&o.__esModule?function(){return o.default}:function(){return o};return i.d(a,"a",a),a},i.o=function(o,a){return Object.prototype.hasOwnProperty.call(o,a)},i.p="",i(i.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(s,r,i){i.r(r);var o=i("react"),a=function(){var d=function(p,f){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,v){m.__proto__=v}||function(m,v){for(var y in v)v.hasOwnProperty(y)&&(m[y]=v[y])},d(p,f)};return function(p,f){d(p,f);function m(){this.constructor=p}p.prototype=f===null?Object.create(f):(m.prototype=f.prototype,new m)}}(),l=function(){return l=Object.assign||function(d){for(var p,f=1,m=arguments.length;f<m;f++){p=arguments[f];for(var v in p)Object.prototype.hasOwnProperty.call(p,v)&&(d[v]=p[v])}return d},l.apply(this,arguments)},u=function(d,p){var f={};for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&p.indexOf(m)<0&&(f[m]=d[m]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var v=0,m=Object.getOwnPropertySymbols(d);v<m.length;v++)p.indexOf(m[v])<0&&Object.prototype.propertyIsEnumerable.call(d,m[v])&&(f[m[v]]=d[m[v]]);return f};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(p){var f=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return f?new Promise(function(m,v){f.call(navigator,p,m,v)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function c(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var h=function(d){a(p,d);function p(f){var m=d.call(this,f)||this;return m.canvas=null,m.ctx=null,m.requestUserMediaId=0,m.unmounted=!1,m.state={hasUserMedia:!1},m}return p.prototype.componentDidMount=function(){var f=this,m=f.state,v=f.props;if(this.unmounted=!1,!c()){v.onUserMediaError("getUserMedia not supported");return}m.hasUserMedia||this.requestUserMedia(),v.children&&typeof v.children!="function"&&console.warn("children must be a function")},p.prototype.componentDidUpdate=function(f){var m=this.props;if(!c()){m.onUserMediaError("getUserMedia not supported");return}var v=JSON.stringify(f.audioConstraints)!==JSON.stringify(m.audioConstraints),y=JSON.stringify(f.videoConstraints)!==JSON.stringify(m.videoConstraints),w=f.minScreenshotWidth!==m.minScreenshotWidth,b=f.minScreenshotHeight!==m.minScreenshotHeight;(y||w||b)&&(this.canvas=null,this.ctx=null),(v||y)&&(this.stopAndCleanup(),this.requestUserMedia())},p.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},p.stopMediaStream=function(f){f&&(f.getVideoTracks&&f.getAudioTracks?(f.getVideoTracks().map(function(m){f.removeTrack(m),m.stop()}),f.getAudioTracks().map(function(m){f.removeTrack(m),m.stop()})):f.stop())},p.prototype.stopAndCleanup=function(){var f=this.state;f.hasUserMedia&&(p.stopMediaStream(this.stream),f.src&&window.URL.revokeObjectURL(f.src))},p.prototype.getScreenshot=function(f){var m=this,v=m.state,y=m.props;if(!v.hasUserMedia)return null;var w=this.getCanvas(f);return w&&w.toDataURL(y.screenshotFormat,y.screenshotQuality)},p.prototype.getCanvas=function(f){var m=this,v=m.state,y=m.props;if(!this.video||!v.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var w=this.video.videoWidth,b=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var I=w/b;w=y.minScreenshotWidth||this.video.clientWidth,b=w/I,y.minScreenshotHeight&&b<y.minScreenshotHeight&&(b=y.minScreenshotHeight,w=b*I)}this.canvas=document.createElement("canvas"),this.canvas.width=(f==null?void 0:f.width)||w,this.canvas.height=(f==null?void 0:f.height)||b,this.ctx=this.canvas.getContext("2d")}var k=this,R=k.ctx,C=k.canvas;return R&&C&&(C.width=(f==null?void 0:f.width)||C.width,C.height=(f==null?void 0:f.height)||C.height,y.mirrored&&(R.translate(C.width,0),R.scale(-1,1)),R.imageSmoothingEnabled=y.imageSmoothing,R.drawImage(this.video,0,0,(f==null?void 0:f.width)||C.width,(f==null?void 0:f.height)||C.height),y.mirrored&&(R.scale(-1,1),R.translate(-C.width,0))),C},p.prototype.requestUserMedia=function(){var f=this,m=this.props,v=function(b,I){var k={video:typeof I<"u"?I:!0};m.audio&&(k.audio=typeof b<"u"?b:!0),f.requestUserMediaId++;var R=f.requestUserMediaId;navigator.mediaDevices.getUserMedia(k).then(function(C){f.unmounted||R!==f.requestUserMediaId?p.stopMediaStream(C):f.handleUserMedia(null,C)}).catch(function(C){f.handleUserMedia(C)})};if("mediaDevices"in navigator)v(m.audioConstraints,m.videoConstraints);else{var y=function(b){return{optional:[{sourceId:b}]}},w=function(b){var I=b.deviceId;return typeof I=="string"?I:Array.isArray(I)&&I.length>0?I[0]:typeof I=="object"&&I.ideal?I.ideal:null};MediaStreamTrack.getSources(function(b){var I=null,k=null;b.forEach(function(T){T.kind==="audio"?I=T.id:T.kind==="video"&&(k=T.id)});var R=w(m.audioConstraints);R&&(I=R);var C=w(m.videoConstraints);C&&(k=C),v(y(I),y(k))})}},p.prototype.handleUserMedia=function(f,m){var v=this.props;if(f||!m){this.setState({hasUserMedia:!1}),v.onUserMediaError(f);return}this.stream=m;try{this.video&&(this.video.srcObject=m),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(m)})}v.onUserMedia(m)},p.prototype.render=function(){var f=this,m=this,v=m.state,y=m.props,w=y.audio;y.forceScreenshotSourceSize;var b=y.disablePictureInPicture;y.onUserMedia,y.onUserMediaError,y.screenshotFormat,y.screenshotQuality,y.minScreenshotWidth,y.minScreenshotHeight,y.audioConstraints,y.videoConstraints,y.imageSmoothing;var I=y.mirrored,k=y.style,R=k===void 0?{}:k,C=y.children,T=u(y,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),N=I?l(l({},R),{transform:(R.transform||"")+" scaleX(-1)"}):R,$={getScreenshot:this.getScreenshot.bind(this)};return o.createElement(o.Fragment,null,o.createElement("video",l({autoPlay:!0,disablePictureInPicture:b,src:v.src,muted:!w,playsInline:!0,ref:function(P){f.video=P},style:N},T)),C&&C($))},p.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},p}(o.Component);r.default=h},react:function(s,r){s.exports=n}}).default})})(iO);var Bq=iO.exports;const Uq=M1(Bq);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wq=1e-7,jq=1e-4;class oO{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class SS{refCount(e){return sr("refCount")}incRef(e){return sr("incRef")}timerAvailable(){return!0}time(e){return sr("time")}read(e){return sr("read")}readSync(e){return sr("readSync")}readToGPU(e,n){return sr("readToGPU")}numDataIds(){return sr("numDataIds")}disposeData(e,n){return sr("disposeData")}write(e,n,s){return sr("write")}move(e,n,s,r,i){return sr("move")}createTensorFromGPUData(e,n,s){return sr("createTensorFromGPUData")}memory(){return sr("memory")}floatPrecision(){return sr("floatPrecision")}epsilon(){return this.floatPrecision()===32?Wq:jq}dispose(){return sr("dispose")}}function sr(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gq(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,$c(t,e,n)}function Ru(t,e,n){return Math.max(t,Math.min(e,n))}function TS(t){return t%2===0?t:t+1}function $c(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function Hq(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function F(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function Ir(t,e,n=""){F(ut(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function jh(t){F(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function re(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function qq(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==null&&e[n]!==null&&t[n]!==e[n])return!1;return!0}function ut(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Th(t){return t%1===0}function j2(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function rh(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function CN(t,e=r=>0,n,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(t()){r();return}o++;const l=e(o);if(n!=null&&o>=n){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function aO(t,e){let n=1,s=-1;for(let i=0;i<t.length;++i)if(t[i]>=0)n*=t[i];else if(t[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(t[i]<0)throw Error(`Shapes can not be < 0. Found ${t[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const r=t.slice();return r[s]=e/n,r}function st(t,e){const n=e.length;return t=t==null?e.map((s,r)=>r):[].concat(t),F(t.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),F(t.every(s=>Th(s)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(s=>s<0?n+s:s)}function Tl(t,e){const n=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:st(e,t).sort();let o=0;for(let a=0;a<t.length;++a){if(i!=null){if(i[o]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(i[o]==null||i[o]>a)&&t[a]===1&&(n.push(t[a]),s.push(a)),i[o]<=a&&o++}t[a]!==1&&(n.push(t[a]),s.push(a))}return{newShape:n,keptDims:s}}function ts(t,e){return yn(t,e)}function yn(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function Kq(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function Xq(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function lO(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function a1(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function Yq(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function bf(t){return typeof t=="string"||t instanceof String}function Qq(t){return typeof t=="boolean"}function G2(t){return typeof t=="number"}function Gh(t){return Array.isArray(t)?Gh(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":G2(t)?"float32":bf(t)?"string":Qq(t)?"bool":"float32"}function H2(t){return!!(t&&t.constructor&&t.call&&t.apply)}function q2(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function Ve(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function uO(t,e,n,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=n[t+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<i;l++)r[l]=uO(t+l*a,o,n,s)}return r}function oi(t,e,n=!1){if(t.length===0)return e[0];const s=t.reduce((r,i)=>r*i)*(n?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return uO(0,t,e,n)}function Jq(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function CS(t,e){const n=ws(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function ws(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function cO(t,e){const n=t.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return oi(t,new Float32Array(n));if(e==="int32")return oi(t,new Int32Array(n));if(e==="bool")return oi(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function zr(t){t.forEach(e=>{F(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function wo(t,e,n){if(e===0)return 0;if(e===1)return t[0];let s=t[t.length-1];for(let r=0;r<t.length-1;++r)s+=n[r]*t[r];return s}function Hh(t,e,n){if(e===0)return[];if(e===1)return[t];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(t/n[r]),t-=s[r]*n[r];return s[s.length-1]=t,s}function Du(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kN="tfjsflags";class Zq{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=eK,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(te().getBool("IS_TEST")||te().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,s){if(this.flagRegistry[e]={evaluationFn:n,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];te().getBool("IS_TEST")||te().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(Du(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);kN in e&&e[kN].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=nK(r,i)})}}function eK(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(tK(e,s[0],s[1]),s.join("="))),e}function tK(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function nK(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function te(){return hO}let hO=null;function sK(t){hO=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let ox;function dO(){if(ox==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");ox=t}return ox}function rK(){const t=dO();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function kS(t,e){const n=rK();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const y0="Abs",If="Acos",Sf="Acosh",qh="Add",v0="AddN",ES="All",_S="Any",w0="ArgMax",x0="ArgMin",Tf="Asin",Cf="Asinh",kf="Atan",Ef="Atanh",_f="Atan2",b0="AvgPool",NS="AvgPoolGrad",I0="AvgPool3D",$S="AvgPool3DGrad",S0="BatchMatMul",T0="BatchToSpaceND",AS="Bincount",C0="BitwiseAnd",iK="BroadcastTo",RS="BroadcastArgs",Nf="Cast",$f="Ceil",Af="ClipByValue",DS="Complex",k0="ComplexAbs",E0="Concat",_0="Conv2D",OS="Conv2DBackpropFilter",N0="Conv2DBackpropInput",$0="Conv3D",PS="Conv3DBackpropFilterV2",FS="Conv3DBackpropInputV2",Rf="Cos",Df="Cosh",LS="Cumprod",A0="Cumsum",MS="CropAndResize",VS="DenseBincount",zS="DepthToSpace",R0="DepthwiseConv2dNative",BS="DepthwiseConv2dNativeBackpropFilter",US="DepthwiseConv2dNativeBackpropInput",WS="Diag",D0="Dilation2D",K2="Dilation2DBackpropInput",X2="Dilation2DBackpropFilter",oK="Draw",Of="RealDiv",jS="Einsum",Pf="Elu",GS="EluGrad",Ff="Erf",O0="Equal",Lf="Exp",P0="ExpandDims",Mf="Expm1",HS="FFT",qS="Fill",KS="FlipLeftRight",Vf="Floor",zf="FloorDiv",F0="FusedBatchNorm",L0="GatherV2",XS="GatherNd",M0="Greater",Bf="GreaterEqual",Uf="Identity",YS="IFFT",QS="Imag",Wf="IsFinite",jf="IsInf",Gf="IsNan",V0="LeakyRelu",z0="Less",B0="LessEqual",JS="LinSpace",Hf="Log",qf="Log1p",U0="LogicalAnd",W0="LogicalNot",j0="LogicalOr",aK="LogSoftmax",G0="LRN",ZS="LRNGrad",H0="Max",Kf="Maximum",q0="MaxPool",eT="MaxPoolGrad",K0="MaxPool3D",tT="MaxPool3DGrad",nT="MaxPoolWithArgmax",X0="Mean",Y0="Min",Xf="Minimum",Q0="MirrorPad",Yf="Mod",sT="Multinomial",Qf="Multiply",J0="Neg",Z0="NotEqual",rT="NonMaxSuppressionV3",iT="NonMaxSuppressionV4",oT="NonMaxSuppressionV5",ev="OnesLike",tv="OneHot",nv="Pack",sv="PadV2",Jf="Pow",rv="Prelu",iv="Prod",aT="RaggedGather",lT="RaggedRange",uT="RaggedTensorToTensor",cT="Range",hT="Real",Zf="Reciprocal",em="Relu",ov="Reshape",av="ResizeNearestNeighbor",dT="ResizeNearestNeighborGrad",lv="ResizeBilinear",pT="ResizeBilinearGrad",tm="Relu6",uv="Reverse",nm="Round",sm="Rsqrt",fT="ScatterNd",mT="TensorScatterUpdate",gT="SearchSorted",cv="Select",rm="Selu",hv="Slice",im="Sin",om="Sinh",am="Sign",lm="Sigmoid",um="Softplus",cm="Sqrt",dv="Sum",pv="SpaceToBatchND",fv="SplitV",mv="Softmax",yT="SparseFillEmptyRows",vT="SparseReshape",wT="SparseSegmentMean",xT="SparseSegmentSum",bT="SparseToDense",hm="SquaredDifference",IT="Square",gv="StaticRegexReplace",ST="StridedSlice",TT="StringNGrams",CT="StringSplit",kT="StringToHashBucketFast",dm="Sub",pm="Tan",fm="Tanh",mm="Tile",ET="TopK",_T="Transform",ih="Transpose",NT="Unique",yv="Unpack",vv="UnsortedSegmentSum",wv="ZerosLike",gm="Step",Y2="FromPixels",$T="RotateWithOffset",l1="_FusedMatMul",u1="FusedConv2D",c1="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nr(...t){te().getBool("IS_TEST")||te().getBool("PROD")||console.warn(...t)}function lK(...t){te().getBool("IS_TEST")||te().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h1=kS("kernelRegistry",()=>new Map),Q2=kS("gradRegistry",()=>new Map);function J2(t,e){const n=fO(t,e);return h1.get(n)}function EN(t){return Q2.get(t)}function _N(t){const e=h1.entries(),n=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===t&&n.push(o)}return n}function pO(t){const{kernelName:e,backendName:n}=t,s=fO(e,n);h1.has(s)&&Nr(`The kernel '${e}' for backend '${n}' is already registered`),h1.set(s,t)}function uK(t){const{kernelName:e}=t;Q2.has(e)&&te().getBool("DEBUG")&&Nr(`Overriding the gradient for '${e}'`),Q2.set(e,t)}function fO(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mO(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var gO=Gt,Jr=null;try{Jr=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Gt(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}Gt.prototype.__isLong__;Object.defineProperty(Gt.prototype,"__isLong__",{value:!0});function Sr(t){return(t&&t.__isLong__)===!0}Gt.isLong=Sr;var NN={},$N={};function ec(t,e){var n,s,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(s=$N[t],s)?s:(n=Ht(t,(t|0)<0?-1:0,!0),r&&($N[t]=n),n)):(t|=0,(r=-128<=t&&t<128)&&(s=NN[t],s)?s:(n=Ht(t,t<0?-1:0,!1),r&&(NN[t]=n),n))}Gt.fromInt=ec;function Zr(t,e){if(isNaN(t))return e?uu:ei;if(e){if(t<0)return uu;if(t>=yO)return xO}else{if(t<=-RN)return cr;if(t+1>=RN)return wO}return t<0?Zr(-t,e).neg():Ht(t%Ch|0,t/Ch|0,e)}Gt.fromNumber=Zr;function Ht(t,e,n){return new Gt(t,e,n)}Gt.fromBits=Ht;var d1=Math.pow;function AT(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return ei;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return AT(t.substring(1),e,n).neg();for(var r=Zr(d1(n,8)),i=ei,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+a),n);if(a<8){var u=Zr(d1(n,a));i=i.mul(u).add(Zr(l))}else i=i.mul(r),i=i.add(Zr(l))}return i.unsigned=e,i}Gt.fromString=AT;function Ki(t,e){return typeof t=="number"?Zr(t,e):typeof t=="string"?AT(t,e):Ht(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Gt.fromValue=Ki;var AN=65536,cK=1<<24,Ch=AN*AN,yO=Ch*Ch,RN=yO/2,DN=ec(cK),ei=ec(0);Gt.ZERO=ei;var uu=ec(0,!0);Gt.UZERO=uu;var qc=ec(1);Gt.ONE=qc;var vO=ec(1,!0);Gt.UONE=vO;var Z2=ec(-1);Gt.NEG_ONE=Z2;var wO=Ht(-1,2147483647,!1);Gt.MAX_VALUE=wO;var xO=Ht(-1,-1,!0);Gt.MAX_UNSIGNED_VALUE=xO;var cr=Ht(0,-2147483648,!1);Gt.MIN_VALUE=cr;var ke=Gt.prototype;ke.toInt=function(){return this.unsigned?this.low>>>0:this.low};ke.toNumber=function(){return this.unsigned?(this.high>>>0)*Ch+(this.low>>>0):this.high*Ch+(this.low>>>0)};ke.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(cr)){var n=Zr(e),s=this.div(n),r=s.mul(n).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Zr(d1(e,6),this.unsigned),o=this,a="";;){var l=o.div(i),u=o.sub(l.mul(i)).toInt()>>>0,c=u.toString(e);if(o=l,o.isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}};ke.getHighBits=function(){return this.high};ke.getHighBitsUnsigned=function(){return this.high>>>0};ke.getLowBits=function(){return this.low};ke.getLowBitsUnsigned=function(){return this.low>>>0};ke.getNumBitsAbs=function(){if(this.isNegative())return this.eq(cr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};ke.isZero=function(){return this.high===0&&this.low===0};ke.eqz=ke.isZero;ke.isNegative=function(){return!this.unsigned&&this.high<0};ke.isPositive=function(){return this.unsigned||this.high>=0};ke.isOdd=function(){return(this.low&1)===1};ke.isEven=function(){return(this.low&1)===0};ke.equals=function(e){return Sr(e)||(e=Ki(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};ke.eq=ke.equals;ke.notEquals=function(e){return!this.eq(e)};ke.neq=ke.notEquals;ke.ne=ke.notEquals;ke.lessThan=function(e){return this.comp(e)<0};ke.lt=ke.lessThan;ke.lessThanOrEqual=function(e){return this.comp(e)<=0};ke.lte=ke.lessThanOrEqual;ke.le=ke.lessThanOrEqual;ke.greaterThan=function(e){return this.comp(e)>0};ke.gt=ke.greaterThan;ke.greaterThanOrEqual=function(e){return this.comp(e)>=0};ke.gte=ke.greaterThanOrEqual;ke.ge=ke.greaterThanOrEqual;ke.compare=function(e){if(Sr(e)||(e=Ki(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};ke.comp=ke.compare;ke.negate=function(){return!this.unsigned&&this.eq(cr)?cr:this.not().add(qc)};ke.neg=ke.negate;ke.add=function(e){Sr(e)||(e=Ki(e));var n=this.high>>>16,s=this.high&65535,r=this.low>>>16,i=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,u=e.low&65535,c=0,h=0,d=0,p=0;return p+=i+u,d+=p>>>16,p&=65535,d+=r+l,h+=d>>>16,d&=65535,h+=s+a,c+=h>>>16,h&=65535,c+=n+o,c&=65535,Ht(d<<16|p,c<<16|h,this.unsigned)};ke.subtract=function(e){return Sr(e)||(e=Ki(e)),this.add(e.neg())};ke.sub=ke.subtract;ke.multiply=function(e){if(this.isZero())return ei;if(Sr(e)||(e=Ki(e)),Jr){var n=Jr.mul(this.low,this.high,e.low,e.high);return Ht(n,Jr.get_high(),this.unsigned)}if(e.isZero())return ei;if(this.eq(cr))return e.isOdd()?cr:ei;if(e.eq(cr))return this.isOdd()?cr:ei;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(DN)&&e.lt(DN))return Zr(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,u=e.low>>>16,c=e.low&65535,h=0,d=0,p=0,f=0;return f+=o*c,p+=f>>>16,f&=65535,p+=i*c,d+=p>>>16,p&=65535,p+=o*u,d+=p>>>16,p&=65535,d+=r*c,h+=d>>>16,d&=65535,d+=i*u,h+=d>>>16,d&=65535,d+=o*l,h+=d>>>16,d&=65535,h+=s*c+r*u+i*l+o*a,h&=65535,Ht(p<<16|f,h<<16|d,this.unsigned)};ke.mul=ke.multiply;ke.divide=function(e){if(Sr(e)||(e=Ki(e)),e.isZero())throw Error("division by zero");if(Jr){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?Jr.div_u:Jr.div_s)(this.low,this.high,e.low,e.high);return Ht(n,Jr.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?uu:ei;var s,r,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return uu;if(e.gt(this.shru(1)))return vO;i=uu}else{if(this.eq(cr)){if(e.eq(qc)||e.eq(Z2))return cr;if(e.eq(cr))return qc;var o=this.shr(1);return s=o.div(e).shl(1),s.eq(ei)?e.isNegative()?qc:Z2:(r=this.sub(e.mul(s)),i=s.add(r.div(e)),i)}else if(e.eq(cr))return this.unsigned?uu:ei;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=ei}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),l=a<=48?1:d1(2,a-48),u=Zr(s),c=u.mul(e);c.isNegative()||c.gt(r);)s-=l,u=Zr(s,this.unsigned),c=u.mul(e);u.isZero()&&(u=qc),i=i.add(u),r=r.sub(c)}return i};ke.div=ke.divide;ke.modulo=function(e){if(Sr(e)||(e=Ki(e)),Jr){var n=(this.unsigned?Jr.rem_u:Jr.rem_s)(this.low,this.high,e.low,e.high);return Ht(n,Jr.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};ke.mod=ke.modulo;ke.rem=ke.modulo;ke.not=function(){return Ht(~this.low,~this.high,this.unsigned)};ke.and=function(e){return Sr(e)||(e=Ki(e)),Ht(this.low&e.low,this.high&e.high,this.unsigned)};ke.or=function(e){return Sr(e)||(e=Ki(e)),Ht(this.low|e.low,this.high|e.high,this.unsigned)};ke.xor=function(e){return Sr(e)||(e=Ki(e)),Ht(this.low^e.low,this.high^e.high,this.unsigned)};ke.shiftLeft=function(e){return Sr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ht(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Ht(0,this.low<<e-32,this.unsigned)};ke.shl=ke.shiftLeft;ke.shiftRight=function(e){return Sr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ht(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Ht(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};ke.shr=ke.shiftRight;ke.shiftRightUnsigned=function(e){if(Sr(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var s=this.low;return Ht(s>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?Ht(n,0,this.unsigned):Ht(n>>>e-32,0,this.unsigned)};ke.shru=ke.shiftRightUnsigned;ke.shr_u=ke.shiftRightUnsigned;ke.toSigned=function(){return this.unsigned?Ht(this.low,this.high,!1):this};ke.toUnsigned=function(){return this.unsigned?this:Ht(this.low,this.high,!0)};ke.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};ke.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};ke.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};Gt.fromBytes=function(e,n,s){return s?Gt.fromBytesLE(e,n):Gt.fromBytesBE(e,n)};Gt.fromBytesLE=function(e,n){return new Gt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};Gt.fromBytesBE=function(e,n){return new Gt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const bO=M1(gO),hK=wz({__proto__:null,default:bO},[gO]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eu=bO||hK;function xv(t){return eu.fromString(t,!0,16)}const IO=xv("c3a5c85c97cb3127"),Zl=xv("b492b66fbe98f273"),As=xv("9ae16a3b2f90404f");function eb(t){return t.xor(t.shru(47))}function SO(t,e,n){const s=t.slice(e,e+n);return eu.fromBytes(Array.from(s),!0,!0)}function Ut(t,e){return SO(t,e,8)}function ON(t,e){return SO(t,e,4)}function zn(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function Qa(t,e,n=xv("9ddfea08eb382d69")){let s=t.xor(e).mul(n);s=s.xor(s.shru(47));let r=e.xor(s).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function dK(t,e,n,s,r,i){r=r.add(t),i=zn(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(n),i=i.add(zn(r,44)),[r.add(s),i.add(o)]}function Ng(t,e,n,s){return dK(Ut(t,e),Ut(t,e+8),Ut(t,e+16),Ut(t,e+24),n,s)}function pK(t,e=t.length){if(e>=8){const n=As.add(e*2),s=Ut(t,0).add(As),r=Ut(t,e-8),i=zn(r,37).mul(n).add(s),o=zn(s,25).add(r).mul(n);return Qa(i,o,n)}if(e>=4){const n=As.add(e*2),s=ON(t,0);return Qa(s.shl(3).add(e),ON(t,e-4),n)}if(e>0){const n=t[0],s=t[e>>1],r=t[e-1],i=n+(s<<8),o=e+(r<<2);return eb(As.mul(i).xor(IO.mul(o))).mul(As)}return As}function fK(t,e=t.length){const n=As.add(e*2),s=Ut(t,0).mul(Zl),r=Ut(t,8),i=Ut(t,e-8).mul(n),o=Ut(t,e-16).mul(As);return Qa(zn(s.add(r),43).add(zn(i,30)).add(o),s.add(zn(r.add(As),18)).add(i),n)}function mK(t,e=t.length){const n=As.add(e*2),s=Ut(t,0).mul(As),r=Ut(t,8),i=Ut(t,e-8).mul(n),o=Ut(t,e-16).mul(As),a=zn(s.add(r),43).add(zn(i,30)).add(o),l=Qa(a,s.add(zn(r.add(As),18)).add(i),n),u=Ut(t,16).mul(n),c=Ut(t,24),h=a.add(Ut(t,e-32)).mul(n),d=l.add(Ut(t,e-24)).mul(n);return Qa(zn(u.add(c),43).add(zn(h,30)).add(d),u.add(zn(c.add(s),18)).add(h),n)}function gK(t,e=t.length){const n=eu.fromNumber(81,!0);if(e<=32)return e<=16?pK(t,e):fK(t,e);if(e<=64)return mK(t,e);let s=n,r=n.mul(Zl).add(113),i=eb(r.mul(As).add(113)).mul(As),o=[eu.UZERO,eu.UZERO],a=[eu.UZERO,eu.UZERO];s=s.mul(As).add(Ut(t,0));let l=0;const u=(e-1>>6)*64,c=u+(e-1&63)-63;do s=zn(s.add(r).add(o[0]).add(Ut(t,l+8)),37).mul(Zl),r=zn(r.add(o[1]).add(Ut(t,l+48)),42).mul(Zl),s=s.xor(a[1]),r=r.add(o[0]).add(Ut(t,l+40)),i=zn(i.add(a[0]),33).mul(Zl),o=Ng(t,l,o[1].mul(Zl),s.add(a[0])),a=Ng(t,l+32,i.add(a[1]),r.add(Ut(t,l+16))),[i,s]=[s,i],l+=64;while(l!==u);const h=Zl.add(i.and(255).shl(1));return l=c,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=zn(s.add(r).add(o[0]).add(Ut(t,l+8)),37).mul(h),r=zn(r.add(o[1]).add(Ut(t,l+48)),42).mul(h),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(Ut(t,l+40))),i=zn(i.add(a[0]),33).mul(h),o=Ng(t,l,o[1].mul(h),s.add(a[0])),a=Ng(t,l+32,i.add(a[1]),r.add(Ut(t,l+16))),[i,s]=[s,i],Qa(Qa(o[0],a[0],h).add(eb(r).mul(IO)).add(i),Qa(o[1],a[1],h).add(s),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cl(t,e){return e==="string"?Ja(t):tc([t],e)}function yK(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function tc(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Ou(t)),te().getBool("DEBUG")&&Kq(t,e),yK(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let s=0;s<n.length;++s)Math.round(t[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${e}`)}function Gs(){return te().platform.now()}function Ja(t,e="utf-8"){return e=e||"utf-8",te().platform.encode(t,e)}function ll(t,e="utf-8"){return e=e||"utf-8",te().platform.decode(t,e)}function ci(t){return te().platform.isTypedArray!=null?te().platform.isTypedArray(t):mO(t)}function Ou(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||Du(t)||t==null||ci(t)&&n)e.push(t);else if(Array.isArray(t)||ci(t))for(let s=0;s<t.length;++s)Ou(t[s],e,n);else{let s=-1;for(const r of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Ou(t[r],e,n)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vK{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new xK)}profileKernel(e,n,s){let r;const i=()=>{r=s()};let o;const a=Gs();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const u of r)u.dataSync();o=Promise.resolve({kernelMs:Gs()-a})}if(te().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const c=r[u];c.data().then(h=>{wK(h,c.dtype,e)})}return{kernelName:e,outputs:r,inputs:n,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],i,l[2])})})}}function wK(t,e,n){if(e!=="float32")return!1;for(let s=0;s<t.length;s++){const r=t[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class xK{logKernelProfile(e,n,s,r,i,o){const a=typeof r=="number"?rh(`${r}ms`,9):r.error,l=rh(e,25),u=n.rank,c=n.size,h=rh(n.shape.toString(),14);let d="";for(const p in i){const f=i[p];if(f!=null){const m=f.shape||n.shape,v=m.length;d+=`${p}: ${v}D ${v>0?m:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${h}	%c${c}	%c${d}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bK(t,e,n){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<t.length;l++){const u=t[l],c=u.inputs;for(const h in c){const d=c[h];let p=!1;for(let f=0;f<e.length;f++)if(s[d.id]){u.outputs.forEach(m=>s[m.id]=!0),p=!0,r[u.id]=!0;break}if(p)break}}const i={};i[n.id]=!0;const o={};for(let l=t.length-1;l>=0;l--){const u=t[l],c=u.inputs;for(let h=0;h<u.outputs.length;h++)if(i[u.outputs[h].id]){for(const d in c)i[c[d].id]=!0,o[u.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const u=t[l];if(r[u.id]&&o[u.id]){const c={};for(const d in u.inputs){const p=u.inputs[d];s[p.id]&&(c[d]=p)}const h=Object.assign({},u);h.inputs=c,h.outputs=u.outputs,a.push(h)}}return a}function IK(t,e,n,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const u=t[l.id];u!=null?o.push(u):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=n(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const c=i.inputs[l];if(!ut(u.shape,c.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${c.shape}'`);if(t[c.id]==null)t[c.id]=u;else{const h=t[c.id];t[c.id]=s(h,u),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PN=20,Vd=3,ax=7;function SK(t,e,n,s){const r=Ve(e),i=TK(t,e,n,r),o=e.length,a=hy(t,e,n,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function TK(t,e,n,s){const r=re(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=n==="complex64"?Qd(t):t;if(a>1)for(let u=0;u<r/i;u++){const c=u*i;for(let h=0;h<i;h++)o[h]=Math.max(o[h],Yd(l[c+h],0,n).length)}return o}function Yd(t,e,n){let s;return Array.isArray(t)?s=`${parseFloat(t[0].toFixed(ax))} + ${parseFloat(t[1].toFixed(ax))}j`:bf(t)?s=`'${t}'`:n==="bool"?s=TO(t):s=parseFloat(t.toFixed(ax)).toString(),rh(s,e)}function TO(t){return t===0?"false":"true"}function hy(t,e,n,s,r,i=!0){const o=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const m=Qd(t);return[Yd(m[0],0,n)]}return n==="bool"?[TO(t[0])]:[t[0].toString()]}if(l===1){if(a>PN){const v=Vd*o;let y=Array.from(t.slice(0,v)),w=Array.from(t.slice((a-Vd)*o,a*o));return n==="complex64"&&(y=Qd(y),w=Qd(w)),["["+y.map((b,I)=>Yd(b,r[I],n)).join(", ")+", ..., "+w.map((b,I)=>Yd(b,r[a-Vd+I],n)).join(", ")+"]"]}return["["+(n==="complex64"?Qd(t):Array.from(t)).map((v,y)=>Yd(v,r[y],n)).join(", ")+"]"]}const u=e.slice(1),c=s.slice(1),h=s[0]*o,d=[];if(a>PN){for(let m=0;m<Vd;m++){const v=m*h,y=v+h;d.push(...hy(t.slice(v,y),u,n,c,r,!1))}d.push("...");for(let m=a-Vd;m<a;m++){const v=m*h,y=v+h;d.push(...hy(t.slice(v,y),u,n,c,r,m===a-1))}}else for(let m=0;m<a;m++){const v=m*h,y=v+h;d.push(...hy(t.slice(v,y),u,n,c,r,m===a-1))}const p=l===2?",":"";d[0]="["+(a>0?d[0]+p:"");for(let m=1;m<d.length-1;m++)d[m]=" "+d[m]+p;let f=`,
`;for(let m=2;m<l;m++)f+=`
`;return d[d.length-1]=" "+d[d.length-1]+"]"+(i?"":f),d}function Qd(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rn{constructor(e,n,s){if(this.dtype=n,this.shape=e.slice(),this.size=re(e),s!=null){const r=s.length;F(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||yn(n,this.size),this.strides=Ve(e)}set(e,...n){n.length===0&&(n=[0]),F(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const r of e){if(r<0||r>=this.shape[n]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}n++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let s=0;s<e.length-1;++s)n+=this.strides[s]*e[s];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(e/this.strides[s]),e-=n[s]*this.strides[s];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return Ni().makeTensor(this.values,this.shape,this.dtype)}}let Ni=null,Ac=null;function CK(t){Ni=t}function kK(t){Ac=t}class Mt{constructor(e,n,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=re(e),this.strides=Ve(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Ac.buffer(this.shape,this.dtype,e)}bufferSync(){return Ac.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return oi(this.shape,e,this.dtype==="complex64")}arraySync(){return oi(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Ni().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(s=>ll(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Ni().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Ni().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>ll(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Ni().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Ni().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Ac.print(this,e)}clone(){return this.throwIfDisposed(),Ac.clone(this)}toString(e=!1){const n=this.dataSync();return SK(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Ac.cast(this,e)}variable(e=!0,n,s){return this.throwIfDisposed(),Ni().makeVariable(this,e,n,s)}}Object.defineProperty(Mt,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function ae(){return kS("Tensor",()=>Mt)}ae();class p1 extends Mt{constructor(e,n,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=n,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!ut(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Ni().disposeTensor(this),this.dataId=e.dataId,Ni().incRef(this,null)}dispose(){Ni().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(p1,Symbol.hasInstance,{value:t=>t instanceof Mt&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var FN;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(FN||(FN={}));var tb;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(tb||(tb={}));var nb;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(nb||(nb={}));var sb;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(sb||(sb={}));var rb;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(rb||(rb={}));const EK={float32:sb,int32:tb,bool:nb,complex64:rb};function vr(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return EK[t][e]}function RT(t){return vr(t,"int32")}function CO(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function kO(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pn(t,e){if(t.dtype===e.dtype)return[t,e];const n=vr(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function _K(t,e){F(t.dtype===e.dtype,()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`)}function EO(t){const e=[];return _O(t,e,new Set),e}function _O(t,e,n){if(t==null)return;if(t instanceof Mt){e.push(t);return}if(!NK(t))return;const s=t;for(const r in s){const i=s[r];n.has(i)||(n.add(i),_O(i,e,n))}}function NK(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lx(t){return t.kernelName!=null}class LN{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class kh{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new LN}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,s=1){return e in this.registryFactory?(Nr(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(e);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new vK(this.backendInstance),!0}setupRegisteredKernels(){_N(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){_N(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof SS)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Nr(`Initialization of backend ${e} failed`),Nr(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Nr(`Initialization of backend ${e} failed`),Nr(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const s=this.state.tensorInfo.get(n),r=s.backend,i=this.readSync(n),o=r.refCount(n);r.disposeData(n,!0),s.backend=e,e.move(n,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let s=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=n(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,n,s){e();try{const r=s();return n(),r}catch(r){throw n(),r}}nextTensorId(){return kh.nextTensorId++}nextVariableId(){return kh.nextVariableId++}clone(e){const n=j.runKernel(Uf,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},u={dtype:a};return j.runKernel(Nf,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[n],r,i,{}),n}runKernel(e,n,s){if(this.backendName==null&&this.backend,!(J2(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-n-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=lx(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(lx(e)){const{kernelName:f,inputs:m,attrs:v}=e;this.backendName==null&&this.backend;const y=J2(f,this.backendName);F(y!=null,()=>`Cannot find registered kernel '${f}' for backend '${this.backendName}'`),a=()=>{const w=this.backend.numDataIds();l=y.kernelFunc({inputs:m,attrs:v,backend:this.backend});const b=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(f,w,b);const I=b.map(k=>k.rank!=null?k:this.makeTensorFromTensorInfo(k));if(r){const k=this.getTensorsForGradient(f,m,I);s=this.saveTensorsForBackwardMode(k)}return I}}else{const{forwardFunc:f}=e,m=v=>{r&&(s=v.map(y=>this.keep(this.clone(y))))};a=()=>{const v=this.backend.numDataIds();l=this.tidy(()=>f(this.backend,m));const y=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,v,y),y}}const{inputs:c,attrs:h}=e,d=lx(e)?null:e.backwardsFunc;let p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(p=this.profiler.profileKernel(u,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),n=p.outputs)}),r&&this.addTapeNode(u,c,n,d,s,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(f=>c[f]!=null?c[f].shape:null),outputShapes:n.map(f=>f.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,n,s){const r=EN(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(F(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(u=>n[u])):a=i.map(u=>n[u]);const l=s.filter((u,c)=>o[c]);return a.concat(l)}return[]}makeTensor(e,n,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&bf(e[0])&&(i=e.map(l=>Ja(l)));const o=r.write(i,n,s),a=new Mt(n,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),u=Yq(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,n,s,r){s=s||"float32";const i={dataId:e,shape:n,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,n){const{dataId:s,shape:r,dtype:i}=e,o=new Mt(r,i,s,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(e,n=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new p1(e,n,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*a1(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof p1||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*a1(e.dtype);this.state.numBytes-=s}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:s,saved:i},l=EN(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((c,h)=>{if(c==null){const d=s[h],p=ws(d.size,d.dtype);return this.makeTensor(p,d.shape,d.dtype)}return c}),r(u.length>1?u:u[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=EO(e),s=new Set(n.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,n,s,r=!1){if(F(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));F(i instanceof Mt,()=>"The result y returned by f() must be a tensor.");const o=bK(this.state.activeTape,n,i);if(!r&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??$K(i.shape),IK(a,o,u=>this.tidy(u),AK);const l=n.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const c of u.saved)c.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return F(H2(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{F(n.every(a=>a instanceof Mt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};n.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...n,l),F(s.value instanceof Mt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),F(H2(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const u=s.gradFunc(a,l),c=Array.isArray(u)?u:[u];F(c.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),F(c.every(d=>d instanceof Mt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return c.forEach((d,p)=>{h[p]=()=>d}),h};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=Gs(),s=await this.backend.time(e);return s.wallMs=Gs()-n,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new LN;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}kh.nextTensorId=0;kh.nextVariableId=0;function $K(t){const e=CS(re(t),"float32");return j.makeTensor(e,t,"float32")}function NO(){const t=dO();if(t._tfengine==null){const e=new Zq(t);t._tfengine=new kh(e)}return sK(t._tfengine.ENV),CK(()=>t._tfengine),t._tfengine}const j=NO();function AK(t,e){const n={a:t,b:e};return j.runKernel(qh,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RK(){return typeof navigator<"u"&&navigator!=null}function $O(t){if(t||RK()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function AO(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ys=te();Ys.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Ys.registerFlag("IS_BROWSER",()=>AO());Ys.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Ys.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Ys.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Ys.registerFlag("PROD",()=>!1);Ys.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ys.getBool("DEBUG"));Ys.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Ys.registerFlag("IS_TEST",()=>!1);Ys.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Ys.getBool("DEBUG"));Ys.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Ys.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Ys.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kl(t,e){let n=t;if(ci(t))return e==="string"?[]:[t.length];if(CO(t)){const r=t.channels||"RGBA";return[t.height,t.width*r.length]}else if(kO(t))return[t.buffer.size/(e==null?4:a1(e))];if(!Array.isArray(t))return[];const s=[];for(;Array.isArray(n)||ci(n)&&e!=="string";)s.push(n.length),n=n[0];return Array.isArray(t)&&te().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&RO(t,s,[]),s}function RO(t,e,n){if(n=n||[],!Array.isArray(t)&&!ci(t)){F(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}F(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),F(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const s=e.slice(1);for(let r=0;r<t.length;++r)RO(t[r],s,n.concat(r))}function MN(t,e,n,s){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function L(t,e,n,s="numeric"){if(t instanceof ae())return MN(s,t.dtype,e,n),t;let r=Gh(t);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),MN(s,r,e,n),t==null||!ci(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const i=kl(t,r);!ci(t)&&!Array.isArray(t)&&(t=[t]);const a=r!=="string"?tc(t,r):Ou(t,[],!0);return j.makeTensor(a,i,r)}function f1(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((i,o)=>L(i,`${e}[${o}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DO="__op";function U(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+DO;const r=(...i)=>{j.startScope(n);try{const o=s(...i);return Du(o)&&console.error("Cannot return a Promise inside of tidy."),j.endScope(o),o}catch(o){throw j.endScope(null),o}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DK(t,e){const n=L(t,"real","complex"),s=L(e,"imag","complex");Ir(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:n,imag:s};return j.runKernel(DS,r)}const ul=U({complex_:DK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function El(t,e,n,s){if(s==null)s=Gh(t);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(kO(t)||CO(t)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return j.backend.createTensorFromGPUData(t,e||n,s)}if(!ci(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){zr(e);const r=re(e),i=re(n);F(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<n.length;++o){const a=n[o],l=o===n.length-1?a!==re(e.slice(o)):!0;F(n[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!ci(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=s!=="string"?tc(t,s):Ou(t,[],!0),j.makeTensor(t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Li(t,e,n){const s=kl(t,n);return El(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pu={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Xi{static join(e){return new Xi(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>ci(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=n+r.byteLength;this.shards.push({buffer:r,start:n,end:i}),n=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=n-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],h=e+a-u.start,d=a,f=Math.min(n,u.end)-u.start,m=new Uint8Array(u.buffer,h,f-h);if(o.set(m,d),a+=m.length,n<u.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(r){return e<r.start?-1:e>=r.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=OK(this.shards,n);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function OK(t,e){let n=0,s=t.length;for(;n<=s;){const r=Math.floor((s-n)/2)+n,i=e(t[r]);if(i===0)return r;i<0?s=r:n=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ao(){return j}function VN(){return j.memory()}function Y(t,e){return j.tidy(t,e)}function Ye(t){EO(t).forEach(n=>n.dispose())}function Un(t){return j.keep(t)}function PK(t){return j.setBackend(t)}function FK(){return j.ready()}function LK(){return j.backendName}function OO(t,e,n=1){return j.registerBackend(t,e,n)}function PO(){return j.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cl=4;async function ib(t,e){const n=[],s=[],r=Array.isArray(t)?t.map(o=>o.name):Object.keys(t);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(t)?t[o].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const c=new Promise(async h=>{const d=await l.bytes(),p=d.reduce((v,y)=>v+y.length,0)+cl*d.length,f=new Uint8Array(p);let m=0;for(let v=0;v<d.length;v++){const y=d[v],w=new Uint8Array(new Uint32Array([y.length]).buffer);f.set(w,m),m+=cl,f.set(y,m),m+=y.length}h(f)});s.push(c)}else s.push(l.data());e!=null&&(u.group=e),n.push(u)}const i=await Promise.all(s);return{data:zK(i),specs:n}}function FO(t,e){const n=new Xi(t),s={};let r=0;for(const i of e){const o=MK(i,(a,l)=>n.slice(r+a,r+l));s[i.name]=LO(i,n.slice(r,r+o)),r+=o}return s}function MK(t,e){const n=re(t.shape);let s;if("quantization"in t){const r=t.quantization;s=Pu[r.dtype]}else if(t.dtype==="string"){let r=0;for(let i=0;i<n;i++)r+=cl+new Uint32Array(e(r,r+cl))[0];return r}else s=Pu[t.dtype];return n*s}async function VK(t,e){const n=re(t.shape);let s;if("quantization"in t){const r=t.quantization;s=Pu[r.dtype]}else if(t.dtype==="string"){let r=0;for(let i=0;i<n;i++)r+=cl+new Uint32Array(await e(r,r+cl))[0];return r}else s=Pu[t.dtype];return n*s}function LO(t,e){const n=t.name,s=t.dtype,r=t.shape,i=re(r);let o,a=0;if("quantization"in t){const l=t.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${t.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${t.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${t.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=Pu[l.dtype],c=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(c.length);for(let h=0;h<c.length;h++){const d=c[h];o[h]=d*l.scale+l.min}}else if(l.dtype==="float16")o=HK()(c);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(c.length);for(let h=0;h<c.length;h++){const d=c[h];o[h]=Math.round(d*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=i*u}else if(s==="string"){const l=re(t.shape);o=[];for(let u=0;u<l;u++){const c=new Uint32Array(e.slice(a,a+cl))[0];a+=cl;const h=new Uint8Array(e.slice(a,a+c));o.push(h),a+=c}}else{const l=Pu[s];if(s==="float32")o=new Float32Array(e);else if(s==="int32")o=new Int32Array(e);else if(s==="bool")o=new Uint8Array(e);else if(s==="complex64"){o=new Float32Array(e);const u=new Float32Array(o.length/2),c=new Float32Array(o.length/2);for(let f=0;f<u.length;f++)u[f]=o[f*2],c[f]=o[f*2+1];const h=Li(u,r,"float32"),d=Li(c,r,"float32"),p=ul(h,d);return h.dispose(),d.dispose(),p}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=i*l}return Li(o,r,s)}async function zN(t,e,n){let s=new Uint8Array(e);for(;s.byteLength<n;){const{done:r,value:i}=await t.read();if(r&&i==null){const a=n-s.byteLength;throw new Error(`Reader is done but ${a} bytes are still expected`)}const o=new Uint8Array(s.length+i.byteLength);o.set(s,0),o.set(new Uint8Array(i),s.length),s=o}return s.buffer}async function MO(t,e){const n={},s=t.getReader();let r=new ArrayBuffer(0);for(const i of e){const o=await VK(i,async(u,c)=>(r=await zN(s,r,c),r.slice(u,c)));r=await zN(s,r,o);const a=r.slice(0,o);r=r.slice(o);const l=LO(i,a);if(n[i.name]=l,LK()==="webgpu"){const u=PO();"uploadToGPU"in u&&re(l.shape)>=te().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&u.uploadToGPU(l.dataId)}}return n}function zK(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(i=>{if(e+=i.byteLength,n.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return n.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const DT=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function BN(t){return DT?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function BK(t){if(DT)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,r=e.length;s<r;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function UK(t){if(DT){const s=Buffer.from(t,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function VO(t){return Xi.join(t)}function UN(t){const e="/";for(t=t.trim();t.endsWith(e);)t=t.slice(0,t.length-1);const n=t.split(e);return n[n.length-1]}function zO(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function BO(t,e,n){const s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(s.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=n}return t.signature!=null&&(s.signature=t.signature),t.userDefinedMetadata!=null&&(s.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(s.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(s.initializerSignature=t.initializerSignature),s}async function OT(t,e){let n,s;return t.weightsManifest!=null&&([n,s]=await e(t.weightsManifest)),BO(t,n,s)}function ym(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:BN(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:BN(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new Xi(t.weightData).byteLength}}function ob(t){const e=[];for(const n of t)e.push(...n.weights);return e}function WK(){const t=n=>{let s=n<<13,r=0;for(;!(s&8388608);)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function jK(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function GK(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function HK(){const t=WK(),e=jK(),n=GK();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const a=s[o],l=t[n[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return nn.instance==null&&(nn.instance=new nn),nn.instance}static registerSaveRouter(e){nn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){nn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return nn.getHandlers(e,"save")}static getLoadHandlers(e,n){return nn.getHandlers(e,"load",n)}static getHandlers(e,n,s){const r=[];return(n==="load"?nn.getInstance().loadRouters:nn.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}}const qK=t=>nn.registerSaveRouter(t),KK=t=>nn.registerLoadRouter(t),UO=t=>nn.getSaveHandlers(t),XK=(t,e)=>nn.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ab="tensorflowjs",lb=1,cu="models_store",Ma="model_info_store";function WO(){if(!te().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function ub(t){const e=t.result;e.createObjectStore(cu,{keyPath:"modelPath"}),e.createObjectStore(Ma,{keyPath:"modelPath"})}class Fu{constructor(e){if(this.indexedDB=WO(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((s,r)=>{const i=this.indexedDB.open(ab,lb);i.onupgradeneeded=()=>ub(i),i.onsuccess=()=>{const o=i.result;if(n==null){const a=o.transaction(cu,"readonly"),u=a.objectStore(cu).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=c=>(o.close(),r(u.error)),a.oncomplete=()=>o.close()}else{n.weightData=Xi.join(n.weightData);const a=ym(n),l=o.transaction(Ma,"readwrite");let u=l.objectStore(Ma),c;try{c=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(d){return r(d)}let h;c.onsuccess=()=>{h=o.transaction(cu,"readwrite");const d=h.objectStore(cu);let p;try{p=d.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(f){return r(f)}p.onsuccess=()=>s({modelArtifactsInfo:a}),p.onerror=f=>{u=l.objectStore(Ma);const m=u.delete(this.modelPath);m.onsuccess=()=>(o.close(),r(p.error)),m.onerror=v=>(o.close(),r(p.error))}},c.onerror=d=>(o.close(),r(c.error)),l.oncomplete=()=>{h==null?o.close():h.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}Fu.URL_SCHEME="indexeddb://";const jO=t=>te().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Fu.URL_SCHEME)?YK(t.slice(Fu.URL_SCHEME.length)):null;nn.registerSaveRouter(jO);nn.registerLoadRouter(jO);function YK(t){return new Fu(t)}function QK(t){return t.startsWith(Fu.URL_SCHEME)?t.slice(Fu.URL_SCHEME.length):t}class JK{constructor(){this.indexedDB=WO()}async listModels(){return new Promise((e,n)=>{const s=this.indexedDB.open(ab,lb);s.onupgradeneeded=()=>ub(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(Ma,"readonly"),a=i.objectStore(Ma).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),n(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>n(s.error)})}async removeModel(e){return e=QK(e),new Promise((n,s)=>{const r=this.indexedDB.open(ab,lb);r.onupgradeneeded=()=>ub(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(Ma,"readwrite"),a=o.objectStore(Ma),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const c=a.delete(e),h=()=>{u=i.transaction(cu,"readwrite");const p=u.objectStore(cu).delete(e);p.onsuccess=()=>n(l.result.modelArtifactsInfo),p.onerror=f=>s(l.error)};c.onsuccess=h,c.onerror=d=>(h(),i.close(),s(l.error))}},l.onerror=c=>(i.close(),s(l.error)),o.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vo="/",Rc="tensorflowjs_models",GO="info",ZK="model_topology",eX="weight_specs",tX="weight_data",nX="model_metadata";function HO(t){return{info:[Rc,t,GO].join(Vo),topology:[Rc,t,ZK].join(Vo),weightSpecs:[Rc,t,eX].join(Vo),weightData:[Rc,t,tX].join(Vo),modelMetadata:[Rc,t,nX].join(Vo)}}function qO(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function sX(t){const e=t.split(Vo);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(Vo)}function rX(t){return t.startsWith(Lu.URL_SCHEME)?t.slice(Lu.URL_SCHEME.length):t}class Lu{constructor(e){if(!te().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=HO(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=ym(e),i=Xi.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,BK(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw qO(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=UK(o),n}}Lu.URL_SCHEME="localstorage://";const KO=t=>te().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Lu.URL_SCHEME)?iX(t.slice(Lu.URL_SCHEME.length)):null;nn.registerSaveRouter(KO);nn.registerLoadRouter(KO);function iX(t){return new Lu(t)}class oX{constructor(){F(te().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),F(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=Rc+Vo,s=Vo+GO;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(n)&&i.endsWith(s)){const o=sX(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=rX(e);const n=HO(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(n.info));return qO(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oh="://";class _s{constructor(){this.managers={}}static getInstance(){return _s.instance==null&&(_s.instance=new _s),_s.instance}static registerManager(e,n){F(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(oh)&&(e=e.slice(0,e.indexOf(oh))),F(e.length>0,()=>"scheme must not be an empty string.");const s=_s.getInstance();F(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=n}static getManager(e){const n=_s.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(_s.getInstance().managers)}}function dy(t){if(t.indexOf(oh)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${_s.getSchemes().join(",")}`);return{scheme:t.split(oh)[0],path:t.split(oh)[1]}}async function XO(t,e,n=!1){F(t!==e,()=>`Old path and new path are the same: '${t}'`);const s=nn.getLoadHandlers(t);F(s.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),F(s.length<2,()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${t}.`);const r=s[0],i=nn.getSaveHandlers(e);F(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),F(i.length<2,()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${e}.`);const o=i[0],a=dy(t).scheme,l=dy(t).path,u=a===dy(t).scheme,c=await r.load();n&&u&&await _s.getManager(a).removeModel(l);const h=await o.save(c);return n&&!u&&await _s.getManager(a).removeModel(l),h.modelArtifactsInfo}async function aX(){const t=_s.getSchemes(),e={};for(const n of t){const s=await _s.getManager(n).listModels();for(const r in s){const i=n+oh+r;e[i]=s[r]}}return e}async function lX(t){const e=dy(t);return _s.getManager(e.scheme).removeModel(e.path)}async function uX(t,e){return XO(t,e,!1)}async function cX(t,e){return XO(t,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hX{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!te().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return mO(e)}}if(te().get("IS_BROWSER")){te().setPlatform("browser",new hX);try{_s.registerManager(Lu.URL_SCHEME,new oX)}catch{}try{_s.registerManager(Fu.URL_SCHEME,new JK)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dX={importFetch:()=>require("node-fetch")};let ux;class pX{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return te().global.fetch!=null?te().global.fetch(e,n):(ux==null&&(ux=dX.importFetch()),ux(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}te().get("IS_NODE")&&!te().get("IS_BROWSER")&&te().setPlatform("node",new pX);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tt(t,e="float32",n){return e=e||"float32",zr(t),new Rn(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fX(t,e){const n=L(t,"x","cast");if(!Xq(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},r={dtype:e};return j.runKernel(Nf,s,r)}const Se=U({cast_:fX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mX(t){const n={x:L(t,"x","clone","string_or_numeric")};return j.runKernel(Uf,n)}const Ko=U({clone_:mX});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YO(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */NO();const gX={buffer:tt,cast:Se,clone:Ko,print:YO};kK(gX);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yX(t,e){let n=L(t,"a","add"),s=L(e,"b","add");[n,s]=pn(n,s);const r={a:n,b:s};return j.runKernel(qh,r)}const fe=U({add_:yX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vX(t,e){let n=L(t,"a","floorDiv"),s=L(e,"b","floorDiv");[n,s]=pn(n,s);const r={a:n,b:s};return j.runKernel(zf,r)}const PT=U({floorDiv_:vX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wX(t,e){let n=L(t,"a","div"),s=L(e,"b","div");if([n,s]=pn(n,s),n.dtype==="int32"&&s.dtype==="int32")return PT(n,s);const r={a:n,b:s},i={};return j.runKernel(Of,r,i)}const _e=U({div_:wX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xX(t,e){let n=L(t,"a","mul"),s=L(e,"b","mul");[n,s]=pn(n,s);const r={a:n,b:s};return j.runKernel(Qf,r)}const W=U({mul_:xX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bX(t){const e=L(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return j.runKernel(k0,n)}else{const n={x:e};return j.runKernel(y0,n)}}const kn=U({abs_:bX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IX(t){const n={x:L(t,"x","acos")};return j.runKernel(If,n)}const QO=U({acos_:IX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SX(t){const n={x:L(t,"x","acosh")};return j.runKernel(Sf,n)}const JO=U({acosh_:SX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TX(t){F(Array.isArray(t),()=>"The argument passed to tf.addN() must be a list of tensors"),F(t.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`);const e=t.map((r,i)=>L(r,`tensors${i}`,"addN")),n=e[0];e.forEach(r=>{if(r.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(r=>{if(!ut(r.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const s=e;return j.runKernel(v0,s)}const CX=U({addN_:TX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kX(t,e=null,n=!1){const r={x:L(t,"x","all","bool")},i={axis:e,keepDims:n};return j.runKernel(ES,r,i)}const FT=U({all_:kX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EX(t,e=null,n=!1){const r={x:L(t,"x","any","bool")},i={axis:e,keepDims:n};return j.runKernel(_S,r,i)}const m1=U({any_:EX});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _X(t,e=0){const s={x:L(t,"x","argMax")},r={axis:e};return j.runKernel(w0,s,r)}const Eh=U({argMax_:_X});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NX(t,e=0){const s={x:L(t,"x","argMin")},r={axis:e};return j.runKernel(x0,s,r)}const ZO=U({argMin_:NX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $X(t){const n={x:L(t,"x","asin")};return j.runKernel(Tf,n)}const eP=U({asin_:$X});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AX(t){const n={x:L(t,"x","asinh")};return j.runKernel(Cf,n)}const tP=U({asinh_:AX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RX(t){const n={x:L(t,"x","atan")};return j.runKernel(kf,n)}const nP=U({atan_:RX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DX(t,e){let n=L(t,"a","atan2"),s=L(e,"b","atan2");[n,s]=pn(n,s);const r={a:n,b:s};return j.runKernel(_f,r)}const sP=U({atan2_:DX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OX(t){const n={x:L(t,"x","atanh")};return j.runKernel(Ef,n)}const rP=U({atanh_:OX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vm(t,e,n,s,r="NHWC",i){const o=t[3],a=[...e,o],l=ca(r);return jn(t,a,n,i,s,null,null,l)}function pi(t,e,n,s,r,i,o="channelsLast"){const[a,l]=jp(e);let u;if(o==="channelsLast")u=[a,l,t[3],t[3]];else if(o==="channelsFirst")u=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return jn(t,u,n,s,r,i,!1,o)}function ua(t,e,n,s,r,i,o="NDHWC"){const[a,l,u]=cb(e);let c,h;if(o==="NDHWC")h="channelsLast",c=[a,l,u,t[4],t[4]];else if(o==="NCDHW")h="channelsFirst",c=[a,l,u,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return _l(t,c,n,s,r,!1,h,i)}function jn(t,e,n,s,r,i,o=!1,a="channelsLast"){let[l,u,c,h]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,c,h]=t;else if(a==="channelsFirst")[l,h,u,c]=t;else throw new Error(`Unknown dataFormat ${a}`);const[d,p,,f]=e,[m,v]=jp(n),[y,w]=jp(s),b=ah(d,y),I=ah(p,w),{padInfo:k,outHeight:R,outWidth:C}=LX(r,u,c,m,v,b,I,i,a),T=o?f*h:f;let N;return a==="channelsFirst"?N=[l,T,R,C]:a==="channelsLast"&&(N=[l,R,C,T]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:c,inChannels:h,outHeight:R,outWidth:C,outChannels:T,padInfo:k,strideHeight:m,strideWidth:v,filterHeight:d,filterWidth:p,effectiveFilterHeight:b,effectiveFilterWidth:I,dilationHeight:y,dilationWidth:w,inShape:t,outShape:N,filterShape:e}}function _l(t,e,n,s,r,i=!1,o="channelsLast",a){let[l,u,c,h,d]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,u,c,h,d]=t;else if(o==="channelsFirst")[l,d,u,c,h]=t;else throw new Error(`Unknown dataFormat ${o}`);const[p,f,m,,v]=e,[y,w,b]=cb(n),[I,k,R]=cb(s),C=ah(p,I),T=ah(f,k),N=ah(m,R),{padInfo:$,outDepth:P,outHeight:V,outWidth:O}=MX(r,u,c,h,y,w,b,C,T,N,a),Q=i?v*d:v;let Z;return o==="channelsFirst"?Z=[l,Q,P,V,O]:o==="channelsLast"&&(Z=[l,P,V,O,Q]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:c,inWidth:h,inChannels:d,outDepth:P,outHeight:V,outWidth:O,outChannels:Q,padInfo:$,strideDepth:y,strideHeight:w,strideWidth:b,filterDepth:p,filterHeight:f,filterWidth:m,effectiveFilterDepth:C,effectiveFilterHeight:T,effectiveFilterWidth:N,dilationDepth:I,dilationHeight:k,dilationWidth:R,inShape:t,outShape:Z,filterShape:e}}function PX(t,e,n,s,r){s==null&&(s=LT(t,e,n));const i=t[0],o=t[1],a=Gp((i-e+2*s)/n+1,r),l=Gp((o-e+2*s)/n+1,r);return[a,l]}function FX(t,e,n,s,r,i){r==null&&(r=LT(t,e[0],s[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*r>=e[a]&&(o[a]=Gp((t[a]-e[a]+2*r)/s[a]+1,i));return o}function LT(t,e,n,s=1){const r=ah(e,s);return Math.floor((t[0]*(n-1)-n+r)/2)}function jp(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function cb(t){return typeof t=="number"?[t,t,t]:t}function ah(t,e){return e<=1?t:t+(t-1)*(e-1)}function LX(t,e,n,s,r,i,o,a,l){let u,c,h;if(typeof t=="number"){u={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const p=PX([e,n],i,s,t,a);c=p[0],h=p[1]}else if(t==="same"){c=Math.ceil(e/s),h=Math.ceil(n/r);const d=Math.max(0,(c-1)*s+i-e),p=Math.max(0,(h-1)*r+o-n),f=Math.floor(d/2),m=d-f,v=Math.floor(p/2),y=p-v;u={top:f,bottom:m,left:v,right:y,type:"SAME"}}else if(t==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/s),h=Math.ceil((n-o+1)/r);else if(typeof t=="object"){const d=l==="channelsLast"?t[1][0]:t[2][0],p=l==="channelsLast"?t[1][1]:t[2][1],f=l==="channelsLast"?t[2][0]:t[3][0],m=l==="channelsLast"?t[2][1]:t[3][1];u={top:d,bottom:p,left:f,right:m,type:d===0&&p===0&&f===0&&m===0?"VALID":"EXPLICIT"},c=Gp((e-i+d+p)/s+1,a),h=Gp((n-o+f+m)/r+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:u,outHeight:c,outWidth:h}}function MX(t,e,n,s,r,i,o,a,l,u,c){let h,d,p,f;if(t==="valid"&&(t=0),typeof t=="number"){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const v=FX([e,n,s,1],[a,l,u],1,[r,i,o],t,c);d=v[0],p=v[1],f=v[2]}else if(t==="same"){d=Math.ceil(e/r),p=Math.ceil(n/i),f=Math.ceil(s/o);const m=(d-1)*r+a-e,v=(p-1)*i+l-n,y=(f-1)*o+u-s,w=Math.floor(m/2),b=m-w,I=Math.floor(v/2),k=v-I,R=Math.floor(y/2),C=y-R;h={top:I,bottom:k,left:R,right:C,front:w,back:b,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:h,outDepth:d,outHeight:p,outWidth:f}}function Gp(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function hl(t){const[e,n,s]=jp(t);return e===1&&n===1&&s===1}function ss(t,e){return hl(t)||hl(e)}function Mu(t){return jp(t).every(e=>e>0)}function ca(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function Ls(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")F(Th(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{F(Th(r),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${r}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VX(t,e){const s={x:L(t,"x","reshape","string_or_numeric")},r={shape:e};return j.runKernel(ov,s,r)}const H=U({reshape_:VX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zX(t,e,n,s,r){const i=L(t,"x","avgPool","float32"),o=1;F(ss(n,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=H(i,[1,i.shape[0],i.shape[1],i.shape[2]])),F(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Ls("avgPool",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r};let h=j.runKernel(b0,u,c);return h=Se(h,i.dtype),l?H(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const bv=U({avgPool_:zX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BX(t,e,n,s,r,i="NDHWC"){const o=L(t,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=H(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),F(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),F(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),F(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),Ls("avgPool3d",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:i};let h=j.runKernel(I0,u,c);return h=Se(h,a.dtype),l?H(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const iP=U({avgPool3d_:BX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UX(t,e=0){F(t.length>=1,()=>"Pass at least one tensor to concat");const n=f1(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),n.length===1)return Ko(n[0]);const s=n,r={axis:e};return j.runKernel(E0,s,r)}const hn=U({concat_:UX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WX(t,e,n=!1,s=!1){let r=L(t,"a","matMul"),i=L(e,"b","matMul");[r,i]=pn(r,i);const o={a:r,b:i},a={transposeA:n,transposeB:s};return j.runKernel(S0,o,a)}const it=U({matMul_:WX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jX(t){const n={x:L(t,"x","sigmoid","float32")};return j.runKernel(lm,n)}const Mi=U({sigmoid_:jX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GX(t,e,n){const s=L(t,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:n};return j.runKernel(hv,r,i)}const je=U({slice_:GX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HX(t){const n={x:L(t,"x","tanh","float32")};return j.runKernel(fm,n)}const Vu=U({tanh_:HX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qX(t,e,n,s,r,i){const o=L(t,"forgetBias","basicLSTMCell"),a=L(e,"lstmKernel","basicLSTMCell"),l=L(n,"lstmBias","basicLSTMCell"),u=L(s,"data","basicLSTMCell"),c=L(r,"c","basicLSTMCell"),h=L(i,"h","basicLSTMCell"),d=hn([u,h],1),p=it(d,a),f=fe(p,l),m=f.shape[0],v=f.shape[1]/4,y=[m,v],w=je(f,[0,0],y),b=je(f,[0,v],y),I=je(f,[0,v*2],y),k=je(f,[0,v*3],y),R=fe(W(Mi(w),Vu(b)),W(c,Mi(fe(o,I)))),C=W(Vu(R),Mi(k));return[R,C]}const KX=U({basicLSTMCell_:qX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XX(t,e,n){const s=L(t,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);F(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),F(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),F(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:n};return j.runKernel(T0,i,o)}const Iv=U({batchToSpaceND_:XX});function YX(t){let e;return t.rank===0||t.rank===1?e=H(t,[1,1,1,t.size]):t.rank===2?e=H(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=H(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QX(t,e,n,s,r,i){i==null&&(i=.001);const o=L(t,"x","batchNorm"),a=L(e,"mean","batchNorm"),l=L(n,"variance","batchNorm");let u;r!=null&&(u=L(r,"scale","batchNorm"));let c;s!=null&&(c=L(s,"offset","batchNorm")),F(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),F(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),F(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const d={x:YX(o),scale:u,offset:c,mean:a,variance:l},p={varianceEpsilon:i},f=j.runKernel(F0,d,p);return H(f,o.shape)}const wm=U({batchNorm_:QX});function JX(t,e,n,s,r,i){const o=L(t,"x","batchNorm"),a=L(e,"mean","batchNorm"),l=L(n,"variance","batchNorm");let u;r!=null&&(u=L(r,"scale","batchNorm"));let c;return s!=null&&(c=L(s,"offset","batchNorm")),F(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),F(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),F(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&F(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),c!=null&&F(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),wm(o,a,l,c,u,i)}const oP=U({batchNorm2d_:JX});function ZX(t,e,n,s,r,i){const o=L(t,"x","batchNorm"),a=L(e,"mean","batchNorm"),l=L(n,"variance","batchNorm");let u;r!=null&&(u=L(r,"scale","batchNorm"));let c;return s!=null&&(c=L(s,"offset","batchNorm")),F(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),F(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),F(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&F(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),c!=null&&F(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),wm(o,a,l,c,u,i)}const aP=U({batchNorm3d_:ZX});function eY(t,e,n,s,r,i){const o=L(t,"x","batchNorm"),a=L(e,"mean","batchNorm"),l=L(n,"variance","batchNorm");let u;r!=null&&(u=L(r,"scale","batchNorm"));let c;return s!=null&&(c=L(s,"offset","batchNorm")),F(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),F(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),F(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&F(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),c!=null&&F(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),wm(o,a,l,c,u,i)}const lP=U({batchNorm4d_:eY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tY(t,e,n){const s=L(t,"x","bincount"),r=L(e,"weights","bincount");F(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),F(n>=0,()=>`size must be non-negative, but got ${n}.`),F(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:n};return j.runKernel(AS,i,o)}const uP=U({bincount_:tY});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nY(t,e){const n=L(t,"x","bitwiseAnd"),s=L(e,"y","bitwiseAnd");if(!ut(n.shape,s.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${s.shape}`);if(n.dtype!=="int32"||s.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${s.dtype}`);const r={a:n,b:s};return j.runKernel(C0,r)}const sY=U({bitwiseAnd_:nY});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rY(t,e){const n=L(t,"s0","broadcastArgs","int32"),s=L(e,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(s.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${s.rank}`);const r={s0:n,s1:s};return j.runKernel(RS,r)}const iY=U({broadcastArgs_:rY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oY(t,e){let n=L(t,"broadcastTo","x");const s=n.shape;if(zr(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const u=n.shape.slice();for(;u.length<e.length;)u.unshift(1);n=H(n,u)}const r=n.shape,i=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])i[u]=1;else if(n.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((u,c)=>u>1?c:-1).filter(u=>u>=0).length===0)return Ko(n);const a={x:n},l={reps:i};return j.runKernel(mm,a,l)}const lh=U({broadcastTo_:oY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aY(t){const n={x:L(t,"x","ceil","float32")};return j.runKernel($f,n)}const cP=U({ceil_:aY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kh(t,e,n){zr(t),n=n||Gh(e);const s={shape:t,value:e,dtype:n};return j.runKernel(qS,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lY(t,e,n){const s=L(t,"x","clipByValue");if(F(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return Kh(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:n};return j.runKernel(Af,r,i)}const Qs=U({clipByValue_:lY});function uY(t){return hn(t,0)}const hP=U({concat1d_:uY});function cY(t,e){return hn(t,e)}const dP=U({concat2d_:cY});function hY(t,e){return hn(t,e)}const pP=U({concat3d_:hY});function dY(t,e){return hn(t,e)}const fP=U({concat4d_:dY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pY(t,e,n,s,r="NHWC",i=[1,1],o){const a=L(t,"x","conv2d","float32"),l=L(e,"filter","conv2d","float32");let u=a,c=!1;a.rank===3&&(c=!0,u=H(a,[1,a.shape[0],a.shape[1],a.shape[2]])),F(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),F(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Ls("conv2d",s,o);const h=r==="NHWC"?u.shape[3]:u.shape[1];F(h===l.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${l.shape[2]}.`),F(ss(n,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),F(Mu(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),F(Mu(n),()=>"Error in conv2D: Strides should be larger than 0.");const d={x:u,filter:l},p={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},f=j.runKernel(_0,d,p);return c?H(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const dl=U({conv2d_:pY});function fY(t,e,n,s,r="NWC",i=1,o){const a=L(t,"x","conv1d"),l=L(e,"filter","conv1d");let u=a,c=!1;a.rank===2&&(c=!0,u=H(a,[1,a.shape[0],a.shape[1]])),F(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),F(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Ls("conv1d",s,o),F(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),F(ss(n,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${i}'`),F(Mu(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),F(Mu(n),()=>"Error in conv1D: Stride should be larger than 0."),F(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const h=H(l,[1,l.shape[0],l.shape[1],l.shape[2]]),d=H(u,[u.shape[0],1,u.shape[1],u.shape[2]]),v=dl(d,h,[1,n],s,"NHWC",[1,i],o);return c?H(v,[v.shape[2],v.shape[3]]):H(v,[v.shape[0],v.shape[2],v.shape[3]])}const MT=U({conv1d_:fY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mY(t,e,n,s,r,i="NHWC",o){F(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,u=!1;e.rank===3&&(u=!0,l=H(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),F(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),F(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),F(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const c=i==="NHWC"?a[3]:a[1],h=i==="NHWC"?l.shape[3]:l.shape[1];F(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),F(h===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`),Ls("conv2dDerInput",r,o);const d={dy:l,filter:n},p={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},f=j.runKernel(N0,d,p);return u?H(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const VT=U({conv2DBackpropInput_:mY});function gY(t,e,n,s,r,i){const o=L(t,"x","conv2dTranspose"),a=L(e,"filter","conv2dTranspose");return VT(n,o,a,s,r,"NHWC",i)}const zT=U({conv2dTranspose_:gY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yY(t,e,n,s,r="NDHWC",i=[1,1,1]){const o=L(t,"x","conv3d"),a=L(e,"filter","conv3d");let l=o,u=!1;o.rank===4&&(u=!0,l=H(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),F(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),F(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),F(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),F(ss(n,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),F(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),F(Mu(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),F(Mu(n),()=>"Error in conv3D: Strides should be larger than 0.");const c={x:l,filter:a},h={strides:n,pad:s,dataFormat:r,dilations:i},d=j.runKernel($0,c,h);return u?H(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const mP=U({conv3d_:yY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vY(t,e,n,s,r){F(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let i=t,o=e,a=!1;e.rank===4&&(a=!0,o=H(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,t[0],t[1],t[2],t[3]]);const l=i[4],u=o.shape[4];F(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),F(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),F(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),F(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),F(u===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${n.shape[4]}.`);const c={dy:o,filter:n},h={pad:r,strides:s,inputShape:i},d=j.runKernel(FS,c,h);return a?H(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const gP=U({conv3DBackpropInput_:vY});function wY(t,e,n,s,r){const i=L(t,"x","conv3dTranspose"),o=L(e,"filter","conv3dTranspose");return gP(n,i,o,s,r)}const yP=U({conv3dTranspose_:wY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xY(t){const n={x:L(t,"x","cos","float32")};return j.runKernel(Rf,n)}const Sv=U({cos_:xY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bY(t){const n={x:L(t,"x","cosh","float32")};return j.runKernel(Df,n)}const BT=U({cosh_:bY});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IY(t,e=0,n=!1,s=!1){const i={x:L(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:s};return j.runKernel(LS,i,o)}const g1=U({cumprod_:IY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SY(t,e=0,n=!1,s=!1){const i={x:L(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:s};return j.runKernel(A0,i,o)}const UT=U({cumsum_:SY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TY(t,e,n,s=!1){const r=L(t,"x","denseBincount"),i=L(e,"weights","denseBincount");F(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),F(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),F(n>=0,()=>`size must be non-negative, but got ${n}.`),F(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:n,binaryOutput:s};return j.runKernel(VS,o,a)}const hb=U({denseBincount_:TY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CY(t,e,n="NHWC"){const s=L(t,"x","depthToSpace","float32"),r=n==="NHWC"?s.shape[1]:s.shape[2],i=n==="NHWC"?s.shape[2]:s.shape[3],o=n==="NHWC"?s.shape[3]:s.shape[1];F(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),F(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),F(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),F(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:n};return j.runKernel(zS,a,l)}const vP=U({depthToSpace_:CY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kY(t,e,n,s,r="NHWC",i=[1,1],o){const a=L(t,"x","depthwiseConv2d","float32"),l=L(e,"filter","depthwiseConv2d","float32");let u=a,c=!1;a.rank===3&&(c=!0,u=H(a,[1,a.shape[0],a.shape[1],a.shape[2]])),F(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),F(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const h=r==="NHWC"?u.shape[3]:u.shape[1];F(h===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${l.shape[2]}.`),Ls("depthwiseConv2d",s,o);const d={x:u,filter:l},p={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},f=j.runKernel(R0,d,p);return c?H(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const xm=U({depthwiseConv2d_:kY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EY(t){const n={x:L(t,"x","diag")};return j.runKernel(WS,n)}const _Y=U({diag_:EY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NY(t,e,n,s,r=[1,1],i="NHWC"){const o=L(t,"x","dilation2d"),a=L(e,"filter","dilation2d");F(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),F(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),F(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,u=!1;o.rank===3&&(l=H(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),F(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const c={x:l,filter:a},h={strides:n,pad:s,dilations:r},d=j.runKernel(D0,c,h);return u?H(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const wP=U({dilation2d_:NY});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _h(t,e){const n=t.length,s=[];for(let r=0;r<n;r++){const i=n-1-r,o=t[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function Pn(t,e){const n=[];for(let s=0;s<e.length;s++){const r=t[t.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&n.unshift(i)}return n}function Qe(t,e){const n=Math.max(t.length,e.length),s=new Array(n);for(let r=0;r<n;r++){let i=t[t.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[n-r-1]=o;else if(o===1)s[n-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else s[n-r-1]=i}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Y(t,e){let n=L(t,"a","equal","string_or_numeric"),s=L(e,"b","equal","string_or_numeric");[n,s]=pn(n,s),Qe(n.shape,s.shape);const r={a:n,b:s};return j.runKernel(O0,r)}const Wi=U({equal_:$Y});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AY(t,e,n){const s=L(e,"a","where"),r=L(n,"b","where"),i=L(t,"condition","where","bool"),o=Qe(Qe(i.shape,s.shape),r.shape),a=lh(i,o),l=lh(s,o),u=lh(r,o),c={condition:a,t:l,e:u};return j.runKernel(cv,c)}const ys=U({where_:AY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RY(t){const n={x:L(t,"x","zerosLike")};return j.runKernel(wv,n)}const ft=U({zerosLike_:RY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DY(t,e){let n=L(t,"a","div"),s=L(e,"b","div");[n,s]=pn(n,s);const r=_e(n,s),i=ft(r),o=Wi(s,i);return ys(o,i,r)}const xP=U({divNoNan_:DY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OY(t,e){const n=L(t,"t1","dot"),s=L(e,"t2","dot");F((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const r=n.rank===1?n.size:n.shape[1],i=s.rank===1?s.size:s.shape[0];if(F(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),n.rank===1&&s.rank===1){const o=H(n,[1,-1]),a=H(s,[-1,1]),l=it(o,a);return H(l,[])}else if(n.rank===1&&s.rank===2){const o=H(n,[1,-1]),a=H(s,[s.shape[0],s.shape[1]]),l=it(o,a);return H(l,[l.size])}else if(n.rank===2&&s.rank===1){const o=H(s,[-1,1]),a=it(n,o);return H(a,[a.size])}else{const o=H(s,[s.shape[0],s.shape[1]]);return it(n,o)}}const bP=U({dot_:OY});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PY(t,...e){const n=e.map((r,i)=>L(r,`tensors${i}`,"einsum")),s={equation:t};return j.runKernel(jS,n,s)}const Dc=U({einsum_:PY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FY(t){const n={x:L(t,"x","elu","float32")};return j.runKernel(Pf,n)}const bm=U({elu_:FY});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LY(t,e){const n=L(t,"x","ensureShape","string_or_numeric");if(!qq(n.shape,e))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${e}`);return t}const MY=U({ensureShape_:LY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VY(t){let e=L(t,"x","erf");F(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Se(e,"float32"));const n={x:e};return j.runKernel(Ff,n)}const WT=U({erf_:VY});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jT(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function IP(t,e,n){const s=t.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)n.indexOf(a)===-1?r.push(t[i++]):r.push(e[o++]);return r}function Gn(t,e){const n=[],s=t.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&n.push(t[i]);const r=e.map(i=>t[i]);return[n,r]}function wn(t,e){const n=e.map(s=>1);return IP(t,n,e)}function rs(t,e,n){F(jT(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function on(t,e){if(jT(t,e))return null;const n=[];for(let s=0;s<e;++s)t.indexOf(s)===-1&&n.push(s);return t.forEach(s=>n.push(s)),n}function Nl(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function xn(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zY(t,e=null,n=!1){const r={x:L(t,"x","max")},i={reductionIndices:e,keepDims:n};return j.runKernel(H0,r,i)}const ai=U({max_:zY});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BY(t,e=null,n=!1){const r={x:L(t,"x","min")},i={axis:e,keepDims:n};return j.runKernel(Y0,r,i)}const Hp=U({min_:BY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UY(t,e){let n=L(t,"base","pow"),s=L(e,"exp","pow");[n,s]=pn(n,s);const r={a:n,b:s};return j.runKernel(Jf,r)}const na=U({pow_:UY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Be(t,e){if((ci(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ci(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return El(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WY(t){const n={x:L(t,"x","sqrt","float32")};return j.runKernel(cm,n)}const ns=U({sqrt_:WY});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jY(t){const e=L(t,"x","square"),n={};return j.runKernel("Square",{x:e},n)}const Vt=U({square_:jY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GY(t,e=null,n=!1){let s=L(t,"x","sum");s.dtype==="bool"&&(s=Se(s,"int32"));const r={x:s},i={axis:e,keepDims:n};return j.runKernel(dv,r,i)}const De=U({sum_:GY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HY(t,e="euclidean",n=null,s=!1){t=L(t,"x","norm");const r=SP(t,e,n);let i=r.shape;if(s){const o=st(n,t.shape);i=wn(r.shape,o)}return H(r,i)}function SP(t,e,n=null){if(t.rank===0)return kn(t);if(t.rank!==1&&n===null)return SP(H(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return De(kn(t),n);if(e===1/0)return ai(kn(t),n);if(e===-1/0)return Hp(kn(t),n);if(e==="euclidean"||e===2)return ns(De(na(kn(t),Be(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return ai(De(kn(t),n[0]),n[1]-1);if(e===1/0)return ai(De(kn(t),n[1]),n[0]);if(e===-1/0)return Hp(De(kn(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return ns(De(Vt(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Im=U({norm_:HY});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qY(t,e=null,n=!1){return Im(t,"euclidean",e,n)}const TP=U({euclideanNorm_:qY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KY(t){const n={x:L(t,"x","exp")};return j.runKernel(Lf,n)}const Ps=U({exp_:KY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XY(t,e=0){const n=L(t,"x","expandDims","string_or_numeric");F(e<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},r={dim:e};return j.runKernel(P0,s,r)}const Xn=U({expandDims_:XY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YY(t){const n={x:L(t,"x","expm1")};return j.runKernel(Mf,n)}const CP=U({expm1_:YY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QY(t,e){const n=L(t,"x","tile","string_or_numeric");F(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const s={x:n},r={reps:e};return j.runKernel(mm,s,r)}const ti=U({tile_:QY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JY(t,e,n,s="float32"){e==null&&(e=t);const r=tt([t,e],s),i=t<=e?t:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=H(r.toTensor(),[t,e]);if(n==null)return o;if(n.length===1)return ti(Xn(o,0),[n[0],1,1]);if(n.length===2)return ti(Xn(Xn(o,0),0),[n[0],n[1],1,1]);if(n.length===3)return ti(Xn(Xn(Xn(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const GT=U({eye_:JY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZY(t){const n={x:L(t,"x","floor","float32")};return j.runKernel(Vf,n)}const Sm=U({floor_:ZY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eQ(t,e,n=0,s=0){const r=L(t,"x","gather"),i=L(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:n,batchDims:s};return j.runKernel(L0,o,a)}const Tm=U({gather_:eQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tQ(t,e){let n=L(t,"a","greater","string_or_numeric"),s=L(e,"b","greater","string_or_numeric");[n,s]=pn(n,s),Qe(n.shape,s.shape);const r={a:n,b:s};return j.runKernel(M0,r)}const Tr=U({greater_:tQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nQ(t,e){let n=L(t,"a","greaterEqual","string_or_numeric"),s=L(e,"b","greaterEqual","string_or_numeric");[n,s]=pn(n,s),Qe(n.shape,s.shape);const r={a:n,b:s};return j.runKernel(Bf,r)}const $l=U({greaterEqual_:nQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sQ(t){const n={input:L(t,"input","imag")};return j.runKernel(QS,n)}const Tv=U({imag_:sQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rQ(t){const n={x:L(t,"x","isFinite")};return j.runKernel(Wf,n)}const kP=U({isFinite_:rQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iQ(t){const n={x:L(t,"x","isInf")};return j.runKernel(jf,n)}const EP=U({isInf_:iQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oQ(t){const n={x:L(t,"x","isNaN")};return j.runKernel(Gf,n)}const _P=U({isNaN_:oQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aQ(t,e=.2){const s={x:L(t,"x","leakyRelu")},r={alpha:e};return j.runKernel(V0,s,r)}const Cv=U({leakyRelu_:aQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lQ(t,e){let n=L(t,"a","less","string_or_numeric"),s=L(e,"b","less","string_or_numeric");[n,s]=pn(n,s),Qe(n.shape,s.shape);const r={a:n,b:s};return j.runKernel(z0,r)}const qp=U({less_:lQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uQ(t,e){let n=L(t,"a","lessEqual","string_or_numeric"),s=L(e,"b","lessEqual","string_or_numeric");[n,s]=pn(n,s),Qe(n.shape,s.shape);const r={a:n,b:s};return j.runKernel(B0,r)}const nc=U({lessEqual_:uQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cQ(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const s={start:t,stop:e,num:n};return j.runKernel(JS,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hQ(t,e=5,n=1,s=1,r=.5){const i=L(t,"x","localResponseNormalization");F(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),F(Th(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=H(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},u={depthRadius:e,bias:n,alpha:s,beta:r},c=j.runKernel(G0,l,u);return a?H(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const NP=U({localResponseNormalization_:hQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dQ(t){const n={x:L(t,"x","log","float32")};return j.runKernel(Hf,n)}const Fr=U({log_:dQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pQ(t){const n={x:L(t,"x","log1p")};return j.runKernel(qf,n)}const kv=U({log1p_:pQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fQ(t,e){F(H2(t),()=>"The f passed in variableGrads(f) must be a function"),F(e==null||Array.isArray(e)&&e.every(u=>u instanceof p1),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const u in j.registeredVariables)e.push(j.registeredVariables[u])}const s=n?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),F(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=j.gradients(t,e,null,i);F(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),F(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((u,c)=>{a[c]!=null&&(l[u.name]=a[c])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:o,grads:l}}function sa(t){return j.customGrad(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mQ(t){const n={x:L(t,"x","neg")};return j.runKernel(J0,n)}const qt=U({neg_:mQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gQ(t){const n={x:L(t,"x","softplus")};return j.runKernel(um,n)}const Xh=U({softplus_:gQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yQ(t){const e=L(t,"x","logSigmoid");return sa(s=>({value:qt(Xh(qt(s))),gradFunc:o=>W(o,Mi(qt(s)))}))(e)}const $P=U({logSigmoid_:yQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vQ(t,e){let n=L(t,"a","sub"),s=L(e,"b","sub");[n,s]=pn(n,s);const r={a:n,b:s};return j.runKernel(dm,r)}const Ne=U({sub_:vQ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wQ(t,e=-1){const n=L(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return sa((r,i)=>{const a=ai(r,e,!0),l=Ne(r,a),u=Ne(Se(l,"float32"),Fr(De(Ps(l),e,!0)));return i([u]),{value:u,gradFunc:(h,d)=>{const[p]=d,f=!0,m=Ps(p);return Ne(h,W(De(h,e,f),m))}}})(n)}const HT=U({logSoftmax_:wQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xQ(t,e=null,n=!1){const s=L(t,"x","logSumExp"),r=st(e,s.shape),i=ai(s,r,!0),o=Ne(s,i),a=Ps(o),l=De(a,r),u=Fr(l),c=fe(H(i,u.shape),u);if(n){const h=wn(c.shape,r);return H(c,h)}return c}const Ev=U({logSumExp_:xQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bQ(t,e){const n=L(t,"a","logicalAnd","bool"),s=L(e,"b","logicalAnd","bool");Qe(n.shape,s.shape);const r={a:n,b:s};return j.runKernel(U0,r)}const ko=U({logicalAnd_:bQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IQ(t){const n={x:L(t,"x","logicalNot","bool")};return j.runKernel(W0,n)}const _v=U({logicalNot_:IQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SQ(t,e){const n=L(t,"a","logicalOr","bool"),s=L(e,"b","logicalOr","bool");Qe(n.shape,s.shape);const r={a:n,b:s};return j.runKernel(j0,r)}const qT=U({logicalOr_:SQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TQ(t,e){const n=L(t,"a","logicalXor","bool"),s=L(e,"b","logicalXor","bool");return Qe(n.shape,s.shape),ko(qT(t,e),_v(ko(t,e)))}const AP=U({logicalXor_:TQ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $g=2147483648;function CQ(t,e,n="left"){const s=L(t,"sortedSequence","searchSorted"),r=L(e,"values","searchSorted"),i=s.shape[s.shape.length-1],o=r.shape[r.shape.length-1],a=H(s,[-1,i]),l=H(r,[-1,o]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(re(l.shape)>=$g)throw new Error(`values tensor size must less than ${$g}`);if(a.shape[1]>=$g)throw new Error(`trailing dim_size must less than ${$g} for int32 output type, was ${a.shape[1]}`);const u={sortedSequence:a,values:l},c={side:n};return j.runKernel(gT,u,c)}const KT=U({searchSorted_:CQ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kQ(t,e){return KT(t,e,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EQ(t,e,n,s,r){const i=L(t,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=H(i,[1,i.shape[0],i.shape[1],i.shape[2]])),F(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),F(ss(n,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),Ls("maxPool",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r},h=j.runKernel(q0,u,c);return l?H(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Nv=U({maxPool_:EQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Q(t,e=[1,1,1],n,s,r,i="NDHWC"){const o=L(t,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=H(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),F(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),F(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Ls("maxPool3d",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:i},h=j.runKernel(K0,u,c);return l?H(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const RP=U({maxPool3d_:_Q});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NQ(t,e,n,s,r=!1){const o={x:L(t,"x","maxPoolWithArgmax")},a={filterSize:e,strides:n,pad:s,includeBatchInIndex:r},l=j.runKernel(nT,o,a);return{result:l[0],indexes:l[1]}}const $Q=U({maxPoolWithArgmax_:NQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AQ(t,e){let n=L(t,"a","maximum"),s=L(e,"b","maximum");[n,s]=pn(n,s),n.dtype==="bool"&&(n=Se(n,"int32"),s=Se(s,"int32")),Qe(n.shape,s.shape);const r={a:n,b:s};return j.runKernel(Kf,r)}const ha=U({maximum_:AQ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RQ(t,e=null,n=!1){const r={x:L(t,"x","mean")},i={axis:e,keepDims:n};return j.runKernel(X0,r,i)}const un=U({mean_:RQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nn(t,e="float32"){if(zr(t),e==="complex64"){const s=Nn(t,"float32"),r=Nn(t,"float32");return ul(s,r)}const n=ws(re(t),e);return j.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hr(t,e="float32"){if(zr(t),e==="complex64"){const s=hr(t,"float32"),r=Nn(t,"float32");return ul(s,r)}const n=CS(re(t),e);return j.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DQ(t,e,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(t===void 0)return[];let s=L(t,"x","meshgrid",t instanceof Mt?t.dtype:"float32");if(e===void 0)return[s];let r=L(e,"y","meshgrid",e instanceof Mt?e.dtype:"float32");const i=re(s.shape),o=re(r.shape);return n==="xy"?(s=H(s,[1,-1]),r=H(r,[-1,1]),[it(hr([o,1],s.dtype),s),it(r,hr([1,i],r.dtype))]):(s=H(s,[-1,1]),r=H(r,[1,-1]),[it(s,hr([1,o],s.dtype)),it(hr([i,1],r.dtype),r)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OQ(t,e){let n=L(t,"a","minimum"),s=L(e,"b","minimum");[n,s]=pn(n,s),n.dtype==="bool"&&(n=Se(n,"int32"),s=Se(s,"int32")),Qe(n.shape,s.shape);const r={a:n,b:s};return j.runKernel(Xf,r)}const zu=U({minimum_:OQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PQ(t,e,n){F(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=L(t,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");F(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=n==="reflect"?1:0;for(let a=0;a<s.rank;a++)F(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),F(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:n},o={x:s};return j.runKernel(Q0,o,i)}const DP=U({mirrorPad_:PQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FQ(t,e){let n=L(t,"a","mod"),s=L(e,"b","mod");[n,s]=pn(n,s);const r={a:n,b:s};return j.runKernel(Yf,r)}const OP=U({mod_:FQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LQ(t,e=null,n=!1){t=L(t,"x","moments");const s=st(e,t.shape),r=un(t,s,n);let i=r.shape;n||(i=wn(r.shape,s));const o=Vt(Ne(Se(t,"float32"),H(r,i))),a=un(o,s,n);return{mean:r,variance:a}}const $v=U({moments_:LQ});function MQ(t,e,n,s){const r=L(e,"data","multiRNNCell"),i=f1(n,"c","multiRNNCell"),o=f1(s,"h","multiRNNCell");let a=r;const l=[];for(let h=0;h<t.length;h++){const d=t[h](a,i[h],o[h]);l.push(d[0]),l.push(d[1]),a=d[1]}const u=[],c=[];for(let h=0;h<l.length;h+=2)u.push(l[h]),c.push(l[h+1]);return[u,c]}const VQ=U({multiRNNCell_:MQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zQ(t,e,n,s=!1){const r=L(t,"logits","multinomial"),i=r.size,o=r.rank;if(i<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${i}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);n=n||Math.random();const l={logits:o===1?H(r,[1,-1]):r},u={numSamples:e,seed:n,normalized:s},c=j.runKernel(sT,l,u);return o===1?H(c,[c.size]):c}const BQ=U({multinomial_:zQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UQ(t,e){let n=L(t,"a","notEqual","string_or_numeric"),s=L(e,"b","notEqual","string_or_numeric");[n,s]=pn(n,s),Qe(n.shape,s.shape);const r={a:n,b:s};return j.runKernel(Z0,r)}const Nh=U({notEqual_:UQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WQ(t,e,n=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:L(t,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:n,offValue:s};return j.runKernel(tv,o,a)}const XT=U({oneHot_:WQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jQ(t){const n={x:L(t,"x","onesLike")};return j.runKernel(ev,n)}const Lr=U({onesLike_:jQ});function GQ(t,e){const n=L(t,"v1","outerProduct"),s=L(e,"v2","outerProduct");F(n.rank===1&&s.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${s.rank}.`);const r=H(n,[-1,1]),i=H(s,[1,-1]);return it(r,i)}const HQ=U({outerProduct_:GQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qQ(t,e,n=0){const s=L(t,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:n},i={x:s};return j.runKernel(sv,i,r)}const Al=U({pad_:qQ});function KQ(t,e,n=0){return F(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),Al(t,[e],n)}const XQ=U({pad1d_:KQ});function YQ(t,e,n=0){return F(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Al(t,e,n)}const QQ=U({pad2d_:YQ});function JQ(t,e,n=0){return F(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Al(t,e,n)}const ZQ=U({pad3d_:JQ});function eJ(t,e,n=0){return F(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Al(t,e,n)}const tJ=U({pad4d_:eJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nJ(t,e,n){const s=L(t,"x","spaceToBatchND");F(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),F(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),F(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:n};return j.runKernel(pv,r,i)}const Av=U({spaceToBatchND_:nJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sJ(t,e,n,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=L(t,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=H(a,[1,a.shape[0],a.shape[1],a.shape[2]])),F(ss(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const c=pi(l.shape,e,i,r,s),h=[c.dilationHeight,c.dilationWidth];let d;s==="same"?d=iJ([c.filterHeight,c.filterWidth],h):d=[[0,0],[0,0]];const p=h[0]===1&&h[1]===1,[f,m]=rJ([c.inHeight,c.inWidth],h,d),v=p?s:"valid",y=p?l:Av(l,h,f),b=(n==="avg"?()=>bv(y,e,i,v,o):()=>Nv(y,e,i,v,o))(),I=p?b:Iv(b,h,m);return u?H(I,[I.shape[1],I.shape[2],I.shape[3]]):I}function rJ(t,e,n){const s=n.map(c=>c[0]),r=n.map(c=>c[1]),i=t.concat(s,r),o=e.map((c,h)=>(c-i[h]%c)%c),a=r.map((c,h)=>c+o[h]),l=e.map((c,h)=>[s[h],a[h]]),u=e.map((c,h)=>[0,o[h]]);return[l,u]}function iJ(t,e){const s=t.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const PP=U({pool_:sJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oJ(t,e){const n=L(t,"x","prelu"),s=L(e,"alpha","prelu"),r={x:n,alpha:s};return j.runKernel(rv,r)}const Rv=U({prelu_:oJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aJ(t,e=null,n=!1){let s=L(t,"x","prod");s.dtype==="bool"&&(s=Se(s,"int32"));const r={x:s},i={axis:e,keepDims:n};return j.runKernel(iv,r,i)}const FP=U({prod_:aJ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lJ(t,e,n,s){const r=t.map((c,h)=>L(c,`tensors${h}`,"raggedGather","int32")),i=L(e,"paramsDenseValues","raggedGather"),o=L(n,"indices","raggedGather","int32"),a={paramsNestedSplits:r,paramsDenseValues:i,indices:o},l={outputRaggedRank:s},u=j.runKernel(aT,a,l);return{outputNestedSplits:u.slice(0,u.length-1),outputDenseValues:u[u.length-1]}}const uJ=U({raggedGather_:lJ});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cJ(t,e,n){const s=L(t,"starts","raggedRange"),r=L(e,"limits","raggedRange",s.dtype),i=L(n,"deltas","raggedRange",s.dtype),o={starts:s,limits:r,deltas:i},a=j.runKernel(lT,o);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}const hJ=U({raggedRange_:cJ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dJ(t,e,n,s,r){const i=L(t,"shape","raggedTensorToTensor","int32"),o=L(e,"values","raggedTensorToTensor"),a=L(n,"defaultValue","raggedTensorToTensor",o.dtype),l=s.map((h,d)=>L(h,`tensors${d}`,"raggedTensorToTensor","int32")),u={shape:i,values:o,defaultValue:a,rowPartitionTensors:l},c={rowPartitionTypes:r};return j.runKernel(uT,u,c)}const pJ=U({raggedTensorToTensor_:dJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fJ(t,e,n){zr(t);const s=re(t);let r=null;if(n==null||n==="float32")r=new Float32Array(s);else if(n==="int32")r=new Int32Array(s);else if(n==="bool")r=new Uint8Array(s);else throw new Error(`Unknown data type ${n}`);for(let i=0;i<s;i++)r[i]=e();return j.makeTensor(r,t,n)}const mJ=U({rand_:fJ});var YT={exports:{}};YT.exports;(function(t){(function(e,n,s){function r(l){var u=this,c=a();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(l),u.s0<0&&(u.s0+=1),u.s1-=c(l),u.s1<0&&(u.s1+=1),u.s2-=c(l),u.s2<0&&(u.s2+=1),c=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var c=new r(l),h=u&&u.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&i(h,c),d.state=function(){return i(c,{})}),d}function a(){var l=4022871197,u=function(c){c=String(c);for(var h=0;h<c.length;h++){l+=c.charCodeAt(h);var d=.02519603282416938*l;l=d>>>0,d-=l,d*=l,l=d>>>0,d-=l,l+=d*4294967296}return(l>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=o:this.alea=o})(Oi,t)})(YT);var gJ=YT.exports,QT={exports:{}};QT.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,p=(u.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xor128=o})(Oi,t)})(QT);var yJ=QT.exports,JT={exports:{}};JT.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,p=(u.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xorwow=o})(Oi,t)})(JT);var vJ=JT.exports,ZT={exports:{}};ZT.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.x,h=l.i,d,p;return d=c[h],d^=d>>>7,p=d^d<<24,d=c[h+1&7],p^=d^d>>>10,d=c[h+3&7],p^=d^d>>>3,d=c[h+4&7],p^=d^d<<7,d=c[h+7&7],d=d^d<<13,p^=d^d<<9,c[h]=p,l.i=h+1&7,p};function u(c,h){var d,p=[];if(h===(h|0))p[0]=h;else for(h=""+h,d=0;d<h.length;++d)p[d&7]=p[d&7]<<15^h.charCodeAt(d)+p[d+1&7]<<13;for(;p.length<8;)p.push(0);for(d=0;d<8&&p[d]===0;++d);for(d==8?p[7]=-1:p[d],c.x=p,c.i=0,d=256;d>0;--d)c.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,p=(u.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},h.int32=u.next,h.quick=h,c&&(c.x&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xorshift7=o})(Oi,t)})(ZT);var wJ=ZT.exports,eC={exports:{}};eC.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.w,h=l.X,d=l.i,p,f;return l.w=c=c+1640531527|0,f=h[d+34&127],p=h[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=h[d]=f^p,l.i=d,f+(c^c>>>16)|0};function u(c,h){var d,p,f,m,v,y=[],w=128;for(h===(h|0)?(p=h,h=null):(h=h+"\0",p=0,w=Math.max(w,h.length)),f=0,m=-32;m<w;++m)h&&(p^=h.charCodeAt((m+32)%h.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,d=y[m&127]^=p+v,f=d==0?f+1:0);for(f>=128&&(y[(h&&h.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=y[f+34&127],d=y[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,y[f]=p^d;c.w=v,c.X=y,c.i=f}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,p=(u.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},h.int32=u.next,h.quick=h,c&&(c.X&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xor4096=o})(Oi,t)})(eC);var xJ=eC.exports,tC={exports:{}};tC.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var h=l.b,d=l.c,p=l.d,f=l.a;return h=h<<25^h>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-h|0,l.b=h=h<<20^h>>>12^d,l.c=d=d-p|0,l.d=p<<16^d>>>16^f,l.a=f-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var c=0;c<u.length+20;c++)l.b^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var d=u.next()>>>11,p=(u.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.tychei=o})(Oi,t)})(tC);var bJ=tC.exports,LP={exports:{}};const IJ={},SJ=Object.freeze(Object.defineProperty({__proto__:null,default:IJ},Symbol.toStringTag,{value:"Module"})),TJ=xz(SJ);(function(t){(function(e,n,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),u=s.pow(2,o),c=u*2,h=r-1,d;function p(I,k,R){var C=[];k=k==!0?{entropy:!0}:k||{};var T=y(v(k.entropy?[I,b(n)]:I??w(),3),C),N=new f(C),$=function(){for(var P=N.g(i),V=l,O=0;P<u;)P=(P+O)*r,V*=r,O=N.g(1);for(;P>=c;)P/=2,V/=2,O>>>=1;return(P+O)/V};return $.int32=function(){return N.g(4)|0},$.quick=function(){return N.g(4)/4294967296},$.double=$,y(b(N.S),n),(k.pass||R||function(P,V,O,Q){return Q&&(Q.S&&m(Q,N),P.state=function(){return m(N,{})}),O?(s[a]=P,V):P})($,T,"global"in k?k.global:this==s,k.state)}function f(I){var k,R=I.length,C=this,T=0,N=C.i=C.j=0,$=C.S=[];for(R||(I=[R++]);T<r;)$[T]=T++;for(T=0;T<r;T++)$[T]=$[N=h&N+I[T%R]+(k=$[T])],$[N]=k;(C.g=function(P){for(var V,O=0,Q=C.i,Z=C.j,ne=C.S;P--;)V=ne[Q=h&Q+1],O=O*r+ne[h&(ne[Q]=ne[Z=h&Z+V])+(ne[Z]=V)];return C.i=Q,C.j=Z,O})(r)}function m(I,k){return k.i=I.i,k.j=I.j,k.S=I.S.slice(),k}function v(I,k){var R=[],C=typeof I,T;if(k&&C=="object")for(T in I)try{R.push(v(I[T],k-1))}catch{}return R.length?R:C=="string"?I:I+"\0"}function y(I,k){for(var R=I+"",C,T=0;T<R.length;)k[h&T]=h&(C^=k[h&T]*19)+R.charCodeAt(T++);return b(k)}function w(){try{var I;return d&&(I=d.randomBytes)?I=I(r):(I=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(I)),b(I)}catch{var k=e.navigator,R=k&&k.plugins;return[+new Date,e,R,e.screen,b(n)]}}function b(I){return String.fromCharCode.apply(0,I)}if(y(s.random(),n),t.exports){t.exports=p;try{d=TJ}catch{}}else s["seed"+a]=p})(typeof self<"u"?self:Oi,[],Math)})(LP);var CJ=LP.exports,kJ=gJ,EJ=yJ,_J=vJ,NJ=wJ,$J=xJ,AJ=bJ,sc=CJ;sc.alea=kJ;sc.xor128=EJ;sc.xorwow=_J;sc.xorshift7=NJ;sc.xor4096=$J;sc.tychei=AJ;var Dv=sc;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nC{constructor(e,n,s,r,i){this.mean=e,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=Dv.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,n,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,n=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class RJ{constructor(e,n,s,r){this.alpha=e,this.beta=1/n,this.dtype=s;const i=r||Math.random();this.randu=Dv.alea(i.toString()),this.randn=new nC(0,1,s,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,n,s,r,i,o;for(;;){do r=this.randn.nextValue(),o=1+this.c*r;while(o<=0);if(o*=o*o,e=r*r,n=1-.331*e*e,s=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<n||Math.log(i)<s)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}class DJ{constructor(e=0,n=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=Dv.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OJ(t,e,n=1,s="float32",r){if(zr(t),n==null&&(n=1),s==null&&(s="float32"),s!=="float32"&&s!=="int32")throw new Error(`Unsupported data type ${s}`);const i=new RJ(e,n,s,r),o=tt(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const PJ=U({randomGamma_:OJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FJ(t,e=0,n=1,s,r){if(zr(t),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new nC(e,n,s,!1,r),o=tt(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const sC=U({randomNormal_:FJ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LJ(t,e,n){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return sC(t,0,1,e,n)}const MJ=U({randomStandardNormal_:LJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VJ(t,e=0,n=1,s="float32",r){zr(t);const i=tt(t,s),o=new DJ(e,n,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const rc=U({randomUniform_:VJ});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zJ(t,e,n,s){return rc(t,e,n,"int32",s)}const BJ=U({randomUniformInt_:zJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $h(t,e,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const r={start:t,stop:e,step:n,dtype:s};return j.runKernel(cT,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UJ(t){const n={input:L(t,"input","real")};return j.runKernel(hT,n)}const Kp=U({real_:UJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WJ(t){const n={x:L(t,"x","reciprocal")};return j.runKernel(Zf,n)}const MP=U({reciprocal_:WJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jJ(t){const n={x:L(t,"x","relu")};return j.runKernel(em,n)}const $o=U({relu_:jJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GJ(t){const n={x:L(t,"x","relu6")};return j.runKernel(tm,n)}const rC=U({relu6_:GJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HJ(t,e){const s={x:L(t,"x","reverse")},r={dims:e};return j.runKernel(uv,s,r)}const hi=U({reverse_:HJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qJ(t){const e=L(t,"x","reverse");return F(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),hi(e,0)}const KJ=U({reverse1d_:qJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XJ(t,e){const n=L(t,"x","reverse");return F(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),hi(n,e)}const YJ=U({reverse2d_:XJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QJ(t,e){const n=L(t,"x","reverse");return F(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),hi(n,e)}const JJ=U({reverse3d_:QJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZJ(t,e){const n=L(t,"x","reverse");return F(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),hi(n,e)}const eZ=U({reverse4d_:ZJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tZ(t){const n={x:L(t,"x","round")};return j.runKernel(nm,n)}const iC=U({round_:tZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nZ(t){const n={x:L(t,"x","rsqrt","float32")};return j.runKernel(sm,n)}const oC=U({rsqrt_:nZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sZ(t){const n={x:L(t,"x","selu")};return j.runKernel(rm,n)}const aC=U({selu_:sZ});function rZ(t,e,n,s,r,i=[1,1],o="NHWC"){const a=L(t,"x","separableConv2d"),l=L(e,"depthwiseFilter","separableConv2d"),u=L(n,"pointwiseFilter","separableConv2d");let c=a,h=!1;if(a.rank===3&&(h=!0,c=H(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");F(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),F(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),F(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),F(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),F(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const d=l.shape[2],p=l.shape[3];F(u.shape[2]===d*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${d*p}, but got ${u.shape[2]}.`);const f=xm(c,l,s,r,o,i),v=dl(f,u,1,"valid",o);return h?H(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const lC=U({separableConv2d_:rZ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function iZ(t,e){const n=L(t,"x","setdiff1d"),s=L(e,"y","setdiff1d");F(n.dtype===s.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${s.dtype}).`),F(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),F(s.rank===1,()=>`y should be 1D tensor, but got y (${s.shape}).`);const r=await n.data(),i=await s.data(),o=new Set(i);let a=0;for(let c=0;c<r.length;c++)o.has(r[c])||a++;const l=new Rn([a],n.dtype),u=new Rn([a],"int32");for(let c=0,h=0;c<r.length;c++)o.has(r[c])||(l.values[h]=r[c],u.values[h]=c,h++);return[l.toTensor(),u.toTensor()]}const oZ=iZ;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aZ(t){const n={x:L(t,"x","sign")};return j.runKernel(am,n)}const VP=U({sign_:aZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lZ(t){const n={x:L(t,"x","sin","float32")};return j.runKernel(im,n)}const uC=U({sin_:lZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uZ(t){const n={x:L(t,"x","sinh")};return j.runKernel(om,n)}const cC=U({sinh_:uZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cZ(t,e,n){const s=L(t,"x","slice1d");return F(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),je(s,[e],[n])}const Ov=U({slice1d_:cZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hZ(t,e,n){const s=L(t,"x","slice2d");return F(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),je(s,e,n)}const hC=U({slice2d_:hZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dZ(t,e,n){const s=L(t,"x","slice3d");return F(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),je(s,e,n)}const Pv=U({slice3d_:dZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pZ(t,e,n){const s=L(t,"x","slice4d");return F(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),je(s,e,n)}const Xp=U({slice4d_:pZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fZ(t,e=-1){const n=L(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},r={dim:e};return j.runKernel(mv,s,r)}const Fv=U({softmax_:fZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mZ(t){F(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return j.runKernel(HS,e)}const Lv=U({fft_:mZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gZ(t){F(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return j.runKernel(YS,e)}const Yp=U({ifft_:gZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yZ(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const r=H(t,[n,e]);s=Yp(r)}else{const r=[n,2*(e-1)],i=H(Kp(t),[n,e]),o=H(Tv(t),[n,e]),a=hi(je(i,[0,1],[n,e-2]),1),l=W(hi(je(o,[0,1],[n,e-2]),1),Be(-1)),u=hn([i,a],1),c=hn([o,l],1),h=H(ul(u,c),[r[0],r[1]]);s=Yp(h)}if(s=Kp(s),t.rank===3&&t.shape[0]!==0){const r=s,i=t.shape[0];s=H(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const dC=U({irfft_:yZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vZ(t,e,n=0){const r={x:L(t,"x","split")},i={numOrSizeSplits:e,axis:n};return j.runKernel(fv,r,i)}const gr=U({split_:vZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wZ(t,e){F(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const s=t.size/n;let r;if(e!=null&&e<n){const f=t.shape.map(v=>0),m=t.shape.map(v=>v);m[t.shape.length-1]=e,r=je(t,f,m),n=e}else if(e!=null&&e>n){const f=t.shape.map(m=>m);f[t.shape.length-1]=e-n,r=hn([t,Nn(f)],t.shape.length-1),n=e}else r=t;const i=ft(r),o=H(ul(r,i),[s,n]),a=Lv(o),l=Math.floor(n/2)+1,u=Kp(a),c=Tv(a),h=gr(u,[l,n-l],u.shape.length-1),d=gr(c,[l,n-l],c.shape.length-1),p=r.shape.slice();return p[r.shape.length-1]=l,H(ul(h[0],d[0]),p)}const Mv=U({rfft_:wZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xZ(t,e){let n=L(t,"a","squaredDifference"),s=L(e,"b","squaredDifference");[n,s]=pn(n,s),Qe(n.shape,s.shape);const r={a:n,b:s},i={};return j.runKernel(hm,r,i)}const pC=U({squaredDifference_:xZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bZ(t,e){const n=L(t,"x","squeeze","string_or_numeric");return H(n,Tl(n.shape,e).newShape)}const mn=U({squeeze_:bZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IZ(t,e=0){const n=f1(t,"tensors","stack","string_or_numeric");F(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&F(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,r={axis:e};return j.runKernel(nv,s,r)}const wr=U({stack_:IZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SZ(t,e=0){const s={x:L(t,"x","step")},r={alpha:e};return j.runKernel(gm,s,r)}const Yh=U({step_:SZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TZ(t,e,n,s,r=0,i=0,o=0,a=0,l=0){const c={x:L(t,"x","stridedSlice","string_or_numeric")},h={begin:e,end:n,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return j.runKernel(ST,c,h)}const zP=U({stridedSlice_:TZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CZ(t){const n={x:L(t,"x","tan","float32")};return j.runKernel(pm,n)}const BP=U({tan_:CZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tn(t,e){jh(t);const n=kl(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return El(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gu(t,e,n){if(jh(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=kl(t,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return El(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UP(t,e,n){if(jh(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=kl(t,n);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return El(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kZ(t,e,n){if(jh(t),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const s=kl(t,n);if(s.length!==4&&s.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return El(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EZ(t,e,n){if(jh(t),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const s=kl(t,n);if(s.length!==5&&s.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return El(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Z(t,e,n){if(jh(t),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const s=kl(t,n);if(s.length!==6&&s.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||s,El(t,e,s,n)}function WP(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${r}.`;if(n.rank<r)throw new Error(i+` update.rank < ${r}. `);if(t.length<s+(n.rank-r))throw new Error(i+` Output shape length < ${s+(n.rank-r)}`);if(n.rank!==r+t.length-s)throw new Error(i+` update.rank != ${r+t.length-s}`);for(let o=0;o<r;++o)if(n.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-r;++o)if(n.shape[o+r]!==t[o+s])throw new Error(i+` updates.shape[${o+r}] (${n.shape[o+r]}) != shape[${o+r}] (${t[o+r]})`)}function fC(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}WP(n,e,t)}function ic(t,e,n){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=n.length;let o=1;for(let h=r;h<i;++h)o*=n[h];const a=r<1?1:r,l=re(e.shape)/a,u=[...Ve(n.slice(0,r)),1],c=re(n);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:u,outputSize:c}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NZ(t,e,n){const s=L(t,"tensor","tensorScatterupdate"),r=L(e,"indices","tensorScatterupdate","int32"),i=L(n,"updates","tensorScatterupdate");if(fC(i,r,s.shape),s.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${s.dtype} and ${i.dtype}.`);const o={tensor:s,indices:r,updates:i},a={};return j.runKernel(mT,o,a)}const $Z=U({tensorScatterUpdate_:NZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AZ(t,e=1,n=!0){const s=L(t,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:n},[a,l]=j.runKernel(ET,i,o);return{values:a,indices:l}}const jP=U({topk_:AZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RZ(t,e=0,n=1,s,r){if(zr(t),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new nC(e,n,s,!0,r),o=tt(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const mC=U({truncatedNormal_:RZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DZ(t,e=0){const n=L(t,"x","unique","string_or_numeric");F(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},r={axis:e},[i,o]=j.runKernel(NT,s,r);return{values:i,indices:o}}const GP=U({unique_:DZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OZ(t,e,n){const s=L(t,"x","unsortedSegmentSum"),r=L(e,"segmentIds","unsortedSegmentSum","int32");F(Th(n),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:n};return j.runKernel(vv,i,o)}const gC=U({unsortedSegmentSum_:OZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PZ(t,e=0){const n=L(t,"x","unstack","string_or_numeric");F(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},r={axis:e};return j.runKernel(yv,s,r)}const di=U({unstack_:PZ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FZ(t,e){return KT(t,e,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HP(t,e=!0,n,s){return j.makeVariable(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yC(t,e){const n=[];for(let i=0;i<e.length;i++)e[i]&&n.push(i);const s=tt(t,"int32"),r=tt([n.length,t.length],"int32");for(let i=0;i<n.length;i++){const o=s.indexToLoc(n[i]),a=i*t.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function LZ(t){const e=L(t,"condition","whereAsync","bool"),n=await e.data(),s=yC(e.shape,n);return t!==e&&e.dispose(),s}const qP=LZ;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function MZ(t,e,n){const s=L(t,"tensor","boolMask"),r=L(e,"mask","boolMask","bool"),i=n??0,o=r.rank,a=s.shape;F(o>0,()=>"mask cannot be scalar"),Ir(a.slice(i,i+o),r.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let m=i;m<i+o;m++)l*=a[m];const u=a.slice(0,i).concat([l],a.slice(i+o)),c=H(s,u),h=H(r,[-1]),d=await qP(h),p=mn(d,[1]),f=Tm(c,p,i);return t!==s&&s.dispose(),e!==r&&r.dispose(),p.dispose(),c.dispose(),h.dispose(),d.dispose(),f}const VZ=MZ;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zZ(t,e,n){const s=L(t,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),F(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{F(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?Y(()=>{let o=Kp(s),a=Tv(s);return o=j.runKernel(ih,{x:o},i),a=j.runKernel(ih,{x:a},i),n&&(a=qt(a)),ul(o,a)}):j.runKernel(ih,r,i)}const pt=U({transpose_:zZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BZ(t,e,n,s,r=!0){const i=L(t,"v","movingAverage"),o=L(e,"x","movingAverage"),a=L(n,"decay","movingAverage");_K(i,o),F(ut(i.shape,o.shape),()=>"Shape mismatch in v and x");const l=Be(1),u=Ne(l,a);let c=W(Ne(o,i),u);if(r){F(s!=null,()=>"When using zeroDebias: true, step is required.");const h=L(s,"step","movingAverage");c=_e(c,Ne(l,na(a,h)))}return fe(i,c)}const UZ=U({movingAverage_:BZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WZ(t,e,n){zr(n);const s=L(t,"indices","scatterND","int32"),r=L(e,"updates","scatterND");fC(r,s,n);const i={indices:s,updates:r},o={shape:n};return j.runKernel(fT,i,o)}const jZ=U({scatterND_:WZ});function GZ(t,e,n,s){if(t.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const r=t.rank>0?t.shape[0]:1,i=t.rank>1?t.shape[1]:1;if(n.length!==i)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${i}.`);const o=e.size;if(!(e.rank===0||e.rank===1&&o===r))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${r}]`);if(e.dtype!==s.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HZ(t,e,n,s=0){zr(n);const r=L(t,"sparseIndices","sparseToDense","int32"),i=L(e,"sparseValues","sparseToDense","string_or_numeric"),o=L(s,"defaultValue","sparseToDense",i.dtype);GZ(r,i,n,o);const a={sparseIndices:r,sparseValues:i,defaultValue:o},l={outputShape:n};return j.runKernel(bT,a,l)}const qZ=U({sparseToDense_:HZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KZ(t,e){const n=L(e,"indices","gatherND","int32"),r={params:L(t,"x","gatherND","string_or_numeric"),indices:n};return j.runKernel(XS,r)}const XZ=U({gatherND_:KZ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YZ(t,e){if(e==null)return t.shape.slice();if(ut(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)e[s]==null&&t.shape[s]!=null?n.push(t.shape[s]):n.push(e[s]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QZ(t,e,n,s){const r=L(t,"x","dropout");if(F(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),F(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof Mt?r.clone():r;const i=YZ(r,n),o=1-e,a=_e(Sm(fe(rc(i,0,1,"float32",s),o)),o);return W(r,a)}const KP=U({dropout_:QZ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XP(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function vC(t,e,n){const s=1-t%2,r=new Float32Array(t);for(let i=0;i<t;++i){const o=2*Math.PI*i/(t+s-1);r[i]=e-n*Math.cos(o)}return Tn(r,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function JZ(t,e,n=1){const s=L(t,"predictions","inTopK"),r=L(e,"targets","inTopK");F(s.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${s.rank}`),F(s.rank-1===r.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${s.rank} and targets rank ${r.rank}`),Ir(s.shape.slice(0,s.shape.length-1),r.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const i=s.shape[s.shape.length-1];F(n>0&&n<=i,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${i}), but got ${n}`);const o=await s.data(),a=await r.data(),[l,u]=[o.length/i,i],c=ts("bool",l);for(let h=0;h<l;h++){const d=h*u,p=o.subarray(d,d+u),f=[];for(let m=0;m<p.length;m++)f.push({value:p[m],index:m});f.sort((m,v)=>v.value-m.value),c[h]=0;for(let m=0;m<n;m++)if(f[m].index===a[h]){c[h]=1;break}}return t!==s&&s.dispose(),e!==r&&r.dispose(),Li(c,r.shape,"bool")}const ZZ=JZ;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eee(t,e,n,s,r,i="NHWC",o){let a=t;t.rank===3&&(a=H(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=H(e,[1,e.shape[0],e.shape[1],e.shape[2]])),F(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),F(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),F(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const u=i==="NHWC"?a.shape[3]:a.shape[1],c=i==="NHWC"?l.shape[3]:l.shape[1];F(u===n[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${n[2]}.`),F(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),Ls("conv2dDerFilter",r,o);const h={x:a,dy:l},d={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:n};return j.runKernel(OS,h,d)}const wC=U({conv2DBackpropFilter_:eee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vv(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return W(t,Yh(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function zv(t,e){let n=e;const s=Pn(t.shape,e.shape);return s.length>0&&(n=De(n,s)),H(n,t.shape)}function Bv(t,e,n,s){if(e==="linear")return t;if(e==="relu")return $o(t);if(e==="elu")return bm(t);if(e==="relu6")return rC(t);if(e==="prelu")return Rv(t,n);if(e==="leakyrelu")return Cv(t,s);if(e==="sigmoid")return Mi(t);throw new Error(`Unknown fused activation ${e}.`)}const Uv=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tee({x:t,filter:e,strides:n,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(l=l||"linear",Uv(j.state.gradientDepth,l)===!1){F(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let R=dl(t,e,n,s,r,i,o);return a!=null&&(R=fe(R,a)),Bv(R,l,u,c)}const h=L(t,"x","conv2d","float32"),d=L(e,"filter","conv2d","float32");let p=h,f=!1;h.rank===3&&(f=!0,p=H(h,[1,h.shape[0],h.shape[1],h.shape[2]])),F(p.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`),F(d.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${d.rank}.`),Ls("fused conv2d",s,o);const m=r==="NHWC"?p.shape[3]:p.shape[1];F(d.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${d.shape[2]}.`),F(ss(n,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);const v=jn(p.shape,d.shape,n,i,s,o);let y;a!=null&&(y=L(a,"bias","fused conv2d"),[y]=pn(y,h),r==="NHWC"?Qe(v.outShape,y.shape):(F(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),F(y.shape.length===0||y.shape[0]===v.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${v.outChannels})`)));let w;if(u!=null){const R=u.shape;if(F(R.length<=1||R.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${R.length}.`),R.length===1)F(R[0]===1||R[0]===v.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${R}) is not compatible with the number of output channels (${v.outChannels}).`);else if(R.length===3)try{Qe(R,v.outShape)}catch{const T=`Error in fused conv2d: PReLU activation weights (${R}) is not compatible with the output shape of the conv2d (${v.outShape}).`;throw Error(T)}w=L(u,"prelu weights","fused conv2d")}const b=(R,C)=>{F(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[T,N,$,P]=C,V=Vv(R,$,l);F(hl(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const O=VT(N.shape,V,T,n,s),Q=wC(N,V,T.shape,n,s),Z=[O,Q];if(P!=null){const ne=zv(P,V);Z.push(ne)}return Z},I={x:p,filter:d,bias:y,preluActivationWeights:w},k={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:c};return a==null?sa((C,T,N)=>{let $=j.runKernel(u1,I,k);return N([T,C,$]),f&&($=H($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:b}})(p,d):sa((C,T,N,$)=>{let P=j.runKernel(u1,I,k);return $([T,C,P,N]),f&&(P=H(P,[P.shape[1],P.shape[2],P.shape[3]])),{value:P,gradFunc:b}})(p,d,y)}const YP=U({fusedConv2d_:tee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nee(t,e,n,s,r,i=[1,1],o){let a=t;t.rank===3&&(a=H(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=H(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},c={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:n};return j.runKernel(BS,u,c)}const QP=U({depthwiseConv2dNativeBackpropFilter_:nee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function see(t,e,n,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=H(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:n},c={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:t},h=j.runKernel(US,u,c);return l?H(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const JP=U({depthwiseConv2dNativeBackpropInput_:see});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ree({x:t,filter:e,strides:n,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(Uv(j.state.gradientDepth,l)===!1){let k=xm(t,e,n,s,r,i,o);return a!=null&&(k=fe(k,a)),Bv(k,l,u,c)}const h=L(t,"x","depthwiseConv2d","float32"),d=L(e,"filter","depthwiseConv2d","float32");let p=h,f=!1;h.rank===3&&(f=!0,p=H(h,[1,h.shape[0],h.shape[1],h.shape[2]])),F(p.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`),F(d.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${d.rank}.`),F(p.shape[3]===d.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${d.shape[2]}.`),i==null&&(i=[1,1]),F(ss(n,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),Ls("fused depthwiseConv2d",s,o);const m=jn(p.shape,d.shape,n,i,s,o,!0);let v;a!=null&&(v=L(a,"bias","fused conv2d"),[v]=pn(v,h),Qe(m.outShape,v.shape));let y;u!=null&&(y=L(u,"prelu weights","fused depthwiseConv2d"));const w=(k,R)=>{F(hl(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);const[C,T,N,$]=R,P=Vv(k,N,l),V=JP(T.shape,P,C,n,s,i,o),O=QP(T,P,C.shape,n,s,i,o);if($!=null){const Q=zv(v,P);return[V,O,Q]}return[V,O]},b={x:p,filter:d,bias:v,preluActivationWeights:y},I={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:c};return a==null?sa((R,C,T)=>{let N=j.runKernel(c1,b,I);return T([C,R,N]),f&&(N=H(N,[N.shape[1],N.shape[2],N.shape[3]])),{value:N,gradFunc:w}})(p,d):sa((R,C,T,N)=>{let $=j.runKernel(c1,b,I);return N([C,R,$,T]),f&&($=H($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:w}})(p,d,v)}const iee=U({fusedDepthwiseConv2d_:ree});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oee({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(Uv(j.state.gradientDepth,i)===!1){let P=it(t,e,n,s);return r!=null&&(P=fe(P,r)),Bv(P,i,o,a)}let l=L(t,"a","fused matMul"),u=L(e,"b","fused matMul");[l,u]=pn(l,u);const c=n?l.shape[l.rank-2]:l.shape[l.rank-1],h=s?u.shape[u.rank-1]:u.shape[u.rank-2],d=n?l.shape[l.rank-1]:l.shape[l.rank-2],p=s?u.shape[u.rank-2]:u.shape[u.rank-1],f=l.shape.slice(0,-2),m=u.shape.slice(0,-2),v=re(f),y=re(m);F(c===h,()=>`Error in fused matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${n} and transposeB=${s} must match.`);const b=Qe(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([d,p]),I=n?H(l,[v,c,d]):H(l,[v,d,c]),k=s?H(u,[y,p,h]):H(u,[y,h,p]);let R;r!=null&&(R=L(r,"bias","fused matMul"),[R]=pn(R,l),Qe(b,R.shape));let C;o!=null&&(C=L(o,"prelu weights","fused matMul"));const T=(P,V)=>{const[O,Q,Z,ne]=V,le=Vv(H(P,Z.shape),Z,i);let q,J;if(!n&&!s?(q=it(le,Q,!1,!0),J=it(O,le,!0,!1)):!n&&s?(q=it(le,Q,!1,!1),J=it(le,O,!0,!1)):n&&!s?(q=it(Q,le,!1,!0),J=it(O,le,!1,!1)):(q=it(Q,le,!0,!0),J=it(le,O,!0,!0)),r!=null){const ie=zv(ne,le);return[q,J,ie]}else return[q,J]},N={a:I,b:k,bias:R,preluActivationWeights:C},$={transposeA:n,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?sa((V,O,Q)=>{const Z=j.runKernel(l1,N,$);return Q([V,O,Z]),{value:H(Z,b),gradFunc:T}})(I,k):sa((V,O,Q,Z)=>{const ne=j.runKernel(l1,N,$);return Z([V,O,ne,Q]),{value:H(ne,b),gradFunc:T}})(I,k,R)}const db=U({fusedMatMul_:oee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aee=Object.freeze(Object.defineProperty({__proto__:null,conv2d:YP,depthwiseConv2d:iee,matMul:db},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lee(t){return vC(t,.54,.46)}const uee=U({hammingWindow_:lee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cee(t){return vC(t,.5,.5)}const ZP=U({hannWindow_:cee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hee(t,e,n,s=!1,r=0){let i=0;const o=[];for(;i+e<=t.size;)o.push(je(t,i,e)),i+=n;if(s)for(;i<t.size;){const a=i+e-t.size,l=hn([je(t,i,e-a),Kh([a],r)]);o.push(l),i+=n}return o.length===0?gu([],[0,e]):H(hn(o),[o.length,e])}const eF=U({frame_:hee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dee(t,e,n,s,r=ZP){s==null&&(s=XP(e));const i=eF(t,e,n),o=W(i,r(e));return Mv(o,s)}const pee=U({stft_:dee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fee(t,e,n,s,r="bilinear",i=0){const o=L(t,"image","cropAndResize"),a=L(e,"boxes","cropAndResize","float32"),l=L(n,"boxInd","cropAndResize","int32"),u=a.shape[0];F(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),F(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),F(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),F(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),F(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),F(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const c={image:o,boxes:a,boxInd:l},h={method:r,extrapolationValue:i,cropSize:s};return j.runKernel(MS,c,h)}const mee=U({cropAndResize_:fee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gee(t){const e=L(t,"image","flipLeftRight","float32");F(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return j.runKernel(KS,n,{})}const yee=U({flipLeftRight_:gee});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vee(t){const e=L(t,"image","grayscaleToRGB"),n=e.rank-1,s=e.shape[n];F(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),F(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,n),r[n]=3,ti(e,r)}const wee=U({grayscaleToRGB_:vee});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xee(t){const e=L(t,"image","RGBToGrayscale"),n=e.rank-1,s=e.shape[n];F(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),F(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=Se(e,"float32"),o=Tn([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Dc("ij,j->i",i,o);break;case 3:a=Dc("ijk,k->ij",i,o);break;case 4:a=Dc("ijkl,l->ijk",i,o);break;case 5:a=Dc("ijklm,m->ijkl",i,o);break;case 6:a=Dc("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=Xn(a,-1),Se(a,r)}const bee=U({rgbToGrayscale_:xee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iee(t,e,n=0,s=.5){const r=L(t,"image","rotateWithOffset","float32");F(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:n,center:s};return j.runKernel($T,i,o)}const See=U({rotateWithOffset_:Iee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qh(t,e,n,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=t.shape[0];return n=Math.min(n,o),F(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),F(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),F(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),F(e.rank===1,()=>"scores must be a 1D tensor"),F(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),F(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tee(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const i=L(t,"boxes","nonMaxSuppression","float32"),o=L(e,"scores","nonMaxSuppression","float32"),a=Qh(i,o,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:s,scoreThreshold:r};return j.runKernel(rT,{boxes:i,scores:o},l)}const Cee=U({nonMaxSuppression_:Tee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kee(t,e,n){const s=Eee(t,e,n),r=s<0?-(s+1):s;t.splice(r,0,e)}function Eee(t,e,n){return Nee(t,e,n||_ee)}function _ee(t,e){return t>e?1:t<e?-1:0}function Nee(t,e,n){let s=0,r=t.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=n(e,t[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xC(t,e,n,s,r){return SC(t,e,n,s,r,0)}function bC(t,e,n,s,r,i){return SC(t,e,n,s,r,0,!1,i,!0)}function IC(t,e,n,s,r,i){return SC(t,e,n,s,r,i,!0)}function SC(t,e,n,s,r,i,o=!1,a=!1,l=!1){const u=[];for(let v=0;v<e.length;v++)e[v]>r&&u.push({score:e[v],boxIndex:v,suppressBeginIndex:0});u.sort(WN);const c=i>0?-.5/i:0,h=[],d=[];for(;h.length<n&&u.length>0;){const v=u.pop(),{score:y,boxIndex:w,suppressBeginIndex:b}=v;if(y<r)break;let I=!1;for(let k=h.length-1;k>=b;--k){const R=$ee(t,w,h[k]);if(R>=s){I=!0;break}if(v.score=v.score*Aee(s,c,R),v.score<=r)break}v.suppressBeginIndex=h.length,I||(v.score===y?(h.push(w),d.push(v.score)):v.score>r&&kee(u,v,WN))}const p=h.length,f=n-p;a&&f>0&&(h.push(...new Array(f).fill(0)),d.push(...new Array(f).fill(0)));const m={selectedIndices:h};return o&&(m.selectedScores=d),l&&(m.validOutputs=p),m}function $ee(t,e,n){const s=t.subarray(e*4,e*4+4),r=t.subarray(n*4,n*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),c=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),d=Math.max(r[1],r[3]),p=(a-i)*(l-o),f=(h-u)*(d-c);if(p<=0||f<=0)return 0;const m=Math.max(i,u),v=Math.max(o,c),y=Math.min(a,h),w=Math.min(l,d),b=Math.max(y-m,0)*Math.max(w-v,0);return b/(p+f-b)}function Aee(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function WN(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Ree(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const i=L(t,"boxes","nonMaxSuppressionAsync"),o=L(e,"scores","nonMaxSuppressionAsync"),a=Qh(i,o,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),u=l[0],c=l[1],{selectedIndices:h}=xC(u,c,n,s,r);return i!==t&&i.dispose(),o!==e&&o.dispose(),Tn(h,"int32")}const Dee=Ree;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oee(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=L(t,"boxes","nonMaxSuppression"),a=L(e,"scores","nonMaxSuppression"),l=Qh(o,a,n,s,r,i);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u={boxes:o,scores:a},c={maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},h=j.runKernel(oT,u,c);return{selectedIndices:h[0],selectedScores:h[1]}}const Pee=U({nonMaxSuppressionWithScore_:Oee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Fee(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=L(t,"boxes","nonMaxSuppressionAsync"),a=L(e,"scores","nonMaxSuppressionAsync"),l=Qh(o,a,n,s,r,i);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),c=u[0],h=u[1],{selectedIndices:d,selectedScores:p}=IC(c,h,n,s,r,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:Tn(d,"int32"),selectedScores:Tn(p)}}const Lee=Fee;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mee(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=L(t,"boxes","nonMaxSuppression"),a=L(e,"scores","nonMaxSuppression"),l=Qh(o,a,n,s,r,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,d={boxes:o,scores:a},p={maxOutputSize:u,iouThreshold:c,scoreThreshold:h,padToMaxOutputSize:i},f=j.runKernel(iT,d,p);return{selectedIndices:f[0],validOutputs:f[1]}}const Vee=U({nonMaxSuppressionPadded_:Mee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function zee(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=L(t,"boxes","nonMaxSuppressionAsync"),a=L(e,"scores","nonMaxSuppressionAsync"),l=Qh(o,a,n,s,r,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,[d,p]=await Promise.all([o.data(),a.data()]),{selectedIndices:f,validOutputs:m}=bC(d,p,u,c,h,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:Tn(f,"int32"),validOutputs:Be(m,"int32")}}const Bee=zee;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uee(t,e,n=!1,s=!1){const r=L(t,"images","resizeBilinear");F(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),F(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),F(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=H(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:n,halfPixelCenters:s,size:e},u=j.runKernel(lv,a,l);return o?H(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const tF=U({resizeBilinear_:Uee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wee(t,e,n=!1,s=!1){const r=L(t,"images","resizeNearestNeighbor");F(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),F(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),F(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),F(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=H(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:n,halfPixelCenters:s,size:e},u=j.runKernel(av,a,l);return o?H(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const nF=U({resizeNearestNeighbor_:Wee});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jee(t,e="binary",n=!1,s=.5){const r=L(t,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let u=W(Tn([s]),255),c,h,d,p;if(F(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),F(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),F(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),F(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[c,h,d]=gr(r,[1,1,1],-1);const v=W(c,i),y=W(h,o),w=W(d,a);p=fe(fe(v,y),w)}else p=t;if(e==="otsu"){const v=uP(Se(iC(p),"int32"),Li([]),256);u=Gee(v,l)}const f=n?nc(p,u):Tr(p,u);return Se(W(f,255),"int32")}function Gee(t,e){let n=Tn([-1]),s=Tn([0]),r=Tn([0]),i,o,a,l,u,c;for(let h=0;h<t.size-1;h++){i=je(t,0,h+1),o=je(t,h+1),u=_e(De(i),e),c=_e(De(o),e);const d=De(W(i,$h(0,i.size)));a=_e(d,De(i));const p=Kh(o.shape,i.size),f=fe($h(0,o.size),p),m=W(o,f);l=_e(De(m),De(o));const v=Ne(a,l),y=Ne(a,l),w=W(u,c);r=W(W(w,v),y);const b=Tr(r,s);s=ys(b,r,s),n=ys(b,Tn([h]),n)}return n}const Hee=U({threshold_:jee});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qee(t,e,n="nearest",s="constant",r=0,i){const o=L(t,"image","transform","float32"),a=L(e,"transforms","transform","float32");F(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),F(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),F(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},u={interpolation:n,fillMode:s,fillValue:r,outputShape:i};return j.runKernel(_T,l,u)}const Kee=U({transform_:qee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xee(t,e,n){const s=L(t,"a","bandPart");F(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(F(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),F(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=L(e<0?i:e,"numLower","bandPart")):(F(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=ys(qp(e,0),i,zu(e,i))),typeof n=="number"?(F(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),F(n<=o,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`),l=L(n<0?o:n,"numUpper","bandPart")):(F(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=ys(qp(n,0),o,zu(n,o)));const u=H($h(0,i,1,"int32"),[-1,1]),c=$h(0,o,1,"int32"),h=Ne(u,c),d=ko(nc(h,a),$l(h,qt(l))),p=Nn([i,o],s.dtype);return H(wr(di(H(s,[-1,i,o])).map(f=>ys(d,f,p))),r)}const Yee=U({bandPart_:Xee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qee(t){let e;if(Array.isArray(t)){e=!1,F(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=t[0].shape[0];for(let i=1;i<t.length;++i)F(t[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[i].shape[0]} vs. ${r})`)}else e=!0,t=gr(t,t.shape[0],0).map(r=>mn(r,[0]));F(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],s=t;for(let r=0;r<t.length;++r)n.push(j.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=W(De(W(n[o],i)),n[o]);i=Ne(i,a)}return _e(i,Im(i,"euclidean"))}));return e?wr(n,0):n}const Jee=U({gramSchmidt_:Qee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zee(t,e=!1){if(F(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return jN(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,u)=>l*u),s=di(H(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[u,c]=jN(l,e);r.push(u),i.push(c)});const o=H(wr(r,0),t.shape),a=H(wr(i,0),t.shape);return[o,a]}}function jN(t,e=!1){return j.tidy(()=>{F(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],s=t.shape[1];let r=GT(n),i=Ko(t);const o=gu([[1]],[1,1]);let a=Ko(o);const l=n>=s?s:n;for(let u=0;u<l;++u){const c=i,h=a,d=r;[a,i,r]=j.tidy(()=>{const p=je(i,[u,u],[n-u,1]),f=Im(p),m=je(i,[u,u],[1,1]),v=ys(Tr(m,0),gu([[-1]]),gu([[1]])),y=Ne(m,W(v,f)),w=_e(p,y);w.shape[0]===1?a=Ko(o):a=hn([o,je(w,[1,0],[w.shape[0]-1,w.shape[1]])],0);const b=qt(_e(it(v,y),f)),I=je(i,[u,0],[n-u,s]),k=W(b,a),R=pt(a);if(u===0)i=Ne(I,it(k,it(R,I)));else{const N=Ne(I,it(k,it(R,I)));i=hn([je(i,[0,0],[u,s]),N],0)}const C=pt(k),T=je(r,[0,u],[n,r.shape[1]-u]);if(u===0)r=Ne(T,it(it(T,a),C));else{const N=Ne(T,it(it(T,a),C));r=hn([je(r,[0,0],[n,u]),N],1)}return[a,i,r]}),Ye([c,h,d])}return!e&&n>s&&(r=je(r,[0,0],[n,s]),i=je(i,[0,0],[s,s])),[r,i]})}const ete=U({qr_:Zee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var qs;(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(qs||(qs={}));function tte(t,e,n=qs.SUM_BY_NONZERO_WEIGHTS){const s=L(t,"losses","computeWeightedLoss");let r=null;e!=null&&(r=L(e,"weights","computeWeightedLoss"));const i=r==null?s:W(s,r);if(n===qs.NONE)return i;if(n===qs.SUM)return De(i);if(n===qs.MEAN){if(r==null)return un(i);{const o=s.size/r.size,a=_e(De(i),De(r));return o>1?_e(a,Be(o)):a}}if(n===qs.SUM_BY_NONZERO_WEIGHTS){if(r==null)return _e(De(i),Be(s.size));{const o=W(r,hr(s.shape)),a=Se(De(Nh(o,Be(0))),"float32");return _e(De(i),a)}}throw Error(`Unknown reduction: ${n}`)}const da=U({computeWeightedLoss_:tte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nte(t,e,n,s=qs.SUM_BY_NONZERO_WEIGHTS){const r=L(t,"labels","absoluteDifference"),i=L(e,"predictions","absoluteDifference");let o=null;n!=null&&(o=L(n,"weights","absoluteDifference")),Ir(r.shape,i.shape,"Error in absoluteDifference: ");const a=kn(Ne(r,i));return da(a,o,s)}const ste=U({absoluteDifference_:nte});function rte(t,e,n,s,r=qs.SUM_BY_NONZERO_WEIGHTS){const i=L(t,"labels","cosineDistance"),o=L(e,"predictions","cosineDistance");let a=null;s!=null&&(a=L(s,"weights","cosineDistance")),Ir(i.shape,o.shape,"Error in cosineDistance: ");const l=Be(1),u=Ne(l,De(W(i,o),n,!0));return da(u,a,r)}const ite=U({cosineDistance_:rte});function ote(t,e,n,s=qs.SUM_BY_NONZERO_WEIGHTS){let r=L(t,"labels","hingeLoss");const i=L(e,"predictions","hingeLoss");let o=null;n!=null&&(o=L(n,"weights","hingeLoss")),Ir(r.shape,i.shape,"Error in hingeLoss: ");const a=Be(1);r=Ne(W(Be(2),r),a);const l=$o(Ne(a,W(r,i)));return da(l,o,s)}const ate=U({hingeLoss_:ote});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lte(t,e,n,s=1,r=qs.SUM_BY_NONZERO_WEIGHTS){const i=L(t,"labels","huberLoss"),o=L(e,"predictions","huberLoss");let a=null;n!=null&&(a=L(n,"weights","huberLoss")),Ir(i.shape,o.shape,"Error in huberLoss: ");const l=Be(s),u=kn(Ne(o,i)),c=zu(u,l),h=Ne(u,c),d=fe(W(Be(.5),Vt(c)),W(l,h));return da(d,a,r)}const ute=U({huberLoss_:lte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cte(t,e,n,s=1e-7,r=qs.SUM_BY_NONZERO_WEIGHTS){const i=L(t,"labels","logLoss"),o=L(e,"predictions","logLoss");let a=null;n!=null&&(a=L(n,"weights","logLoss")),Ir(i.shape,o.shape,"Error in logLoss: ");const l=Be(1),u=Be(s),c=qt(W(i,Fr(fe(o,u)))),h=W(Ne(l,i),Fr(fe(Ne(l,o),u))),d=Ne(c,h);return da(d,a,r)}const hte=U({logLoss_:cte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dte(t,e,n,s=qs.SUM_BY_NONZERO_WEIGHTS){const r=L(t,"labels","meanSquaredError"),i=L(e,"predictions","meanSquaredError");let o=null;n!=null&&(o=L(n,"weights","meanSquaredError")),Ir(r.shape,i.shape,"Error in meanSquaredError: ");const a=pC(r,i);return da(a,o,s)}const pte=U({meanSquaredError_:dte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fte(t,e){const n=L(t,"labels","sigmoidCrossEntropyWithLogits"),s=L(e,"logits","sigmoidCrossEntropyWithLogits");Ir(n.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const r=$o(s),i=W(s,n),o=kv(Ps(qt(kn(s))));return fe(Ne(r,i),o)}function mte(t,e,n,s=0,r=qs.SUM_BY_NONZERO_WEIGHTS){let i=L(t,"multiClassLabels","sigmoidCrossEntropy");const o=L(e,"logits","sigmoidCrossEntropy");let a=null;if(n!=null&&(a=L(n,"weights","sigmoidCrossEntropy")),Ir(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),s>0){const u=Be(s),c=Be(1),h=Be(.5);i=fe(W(i,Ne(c,u)),W(h,u))}const l=fte(i,o);return da(l,a,r)}const gte=U({sigmoidCrossEntropy_:mte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yte(t,e,n=-1){if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);return sa((r,i,o)=>{const l=Ev(i,[n],!0),u=Ne(Se(i,"float32"),l);o([r,u]);const c=qt(W(u,r));return{value:De(c,[n]),gradFunc:(p,f)=>{const[m,v]=f,y=wn(p.shape,[n]);return[W(H(p,y),Ne(Se(m,"float32"),Ps(v))),W(H(p,y),Ne(Ps(v),Se(m,"float32")))]}}})(t,e)}function vte(t,e,n,s=0,r=qs.SUM_BY_NONZERO_WEIGHTS){let i=L(t,"onehotLabels","softmaxCrossEntropy");const o=L(e,"logits","softmaxCrossEntropy");let a=null;if(n!=null&&(a=L(n,"weights","softmaxCrossEntropy")),Ir(i.shape,o.shape,"Error in softmaxCrossEntropy: "),s>0){const u=Be(s),c=Be(1),h=Be(i.shape[1]);i=fe(W(i,Ne(c,u)),_e(u,h))}const l=yte(i,o);return da(l,a,r)}const wte=U({softmaxCrossEntropy_:vte});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xte(t,e,n,s){const r=L(t,"indices","sparseFillEmptyRows","int32"),i=L(e,"values","sparseFillEmptyRows"),o=L(n,"denseShape","sparseFillEmptyRows","int32"),a=L(s,"defaultValue","sparseFillEmptyRows",i.dtype);if(r.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${r.shape}`);if(i.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${i.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const l={indices:r,values:i,denseShape:o,defaultValue:a},u=j.runKernel(yT,l);return{outputIndices:u[0],outputValues:u[1],emptyRowIndicator:u[2],reverseIndexMap:u[3]}}const bte=U({sparseFillEmptyRows_:xte});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ite(t,e,n){const s=L(t,"inputIndices","sparseReshape","int32"),r=L(e,"inputShape","sparseReshape","int32"),i=L(n,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(r.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${r.shape}`);if(i.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${i.shape}`);const o={inputIndices:s,inputShape:r,newShape:i},a=j.runKernel(vT,o);return{outputIndices:a[0],outputShape:a[1]}}const Ste=U({sparseReshape_:Ite});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tte(t,e,n){const s=L(t,"data","sparseSegmentMean"),r=L(e,"indices","sparseSegmentMean","int32"),i=L(n,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${i.shape}`);const o={data:s,indices:r,segmentIds:i};return j.runKernel(wT,o)}const Cte=U({sparseSegmentMean_:Tte});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kte(t,e,n){const s=L(t,"data","sparseSegmentSum"),r=L(e,"indices","sparseSegmentSum","int32"),i=L(n,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${i.shape}`);const o={data:s,indices:r,segmentIds:i};return j.runKernel(xT,o)}const Ete=U({sparseSegmentSum_:kte});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _te(t,e,n,s,r,i,o,a){const l=L(t,"data","stringNGrams","string");if(l.dtype!=="string")throw new Error("Data must be of datatype string");if(l.shape.length!==1)throw new Error(`Data must be a vector, saw: ${l.shape}`);const u=L(e,"dataSplits","stringNGrams");if(u.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const c={separator:n,nGramWidths:s,leftPad:r,rightPad:i,padWidth:o,preserveShortSequences:a},h={data:l,dataSplits:u},d=j.runKernel(TT,h,c);return{nGrams:d[0],nGramsSplits:d[1]}}const Nte=U({stringNGrams_:_te});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $te(t,e,n=!0){const s=L(t,"input","stringSplit","string"),r=L(e,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(r.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${r.shape}`);const i={skipEmpty:n},o={input:s,delimiter:r},a=j.runKernel(CT,o,i);return{indices:a[0],values:a[1],shape:a[2]}}const Ate=U({stringSplit_:$te});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rte(t,e){const n=L(t,"input","stringToHashBucketFast","string"),s={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const r={input:n};return j.runKernel(kT,r,s)}const Dte=U({stringToHashBucketFast_:Rte});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ote(t,e,n,s=!0){const r=L(t,"input","staticRegexReplace","string"),i={pattern:e,rewrite:n,replaceGlobal:s};return j.runKernel(gv,{x:r},i)}const Pte=U({staticRegexReplace_:Ote});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fte={fft:Lv,ifft:Yp,rfft:Mv,irfft:dC},Lte={hammingWindow:uee,hannWindow:ZP,frame:eF,stft:pee},Ar={flipLeftRight:yee,grayscaleToRGB:wee,resizeNearestNeighbor:nF,resizeBilinear:tF,rgbToGrayscale:bee,rotateWithOffset:See,cropAndResize:mee,nonMaxSuppression:Cee,nonMaxSuppressionAsync:Dee,nonMaxSuppressionWithScore:Pee,nonMaxSuppressionWithScoreAsync:Lee,nonMaxSuppressionPadded:Vee,nonMaxSuppressionPaddedAsync:Bee,threshold:Hee,transform:Kee},sF={bandPart:Yee,gramSchmidt:Jee,qr:ete},Mte={absoluteDifference:ste,computeWeightedLoss:da,cosineDistance:ite,hingeLoss:ate,huberLoss:ute,logLoss:hte,meanSquaredError:pte,sigmoidCrossEntropy:gte,softmaxCrossEntropy:wte},Vte={sparseFillEmptyRows:bte,sparseReshape:Ste,sparseSegmentMean:Cte,sparseSegmentSum:Ete},zte={stringNGrams:Nte,stringSplit:Ate,stringToHashBucketFast:Dte,staticRegexReplace:Pte};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bte=new Map,Ute=new Map;class Jh{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class Yr{constructor(){this.classNameMap={}}static getMap(){return Yr.instance==null&&(Yr.instance=new Yr),Yr.instance}static register(e){Yr.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function ge(t,e,n){F(t.className!=null,()=>"Class being registered does not have the static className property defined."),F(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),F(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const s=n,r=e+">"+s;return Yr.register(t),Bte.set(r,t),Ute.set(t,r),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rl extends Jh{minimize(e,n=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return Ye(i),n?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return fQ(e,n)}dispose(){this.iterations_!=null&&Ye(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Be(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Rl,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rF extends Rl{static get className(){return"Adadelta"}constructor(e,n,s=null){super(),this.learningRate=e,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=j.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=j.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:Y(()=>ft(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:Y(()=>ft(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;Y(()=>{const c=fe(W(l,this.rho),W(Vt(a),1-this.rho)),h=W(_e(ns(fe(u,this.epsilon)),ns(fe(l,this.epsilon))),a),d=fe(W(u,this.rho),W(Vt(h),1-this.rho));l.assign(c),u.assign(d);const p=fe(W(h,-this.learningRate),i);i.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Ye(this.accumulatedGrads.map(e=>e.variable)),Ye(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iF extends Rl{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=j.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:Y(()=>Kh(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;Y(()=>{const l=fe(a,Vt(o));a.assign(l);const u=fe(W(_e(o,ns(fe(l,j.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Ye(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oF extends Rl{static get className(){return"Adam"}constructor(e,n,s,r=null){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Y(()=>{this.accBeta1=Be(n).variable(),this.accBeta2=Be(s).variable()}),r==null&&(this.epsilon=j.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);Y(()=>{const s=Ne(1,this.accBeta1),r=Ne(1,this.accBeta2);n.forEach((i,o)=>{const a=j.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:Y(()=>ft(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:Y(()=>ft(a).variable(l))});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const c=this.accumulatedFirstMoment[o].variable,h=this.accumulatedSecondMoment[o].variable,d=fe(W(c,this.beta1),W(u,1-this.beta1)),p=fe(W(h,this.beta2),W(Vt(u),1-this.beta2)),f=_e(d,s),m=_e(p,r);c.assign(d),h.assign(p);const v=fe(W(_e(f,fe(ns(m),this.epsilon)),-this.learningRate),a);a.assign(v)}),this.accBeta1.assign(W(this.accBeta1,this.beta1)),this.accBeta2.assign(W(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ye(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Ye(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),Y(()=>{this.accBeta1.assign(na(this.beta1,this.iterations_+1)),this.accBeta2.assign(na(this.beta2,this.iterations_+1))});const n=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aF extends Rl{static get className(){return"Adamax"}constructor(e,n,s,r=null,i=0){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Y(()=>{this.iteration=Be(0).variable(),this.accBeta1=Be(n).variable()}),r==null&&(this.epsilon=j.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);Y(()=>{const s=Ne(1,this.accBeta1),r=_e(-this.learningRate,fe(W(this.iteration,this.decay),1));n.forEach((i,o)=>{const a=j.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:ft(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:ft(a).variable(l)});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const c=this.accumulatedFirstMoment[o].variable,h=this.accumulatedWeightedInfNorm[o].variable,d=fe(W(c,this.beta1),W(u,1-this.beta1)),p=W(h,this.beta2),f=kn(u),m=ha(p,f);c.assign(d),h.assign(m);const v=fe(W(_e(r,s),_e(d,fe(m,this.epsilon))),a);a.assign(v)}),this.iteration.assign(fe(this.iteration,1)),this.accBeta1.assign(W(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ye(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Ye(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TC extends Rl{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=j.registeredVariables[s];Y(()=>{const a=fe(W(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Un(Be(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lF extends TC{static get className(){return"Momentum"}constructor(e,n,s=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=Be(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=j.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:Y(()=>ft(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&Y(()=>{let l;const u=fe(W(this.m,o),a);this.useNesterov?l=fe(W(this.c,fe(a,W(u,this.m))),i):l=fe(W(this.c,u),i),o.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Ye(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uF extends Rl{static get className(){return"RMSProp"}constructor(e,n=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=j.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=j.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:Y(()=>ft(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:Y(()=>ft(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:Y(()=>ft(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;Y(()=>{const c=fe(W(l,this.decay),W(Vt(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[r].variable,d=fe(W(h,this.decay),W(a,1-this.decay)),p=_e(W(a,this.learningRate),ns(Ne(c,fe(Vt(d),this.epsilon)))),f=fe(W(u,this.momentum),p);l.assign(c),h.assign(d),u.assign(f);const m=Ne(i,f);i.assign(m)}else{const h=fe(W(l,this.decay),W(Vt(a),1-this.decay)),d=fe(W(u,this.momentum),_e(W(a,this.learningRate),ns(fe(h,this.epsilon))));l.assign(h),u.assign(d);const p=Ne(i,d);i.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Ye(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Ye(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Ye(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wte=[rF,iF,oF,aF,lF,uF,TC];function jte(){for(const t of Wte)ge(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gte="model",Hte=".json",qte=".weights.bin";function GN(t){return new Promise(e=>setTimeout(e)).then(t)}class Bu{constructor(e){if(!te().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(Bu.URL_SCHEME)&&(e=e.slice(Bu.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Gte),this.modelJsonFileName=e+Hte,this.weightDataFileName=e+qte}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=Xi.join(e.weightData),s=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=zO(e,r),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=o,await GN(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=s,await GN(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:ym(e)}}}}Bu.URL_SCHEME="downloads://";class Kte{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,n)=>{const s=new FileReader;s.onload=r=>{const i=JSON.parse(r.target.result),o=i.modelTopology;if(o==null){n(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(i.weightsManifest==null){n(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:o});return}const l=OT(i,u=>this.loadWeights(u));e(l)},s.onerror=r=>n(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(this.jsonFile)})}loadWeights(e){const n=[],s=[];for(const o of e)n.push(...o.weights),s.push(...o.paths);const r=this.checkManifestAndWeightFiles(e),i=s.map(o=>this.loadWeightsFile(o,r[o]));return Promise.all(i).then(o=>[n,o])}loadWeightsFile(e,n){return new Promise((s,r)=>{const i=new FileReader;i.onload=o=>{const a=o.target.result;s(a)},i.onerror=o=>r(`Failed to weights data from file of path '${e}'.`),i.readAsArrayBuffer(n)})}checkManifestAndWeightFiles(e){const n=[],s=this.weightsFiles.map(i=>UN(i.name)),r={};for(const i of e)i.paths.forEach(o=>{const a=UN(o);if(n.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(n.push(a),s.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);r[o]=this.weightsFiles[s.indexOf(a)]});if(n.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}const Xte=t=>te().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Bu.URL_SCHEME)?Yte(t.slice(Bu.URL_SCHEME.length)):null;nn.registerSaveRouter(Xte);function Yte(t="model"){return new Bu(t)}function Qte(t){return new Kte(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HN(t,e,n,s){o(t),n=n??0,s=s??1,a(n,s);let r=0;const i=l=>(l.then(u=>{const c=n+ ++r/t.length*(s-n);return e(c),u}),l);function o(l){F(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){F(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),F(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),F(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(t.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function cF(t,e){e==null&&(e={});const n=e.fetchFunc==null?te().platform.fetch:e.fetchFunc,s=t.map(h=>n(h,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await HN(s,e.onProgress,0,.5)).map(h=>h.arrayBuffer());return e.onProgress==null?await Promise.all(a):await HN(a,e.onProgress,.5,1)}function Jte(t,e){var n;const s=e.fetchFunc==null?te().platform.fetch:e.fetchFunc;let r=0,i;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:async o=>{for(var a;r<t.length;){i||(i=(await s(t[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await i.read();if(l){r++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/t.length);continue}o.enqueue(u);return}o.close()}})}async function Zte(t,e="",n,s){return hF(o=>cF(o,{requestInit:s}))(t,e,n)}function hF(t){return async(e,n="",s)=>{const r=e.map(()=>!1),i={},o=s!=null?s.map(()=>!1):[],a=[];if(e.forEach((p,f)=>{let m=0;p.weights.forEach(v=>{const y="quantization"in v?v.quantization.dtype:v.dtype,w=Pu[y]*re(v.shape),b=()=>{r[f]=!0,i[f]==null&&(i[f]=[]),i[f].push({manifestEntry:v,groupOffset:m,sizeBytes:w})};s!=null?s.forEach((I,k)=>{I===v.name&&(b(),o[k]=!0)}):b(),a.push(v.name),m+=w})}),!o.every(p=>p)){const p=s.filter((f,m)=>!o[m]);throw new Error(`Could not find weights in manifest with names: ${p.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}const l=r.reduce((p,f,m)=>(f&&p.push(m),p),[]),u=[];l.forEach(p=>{e[p].paths.forEach(f=>{const m=n+(n.endsWith("/")?"":"/")+f;u.push(m)})});const c=await t(u),h={};let d=0;return l.forEach(p=>{const f=e[p].paths.length,m=new Xi(c.slice(d,d+f));i[p].forEach(y=>{const w=m.slice(y.groupOffset,y.groupOffset+y.sizeBytes),b=FO(w,[y.manifestEntry]);for(const I in b)h[I]=b[I]}),d+=f}),h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ene="application/octet-stream",tne="application/json";class CC{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(F(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=te().platform.fetch,F(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&F(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=zO(e,s);if(n.body.append("model.json",new Blob([JSON.stringify(r)],{type:tne}),"model.json"),e.weightData!=null){const o=Xi.join(e.weightData);n.body.append("model.weights.bin",new Blob([o],{type:ene}),"model.weights.bin")}const i=await this.fetch(this.path,n);if(i.ok)return{modelArtifactsInfo:ym(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=n.modelTopology,r=n.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return OT(e,n=>this.loadWeights(n))}async loadStream(){const e=await this.loadModelJSON(),n=await this.getWeightUrls(e.weightsManifest),s=ob(e.weightsManifest),r=()=>Jte(n,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=nne(n),i=this.weightPathPrefix||s,o=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):o.push(i+u+r);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const n=await this.getWeightUrls(e),s=ob(e),r=await cF(n,this.loadOptions);return[s,r]}}CC.URL_SCHEME_REGEX=/^https?:\/\//;function nne(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),s=t.substring(0,e),r=n>e?t.substring(n):"";return[s+"/",r]}function pb(t){return t.match(CC.URL_SCHEME_REGEX)!=null}const dF=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(s=>pb(s)):n=pb(t),n)return kC(t,e)}return null};nn.registerSaveRouter(dF);nn.registerLoadRouter(dF);function kC(t,e){return new CC(t,e)}function sne(t,e){return kC(t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cx{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class pF{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class rne{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=n=>Promise.resolve(e.save(n)))}}function ine(t,e,n,s){const r=arguments;return new rne(fF(...r))}function fF(t,e,n,s){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new cx(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new cx({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new cx({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:s}))}function one(t){return new pF(t)}function ane(t){return new pF(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mF=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:Xi,browserFiles:Qte,browserHTTPRequest:sne,concatenateArrayBuffers:VO,copyModel:uX,decodeWeights:FO,decodeWeightsStream:MO,encodeWeights:ib,fromMemory:ine,fromMemorySync:fF,getLoadHandlers:XK,getModelArtifactsForJSON:OT,getModelArtifactsForJSONSync:BO,getModelArtifactsInfoForJSON:ym,getSaveHandlers:UO,getWeightSpecs:ob,http:kC,isHTTPScheme:pb,listModels:aX,loadWeights:Zte,moveModel:cX,registerLoadRouter:KK,registerSaveRouter:qK,removeModel:lX,weightsLoaderFactory:hF,withSaveHandler:one,withSaveHandlerSync:ane},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let ql;function lne(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,s=!1,r=!1,i=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)r=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)i=!0;else if(t.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&t instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);if(J2(Y2,j.backendName)!=null){const f={pixels:t},m={numChannels:e};return j.runKernel(Y2,f,m)}const[u,c]=r?[t.videoWidth,t.videoHeight]:[t.width,t.height];let h;if(o)h=t.getContext("2d").getImageData(0,0,u,c).data;else if(s||n)h=t.data;else if(i||r||a){if(ql==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")ql=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else ql=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});ql.canvas.width=u,ql.canvas.height=c,ql.drawImage(t,0,0,u,c),h=ql.getImageData(0,0,u,c).data}let d;if(e===4)d=new Int32Array(h);else{const f=u*c;d=new Int32Array(f*e);for(let m=0;m<f;m++)for(let v=0;v<e;++v)d[m*e+v]=h[m*4+v]}return UP(d,[c,u,e],"int32")}function une(t){if(t.rank!==2&&t.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${t.rank}.`);const e=t.rank===2?1:t.shape[2];if(e>4||e===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if(t.dtype!=="float32"&&t.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${t.dtype}. Please use float32 or int32 tensors.`)}async function cne(t,e){let n=L(t,"img","toPixels");if(!(t instanceof Mt)){const u=n;n=Se(u,"int32"),u.dispose()}une(n);const[s,r]=n.shape.slice(0,2),i=n.rank===2?1:n.shape[2],o=await n.data(),a=n.dtype==="float32"?255:1,l=new Uint8ClampedArray(r*s*4);for(let u=0;u<s*r;++u){const c=[0,0,0,255];for(let d=0;d<i;d++){const p=o[u*i+d];if(n.dtype==="float32"){if(p<0||p>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${p}.`)}else if(n.dtype==="int32"&&(p<0||p>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${p}.`);i===1?(c[0]=p*a,c[1]=p*a,c[2]=p*a):c[d]=p*a}const h=u*4;l[h+0]=Math.round(c[0]),l[h+1]=Math.round(c[1]),l[h+2]=Math.round(c[2]),l[h+3]=Math.round(c[3])}return n!==t&&n.dispose(),l}const hne=U({fromPixels_:lne});function EC(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(re(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let h=0;h<r.length-1;++h)o*=r[h];const a=t.shape,l=r.slice();l.pop();let u=1;for(let h=i;h<n;++h)u*=a[h],l.push(a[h]);const c=[...Ve(t.shape).map(h=>h/u),1].slice(0,i);return[l,o,u,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fb=-2,dne=-1;function _C(t,e,n){const s=t.shape.length;F(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),F(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)F(e[r]+n[r]<=t.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+n[r]}) would overflow input.shape[${r}] (${t.shape[r]})`)}function pne(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function NC(t,e,n){const s=[];for(let r=0;r<t.length;r++)s[r]=Math.ceil((e[r]-t[r])/n[r]);return s}function gF(t,e,n,s){const r=[...t];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<n;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function yF(t,e,n){return n<=t?n:n-(e-1)}function vF(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function fne(t,e,n,s,r,i,o,a,l){const u=t.length;let c=new Array(u),h=new Array(u),d=new Array(u);if(e.length&&n>0){const p=e[0],f=n+1;c=wF(o,p,f,s,t),h=xF(a,p,f,r,t),d=gF(i,p,f,t)}else for(let p=0;p<u;p++)c[p]=IF(o,s,i,t,p,l),h[p]=SF(a,r,i,t,p,l),d[p]=bF(i,p,l);return{begin:c,end:h,strides:d}}function wF(t,e,n,s,r){const i=[...r],o=vF(n,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=yF(e,n,a);let u=s[l];t&1<<l&&(u=0),i[a]=u}return i}function xF(t,e,n,s,r){const i=[...r],o=vF(n,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=yF(e,n,a);let u=s[l];t&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=Ru(0,i[a],r[a])}return i}function bF(t,e,n){let s=t[e];return(n&1<<e||s==null)&&(s=1),s}function IF(t,e,n,s,r,i){let o=e[r];const a=n[r]||1;(t&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=Ru(0,o,l-1),o}function SF(t,e,n,s,r,i){let o=e[r];const a=n[r]||1;(t&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=Ru(0,o,l):o=Ru(-1,o,l-1),o}function $C(t,e,n){let s=n.length;for(let r=0;r<n.length;r++)if(n[r]>1){s=r;break}for(let r=s+1;r<n.length;r++)if(e[r]>0||n[r]!==t[r])return!1;return!0}function AC(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function Wv(t,e,n){let s;const r=t.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{F(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return n==null?i=new Array(r).fill(-1):typeof n=="number"?i=[n,...new Array(r-1).fill(-1)]:n.length<r?i=n.concat(new Array(r-n.length).fill(-1)):i=n,i=i.map((o,a)=>o>=0?o:(F(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),t.shape[a]-s[a])),[s,i]}function RC(t,e,n,s,r,i,o,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const h={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:u.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let b=0;b<h.dims;b++)c&&1<<b&a&&h.numAddAxisAfterEllipsis++,1<<b&o&&(c=!0);c||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};mne(h,d);let p=!0,f=!0,m=!0;const v=[],y=[];for(let b=0;b<t.length;++b){if(d.strides[b]===0)throw Error(`strides[${b}] must be non-zero`);const I=!!(d.shrinkAxisMask&1<<b),k=t[b];if(k===-1){v.push(I?1:-1);continue}const R=[d.beginMask&1<<b,d.endMask&1<<b],C=[d.strides[b]>0?0:-1,d.strides[b]>0?k:k-1];if(I&&d.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&d.strides[b]===1;const T=!!(d.beginMask&1<<b&&d.endMask&1<<b);if(d.beginValid&&d.endValid){if(I){const V=d.begin[b]<0?k+d.begin[b]:d.begin[b];if(d.begin[b]=V,d.end[b]=d.begin[b]+1,V<0||V>=k)throw Error(`slice index ${d.begin[b]} of dimension ${b} out of bounds.`)}else d.begin[b]=qN(d.begin[b],0,d.strides[b],k,R,C),d.end[b]=qN(d.end[b],1,d.strides[b],k,R,C);const P=d.strides[b]===1&&d.begin[b]===0&&d.end[b]===k;p=p&&P,f=f&&(b===0&&d.strides[b]===1||P)}else p=p&&d.strides[b]===1&&T,f=f&&(b===0&&d.strides[b]===1||T);let N,$=!1;if(d.beginValid&&d.endValid?(N=d.end[b]-d.begin[b],$=!0):I?(N=1,$=!0):T&&k>=0&&(d.strides[b]<0?N=-k:N=k,$=!0),$){let P;N===0||N<0!=d.strides[b]<0?P=0:P=Math.trunc(N/d.strides[b])+(N%d.strides[b]!==0?1:0),v.push(P)}else v.push(-1)}for(let b=0;b<d.finalShapeGatherIndices.length;++b){const I=d.finalShapeGatherIndices[b];I>=0?y.push(v[I]):I===fb&&y.push(1)}return{finalShapeSparse:y.filter((b,I)=>d.finalShapeGatherIndices[I]!==fb),finalShape:y,isIdentity:p,sliceDim0:f,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function mne(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<t.dims;s++)if(1<<s&t.ellipsisMask){const r=Math.min(e.dims-(t.dims-s)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<r;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&t.newAxisMask)e.finalShapeGatherIndices.push(fb),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[s]),t.end!=null&&(e.end[n]=t.end[s]),e.strides[n]=t.strides[s],t.beginMask&1<<s&&(e.beginMask|=1<<n),t.endMask&1<<s&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(dne),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[n]=s,n++}}function qN(t,e,n,s,r,i){if(r[e])return n>0?i[e]:i[e+1&1];{const o=t<0?s+t:t;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const gne=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:_C,computeFlatOffset:AC,computeOutShape:NC,getNormalizedAxes:fne,isSliceContinous:$C,maskToAxes:pne,parseSliceParams:Wv,sliceInfo:RC,startForAxis:IF,startIndicesWithElidedDims:wF,stopForAxis:SF,stopIndicesWithElidedDims:xF,stridesForAxis:bF,stridesWithElidedDims:gF},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yne{static sgd(e){return new TC(e)}static momentum(e,n,s=!1){return new lF(e,n,s)}static rmsprop(e,n=.9,s=0,r=null,i=!1){return new uF(e,n,s,r,i)}static adam(e=.001,n=.9,s=.999,r=null){return new oF(e,n,s,r)}static adadelta(e=.001,n=.95,s=null){return new rF(e,n,s)}static adamax(e=.002,n=.9,s=.999,r=null,i=0){return new aF(e,n,s,r,i)}static adagrad(e,n=.1){return new iF(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cc=yne;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vne=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function TF(){return new Promise(t=>vne(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DC(t,e){const n=t[0].length;t.forEach((r,i)=>{F(r.length===n,()=>`Error in concat${n}D: rank of tensors[${i}] must be the same as the rank of the rest (${n})`)}),F(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=t[0];t.forEach((r,i)=>{for(let o=0;o<n;o++)F(o===e||r[o]===s[o],()=>`Error in concat${n}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function xo(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var $i;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})($i||($i={}));function CF(t,e,n){let s=new Array;if(n==null&&e==null)return s;if(e==null)for(;s.length<t+n.length;)s.push(-1);else s=e.slice();if(n==null)return s;if(t+n.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${s.length}`);for(let r=1;r<n.length;++r){const i=n[r],o=s[s.length-n.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+t}] = ${i} but shape[${r+t}] = ${a}`)}else s[o]=i}return s}function kF(t){const e={FIRST_DIM_SIZE:$i.FIRST_DIM_SIZE,VALUE_ROWIDS:$i.VALUE_ROWIDS,ROW_LENGTHS:$i.ROW_LENGTHS,ROW_SPLITS:$i.ROW_SPLITS,ROW_LIMITS:$i.ROW_LIMITS,ROW_STARTS:$i.ROW_STARTS},n=[];for(const s of t)if(s in e)n.push(e[s]);else break;return n}function EF(t){return t.length===0?0:t[0]===$i.FIRST_DIM_SIZE?t.length-1:t.length}function _F(t,e){if(t==null||e==null)return;const n=t.length,s=e.length;if(n>=s)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(n,s-1);++r){const i=t[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-t.length}] = ${i} but ragged tensor input.flatValues.shape[${r-t.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OC=30;function jv(t){return t<=OC?t:q2(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PC(t,e,n){const s=n*(typeof t=="number"?t:t[0]),r=e*(typeof t=="number"?t:t[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cm(t,e,n,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(t[0]/n),r=r.concat(t.slice(1));else{r=r.concat(t[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([t[o+1]/e[o],e[o]]);r=r.concat(t.slice(i+1))}return r}function km(t,e,n=!0){const s=[];if(n){s.push(e);for(let r=e+1;r<t;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<t;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function Em(t,e,n,s=!0){const r=[];s?r.push(t[0]/n):r.push(t[0]*n);for(let i=1;i<t.length;++i)i<=e.length?s?r.push(e[i-1]*t[i]):r.push(t[i]/e[i-1]):r.push(t[i]);return r}function FC(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function LC(t,e,n){const s=t.slice(0,1);for(let r=0;r<n;++r)s.push(t[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gv=1.7580993408473768,Hv=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MC=.3275911,VC=.254829592,zC=-.284496736,BC=1.421413741,UC=-1.453152027,WC=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ra(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function NF(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function $F(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function AF(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function jC(t,e){const n=t[e*2],s=t[e*2+1];return{real:n,imag:s}}function RF(t,e,n,s){t[s*2]=e,t[s*2+1]=n}function DF(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let r=0;r<Math.ceil(t/2);r++){const i=(e?2:-2)*Math.PI*(r/t);n[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:n,imag:s}}function OF(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hx="->",wne=/->/g,KN=",",XN="...";function GC(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(wne,"").length)/hx.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${hx}").`);const[s,r]=t.split(hx);F(s.indexOf(XN)===-1,()=>`The ellipsis notation ("${XN}") is not supported yet.`);const i=s.split(KN),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let d=0;d<r.length;++d){const p=r[d];if(!i.some(f=>f.indexOf(p)!==-1))throw new Error(`Output subscripts contain the label ${p} not present in the input subscripts.`);a.indexOf(p)===-1&&a.push(p)}for(let d=0;d<s.length;++d){const p=s[d];a.indexOf(p)===-1&&p!==KN&&a.push(p)}const l=new Array(i.length);for(let d=0;d<o;++d){if(new Set(i[d].split("")).size!==i[d].length)throw new Error(`Found duplicate axes in input component ${i[d]}. Support for duplicate axes in input is not implemented yet.`);l[d]=[];for(let p=0;p<i[d].length;++p)l[d].push(a.indexOf(i[d][p]))}const u=a.length,c=r.length,h=[];for(let d=c;d<u;++d)h.push(d);return{allDims:a,summedDims:h,idDims:l}}function HC(t,e){let n=new Array(t);n.fill(-1);for(let r=0;r<e.length;++r)n[e[r]]=r;const s=[];for(let r=0;r<t;++r)n[r]===-1&&s.push(r);return n=n.filter(r=>r!==-1),{permutationIndices:n,expandDims:s}}function qC(t,e,n){const s=new Array(t);for(let r=0;r<n.length;++r){const i=n[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:F(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function KC(t,e){const n=t,s=[];let r=0;t.length===0&&n.push(-1),r=t.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<n.length;++o){const a=n[o],l=xne(e,a);for(const u of l)i.indexOf(u)===-1&&(s[o].push(u),i.push(u))}return{path:n,steps:s}}function XC(t){return t.every((e,n)=>e===n)}function xne(t,e){const n=[];for(let s=0;s<t.length;++s)(t[s].length===0||t[s].indexOf(e)!==-1||e===-1)&&n.push(s);return n}function YC(t,e,n=0){let s=[];if(typeof e=="number")F(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(t.shape[n]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);F(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=t.shape[n]-o}F(t.shape[n]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PF(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function FF(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function LF(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MF(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function VF(t,e){return`size ${t} must be non-negative, not ${e}`}function zF(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function BF(t,e){const n=re(t),s=re(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${t} outputShape= ${e}`}function UF(t,e){const n=re(t),s=re(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mb(){return"segment ids must be >= 0"}function WF(){return"segment ids are not increasing"}function jF(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function GF(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HF(t,e){let n=!1,s;for(t<=OC?(s=t,n=!0):s=q2(t,Math.floor(Math.sqrt(t)));!n;)s>e||s===t?n=!0:s=q2(t,s+1);return s}function qF(t,e,n){const s=[],r=t.length;for(let i=0;i<r;i++)i!==e?s.push(t[i]):s.push(n);return s}function QC(t,e,n,s){const r=e.shape.length,i=t.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let h=0;h<s;++h)if(t.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${t.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const o=t.shape[n],a=[];let l=1,u=1,c=1;for(let h=0;h<s;++h)a.push(t.shape[h]),l*=t.shape[h];for(let h=s;h<n;h++)a.push(t.shape[h]),u*=t.shape[h];for(let h=s;h<r;h++)a.push(e.shape[h]);for(let h=n+1;h<i;h++)a.push(t.shape[h]),c*=t.shape[h];return{batchSize:l,sliceSize:c,outerSize:u,dimSize:o,outputShape:a}}const bne=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:QC,computeOutShape:qF,segOpComputeOptimalWindowSize:HF},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ia(t){try{return t.map(e=>ll(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function KF(t){return t.map(e=>Ja(e))}const Ine=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:VC,ERF_A2:zC,ERF_A3:BC,ERF_A4:UC,ERF_A5:WC,ERF_P:MC,PARALLELIZE_THRESHOLD:OC,get RowPartitionType(){return $i},SELU_SCALE:Hv,SELU_SCALEALPHA:Gv,applyActivation:Bv,assertAndGetBroadcastShape:Qe,assertAxesAreInnerMostDims:rs,assertParamsConsistent:DC,assignToTypedArray:RF,axesAreInnerMostDims:jT,calculateShapes:ic,checkEinsumDimSizes:qC,checkPadOnDimRoundingMode:Ls,combineLocations:IP,combineRaggedTensorToTensorShapes:CF,complexWithEvenIndex:$F,complexWithOddIndex:AF,computeConv2DInfo:jn,computeConv3DInfo:_l,computeDefaultPad:LT,computeDilation2DInfo:vm,computeOptimalWindowSize:jv,computeOutAndReduceShapes:Gn,computeOutShape:xo,computePool2DInfo:pi,computePool3DInfo:ua,convertConv2DDataFormat:ca,decodeEinsumEquation:GC,eitherStridesOrDilationsAreOne:ss,expandShapeToKeepDim:wn,exponent:OF,exponents:DF,fromStringArrayToUint8:KF,fromUint8ToStringArray:ia,getAxesPermutation:on,getBroadcastDims:_h,getComplexWithIndex:jC,getEinsumComputePath:KC,getEinsumPermutation:HC,getFusedBiasGradient:zv,getFusedDyActivation:Vv,getImageCenter:PC,getInnerMostAxes:xn,getPermuted:km,getRaggedRank:EF,getReductionAxes:Pn,getReshaped:Cm,getReshapedPermuted:Em,getRowPartitionTypesHelper:kF,getSliceBeginCoords:FC,getSliceSize:LC,getSparseFillEmptyRowsIndicesDenseShapeMismatch:PF,getSparseFillEmptyRowsNegativeIndexErrorMessage:FF,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:LF,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:zF,getSparseReshapeInputOutputMismatchErrorMessage:UF,getSparseReshapeInputOutputMultipleErrorMessage:BF,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:MF,getSparseReshapeNegativeOutputDimErrorMessage:VF,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:GF,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:mb,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:WF,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:jF,getUndoAxesPermutation:Nl,isIdentityPermutation:XC,log:lK,mergeRealAndImagArrays:ra,prepareAndValidate:EC,prepareSplitSize:YC,segment_util:bne,shouldFuse:Uv,slice_util:gne,splitRealAndImagArrays:NF,stridesOrDilationsArePositive:Mu,tupleValuesAreOne:hl,upcastType:vr,validateDefaultValueShape:_F,validateInput:fC,validateUpdateShape:WP,warn:Nr},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */jte();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XF={kernelName:y0,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>W(t,Yh(Se(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sne={kernelName:If,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Vt(Se(n,"float32")),r=ns(Ne(Be(1),s));return qt(_e(t,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tne={kernelName:Sf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=ns(Ne(Vt(Se(n,"float32")),1));return _e(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cne={kernelName:qh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Qe(n.shape,s.shape);return{a:()=>{let a=t;const l=Pn(n.shape,r);return l.length>0&&(a=De(a,l)),H(a,n.shape)},b:()=>{let a=t;const l=Pn(s.shape,r);return l.length>0&&(a=De(a,l)),H(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kne={kernelName:v0,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((s,r)=>{n[r]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ene={kernelName:w0,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ft(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ne={kernelName:x0,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ft(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nne={kernelName:Tf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>_e(t,ns(Ne(Be(1),Vt(Se(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ne={kernelName:Cf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=ns(fe(Be(1),Vt(Se(n,"float32"))));return _e(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ane={kernelName:_f,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Qe(n.shape,s.shape);return{a:()=>{const a=fe(Vt(n),Vt(s));let l=W(t,_e(s,a));const u=Pn(n.shape,r);return u.length>0&&(l=De(l,u)),H(l,n.shape)},b:()=>{const a=fe(Vt(n),Vt(s));let l=qt(W(t,_e(n,a)));const u=Pn(s.shape,r);return u.length>0&&(l=De(l,u)),H(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rne={kernelName:kf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>_e(t,fe(Vt(Se(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dne={kernelName:Ef,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>_e(t,Ne(Be(1),Vt(Se(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function One(t,e,n,s,r,i){const o=L(t,"dy","avgPool3dGrad"),a=L(e,"input","avgPool3dGrad");let l=o,u=a,c=!1;a.rank===4&&(c=!0,l=H(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=H(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),F(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),F(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),Ls("avgPool3dGrad",r,i);const h={dy:l,input:u},d={filterSize:n,strides:s,pad:r,dimRoundingMode:i},p=j.runKernel($S,h,d);return c?H(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const Pne=U({avgPool3dGrad_:One});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fne={kernelName:I0,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:i,pad:o,dimRoundingMode:a}=n;return{x:()=>Pne(t,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lne(t,e,n,s,r){const i=L(t,"dy","avgPoolGrad"),o=L(e,"input","avgPoolGrad");F(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,u=!1;o.rank===3&&(u=!0,a=H(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=H(i,[1,i.shape[0],i.shape[1],i.shape[2]])),F(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),F(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const c={dy:l,input:a},h={filterSize:n,strides:s,pad:r},d=j.runKernel(NS,c,h);return u?H(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const Mne=U({avgPoolGrad_:Lne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vne={kernelName:b0,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:i,pad:o}=n;return{x:()=>Mne(t,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zne={kernelName:S0,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[s,r]=e,{transposeA:i,transposeB:o}=n;return!i&&!o?{a:()=>it(t,r,!1,!0),b:()=>it(s,t,!0,!1)}:!i&&o?{a:()=>it(t,r,!1,!1),b:()=>it(t,s,!0,!1)}:i&&!o?{a:()=>it(r,t,!1,!0),b:()=>it(s,t,!1,!1)}:{a:()=>it(r,t,!0,!0),b:()=>it(t,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bne={kernelName:T0,gradFunc:(t,e,n)=>{const{blockShape:s,crops:r}=n;return{x:()=>Av(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Une={kernelName:iK,gradFunc:(t,e,n)=>{const s=n,r=s.inputShape,i=s.shape,o=Array.from(i);for(let l=r.length-1;l>=0;l--)if(r[l]===i[l])o[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>De(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wne={kernelName:Nf,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jne={kernelName:$f,gradFunc:t=>({x:()=>ft(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gne={kernelName:Af,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{clipValueMin:r,clipValueMax:i}=n;return{x:()=>ys(ko($l(s,r),nc(s,i)),t,ft(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hne={kernelName:k0,inputsToSave:["x"],gradFunc:XF.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qne={kernelName:E0,saveAllInputs:!0,gradFunc:(t,e,n)=>{const s=e.map(l=>l.shape),{axis:r}=n,i=st(r,e[0].shape)[0],o=s.map(l=>l[i]);return gr(t,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kne={kernelName:_0,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=n;return F(hl(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>VT(s.shape,t,r,o,a,l),filter:()=>wC(s,t,r.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xne={kernelName:N0,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>dl(t,r,i,o,a,1,l),filter:()=>wC(t,s,r.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yne(t,e,n,s,r){let i=t;t.rank===4&&(i=H(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;o.rank===4&&(o=H(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),F(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),F(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),F(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),F(i.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${n[3]}.`),F(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:i,dy:o},l={strides:s,pad:r,filterShape:n};return j.runKernel(PS,a,l)}const Qne=U({conv3DBackpropFilter_:Yne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jne={kernelName:$0,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:i}=n;F(hl(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>gP(o.shape,t,a,r,i),filter:()=>Qne(o,t,a.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zne={kernelName:Rf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>W(qt(uC(Se(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ese={kernelName:Df,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>W(cC(Se(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tse={kernelName:A0,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r,exclusive:i,reverse:o}=n;return{x:()=>{const a=on([r],s.rank);let l=UT(t,r,i,!o);return a!=null&&(l=pt(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nse={kernelName:R0,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=n,a=s??[1,1];F(hl(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return F(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),F(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),F(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),F(ss(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Ls("depthwiseConv2d",i,o),{x:()=>JP(l.shape,t,u,r,i,a,o),filter:()=>QP(l,t,u.shape,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sse={kernelName:D0,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,i={x:s,filter:r,dy:t},o={x:s,filter:r,dy:t};return{x:()=>j.runKernel(K2,i,n),filter:()=>j.runKernel(X2,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rse={kernelName:Pf,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,s={dy:t,y:n};return{x:()=>j.runKernel(GS,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ise={kernelName:Ff,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=W(Ps(qt(Vt(n))),2/Math.sqrt(Math.PI));return{x:()=>W(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ose={kernelName:Lf,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>W(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ase={kernelName:P0,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>H(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lse={kernelName:Mf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>W(t,Ps(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const use={kernelName:Vf,gradFunc:t=>({x:()=>ft(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cse={kernelName:zf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Qe(n.shape,s.shape);return{a:()=>{const a=_e(t,Se(s,"float32")),l=Pn(n.shape,r);return l.length>0?H(De(a,l),n.shape):a},b:()=>{let a=W(t,Se(n,"float32"));const l=Pn(s.shape,r);l.length>0&&(a=H(De(a,l),s.shape));const u=Vt(s);return qt(_e(a,Se(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hse={kernelName:F0,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:s}=n,[r,i,o,a]=e,l=a??Be(1),u=Pn(i.shape,r.shape),c=[];if(i.rank===1){for(let I=0;I<r.shape.length-1;++I)c.push(r.shape[I]);c.push(1)}const h=Ne(r,i),d=W(t,l),p=oC(fe(o,Be(s))),f=W(W(W(p,p),p),Be(-.5));return{x:()=>i.rank===1?H(W(W(t,ti(H(p,[1,1,1,i.shape[0]]),c)),l),r.shape):H(W(W(t,p),l),r.shape),mean:()=>{let I=W(W(p,Be(-1)),d);return i.rank===1&&(I=De(I,u)),H(I,i.shape)},variance:()=>{let I=W(W(f,h),d);return i.rank===1&&(I=De(I,u)),H(I,i.shape)},scale:()=>{const I=W(h,p);let k=W(t,I);return i.rank===1&&(k=De(k,u)),H(k,i.shape)},offset:()=>{let I=t;return i.rank===1&&(I=De(I,u)),H(I,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dse={kernelName:L0,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[s,r]=e,{axis:i,batchDims:o}=n,a=st(i,s.shape)[0],l=(u,c,h)=>()=>{const d=u.shape,p=c.size,f=d.slice(0,a),m=f.length,v=d.slice(i,d.length).slice(1),y=v.length,w=YN(0,m),b=YN(m+1,m+1+y),I=QN([f,[p],v]),k=H(h,I),R=H(c,[p]),C=QN([[m],w,b]),T=pt(k,C);let N=gC(T,R,u.shape[a]);const $=Nl(C);return N=pt(N,$),N};if(o===1){const u=s.shape[0],c=s.split(u,0);return{x:()=>wr(c.map((p,f)=>l(p,r.slice(f,1),t.slice(f,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,t),indices:()=>r}}};function YN(t,e){const n=[];for(let s=t;s<e;++s)n.push(s);return n}function QN(t){const e=[];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)e.push(t[n][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pse={kernelName:Bf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>ft(n),b:()=>ft(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fse={kernelName:Uf,gradFunc:t=>({x:()=>Se(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mse={kernelName:Wf,gradFunc:t=>({x:()=>ft(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gse={kernelName:jf,gradFunc:t=>({x:()=>ft(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yse={kernelName:Gf,gradFunc:t=>({x:()=>ft(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vse={kernelName:V0,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{alpha:r}=n,i=Tr(s,0);return{x:()=>ys(i,t,W(t,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wse={kernelName:qf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>_e(t,fe(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xse={kernelName:Hf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>_e(t,Se(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bse={kernelName:aK,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;return{logits:()=>{const o=Ps(s);return Ne(t,W(De(t,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ise(t,e,n,s=5,r=1,i=1,o=.5){const a={x:t,y:e,dy:n},l={depthRadius:s,bias:r,alpha:i,beta:o};return j.runKernel(ZS,a,l)}const Sse=U({localResponseNormalizationBackprop_:Ise});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tse={kernelName:G0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=n;return{x:()=>Sse(s,r,t,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YF(t,e,n,s){return e.rank<n.rank&&(e=H(e,wn(e.shape,s))),t.rank<n.rank&&(t=H(t,wn(t.shape,s))),{x:()=>W(t,Se(Wi(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JN={kernelName:H0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{reductionIndices:r}=s,i=e[0],o=e[1],a=st(r,i.shape),l=YF(t,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cse={kernelName:Kf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>W(t,Se($l(n,s),"float32")),b:()=>W(t,Se(qp(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kse(t,e,n,s,r,i,o){const a=L(t,"dy","maxPool3dGrad"),l=L(e,"input","maxPool3dGrad"),u=L(n,"output","maxPool3dGrad");let c=a,h=l,d=u,p=!1;l.rank===4&&(p=!0,c=H(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=H(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=H(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),F(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),F(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),F(d.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`),Ls("maxPool3dGrad",i,o);const f={dy:c,input:h,output:d},m={filterSize:s,strides:r,pad:i,dimRoundingMode:o},v=j.runKernel(tT,f,m);return p?H(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}const Ese=U({maxPool3dGrad_:kse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _se={kernelName:K0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=n;return{x:()=>Ese(t,s,r,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nse(t,e,n,s,r,i,o){const a=L(t,"dy","maxPoolGrad"),l=L(e,"input","maxPoolGrad"),u=L(n,"output","maxPoolGrad");F(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),F(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),F(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Ls("maxPoolGrad",i,o);const c={dy:a,input:l,output:u},h={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return j.runKernel(eT,c,h)}const $se=U({maxPoolGrad_:Nse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ase={kernelName:q0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a}=n;return{x:()=>$se(t,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rse={kernelName:X0,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n,i=st(r,s.shape),a=Gn(s.shape,i)[1],l=re(a);return{x:()=>{const c=s.shape.slice();i.forEach(p=>{c[p]=1});const h=H(t,c);return _e(W(h,hr(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dse={kernelName:Y0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{axis:r}=s,[i,o]=e,a=st(r,i.shape),l=YF(t,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ose={kernelName:Xf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>W(t,Se(nc(n,s),"float32")),b:()=>W(t,Se(Tr(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pse={kernelName:Q0,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,i=r.map(o=>o[0]);return{x:()=>je(t,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fse={kernelName:Yf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Qe(n.shape,s.shape);return{a:()=>{const a=Pn(n.shape,r);return a.length>0?H(De(t,a),n.shape):t},b:()=>{const a=W(t,qt(Sm(_e(n,s)))),l=Pn(s.shape,r);return l.length>0?H(De(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lse={kernelName:Qf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Qe(n.shape,s.shape);return{a:()=>{const a=W(t,Se(s,"float32")),l=Pn(n.shape,r);return l.length>0?H(De(a,l),n.shape):a},b:()=>{const a=W(t,Se(n,"float32")),l=Pn(s.shape,r);return l.length>0?H(De(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mse={kernelName:J0,gradFunc:t=>({x:()=>qt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vse={kernelName:tv,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>Nn(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zse={kernelName:ev,gradFunc:t=>({x:()=>ft(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bse={kernelName:nv,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:s}=n;return di(t,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZN={kernelName:sv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,i=r.map(o=>o[0]);return{x:()=>je(t,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Use={kernelName:Jf,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,s,r]=e,i=n,o=s,a=Qe(i.shape,o.shape);return{a:()=>{const c=Se(o,"float32");let h=W(t,W(c,na(i,Ne(c,Be(1)))));const d=Pn(i.shape,a);return d.length>0&&(h=De(h,d)),H(h,i.shape)},b:()=>{const c=Tr(i,0),h=ys(c,Fr(i),ft(i));let d=W(t,W(r,h));const p=Pn(o.shape,a);return p.length>0&&(d=De(d,p)),H(d,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wse={kernelName:rv,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,s]=e,r=Tr(n,0);return{x:()=>ys(r,t,W(t,s)),alpha:()=>{let i=ys(r,ft(t),W(t,n));const o=Pn(s.shape,t.shape);return o.length>0&&(i=De(i,o)),H(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jse(t,e,n){const s=t.shape.slice();s[n]=1;const r=H(e,s),i=g1(t,n,!0,!1),o=g1(t,n,!0,!0),a=W(i,o);return W(r,a)}function Gse(t,e,n){const s=t.shape.length,r=s-n.length,i=on(n,s);let o=t;i!=null&&(o=pt(t,i));const a=o.shape.slice(),u=a.splice(s-n.length,n.length).reduce((d,p)=>d*p,1);a.push(u);const c=o.reshape(a);let h=jse(c,e,r);if(h=h.reshape(o.shape),i!=null){const d=Nl(i);h=pt(h,d)}return h}const Hse={kernelName:iv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;let i=[];return r==null?i=s.shape.map((o,a)=>a):typeof r=="number"?i=[r]:i=r,{x:()=>Gse(s,t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qse={kernelName:Of,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Qe(n.shape,s.shape);return{a:()=>{const a=_e(t,Se(s,"float32")),l=Pn(n.shape,r);return l.length>0?H(De(a,l),n.shape):a},b:()=>{let a=W(t,Se(n,"float32"));const l=Pn(s.shape,r);l.length>0&&(a=H(De(a,l),s.shape));const u=Vt(s);return qt(_e(a,Se(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kse={kernelName:Zf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>_e(t,qt(Vt(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xse={kernelName:tm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=W(nc(n,6),Yh(n));return{x:()=>W(t,Se(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yse={kernelName:em,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>W(t,Se(Yh(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qse={kernelName:ov,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>H(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jse={kernelName:lv,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>j.runKernel(pT,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zse={kernelName:av,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>j.runKernel(dT,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ere={kernelName:uv,gradFunc:(t,e,n)=>{const{dims:s}=n,r=st(s,t.shape);return{x:()=>hi(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tre={kernelName:nm,gradFunc:t=>({x:()=>ft(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nre={kernelName:sm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>qt(_e(t,W(na(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sre={kernelName:cv,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>Se(ft(n),"float32"),t:()=>W(t,Se(n,t.dtype)),e:()=>W(t,Se(_v(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rre={kernelName:rm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Tr(n,Be(0)),r=Be(Gv),i=Be(Hv),o=W(t,i),a=W(W(t,r),Ps(Se(n,"float32")));return ys(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ire={kernelName:lm,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>W(t,W(n,Ne(Be(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ore={kernelName:am,gradFunc:t=>({x:()=>ft(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const are={kernelName:im,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>W(Sv(Se(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lre={kernelName:om,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>W(BT(Se(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ure={kernelName:hv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{begin:r,size:i}=n,o=s.shape,[a,l]=Wv(s,r,i),u=[];for(let c=0;c<t.rank;c++)u.push([a[c],o[c]-a[c]-l[c]]);return{x:()=>Al(t,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cre={kernelName:mv,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{dim:r}=n,i=!0,o=W(t,s);return{logits:()=>Ne(o,W(De(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hre={kernelName:um,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>W(t,Mi(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e$={kernelName:pv,gradFunc:(t,e,n)=>{const{blockShape:s,paddings:r}=n;return{x:()=>Iv(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t$={kernelName:fv,gradFunc:(t,e,n)=>{const{axis:s}=n;return{x:()=>hn(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dre={kernelName:cm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>_e(t,W(ns(Se(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pre={kernelName:IT,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>W(t,W(Se(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fre={kernelName:hm,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Be(2);return{a:()=>W(t,W(r,Ne(n,s))),b:()=>W(t,W(r,Ne(s,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mre={kernelName:gm,gradFunc:t=>({x:()=>ft(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gre={kernelName:dm,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Qe(n.shape,s.shape);return{a:()=>{let a=t;const l=Pn(n.shape,r);return l.length>0&&(a=De(a,l)),H(a,n.shape)},b:()=>{let a=t;const l=Pn(s.shape,r);return l.length>0&&(a=De(a,l)),H(qt(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yre={kernelName:dv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,r=s.shape.slice(),{axis:i}=n;st(i,s.shape).forEach(u=>{r[u]=1});const a=H(t,r),l=W(a,hr(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vre={kernelName:pm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>_e(t,Vt(Sv(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wre={kernelName:fm,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>W(Ne(Be(1),Vt(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xre={kernelName:mm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{reps:r}=n;return{x:()=>{let o=ft(s);if(s.rank===1)for(let a=0;a<r[0];++a)o=fe(o,je(t,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)o=fe(o,je(t,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)o=fe(o,je(t,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let c=0;c<r[3];++c)o=fe(o,je(t,[a*s.shape[0],l*s.shape[1],u*s.shape[2],c*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bre={kernelName:ih,gradFunc:(t,e,n)=>{const s=n,{perm:r}=s,i=Nl(r);return{x:()=>pt(t,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ire={kernelName:yv,gradFunc:(t,e,n)=>{const s=n,{axis:r}=s;return{value:()=>wr(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sre={kernelName:vv,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Tre(t,n)}}};function Tre(t,e){const n=ha(e,ft(e)),s=Tm(t,n);let r=$l(e,Be(0,"int32"));const i=s.rank-r.rank;for(let a=0;a<i;++a)r=Xn(r,a+1);r=ko(r,hr(s.shape,"bool"));const o=ft(s);return ys(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cre={kernelName:wv,gradFunc:t=>({x:()=>ft(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kre=[XF,Sne,Tne,Cne,kne,Ene,_ne,Nne,$ne,Ane,Rne,Dne,Fne,Vne,zne,Bne,Une,Wne,jne,Gne,Hne,qne,Xne,Kne,Jne,Zne,ese,tse,nse,sse,qse,rse,ise,ose,ase,lse,cse,use,hse,dse,pse,fse,mse,gse,yse,vse,wse,xse,bse,Tse,JN,JN,Cse,_se,Ase,Rse,Dse,Ose,Pse,Fse,Lse,Mse,Vse,zse,Bse,ZN,ZN,Use,Wse,Hse,Kse,Xse,Yse,Qse,Jse,Zse,ere,tre,nre,sre,rre,ire,ore,are,lre,ure,cre,hre,e$,e$,t$,t$,dre,fre,pre,mre,gre,yre,vre,wre,xre,bre,Ire,Sre,Cre];for(const t of kre)uK(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.abs=function(){return this.throwIfDisposed(),kn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.acos=function(){return this.throwIfDisposed(),QO(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.acosh=function(){return this.throwIfDisposed(),JO(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.add=function(t){return this.throwIfDisposed(),fe(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.all=function(t,e){return this.throwIfDisposed(),FT(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.any=function(t,e){return this.throwIfDisposed(),m1(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.argMax=function(t){return this.throwIfDisposed(),Eh(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.argMin=function(t){return this.throwIfDisposed(),ZO(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.asScalar=function(){return this.throwIfDisposed(),F(this.size===1,()=>"The array must have only 1 element."),H(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.asType=function(t){return this.throwIfDisposed(),Se(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.as1D=function(){return this.throwIfDisposed(),H(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.as2D=function(t,e){return this.throwIfDisposed(),H(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),H(this,[t,e,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.as4D=function(t,e,n,s){return this.throwIfDisposed(),H(this,[t,e,n,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.as5D=function(t,e,n,s,r){return this.throwIfDisposed(),H(this,[t,e,n,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.asin=function(){return this.throwIfDisposed(),eP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.asinh=function(){return this.throwIfDisposed(),tP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.atan=function(){return this.throwIfDisposed(),nP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.atan2=function(t){return this.throwIfDisposed(),sP(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.atanh=function(){return this.throwIfDisposed(),rP(this)};ae().prototype.avgPool=function(t,e,n,s){return this.throwIfDisposed(),bv(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),Iv(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.batchNorm=function(t,e,n,s,r){return this.throwIfDisposed(),wm(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.broadcastTo=function(t){return this.throwIfDisposed(),lh(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.cast=function(t){return this.throwIfDisposed(),Se(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.ceil=function(){return this.throwIfDisposed(),cP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Qs(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof Mt&&(t=[t]),hn([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.conv1d=function(t,e,n,s,r,i){return this.throwIfDisposed(),MT(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.conv2dTranspose=function(t,e,n,s,r){return this.throwIfDisposed(),zT(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.conv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),dl(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.cos=function(){return this.throwIfDisposed(),Sv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.cosh=function(){return this.throwIfDisposed(),BT(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),g1(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),UT(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),vP(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.depthwiseConv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),xm(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.dilation2d=function(t,e,n,s,r){return this.throwIfDisposed(),wP(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.divNoNan=function(t){return this.throwIfDisposed(),xP(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.div=function(t){return this.throwIfDisposed(),_e(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.dot=function(t){return this.throwIfDisposed(),bP(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.elu=function(){return this.throwIfDisposed(),bm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.equal=function(t){return this.throwIfDisposed(),Wi(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.erf=function(){return this.throwIfDisposed(),WT(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),TP(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.exp=function(){return this.throwIfDisposed(),Ps(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.expandDims=function(t){return this.throwIfDisposed(),Xn(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.expm1=function(){return this.throwIfDisposed(),CP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.fft=function(){return this.throwIfDisposed(),Lv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.flatten=function(){return this.throwIfDisposed(),H(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.floor=function(){return this.throwIfDisposed(),Sm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.floorDiv=function(t){return this.throwIfDisposed(),PT(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.gather=function(t,e,n){return this.throwIfDisposed(),Tm(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.greaterEqual=function(t){return this.throwIfDisposed(),$l(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.greater=function(t){return this.throwIfDisposed(),Tr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.ifft=function(){return this.throwIfDisposed(),Yp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.irfft=function(){return this.throwIfDisposed(),dC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.isFinite=function(){return this.throwIfDisposed(),kP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.isInf=function(){return this.throwIfDisposed(),EP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.isNaN=function(){return this.throwIfDisposed(),_P(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.leakyRelu=function(t){return this.throwIfDisposed(),Cv(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.lessEqual=function(t){return this.throwIfDisposed(),nc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.less=function(t){return this.throwIfDisposed(),qp(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.localResponseNormalization=function(t,e,n,s){return this.throwIfDisposed(),NP(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.logSigmoid=function(){return this.throwIfDisposed(),$P(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.logSoftmax=function(t){return this.throwIfDisposed(),HT(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),Ev(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.log=function(){return this.throwIfDisposed(),Fr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.log1p=function(){return this.throwIfDisposed(),kv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.logicalAnd=function(t){return this.throwIfDisposed(),ko(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.logicalNot=function(){return this.throwIfDisposed(),_v(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.logicalOr=function(t){return this.throwIfDisposed(),qT(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.logicalXor=function(t){return this.throwIfDisposed(),AP(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),it(this,t,e,n)};ae().prototype.maxPool=function(t,e,n,s){return this.throwIfDisposed(),Nv(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.max=function(t,e){return this.throwIfDisposed(),ai(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.maximum=function(t){return this.throwIfDisposed(),ha(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.mean=function(t,e){return this.throwIfDisposed(),un(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.min=function(t,e){return this.throwIfDisposed(),Hp(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.minimum=function(t){return this.throwIfDisposed(),zu(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),DP(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.mod=function(t){return this.throwIfDisposed(),OP(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.mul=function(t){return this.throwIfDisposed(),W(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.neg=function(){return this.throwIfDisposed(),qt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.norm=function(t,e,n){return this.throwIfDisposed(),Im(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.notEqual=function(t){return this.throwIfDisposed(),Nh(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),XT(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.onesLike=function(){return this.throwIfDisposed(),Lr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.pad=function(t,e){return this.throwIfDisposed(),Al(this,t,e)};ae().prototype.pool=function(t,e,n,s,r,i){return this.throwIfDisposed(),PP(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.pow=function(t){return this.throwIfDisposed(),na(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.prelu=function(t){return this.throwIfDisposed(),Rv(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.prod=function(t,e){return this.throwIfDisposed(),FP(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.reciprocal=function(){return this.throwIfDisposed(),MP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.relu=function(){return this.throwIfDisposed(),$o(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.relu6=function(){return this.throwIfDisposed(),rC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.reshapeAs=function(t){return this.throwIfDisposed(),H(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.reshape=function(t){return this.throwIfDisposed(),H(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),tF(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),nF(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.reverse=function(t){return this.throwIfDisposed(),hi(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.rfft=function(){return this.throwIfDisposed(),Mv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.round=function(){return this.throwIfDisposed(),iC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.rsqrt=function(){return this.throwIfDisposed(),oC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.selu=function(){return this.throwIfDisposed(),aC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.separableConv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),lC(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.sigmoid=function(){return this.throwIfDisposed(),Mi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.sign=function(){return this.throwIfDisposed(),VP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.sin=function(){return this.throwIfDisposed(),uC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.sinh=function(){return this.throwIfDisposed(),cC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.slice=function(t,e){return this.throwIfDisposed(),je(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.softmax=function(t){return this.throwIfDisposed(),Fv(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.softplus=function(){return this.throwIfDisposed(),Xh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Av(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.split=function(t,e){return this.throwIfDisposed(),gr(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.sqrt=function(){return this.throwIfDisposed(),ns(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.square=function(){return this.throwIfDisposed(),Vt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.squaredDifference=function(t){return this.throwIfDisposed(),pC(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.squeeze=function(t){return this.throwIfDisposed(),mn(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof Mt?[this,t]:[this,...t];return wr(n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.step=function(t){return this.throwIfDisposed(),Yh(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.stridedSlice=function(t,e,n,s,r,i,o,a){return this.throwIfDisposed(),zP(this,t,e,n,s,r,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.sub=function(t){return this.throwIfDisposed(),Ne(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.sum=function(t,e){return this.throwIfDisposed(),De(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.tan=function(){return this.throwIfDisposed(),BP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.tanh=function(){return this.throwIfDisposed(),Vu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.tile=function(t){return this.throwIfDisposed(),ti(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.toBool=function(){return this.throwIfDisposed(),Se(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.toFloat=function(){return this.throwIfDisposed(),Se(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.toInt=function(){return this.throwIfDisposed(),Se(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.topk=function(t,e){return this.throwIfDisposed(),jP(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.transpose=function(t){return this.throwIfDisposed(),pt(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.unique=function(t){return this.throwIfDisposed(),GP(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),gC(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.unstack=function(t){return this.throwIfDisposed(),di(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.where=function(t,e){return this.throwIfDisposed(),ys(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ae().prototype.zerosLike=function(){return this.throwIfDisposed(),ft(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class uo extends Error{constructor(e){super(e),Object.setPrototypeOf(this,uo.prototype)}}class ni extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ni.prototype)}}class K extends Error{constructor(e){super(e),Object.setPrototypeOf(this,K.prototype)}}class et extends Error{constructor(e){super(e),Object.setPrototypeOf(this,et.prototype)}}class JC extends Error{constructor(e){super(e),Object.setPrototypeOf(this,JC.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class QF{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let n;return this.cache.has(e)&&(n=this.cache.get(e),this.cache.delete(e),this.cache.set(e,n)),n}put(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let n=0;n<this.maxEntries-e;n++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Uu(t,e){if(Array.isArray(t)){let n=[];for(let s=0;s<e;s++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function co(t,e){if(!t)throw new JC(e)}function n$(t,e){let n=0;for(const s of t)s===e&&n++;return n}function Hs(t){return t.length===1?t[0]:t}function Ct(t){return Array.isArray(t)?t:[t]}function Fo(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function tu(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let Wr={};function ZC(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function gb(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>gb(e));else{const e=Object.keys(t);for(const n of e){const s=t[n];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?t[n]=s.value:gb(s))}}}function _m(t,e={},n={},s="object",r=!1){if(typeof t=="string"){const i=t;let o;if(i in n)o=n[i];else if(i in Wr)o=Wr[i];else if(o=e[i],o==null)throw new K(`Unknown ${s}: ${t}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=t;if(i.className==null||i.config==null)throw new K(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in n?[a,l]=n[o]:o in Wr?[a,l]=Wr.className:o in e&&([a,l]=e[o]),a==null)throw new K(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const p of Object.keys(Wr))u[p]=Wr[p];for(const p of Object.keys(n))u[p]=n[p];const c=i.config;c.customObjects=u;const h=Object.assign({},Wr);for(const p of Object.keys(n))Wr[p]=n[p];gb(i.config);const d=l(a,i.config,n,r);return Wr=Object.assign({},h),d}else{const u=Object.assign({},Wr);for(const h of Object.keys(n))Wr[h]=n[h];const c=new a(i.config);return Wr=Object.assign({},u),c}}}function Ere(t,e){return t<e?-1:t>e?1:0}function Ag(t,e){return-1*Ere(t,e)}function Za(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function _re(t){if(t==null)throw new K(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function oc(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new K(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function ek(t,e,n=0,s=1/0){return co(n>=0),co(s>=n),Array.isArray(t)&&t.length>=n&&t.length<=s&&t.every(r=>typeof r===e)}function Wn(t,e){Array.isArray(t)?(F(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,s)=>Wn(n,`element ${s+1} of ${e}`))):F(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${JF(t)}.`)}function JF(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>JF(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function Nre(t,e,n){let s=n!=null?n():Gs(),r;return(...o)=>{const a=n!=null?n():Gs();return a-s<e||(s=a,r=t(...o)),r}}function ZF(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let $re=0;function eL(){return $re++}const Rg={};function qv(t=""){return t in Rg||(Rg[t]=0),Rg[t]+=1,t+Rg[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Are=["channelsFirst","channelsLast"],Rre=["nearest","bilinear"],Dre=["valid","same","causal"],Ore=["max","avg"],Pre=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const kc=new Map;function bn(t){oc(Are,"DataFormat",t)}function Fre(t){oc(Rre,"InterpolationFormat",t)}function Br(t){oc(Dre,"PaddingMode",t)}function tL(t){oc(Ore,"PoolMode",t)}const yp=[],s$="/";function yu(t,e){yp.push(t);try{const n=e();return yp.pop(),n}catch(n){throw yp.pop(),n}}function Lre(){return yp.length===0?"":yp.join(s$)+s$}function nL(t){if(!rL(t))throw new Error("Not a valid tensor name: '"+t+"'");return Lre()+t}function sL(t){if(!rL(t))throw new Error("Not a valid tensor name: '"+t+"'");kc.has(t)||kc.set(t,0);const e=kc.get(t);if(kc.set(t,kc.get(t)+1),e>0){const n=`${t}_${e}`;return kc.set(n,1),n}else return t}const Mre=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function rL(t){return!!t.match(Mre)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vre(t){return t===parseInt(t.toString(),10)}function el(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let s=1;for(let r=e;r<n;++r)s*=t[r];return s}function Ah(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s<e&&(e=s)}return e}function pl(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s>e&&(e=s)}return e}function ji(t,e){if(e<t)throw new K(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let s=t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let dx;function $n(){return dx==null&&(dx=PO().epsilon()),dx}function Gi(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bo(t,e){return Se(t,e)}function Nm(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),H(t,n)}function zre(t,e){return Y(()=>{if(t.shape.length!==2)throw new K(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=Nm(t,1);return yb(n,[1,e,1])})}function Bre(t){const e=[el(t.shape)];return H(t,e)}function Ure(t){if(t.rank<=1)throw new K(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],el(t.shape,1)];return H(t,e)}function vu(t,e,n){return Y(()=>{switch(t.rank){case 1:return Ov(t,e,n);case 2:return hC(t,[e,0],[n,t.shape[1]]);case 3:return Pv(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return Xp(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return je(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return je(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new K(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function px(t,e,n){return Y(()=>{switch(t.rank){case 1:return Ov(t,e,n);case 2:return hC(t,[0,e],[t.shape[0],n]);case 3:return Pv(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return Xp(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new K(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Dg(t,e,n,s){return Y(()=>{switch(t.rank){case 1:return Ov(t,e,n);case 2:switch(s){case 1:return vu(t,e,n);case 2:return px(t,e,n);default:throw new K(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return vu(t,e,n);case 2:return Pv(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return px(t,e,n);default:throw new K(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return vu(t,e,n);case 2:return Xp(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return Xp(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return px(t,e,n);default:throw new K(`The axis is not within the rank of the tensor ${s}`)}default:throw new K(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function tk(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),hn(t,e)}function r$(t,e){switch(t.rank){case 1:return hP([t,e]);case 2:return dP([t,e],0);case 3:return pP([t,e],0);case 4:return fP([t,e],0);default:throw new K(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function yb(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new K(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return ti(t,e)}function Kv(t,e=0,n=1,s,r){return sC(t,e,n,s,r)}function Io(t,e,n,s){if(t.rank<2||e.rank<2)throw new et(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=t.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new et(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return db({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?vb(t.rank,s,Gi()):null,activation:n});{const r=t.shape.slice(),i=r.pop();t=H(t,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),u=[...o,a],c=Array.from({length:e.rank},(f,m)=>m===0?e.rank-2:m<=e.rank-2?m-1:m);e=H(pt(e,c),[l,-1]);const h=[...r,...u];return H(db({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?vb(t.rank,s,Gi()):null,activation:n}),h)}}function iL(t,e,n){return Y(()=>(Array.isArray(e)?e=Tn(e,"int32"):e=Se(e,"int32"),Tm(t,e,n)))}function $m(t){return W(t,t)}function vb(t,e,n){const s=e.shape;if(e.rank!==1&&e.rank!==t)throw new K(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return s.length===1?H(e,[1,s[0],1,1,1]):H(e,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?H(e,[1,1,1,1,s[0]]):H(e,[1].concat(s))}else if(t===4){if(n==="channelsFirst")return s.length===1?H(e,[1,s[0],1,1]):H(e,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?H(e,[1,1,1,s[0]]):H(e,[1].concat(s))}else if(t===3){if(n==="channelsFirst")return s.length===1?H(e,[1,s[0],1]):H(e,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?H(e,[1,1,s[0]]):H(e,[1].concat(s))}else if(t<3)return e;throw new K(`Unsupported input rank by biasAdd: ${e.rank}`)}function Yi(t,e,n){return Y(()=>(n==null&&(n=Gi()),bn(n),fe(t,vb(t.rank,e,n))))}function Wre(t,e=1){if(e!==1)throw new et(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return bm(t)}function jre(t){return Y(()=>_e(t,fe(kn(t),1)))}function oL(t,e,n,s){return Y(()=>KP(t,e,n,s))}function Gre(t){return Y(()=>{const e=fe(.5,W(.2,t));return Qs(e,0,1)})}function Am(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Hre=["fanIn","fanOut","fanAvg"],qre=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Kre(t){oc(Hre,"FanMode",t)}function Xre(t){oc(qre,"Distribution",t)}class fi extends Jh{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class aL extends fi{apply(e,n){return Nn(e,n)}}aL.className="Zeros";ge(aL);class nk extends fi{apply(e,n){return hr(e,n)}}nk.className="Ones";ge(nk);class lL extends fi{constructor(e){if(super(),typeof e!="object")throw new K(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new K(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return Y(()=>W(Be(this.value),hr(e,n)))}getConfig(){return{value:this.value}}}lL.className="Constant";ge(lL);class uL extends fi{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return rc(e,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}uL.className="RandomUniform";ge(uL);class cL extends fi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new et(`randomNormal does not support dType ${n}.`);return Kv(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}cL.className="RandomNormal";ge(cL);class hL extends fi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new et(`truncatedNormal does not support dType ${n}.`);return mC(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}hL.className="TruncatedNormal";ge(hL);class dL extends fi{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,n){return Y(()=>{if(e.length!==2||e[0]!==e[1])throw new K("Identity matrix initializer can only be used for 2D square matrices.");return W(this.gain,GT(e[0]))})}getConfig(){return{gain:this.gain}}}dL.className="Identity";ge(dL);function Yre(t,e="channelsLast"){let n,s;if(bn(e),t.length===2)n=t[0],s=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const r=el(t,2);n=t[1]*r,s=t[0]*r}else if(e==="channelsLast"){const r=el(t,0,t.length-2);n=t[t.length-2]*r,s=t[t.length-1]*r}}else{const r=el(t);n=Math.sqrt(r),s=Math.sqrt(r)}return[n,s]}class xr extends fi{constructor(e){if(super(),e.scale<0)throw new K(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,Kre(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Xre(this.distribution),this.seed=e.seed}apply(e,n){const s=Yre(e),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new et(`${this.getClassName()} does not support dType ${n}.`);return mC(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*o);return rc(e,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}xr.className="VarianceScaling";ge(xr);class sk extends xr{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return xr.className}}sk.className="GlorotUniform";ge(sk);class rk extends xr{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return xr.className}}rk.className="GlorotNormal";ge(rk);class ik extends xr{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return xr.className}}ik.className="HeNormal";ge(ik);class ok extends xr{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return xr.className}}ok.className="HeUniform";ge(ok);class ak extends xr{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return xr.className}}ak.className="LeCunNormal";ge(ak);class lk extends xr{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return xr.className}}lk.className="LeCunUniform";ge(lk);class pL extends fi{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,n){return Y(()=>{if(e.length<2)throw new et("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const s=re(e.slice(0,-1)),r=e[e.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],a=Kv(o,0,1,n,this.seed),l=sF.qr(a,!1);let u=l[0];const h=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=W(u,h.sign()),s<r&&(u=u.transpose()),W(Be(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}pL.className="Orthogonal";ge(pL);const i$={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function o$(t,e={}){return _m(t,Yr.getMap().classNameMap,e,"initializer")}function rn(t){return ZC(t)}function Jt(t){if(typeof t=="string"){const e=t in i$?i$[t]:t;if(e==="GlorotNormal")return new rk;if(e==="GlorotUniform")return new sk;if(e==="HeNormal")return new ik;if(e==="HeUniform")return new ok;if(e==="LeCunNormal")return new ak;if(e==="LeCunUniform")return new lk;{const n={};return n.className=e,n.config={},o$(n)}}else return t instanceof fi?t:o$(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wb(t){return Array.isArray(t)&&Array.isArray(t[0])}function y1(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function Ge(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new K(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function wt(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new K(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function v1(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const a$="Variable";class Qre{constructor(e,n="float32",s=a$,r=!0,i=null){this.dtype=n??"float32",this.shape=e.shape,this.id=eL(),s=s??a$,this.originalName=nL(s),this.name=sL(this.originalName),this.trainable_=r,this.constraint=i,this.val=HP(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),Jre(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function Jre(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function xb(t){return t.map(e=>e.read())}function uk(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class An{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Eo{constructor(e,n,s,r,i,o,a){this.dtype=e,this.shape=n,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=eL(),o!=null&&(this.originalName=nL(o),this.name=sL(this.originalName)),this.rank=n.length}}let Zre=0;class Xv{constructor(e,n){this.callArgs=n,this.id=Zre++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let eie=0;class rt extends Jh{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=eie++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const s=this.getClassName();n=Fo(s)+"_"+qv(s)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),s=[i].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new ni(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new K(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Hs(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Hs(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new uo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new uo(`Layer ${this.name} is not connected, no input to return.`);return Hs(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new uo(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new uo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Hs(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const n=Ct(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=Ct(this.inputSpec);if(n.length!==s.length)throw new K(`Layer ${this.name} expects ${s.length} inputs, but it received ${n.length} input tensors. Input received: ${e}`);for(let r=0;r<n.length;r++){const i=n[r],o=s[r];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new K(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new K(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new K(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new K(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const u in o.axes){const c=Number(u),h=o.axes[u],d=c>=0?l[c]:l[l.length+c];if(h!=null&&[h,null].indexOf(d)===-1)throw new K(`Input ${r} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${h} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const u=o.shape[l],c=i.shape[l];if(u!=null&&c!=null&&u!==c)throw new K(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const s=Ct(e),r=sie(e),i=rie(e);if(r===i)throw new K("Arguments to apply() must be all SymbolicTensors or all Tensors");return yu(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of Ct(e))o.push(a.shape);this.build(Hs(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,n);this.supportsMasking&&this.setMaskMetadata(e,o);const a=Ct(o),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(o=Hs(l),this.activityRegularizer!=null)throw new et("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=tie(e),a=this.computeOutputShape(o);let l;const u=nie(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((c,h)=>new Eo(u,c,this,Ct(e),n,this.name,h)):l=new Eo(u,a,this,Ct(e),n,this.name),this.addInboundNode(e,l,null,null,o,a,n),this._refCount++,this.activityRegularizer!=null)throw new et("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new uo(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const s=JSON.stringify(n.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new uo(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new ni(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return v1(this.weights)}build(e){this.built=!0}getWeights(e=!1){return xb(e?this.trainableWeights:this.weights)}setWeights(e){Y(()=>{const n=this.weights;if(n.length!==e.length)throw new K(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const s=[],r=xb(n);for(let i=0;i<r.length;++i){const o=r[i],a=n[i],l=e[i];if(!ut(o.shape,l.shape))throw new K(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}uk(s)})}addWeight(e,n,s,r,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new K(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():Jt("zeros"));const u=r.apply(n,s),c=new Qre(u,s,e,o,a);return u.dispose(),i!=null&&this.addLoss(()=>i.apply(c.read())),o==null&&(o=!0),o?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Ct(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(e,n,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),i=Ct(n),o=Ct(r);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,n,s,r,i,o,a=null){const l=Ct(e);n=Ct(n),s=Ct(s),r=Ct(r),i=y1(i),o=y1(o);const u=[],c=[],h=[];for(const d of l)u.push(d.sourceLayer),c.push(d.nodeIndex),h.push(d.tensorIndex);new Xv({outboundLayer:this,inboundLayers:u,nodeIndices:c,tensorIndices:h,inputTensors:l,outputTensors:n,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},a);for(let d=0;d<n.length;d++)n[d].sourceLayer=this,n[d].nodeIndex=this.inboundNodes.length-1,n[d].tensorIndex=d}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function tie(t){t=Ct(t);const e=[];for(const n of t)e.push(n.shape);return Hs(e)}function nie(t){return"float32"}function fL(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const s=e.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],a=s.inboundLayers[i],l=s.nodeIndices[i],u=fL(o,a,l);for(const c of u)r.indexOf(c)===-1&&r.push(c)}return r}}}function sie(t){let e=!0;for(const n of Ct(t))if(!(n instanceof Eo)){e=!1;break}return e}function rie(t){let e=!0;for(const n of Ct(t))if(n instanceof Eo){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Rm extends rt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:qv("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new K("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new K("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new K("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];const r=new Eo(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Xv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new K(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Rm.className="InputLayer";ge(Rm);function iie(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new K("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new Rm({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function oie(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return Se(e,t.dtype)}catch{throw new K(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class Va{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Va)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=oie(e,n),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new K(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Eo){if(this.id2Value[e.id]==null)throw new K(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new K(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof Eo){if(this.id2Value[e.id]==null)throw new K(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new K(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&Ye(this.id2Mask)}}const w1=new QF,x1=new QF;function aie(t){w1!=null&&w1.setMaxEntries(t),x1!=null&&x1.setMaxEntries(t)}function Jd(t,e,n,s){const r=n==null?!1:n.training,i=Array.isArray(t),o=i?t:[t],a=o.map(f=>f.name),l=[],u=e.names();for(const f of a)u.indexOf(f)!==-1?l.push(e.getValue(f)):l.push(null);const c=a.join(",")+"|"+e.names().sort().join(",");let h=w1.get(c),d;if(h==null){const f=lie(o,e);h=f.sorted,d=f.recipientCounts,w1.put(c,h),x1.put(c,d)}d={},r||Object.assign(d,x1.get(c));const p=new Va(e);for(let f=0;f<h.length;++f){const m=h[f],v=m.sourceLayer;if(v instanceof Rm)continue;const y=[],w=[],b=[];let I=!1;for(const N of m.inputs){const $=p.getValue(N),P=p.getMask(N);y.push($),w.push(P),P!=null&&(I=!0),r||(d[N.name]--,d[N.name]===0&&!e.hasKey(N)&&a.indexOf(N.name)===-1&&!$.isDisposed&&N.sourceLayer.stateful!==!0&&b.push($))}I&&(n=n||{},n.mask=w[0]);const k=Ct(v.apply(y,n));let R=null;v.supportsMasking&&(R=v.computeMask(y,w));const C=cie(m),T=Array.isArray(C)?C:[C];for(let N=0;N<T.length;++N){p.hasKey(T[N])||p.add(T[N],k[N],Array.isArray(R)?R[0]:R);const $=a.indexOf(T[N].name);$!==-1&&(l[$]=k[N])}r||Ye(b)}return p.disposeMasks(),i?l:l[0]}function lie(t,e){F(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],s={};if(t.length===1){const r=l$(t[0],e);n=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of t){const{sorted:o,recipientMap:a}=l$(i,e);for(const l of o)r.has(l.name)||(n.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:n,recipientCounts:uie(s)}}function uie(t){const e={};for(const n in t)e[n]=t[n].size;return e}function l$(t,e){const n=new Set,s=[],r={};for(const a of e.names())n.add(a);const i=[],o=[];for(i.push(t);i.length>0;){const a=i[i.length-1];if(n.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),s.push(a),n.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!n.has(u.name)&&i.push(u)}}return{sorted:s,recipientMap:r}}function cie(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let s=0;s<t.sourceLayer.inboundNodes.length;++s)for(const r of t.sourceLayer.inboundNodes[s].outputTensors)if(r.id===t.id){n=s;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hie=te();hie.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,aie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ck(t,e){return Y(()=>ns(De(W(t,t),e,!0)))}class Dm extends Jh{getConfig(){return{}}}class mL extends Dm{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Y(()=>{const n=ck(e,this.axis),s=Qs(n,0,this.maxValue);return W(e,_e(s,fe($n(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}mL.className="MaxNorm";ge(mL);class gL extends Dm{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Y(()=>_e(e,fe($n(),ck(e,this.axis))))}getConfig(){return{axis:this.axis}}}gL.className="UnitNorm";ge(gL);class yL extends Dm{apply(e){return $o(e)}}yL.className="NonNeg";ge(yL);class vL extends Dm{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Y(()=>{const n=ck(e,this.axis),s=fe(W(this.rate,Qs(n,this.minValue,this.maxValue)),W(1-this.rate,n));return W(e,_e(s,fe($n(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}vL.className="MinMaxNorm";ge(vL);const u$={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Dn(t){return ZC(t)}function c$(t,e={}){return _m(t,Yr.getMap().classNameMap,e,"constraint")}function On(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in u$?u$[t]:t,config:{}};return c$(n)}else return t instanceof Dm?t:c$(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Kl(t){if(t==null)return;const e=[],n=[],s=[];for(const r in t){const i=t[r];if(typeof i!="number"){const o=i;e.push(o.data()),n.push(r),s.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)t[n[i]]=r[i][0];Ye(s)}}function wL(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var h$;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(h$||(h$={}));const die=125;class Qp{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class pie{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class fie extends Qp{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const s=n.size==null?0:n.size;this.seen+=s;for(const r in n){const i=n[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const a=Y(()=>fe(this.totals[r],W(i,s)));this.totals[r]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:Y(()=>{const r=W(_e(1,this.seen),this.totals[s]);n[s]=r,this.totals[s].dispose(),Un(n[s])}))}}class mie extends Qp{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){const e=[],n=[],s=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),n.push(i),s.push(a)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[n[i]][s[i]].dispose(),this.history[n[i]][s[i]]=r[i][0]}}class gie extends Qp{constructor(e,n){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||TF,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=die),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");G2(this.yieldEvery)&&(this.maybeWait=Nre(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,s){const r=[];this.yield!=null&&(await Kl(s),r.push(this.yield(e,n,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await Kl(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const s=[];this.epochEnd!=null&&(await Kl(n),s.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,n){this.batchBegin!=null&&(await Kl(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const s=[];this.batchEnd!=null&&(await Kl(n),s.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):G2(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Kl(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Kl(e),await this.trainEnd(e))}}function xL(t,e){return t==null&&(t={}),t instanceof Qp?[t]:Array.isArray(t)&&t[0]instanceof Qp?t:Ct(t).map(s=>new gie(s,e))}class Gr{constructor(){}static registerCallbackConstructor(e,n){F(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Gr.checkForDuplicate(n),Gr.constructors[e]==null&&(Gr.constructors[e]=[]),Gr.constructors[e].push(n)}static checkForDuplicate(e){for(const n in Gr.constructors)Gr.constructors[+n].forEach(r=>{if(r===e)throw new K("Duplicate callback constructor.")})}static clear(){Gr.constructors={}}static createCallbacks(e){const n=[];for(const s in Gr.constructors){const r=+s;e>=r&&n.push(...Gr.constructors[r])}return n.map(s=>new s)}}Gr.constructors={};function bL(t,e,n,s,r,i,o,a,l){const u=new mie,c=[new fie,...Gr.createCallbacks(e)];t!=null&&c.push(...t),c.push(u);const h=new pie(c);return h.setParams({epochs:n,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:h,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Xo(t,e={},n=!1){return _m(t,Yr.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function b1(t,e){return Y(()=>{t.dtype!=="float32"&&(t=Se(t,"float32"));const n=De($m(t),e,!0),s=Kh(n.shape,$n()),r=ns(ha(n,s));return _e(t,r)})}function Yv(t,e){return Y(()=>un($m(Ne(e,t)),-1))}function hk(t,e){return Y(()=>un(kn(Ne(e,t)),-1))}function dk(t,e){return Y(()=>{const n=Ne(t,e),s=Qs(kn(t),$n(),Number.MAX_VALUE),r=kn(_e(n,s));return W(100,un(r,-1))})}function yie(t,e){return Y(()=>{const n=Qs(e,$n(),Number.MAX_VALUE),s=Fr(fe(1,n)),r=Qs(t,$n(),Number.MAX_VALUE),i=Fr(fe(1,r));return un($m(Ne(s,i)),-1)})}function vie(t,e){return Y(()=>{const n=ha(0,Ne(1,W(t,e)));return un($m(n),-1)})}function wie(t,e){return Y(()=>{const n=ha(0,Ne(1,W(t,e)));return un(n,-1)})}function xie(t,e){return Y(()=>{const n=De(W(t,e),-1),s=ai(W(Ne(1,t),e),-1);return ha(0,fe(1,Ne(s,n)))})}function bie(t,e){return Y(()=>{const n=Math.log(2),s=Ne(e,t),r=Ne(fe(s,Xh(W(-2,s))),n);return un(r,-1)})}function Jp(t,e,n=!1){return Y(()=>{if(n)e=Fv(e);else{const s=De(e,e.shape.length-1,!0);e=_e(e,s)}return e=Qs(e,$n(),1-$n()),qt(De(W(Se(t,"float32"),Fr(e)),e.shape.length-1))})}function I1(t,e,n=!1){return Y(()=>{const s=Se(Sm(Bre(t)),"int32");e=Qs(e,$n(),1-$n());const r=e.shape,i=H(XT(s,r[r.length-1]),r);return Jp(i,e,n)})}function Iie(t,e){if(!ut(t.shape,e.shape))throw new K(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return Y(()=>{const n=$o(e),s=qt(kn(e));return fe(Ne(n,W(e,t)),kv(Ps(s)))})}function Qv(t,e){return Y(()=>{let n;return n=Qs(e,$n(),1-$n()),n=Fr(_e(n,Ne(1,n))),un(Iie(t,n),-1)})}function Sie(t,e){return Y(()=>{const n=Qs(t,$n(),1),s=Qs(e,$n(),1);return De(W(t,Fr(_e(n,s))),-1)})}function Tie(t,e){return Y(()=>{const n=Fr(fe($n(),e));return un(Ne(e,W(t,n)),-1)})}function IL(t,e){return Y(()=>{const n=b1(t,-1),s=b1(e,-1),r=W(n,s);return qt(De(r,-1))})}const S1={meanSquaredError:Yv,meanAbsoluteError:hk,meanAbsolutePercentageError:dk,meanSquaredLogarithmicError:yie,squaredHinge:vie,hinge:wie,categoricalHinge:xie,logcosh:bie,categoricalCrossentropy:Jp,sparseCategoricalCrossentropy:I1,binaryCrossentropy:Qv,kullbackLeiblerDivergence:Sie,poisson:Tie,cosineProximity:IL};function fx(t){if(typeof t=="string"){if(t in S1)return S1[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new K(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function SL(t,e){return Y(()=>{const n=W(.5,Lr(e)),s=bo(Tr(e,n),t.dtype);return un(Wi(t,s),-1)})}function TL(t,e){return Y(()=>bo(Wi(Eh(t,-1),Eh(e,-1)),"float32"))}function Cie(t,e){return Y(()=>Se(De(ko(Wi(t,1),Wi(e,1))),"float32"))}function kie(t,e){return Y(()=>Se(De(ko(Wi(t,0),Wi(e,1))),"float32"))}function Eie(t,e){return Y(()=>{const n=Cie(t,e),s=kie(t,e),r=fe(n,s);return Se(ys(Tr(r,0),_e(n,r),0),"float32")})}function _ie(t,e){return Qv(t,e)}function Nie(t,e){return t.rank===e.rank&&(t=mn(t,[t.rank-1])),e=Eh(e,-1),e.dtype!==t.dtype&&(e=Se(e,t.dtype)),Se(Wi(t,e),"float32")}const $ie=Yv,Aie=Yv,Rie=hk,Die=hk,Oie=dk,Pie=dk,CL=Jp,Fie=IL,kL=I1,T1={binaryAccuracy:SL,categoricalAccuracy:TL,precision:Eie,categoricalCrossentropy:CL,sparseCategoricalCrossentropy:kL,mse:$ie,MSE:Aie,mae:Rie,MAE:Die,mape:Oie,MAPE:Pie,cosine:Fie};function Lie(t){if(typeof t=="string"&&t in T1)return T1[t];if(typeof t!="string"&&t!=null)return t;throw new K(`Unknown metric ${t}`)}function Og(t){if(co(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys(S1))if(S1[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(T1))if(T1[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Mie(t){const e={Adagrad:()=>Cc.adagrad(.01),Adadelta:()=>Cc.adadelta(1,.95,$n()),Adam:()=>Cc.adam(.001,.9,.999,$n()),Adamax:()=>Cc.adamax(.002,.9,.999,$n(),0),RMSProp:()=>Cc.rmsprop(.001,.9,0,$n()),SGD:()=>Cc.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new K(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const d$=1*1024*1024;function p$(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!bb(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const s=JSON.stringify(t);s.length>d$&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${d$}.`)}}function bb(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!bb(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!bb(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vie(t,e,n,s=console.log){const r=Bie(t),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(c=>Math.floor(e*c)));let o;if(!r){i.push("Receives inputs"),o=[];for(const c in t.nodesByDepth)o.push(...t.nodesByDepth[c])}s("_".repeat(e)),C1(i,n,s),s("=".repeat(e));const a=t.layers;for(let c=0;c<a.length;++c)r?Uie(a[c],n,s):Wie(a[c],n,o,s),s((c===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=zie(t),u=v1(t.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function zie(t){let e;return t.collectedTrainableWeights!=null?e=v1(t.collectedTrainableWeights):e=v1(t.trainableWeights),e}function Bie(t){let e=!0;const n=[],s=[];for(const r in t.nodesByDepth)n.push(t.nodesByDepth[r]);for(const r of n){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of t.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function C1(t,e,n=console.log){let s="";for(let r=0;r<t.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=t[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);n(s)}function Uie(t,e,n){let s,r;try{r=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(t.outputShape)}catch{s="multiple"}const i=t.name,o=t.getClassName(),a=[`${i} (${o})`,r,s,t.countParams().toString()];C1(a,e,n)}function Wie(t,e,n,s){let r,i;try{i=t.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}const o=[];for(const h of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(h)===-1))for(let d=0;d<h.inboundLayers.length;++d){const p=h.inboundLayers[d].name,f=h.nodeIndices[d],m=h.tensorIndices[d];o.push(`${p}[${f}][${m}]`)}const a=t.name,l=t.getClassName(),u=o.length===0?"":o[0],c=[`${a} (${l})`,i,r,t.countParams().toString(),u];C1(c,e,s);for(let h=1;h<o.length;++h)C1(["","","","",o[h]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function EL(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function Ib(t,e){if(t===null)return null;if(typeof t=="string")return tu(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const i=t[r];EL(e,r,i)?n.push(i):n.push(Ib(i,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s];if(s==="name"&&typeof r=="string")n[s]=r;else{const i=tu(s);n[i]=Ib(r,i)}}return n}}function Sb(t,e){if(t==null)return null;if(typeof t=="string")return Fo(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const i=t[r];EL(e,r,i)?n.push(i):n.push(Sb(i,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s],i=Fo(s);(s==="name"||s==="className")&&typeof r=="string"?n[i]=r:n[i]=Sb(r,s)}return n}}/** @license See the LICENSE file. */const _L="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const jie=t=>{const e=Object.keys(t);if(e.length===0)return!1;const n=e[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class Ti extends rt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const w=this.getClassName().toLowerCase();this.name=qv(w)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Za(this.inputs).length!==this.inputs.length)throw new K(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(w=>w.name)}`);Za(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(w=>w.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const w of this.outputs){const b=w.sourceLayer,I=w.nodeIndex,k=w.tensorIndex;this.outputLayers.push(b),this.outputLayersNodeIndices.push(I),this.outputLayersTensorIndices.push(k)}for(const w of this.inputs){const b=w.sourceLayer,I=w.nodeIndex,k=w.tensorIndex;co(I===0,"input layer has >1 nodes"),co(k===0,"input layer has >1 tensors"),this.inputLayers.push(b),this.inputLayersNodeIndices.push(I),this.inputLayersTensorIndices.push(k)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let w=0;w<this.inputLayers.length;w++){const b=this.inputLayers[w];if(!(b instanceof Rm))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${w} (0-based) originates from layer type ${b.getClassName()}.`);this.inputNames.push(b.name),this.feedInputShapes.push(b.batchInputShape),this.feedInputNames.push(b.name)}for(const w of this.outputLayers)this.outputNames.push(w.name);this.internalInputShapes=this.inputs.map(w=>w.shape),this.internalOutputShapes=this.outputs.map(w=>w.shape);const n={},s={},r={},i={},o={},a=[],l=(w,b,I,k,R,C)=>{(k==null||R==null||C==null)&&(k=w.sourceLayer,R=w.nodeIndex,C=w.tensorIndex);const T=k.inboundNodes[R];if(I.indexOf(T)!==-1)throw new ni(`The tensor ${w.name} at layer "${k.name}" is part of a cycle.`);if(b.indexOf(T)!==-1)return;this.containerNodes.add(Ti.nodeKey(k,R)),k.id in o||(o[k.id]=Object.keys(o).length),I.indexOf(T)===-1&&I.push(T);const N=T.inboundLayers.length;for(let $=0;$<N;$++){const P=T.inputTensors[$],V=T.inboundLayers[$],O=T.nodeIndices[$],Q=T.tensorIndices[$];l(P,b,I,V,O,Q)}for(b.push(T);I.indexOf(T)>=0;)I.splice(I.indexOf(T),1);a.push(T)},u=[],c=[];for(const w of this.outputs)l(w,u,c);const h=a.slice().reverse();for(const w of h){s[w.id]=w,w.id in n||(n[w.id]=0);let b=n[w.id];const I=r[w.outboundLayer.id]==null?0:r[w.outboundLayer.id];b=Math.max(b,I),r[w.outboundLayer.id]=b,i[w.outboundLayer.id]=w.outboundLayer,n[w.id]=b;for(let k=0;k<w.inboundLayers.length;k++){const R=w.inboundLayers[k],C=w.nodeIndices[k],T=R.inboundNodes[C],N=n[T.id]==null?0:n[T.id];n[T.id]=Math.max(b+1,N),s[T.id]=T}}const d={};for(const w in n){const b=n[w];b in d||(d[b]=[]),d[b].push(s[w])}const p={};for(const w in r){const b=r[w];b in p||(p[b]=[]),p[b].push(i[w])}let f=Object.keys(p).map(w=>parseInt(w,10)).sort(Ag);this.layers=[];for(const w of f){const b=p[w];b.sort((I,k)=>{const R=o[I.id],C=o[k.id];return R<C?-1:R>C?1:0});for(const I of b)I instanceof Ti&&this.internalContainerRefs.push(I),this.layers.push(I)}this.layersByDepth=p,f=Object.keys(d).map(w=>parseInt(w,10)).sort(Ag);const m=this.inputs.slice(),v=[];for(const w of f)for(const b of d[w]){const I=b.outboundLayer;if(I!=null){for(const k of b.inputTensors)if(m.indexOf(k)===-1)throw new ni(`Graph disconnected: cannot obtain value for tensor ${k} at layer "${I.name}". The following previous layers were accessed without issue: ${v}`);for(const k of b.outputTensors)m.push(k);v.push(I.name)}}this.nodesByDepth=d;const y=this.layers.map(w=>w.name);for(const w of y){const b=y.filter(I=>I===w).length;if(b!==1)throw new ni(`The name "${w}" is used ${b} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new Xv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(w=>null),outputMasks:this.outputs.map(w=>null),inputShapes:this.inputs.map(w=>w.shape),outputShapes:this.outputs.map(w=>w.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new K("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.layers)n.push(...s.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const s={};let r=0;const i=jie(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const c=i?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[c]!=null)throw new K(`Duplicate weight name: ${c}`);s[c]=u,r++}const o=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(n)throw new K(`Provided weight data has no target variable: ${a}`);delete s[l]}if(n){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new K(`${a.length} of ${r} weights are not set: ${a}`)}uk(o)}parseWeights(e){for(const n in Object.keys(e)){const s=n.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==n&&(e[i]=e[n],delete e[n])}}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${_L}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const s=Sb(this.updatedConfig());return n?JSON.stringify(s):s}call(e,n){return Y(()=>{e=Ct(e);const s=new Va;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Jd(this.outputs,s,n)})}computeMask(e,n){return Y(()=>{e=Ct(e);let s;return n==null?s=Uu(null,e.length):s=Ct(n),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const n=y1(e);if(n.length!==this.inputLayers.length)throw new K(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],u=n[a],c=l.name+"_0_0";s[c]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Ag);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const c=u.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(c.id)!==-1)continue;const h=[];for(let m=0;m<u.inboundLayers.length;m++){const v=u.inboundLayers[m],y=u.nodeIndices[m],w=u.tensorIndices[m],b=`${v.name}_${y}_${w}`,I=s[b];h.push(I)}const d=c.computeOutputShape(Hs(h)),p=y1(d),f=c.inboundNodes.indexOf(u);for(let m=0;m<p.length;m++){const v=`${c.name}_${f}_${m}`;s[v]=p[m]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],c=this.outputLayersTensorIndices[a],h=`${l.name}_${u}_${c}`;o.push(h)}for(let a=0;a<o.length;a++){const l=o[a];co(l in s),i.push(s[l])}return Hs(i)}runInternalGraph(e,n){n==null&&(n=Uu(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],c=e[l],h=n[l];s[u.id]=[c,h]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Ag);for(const l of r){const u=this.nodesByDepth[l];for(const c of u){const h=c.outboundLayer,d=c.inputTensors,p=c.outputTensors,f=new Array;for(const m of d)m.id in s&&f.push(s[m.id]);if(f.length===d.length){let m={},v,y,w,b;if(c.callArgs!=null&&(m=c.callArgs),f.length===1){const[I,k]=f[0];m.mask==null&&(m.mask=k),w=Ct(h.call(I,m)),b=Ct(h.computeMask(I,k)),v=[I],y=[k]}else v=f.map(I=>I[0]),y=f.map(I=>I[1]),m.mask==null&&(m.mask=y),w=Ct(h.call(v,m)),b=Ct(h.computeMask(v,y));if(h.activityRegularizer)throw new et("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let I=0;I<p.length;++I){const k=p[I],R=w[I],C=b[I];s[k.id]=[R,C]}}}}const i=[],o=[],a=[];for(const l of this.outputs){co(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,c]=s[l.id];a.push(u.shape),i.push(u),o.push(c)}return[i,o,a]}buildNodeConversionMap(e){const n={};let s;for(const r of this.layers){s=r instanceof Ti?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=Ti.nodeKey(r,i);this.containerNodes.has(o)&&(n[o]=s,s+=1)}}return n}getLayer(e,n){if(n!=null)return this.findLayer(n);if(e==null)throw new K("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new K(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new K(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return Y(()=>{const e=[];for(const n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){const r=Ti.nodeKey(n,s);this.containerNodes.has(r)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),u=[];for(let h=0;h<o.inboundNodes.length;h++){const d=o.inboundNodes[h],p=Ti.nodeKey(o,h);let f={};if(this.containerNodes.has(p)){if(d.callArgs)try{JSON.stringify(d.callArgs),f=d.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${d.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),f={}}if(d.inboundLayers.length>0){const m=[];for(let v=0;v<d.inboundLayers.length;v++){const y=d.inboundLayers[v],w=d.nodeIndices[v],b=d.tensorIndices[v],I=Ti.nodeKey(y,w);let k=n[I];k==null&&(k=0),m.push([y.name,k,b,f])}u.push(m)}}}const c={};c.name=o.name,c.className=a,c.config=l,c.inboundNodes=u,s.push(c)}e.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],u=Ti.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=n[u];c==null&&(c=0);const h=this.inputLayersTensorIndices[o];r.push([a.name,c,h])}e.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],u=Ti.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=n[u];c==null&&(c=0);const h=this.outputLayersTensorIndices[o];i.push([a.name,c,h])}return e.outputLayers=i,e}static fromConfig(e,n,s={},r=!1){const i={},o={};function a(v,y){v.name in o?o[v.name].push(y):o[v.name]=[y]}function l(v,y){const w=[];let b;for(const I of y){const k=I[0],R=I[1],C=I[2];if(b=I[3]==null?{}:I[3],!(k in i)){a(v,y);return}const T=i[k];if(T.inboundNodes.length<=R){a(v,y);return}const N=T.inboundNodes[R];w.push(N.outputTensors[C])}w.length>0&&v.apply(Hs(w),b)}function u(v){const y=v.name,w=Xo(v,n.customObjects!=null?n.customObjects:{});w.setFastWeightInitDuringBuild(r),i[y]=w,v.inboundNodes.forEach(I=>{if(!(I instanceof Array))throw new K(`Corrupted configuration, expected array for nodeData: ${I}`);a(w,I)})}const c=n.name,h=n.layers;for(const v of h)u(v);for(;!_re(o);)for(const v of h){const y=i[v.name];if(y.name in o){const w=o[y.name];delete o[y.name];for(const b of w)l(y,b)}}const d=[],p=[],f=n.inputLayers;for(const v of f){const y=v[0],w=v[1],b=v[2];co(y in i);const k=i[y].inboundNodes[w].outputTensors;d.push(k[b])}const m=n.outputLayers;for(const v of m){const y=v[0],w=v[1],b=v[2];co(y in i);const k=i[y].inboundNodes[w].outputTensors;p.push(k[b])}return new e({inputs:d,outputs:p,name:c})}get stateful(){if(this._stateful)throw new K("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){Y(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Gie(t,e,n){const s=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(r=>null);if(s===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==s)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const r=[];return e.forEach(i=>{i in t?r.push(t[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function NL(t,e){return Gie(t,e,"classWeight")}async function $L(t,e,n,s){if(n!=null){const r=Y(()=>{if(t.shape.length===1)return Ko(t);if(t.shape.length===2){if(t.shape[1]>1)return Eh(t,1);if(t.shape[1]===1)return H(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());Ye(r);const o=[];return i.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(n[a])}),Tn(o,"float32")}else return null}function Hie(t,e){return W(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const qie=32;function AL(t,e){let n,s;const r=e;n=r.xs,s=r.ys,F(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=f$("input",t.inputNames,n),o=f$("output",t.outputNames,s),a=i[0].shape[0];F(i.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),F(o.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<i.length;l++)F(i[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<o.length;l++)F(o[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:i,ys:o}}function f$(t,e,n){if(n instanceof Mt)return[n];if(Array.isArray(n))return F(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const s=[];for(const r of e){if(n[r]==null)throw new K(`The feature data generated by the dataset lacks the required ${t} key '${r}'.`);s.push(n[r])}return s}}function Kie(t){if(t.length===3)throw new et("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function Xie(t,e,n){const s=n.batchesPerEpoch!=null;if(F(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),F(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),F(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),F(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),F(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const r=n.validationData!=null;let i,o;if(r)if(m$(n.validationData))F(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const v=Kie(n.validationData);i=v.xs,o=v.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(v=>"val_"+v)):u=l.slice();const c=xL(n.callbacks,n.yieldEvery),h=n.verbose==null?1:n.verbose,{callbackList:d,history:p}=bL(c,h,n.epochs,null,null,Yie(e,n),null,r,u);d.setModel(t),t.history=p,await d.onTrainBegin(),t.stopTraining_=!1;let f=n.initialEpoch==null?0:n.initialEpoch,m=await e.iterator();for(;f<n.epochs;){const v={};await d.onEpochBegin(f);let y=0,w=0;for(s||(m=await e.iterator());!s||y<n.batchesPerEpoch;){const b=await m.next();if(s&&b.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(b.value!=null){const{xs:I,ys:k}=AL(t,b.value),R={};R.batch=w,R.size=I[0].shape[0],await d.onBatchBegin(w,R);const C=[];if(n.classWeight!=null){const $=NL(n.classWeight,t.outputNames);for(let P=0;P<$.length;++P)C.push(await $L(k[P],null,$[P]))}const T=I.concat(k).concat(C),N=a(T);Ye(T);for(let $=0;$<l.length;++$){const P=l[$],V=N[$];R[P]=V,Un(V)}await d.onBatchEnd(w,R),wL(R),w++,y++}if(s?y>=n.batchesPerEpoch:b.done){if(r){let I;m$(n.validationData)?I=Ct(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):I=Ct(t.evaluate(i,o,{batchSize:n.validationBatchSize==null?qie:n.validationBatchSize,verbose:0}));for(let k=0;k<t.metricsNames.length;++k)v[`val_${t.metricsNames[k]}`]=I[k]}break}if(t.stopTraining_)break}if(await d.onEpochEnd(f,v),f++,t.stopTraining_)break}return await d.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function Yie(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function m$(t){return typeof t.iterator=="function"}function Qie(t){return typeof t.next=="function"}async function Jie(t,e,n){n=n||{};const s=n.batches!=null,r=t.testFunction;let i=[];if(n.verbose>0)throw new et("Verbose mode is not implemented yet.");F(!s||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const o=Qie(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<n.batches;){const u=await o.next();if(i=Y(()=>{if(u.value){const{xs:c,ys:h}=AL(t,u.value),d=c.concat(h),p=Y(()=>r(d));if(Ye(d),l===0)for(let m=0;m<p.length;++m)i.push(Be(0));const f=d[0].shape[0];for(let m=0;m<p.length;++m){const v=p[m],y=i[m];i[m]=Y(()=>fe(i[m],W(f,v))),l>0&&Ye(y)}Ye(p),a+=f,++l}return i}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){const c=i[u];i[u]=_e(i[u],a),Ye(c)}return Hs(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mx(t){F(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function zd(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(s=>vu(s,e,n-e)):vu(t,e,n-e)}function Tb(t,e){return Y(()=>t==null?null:Array.isArray(t)?t.map(n=>Tb(n,e)):iL(t,e.dtype==="int32"?e:Se(e,"int32")))}function gx(t,e){const n=[];let s=0,r=null;for(;s<t;)r=s+e,r>=t&&(r=t),n.push([s,r]),s=r;return n}function RL(t){const e=[];t instanceof Mt&&(t=[t]);for(let n=0;n<t.length;++n){const s=t[n];if(s.rank===1)e.push(Nm(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function Si(t,e){if(t==null)return;const n=[];if(e instanceof Mt)n.push(e.id);else if(Array.isArray(e))e.forEach(r=>n.push(r.id));else if(e!=null)for(const r in e){const i=e[r];n.push(i.id)}const s=[];if(t instanceof Mt)n.indexOf(t.id)===-1&&s.push(t);else if(Array.isArray(t))t.forEach(r=>{n.indexOf(r.id)===-1&&s.push(r)});else if(t!=null)for(const r in t){const i=t[r];n.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Zie(t){return t instanceof Mt}function Cb(t){return Array.isArray(t)}function g$(t){return!Zie(t)&&!Cb(t)}function y$(t,e,n,s=!0,r=""){if(e==null||e.length===0){if(t!=null){let o=!1;if(Cb(t)&&t.length>0)o=!0;else if(g$(t)){for(const a in t)if(t.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new K(`Error when checking model ${r} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(o=>null);let i;if(g$(t)){t=t,i=[];for(const o of e){if(t[o]==null)throw new K(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(t[o])}}else if(Cb(t)){if(t=t,t.length!==e.length)throw new K(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);i=t}else{if(t=t,e.length>1)throw new K(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);i=[t]}if(i=RL(i),n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=i[o];if(a.shape.length!==n[o].length)throw new K(`Error when checking ${r}: expected ${e[o]} to have ${n[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],c=n[o][l];if(c!=null&&c>=0&&u!==c)throw new K(`${r} expected a batch of elements where each example has shape [${n[o].slice(1,n[o].length)}] (i.e.,tensor shape [*,${n[o].slice(1,n[o].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function eoe(t,e,n){const s=Za(t.map(i=>i.shape[0]));s.sort();const r=Za(e.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new K(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(r.length>1)throw new K(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!ut(s,r))throw new K(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function toe(t,e,n){const s=[Yv,Qv,Jp];for(let r=0;r<t.length;++r){const i=t[r],o=e[r],a=n[r];if(o!=null){if(o===Jp&&i.shape[i.shape.length-1]===1)throw new K(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=i.shape.slice(1),u=a.slice(1);for(let c=0;c<l.length;++c){const h=l[c],d=u[c];if(d!=null&&h!==d)throw new K(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function v$(t,e,n,s=!0,r=""){let i;if(Array.isArray(t)){if(t.length!==e.length)throw new K(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);i=t}else{if(e.length>1)throw new K(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);i=[t]}if(n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=i[o];if(a.shape.length!==n[o].length)throw new K(`Error when checking ${r}: expected ${e[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],c=n[o][l];if(c!=null&&c!==u)throw new K(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function noe(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(s=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(s=>n);{const s=[];for(const r of e){let i=n.hasOwnProperty(r)?n[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const soe="layers-model";class uh extends Ti{constructor(e){super(e),this.isTraining=!1}summary(e,n,s=console.log){if(!this.built)throw new K("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Vie(this,e,n,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=Mie(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Rl))throw new K("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new K(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),n.push(fx(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new K(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>fx(a))}else{const o=fx(e.loss);this.outputs.forEach(a=>{n.push(o)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],yu("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=noe(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};yu("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=r[o];(u=>{const c="";let h,d,p;for(const f of u){if(typeof f=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(f)!==-1){const v=this.internalOutputShapes[o];v[v.length-1]===1||this.lossFunctions[o]===Qv?["accuracy","acc"].indexOf(f)!==-1?d=SL:["crossentropy","ce"].indexOf(f)!==-1&&(d=_ie):this.lossFunctions[o]===I1?["accuracy","acc"].indexOf(f)!==-1?d=Nie:["crossentropy","ce"].indexOf(f)!==-1&&(d=kL):["accuracy","acc"].indexOf(f)!==-1?d=TL:["crossentropy","ce"].indexOf(f)!==-1&&(d=CL);let y;["accuracy","acc"].indexOf(f)!==-1?y="acc":["crossentropy","ce"].indexOf(f)!==-1&&(y="ce"),p=d,h=c+y}else p=Lie(f),h=c+Og(f);let m;yu(h,()=>{m=p}),i(o,h,m)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,s={}){const r=s.batchSize==null?32:s.batchSize;mx(r);const o=this.standardizeUserDataXY(e,n,!0,r);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return Hs(u)}finally{Si(o[0],e),Si(o[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),Jie(this,e,n)}checkNumSamples(e,n,s,r="steps"){let i;if(s!=null){if(i=null,n!=null)throw new K(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new K(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new K("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(n),r=s?n:[n],i=this.retrieveSymbolicTensors(r),o=new Va;if(e instanceof Mt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new K(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new K(`No value is provided for the model's input ${l.name}`);o.add(l,u)}const a=Jd(i,o);return s?a:a[0]}retrieveSymbolicTensors(e){const n=Uu(null,e.length);let s=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(n[a]=i[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw n.forEach((i,o)=>{i==null&&r.push(e[o])}),new K(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return n}predictLoop(e,n=32,s=!1){return Y(()=>{const r=this.checkNumSamples(e);if(s)throw new et("Verbose predictLoop() is not implemented yet.");const i=gx(r,n),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)Y(()=>{const u=i[a][0],c=i[a][1],h=zd(e,u,c),d=[];if(Array.isArray(h))for(let f=0;f<h.length;++f)d.push({key:this.inputs[f],value:h[f]});else d.push({key:this.inputs[0],value:h});const p=new Va(d);return Jd(this.outputs,p)}).forEach((u,c)=>o[c].push(u));return Hs(o.map(a=>hn(a,0)))})}predict(e,n={}){const s=RL(e);v$(s,this.inputNames,this.feedInputShapes,!1);try{const r=n.batchSize==null?32:n.batchSize;return mx(r),this.predictLoop(s,r)}finally{Si(s,e)}}predictOnBatch(e){v$(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,s=!0,r){if(this.optimizer_==null)throw new ni("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===I1?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=y$(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=y$(n,this.feedOutputNames,i,!1,"target"),eoe(e,n),toe(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new K(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,s,r,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,n,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const c=NL(r,this.outputNames);u=[];for(let h=0;h<c.length;++h)u.push(await $L(l[h],null,c[h]))}return[a,l,u]}testLoop(e,n,s,r=0,i){return Y(()=>{const o=this.checkNumSamples(n,s,i,"steps"),a=[];if(r>0)throw new et("Verbose mode is not implemented yet.");if(i!=null)throw new et("steps mode in testLoop() is not implemented yet");{const l=gx(o,s),u=Tn(ji(0,o));for(let c=0;c<l.length;++c){const h=l[c][0],d=l[c][1],p=vu(u,h,d-h),f=Tb(n,p),m=e(f);if(c===0)for(let v=0;v<m.length;++v)a.push(Be(0));for(let v=0;v<m.length;++v){const y=m[v];a[v]=fe(a[v],W(d-h,y))}}for(let c=0;c<a.length;++c)a[c]=_e(a[c],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let s=0;s<e.length;++s){const r=e[s];let i=r;if(n$(e,r)>1){const o=n$(e.slice(0,s),r);i+=`_${o}`}n.push(i)}return n}makeTrainFunction(){return e=>{const n=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const h=[];for(let m=0;m<this.inputs.length;++m)h.push({key:this.inputs[m],value:s[m]});const d=new Va(h),p=Jd(this.outputs,d,{training:!0});let f;for(let m=0;m<this.lossFunctions.length;++m){const v=this.lossFunctions[m];let y=v(r[m],p[m]);i[m]!=null&&(y=Hie(y,i[m]));const w=un(y);n.push(w),m===0?f=y:f=fe(f,y)}for(let m=0;m<this.metricsTensors.length;++m){let v;if(this.outputs.length>1&&m<this.outputs.length)v=n[m];else{const y=this.metricsTensors[m][0],w=this.metricsTensors[m][1];v=un(y(r[w],p[w]))}Un(v),o.push(v)}return f=un(f),this.calculateLosses().forEach(m=>{f=fe(f,m)}),f},l=this.collectedTrainableWeights.map(h=>h.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>Y(()=>{const n=[];let s;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let u=0;u<this.inputs.length;++u)o.push({key:this.inputs[u],value:r[u]});const a=new Va(o),l=Jd(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const c=this.lossFunctions[u],h=un(c(i[u],l[u]));u===0?s=h:s=fe(s,h),n.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const c=this.metricsTensors[u][0],h=this.metricsTensors[u][1],d=un(c(i[h],l[h]));n.push(d)}return n})}async fit(e,n,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,a,l,u,c,h,d;try{const p=s.batchSize==null?32:s.batchSize;mx(p);const m=await this.standardizeUserData(e,n,s.sampleWeight,s.classWeight,!1,p);r=m[0],i=m[1],d=m[2];let v=!1,y;if(s.validationData!=null&&s.validationData.length>0){if(v=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new et("validationData including sample weights is not supported yet."):new K(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const $=await this.standardizeUserData(l,u,null,null,!0,p);c=$[0],h=$[1],y=c.concat(h)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){v=!0;const N=Math.floor(r[0].shape[0]*(1-s.validationSplit)),$=r[0].shape[0];c=zd(r,N,$),o=r,r=zd(r,0,N),h=zd(i,N,$),a=i,i=zd(i,0,N),y=c.concat(h)}else s.validationSteps!=null&&(v=!0);const w=r.concat(i).concat(d);this.checkTrainableWeightsConsistency();const b=this.makeTrainFunction(),I=this.getDedupedMetricsNames();let k,R;v?(this.makeTestFunction(),k=this.testFunction,R=I.slice().concat(I.map(N=>"val_"+N))):(k=null,y=[],R=I.slice());const C=xL(s.callbacks,s.yieldEvery);return await this.fitLoop(b,w,I,p,s.epochs,s.verbose,C,k,y,s.shuffle,R,s.initialEpoch,null,null)}finally{this.isTraining=!1,Si(r,e),Si(i,n),Si(o,e),Si(a,n),Si(c,l),Si(h,u),d!=null&&Ye(d)}}async fitLoop(e,n,s,r,i,o,a,l,u,c,h,d,p,f){r==null&&(r=32),i==null&&(i=1),c==null&&(c=!0),d==null&&(d=0);let m=!1;if(l!=null&&u!=null&&(m=!0),f!=null&&(m=!0,p==null))throw new K("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const v=this.checkNumSamples(n,r,p,"steps_per_epoch");let y;v!=null&&(y=ji(0,v)),o==null&&(o=1);const{callbackList:w,history:b}=bL(a,o,i,d,v,p,r,m,h);w.setModel(this),this.history=b,await w.onTrainBegin(),this.stopTraining_=!1;for(let I=d;I<i;++I){await w.onEpochBegin(I);const k={};if(p!=null)throw new et("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new et("batch shuffling is not implemneted yet");c&&Gq(y);const R=Tn(y),C=gx(v,r);for(let T=0;T<C.length;++T){const N={};if(await w.onBatchBegin(T,N),Y(()=>{const $=C[T][0],P=C[T][1],V=vu(R,$,P-$);N.batch=T,N.size=P-$;const O=Tb(n,V),Q=e(O);for(let Z=0;Z<s.length;++Z){const ne=s[Z],le=Q[Z];N[ne]=le,Un(le)}if(T===C.length-1&&m){const Z=this.testLoop(l,u,r);for(let ne=0;ne<s.length;++ne){const le=s[ne],q=Z[ne];Un(q),k["val_"+le]=q}}}),await w.onBatchEnd(T,N),wL(N),this.stopTraining_)break}R.dispose()}if(await w.onEpochEnd(I,k),this.stopTraining_)break}return await w.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,n){return Xie(this,e,n)}async trainOnBatch(e,n){const s=await this.standardizeUserData(e,n),r=s[0],i=s[1],a=this.makeTrainFunction()(r.concat(i)),l=[];for(const u of a){const c=await u.data();l.push(c[0])}return Ye(a),Si(s[0],e),Si(s[1],n),Hs(l)}getNamedWeights(e){const n=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||n.push({name:r[o].originalName,tensor:i[o]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=VN().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-VN().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Fo(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>Fo(n))}else{const n=Object.keys(this.loss);e={};const s=this.loss;for(const r of n)if(typeof s[r]=="string")e[r]=Fo(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Fo(Og(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Fo(Og(e)));{const e={};for(const n in this.metrics)e[n]=Fo(Og(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=Ib(e.optimizer_config),s=Xo(n);let r;if(typeof e.loss=="string")r=tu(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>tu(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=tu(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>tu(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=tu(e.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(e,n){if(typeof e=="string"){const u=UO(e);if(u.length===0)throw new K(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new K(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new K("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await ib(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:soe,generatedBy:`TensorFlow.js tfjs-layers v${_L}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:c,specs:h}=await ib(await this.optimizer.getWeights(),u);s.specs.push(...h),s.data=VO([s.data,c])}return this.userDefinedMetadata!=null&&(p$(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){p$(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}uh.className="Model";ge(uh);class DL extends uh{}DL.className="Functional";ge(DL);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Zp extends uh{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:qv("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new K(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof Zp||e instanceof uh;let s;if(n){if(s=e,s.outputs.length!==1)throw new K("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new K("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new K("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=iie({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new K(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new K("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=fL(this.outputs[0])}this.inboundNodes=[],new Xv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Uu(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(wt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new uh({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,s=console.log){this.built||this.build(),super.summary(e,n,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,s={}){if(!this.built)throw new ni("The model needs to be compiled before being used.");return this.model.evaluate(e,n,s)}async evaluateDataset(e,n){if(!this.built)throw new ni("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,s={}){if(!this.built)throw new ni("The model needs to be compiled before being used.");return this.model.fit(e,n,s)}async fitDataset(e,n){if(!this.built)throw new ni("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,s={},r=!1){let i,o={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new K("Legacy serialization format not supported yet.");i=n}else F(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=n.layers,delete n.layers,o=n;const a=new e(o);if(!(a instanceof Zp))throw new et(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const c=Xo(l,void 0,r);r&&c.setFastWeightInitDuringBuild(!0),a.add(c)}return a}set stopTraining(e){if(this.model==null)throw new K("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new K("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const s={};s.className=n.getClassName(),s.config=n.getConfig(),e.push(s)}return{name:this.name,layers:e}}}Zp.className="Sequential";ge(Zp);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let xs=class extends Jh{getConfig(){return{}}};class OL extends xs{apply(e,n=1){return Wre(e,n)}}OL.className="elu";ge(OL);class PL extends xs{apply(e){return aC(e)}}PL.className="selu";ge(PL);class FL extends xs{apply(e){return $o(e)}}FL.className="relu";ge(FL);class LL extends xs{apply(e){return Y(()=>zu(6,$o(e)))}}LL.className="relu6";ge(LL);class ML extends xs{apply(e){return e}}ML.className="linear";ge(ML);class VL extends xs{apply(e){return Mi(e)}}VL.className="sigmoid";ge(VL);class zL extends xs{apply(e){return Gre(e)}}zL.className="hardSigmoid";ge(zL);class BL extends xs{apply(e){return Xh(e)}}BL.className="softplus";ge(BL);class UL extends xs{apply(e){return jre(e)}}UL.className="softsign";ge(UL);class WL extends xs{apply(e){return Vu(e)}}WL.className="tanh";ge(WL);let pk=class extends xs{apply(e,n=-1){return Fv(e,n)}};pk.className="softmax";ge(pk);class jL extends xs{apply(e,n=-1){return HT(e,n)}}jL.className="logSoftmax";ge(jL);class GL extends xs{apply(e){return Y(()=>Y(()=>{const n=Math.sqrt(2),s=W(.5,fe(1,WT(_e(e,n))));return W(e,s)}))}}GL.className="gelu";ge(GL);class HL extends xs{apply(e){return Y(()=>W(.5,W(e,fe(1,Vu(W(ns(_e(2,Math.PI)),fe(e,W(.044715,na(e,3)))))))))}}HL.className="gelu_new";ge(HL);class qL extends xs{apply(e){return Y(()=>W(e,Vu(Xh(e))))}}qL.className="mish";ge(qL);class KL extends xs{apply(e,n=1){return Y(()=>W(Mi(W(e,n)),e))}}KL.className="swish";ge(KL);function fl(t){return t.getClassName()}function yx(t,e={}){return _m(t,Yr.getMap().classNameMap,e,"activation")}function ml(t){if(t==null){const e={};return e.className="linear",e.config={},yx(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},yx(e)}else return t instanceof xs?t:yx(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function roe(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class XL extends Jh{}class YL extends XL{constructor(e){super(),roe(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return Y(()=>{let n=Nn([1]);return this.hasL1&&(n=fe(n,De(W(this.l1,kn(e))))),this.hasL2&&(n=fe(n,De(W(this.l2,$m(e))))),H(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}YL.className="L1L2";ge(YL);const w$={l1l2:"L1L2"};function zt(t){return ZC(t)}function x$(t,e={}){return _m(t,Yr.getMap().classNameMap,e,"regularizer")}function Zt(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in w$?w$[t]:t,config:{}};return x$(n)}else return t instanceof XL?t:x$(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class QL extends rt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=Ge(e);let s=$o(e);return this.maxValue!=null&&(s=Qs(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}QL.className="ReLU";ge(QL);class JL extends rt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=Ge(e);return Cv(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}JL.className="LeakyReLU";ge(JL);class ZL extends rt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Jt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Zt(e.alphaRegularizer),this.alphaConstraint=On(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new K(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=wt(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)n[r-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new An({ndim:e.length,axes:s})],this.built=!0}call(e,n){return e=Ge(e),Rv(e,this.alpha.read())}getConfig(){const e={alphaInitializer:rn(this.alphaInitializer),alphaRegularizer:zt(this.alphaRegularizer),alphaConstraint:Dn(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}ZL.className="PReLU";ge(ZL);let eM=class extends rt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new et(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=Ge(e);return bm(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}};eM.className="ELU";ge(eM);class tM extends rt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const s=Ge(e);return W(s,Se(Tr(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}tM.className="ThresholdedReLU";ge(tM);class nM extends rt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new pk().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){return Y(()=>{let s=Ge(e);const r=n.mask;if(r!=null){const i=W(Ne(hr(s.shape),Se(r,s.dtype)),Be(-1e9));s=fe(s,i)}return this.axis instanceof Array?this.axis.length>1?Ps(Ne(s,Ev(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}nM.className="Softmax";ge(nM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ch(t,e,n){if(typeof t=="number")return Uu(t,e);if(t.length!==e)throw new K(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let s=0;s<e;++s){const r=t[s];if(!Vre(r))throw new K(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${r}`)}return t}function Vi(t,e,n,s,r=1){if(t==null)return t;const i=e+(e-1)*(r-1);let o;return n==="same"?o=t:o=t-i+1,Math.floor((o+s-1)/s)}function ho(t,e,n,s){if(t==null)return null;if(s==="valid")t=t*e+pl([n-e,0]);else if(s==="same")t=t*e;else throw new K(`Unsupport padding mode: ${s}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fk(t,e){return Y(()=>(bn(e),e==="channelsFirst"?pt(t,[0,2,3,1]):t))}function sM(t,e){return Y(()=>(bn(e),e==="channelsFirst"?pt(t,[0,2,3,4,1]):t))}function ioe(t,e,n,s=1,r="valid",i,o=1){return Y(()=>{if(i==null&&(i=Gi()),bn(i),t.shape.length!==3)throw new K(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new K(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new K(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(i==="channelsFirst"&&(t=pt(t,[0,2,1])),r==="causal")throw new et("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=MT(t,e,s,r==="same"?"same":"valid","NWC",o);return n!=null&&(a=Yi(a,n)),a})}function b$(t,e,n,s=[1,1],r="valid",i,o,a=null){return Y(()=>{if(i==null&&(i=Gi()),bn(i),t.rank!==3&&t.rank!==4)throw new K(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new K(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=fk(t,i);if(r==="causal")throw new et("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=YP({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),i==="channelsFirst"&&(l=pt(l,[0,3,1,2])),l})}function ooe(t,e,n,s=[1,1,1],r="valid",i,o){return Y(()=>{if(i==null&&(i=Gi()),bn(i),t.rank!==4&&t.rank!==5)throw new K(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new K(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=sM(t,i);if(r==="causal")throw new et("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=mP(a,e,s,r==="same"?"same":"valid","NDHWC",o),n!=null&&(a=Yi(a,n)),i==="channelsFirst"&&(a=pt(a,[0,4,1,2,3])),a})}class Jv extends rt{constructor(e,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Jv.verifyArgs(n),this.rank=e,Wn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new et(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=ch(n.kernelSize,e,"kernelSize"),this.strides=ch(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,Br(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,bn(this.dataFormat),this.activation=ml(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=Jt(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=On(n.biasConstraint),this.biasRegularizer=Zt(n.biasRegularizer),this.activityRegularizer=Zt(n.activityRegularizer),this.dilationRate=ch(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new K(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new K(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new K(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(co("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!ek(e.kernelSize,"number",1,3))throw new K(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:fl(this.activation),useBias:this.useBias,biasInitializer:rn(this.biasInitializer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),biasConstraint:Dn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class Zh extends Jv{constructor(e,n){super(e,n),this.kernel=null,Zh.verifyArgs(n),this.filters=n.filters,Wn(this.filters,"filters"),this.kernelInitializer=Jt(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=On(n.kernelConstraint),this.kernelRegularizer=Zt(n.kernelRegularizer)}build(e){e=wt(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new K(`The channel dimension of the input should be defined. Found ${e[n]}`);const s=e[n],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(e,n){return Y(()=>{e=Ge(e);let s;const r=this.bias==null?null:this.bias.read(),i=ZF(this.activation.getClassName());if(i!=null&&this.rank===2)s=b$(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=ioe(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=b$(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=ooe(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new et("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=wt(e);const n=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<s.length;++i){const o=Vi(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);n.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(n),r.push(this.filters)):(r.push(this.filters),r=r.concat(n)),r}getConfig(){const e={filters:this.filters,kernelInitializer:rn(this.kernelInitializer),kernelRegularizer:zt(this.kernelRegularizer),kernelConstraint:Dn(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new K(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Om extends Zh{constructor(e){super(2,e),Om.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!ek(e.kernelSize,"number",1,2))throw new K(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Om.className="Conv2D";ge(Om);class Pm extends Zh{constructor(e){super(3,e),Pm.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new K(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Pm.className="Conv3D";ge(Pm);class rM extends Om{constructor(e){if(super(e),this.inputSpec=[new An({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new K(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=wt(e),e.length!==4)throw new K("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new K("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new An({ndim:4,axes:{[n]:s}})],this.built=!0}call(e,n){return Y(()=>{let s=Ge(e);if(s.shape.length!==4)throw new K(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=r[o],u=r[a],c=this.kernelSize[0],h=this.kernelSize[1],d=this.strides[0],p=this.strides[1],f=ho(l,d,c,this.padding),m=ho(u,p,h,this.padding),v=[i,f,m,this.filters];this.dataFormat!=="channelsLast"&&(s=pt(s,[0,2,3,1]));let y=zT(s,this.kernel.read(),v,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=pt(y,[0,3,1,2])),this.bias!=null&&(y=Yi(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(e){e=wt(e);const n=e.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return n[s]=this.filters,n[r]=ho(n[r],l,o,this.padding),n[i]=ho(n[i],u,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}rM.className="Conv2DTranspose";ge(rM);class iM extends Pm{constructor(e){if(super(e),this.inputSpec=[new An({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new K(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=wt(e),e.length!==5)throw new K("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new K("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new An({ndim:5,axes:{[n]:s}})],this.built=!0}call(e,n){return Y(()=>{let s=Ge(e);if(s.shape.length!==5)throw new K(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const u=r[l],c=r[o],h=r[a],d=this.kernelSize[0],p=this.kernelSize[1],f=this.kernelSize[2],m=this.strides[0],v=this.strides[1],y=this.strides[2],w=ho(u,m,d,this.padding),b=ho(c,v,p,this.padding),I=ho(h,y,f,this.padding),k=[i,w,b,I,this.filters];this.dataFormat!=="channelsLast"&&(s=pt(s,[0,2,3,4,1]));let R=yP(s,this.kernel.read(),k,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(R=pt(R,[0,4,1,2,3])),this.bias!==null&&(R=Yi(R,this.bias.read(),this.dataFormat)),this.activation!==null&&(R=this.activation.apply(R)),R})}computeOutputShape(e){e=wt(e);const n=e.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],h=this.strides[1],d=this.strides[2];return n[s]=this.filters,n[r]=ho(n[r],c,a,this.padding),n[i]=ho(n[i],h,l,this.padding),n[o]=ho(n[o],d,u,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}iM.className="Conv3DTranspose";ge(iM);class oM extends Zh{constructor(e,n){if(super(e,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new K("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new K("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new K(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=Jt(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Zt(n.depthwiseRegularizer),this.depthwiseConstraint=On(n.depthwiseConstraint),this.pointwiseInitializer=Jt(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Zt(n.pointwiseRegularizer),this.pointwiseConstraint=On(n.pointwiseConstraint)}build(e){if(e=wt(e),e.length<this.rank+2)throw new K(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new K(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const s=e[n],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new An({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(e,n){return Y(()=>{e=Ge(e);let s;if(this.rank===1)throw new et("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=pt(e,[0,2,3,1])),s=lC(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Yi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=pt(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=rn(this.depthwiseInitializer),e.pointwiseInitializer=rn(this.pointwiseInitializer),e.depthwiseRegularizer=zt(this.depthwiseRegularizer),e.pointwiseRegularizer=zt(this.pointwiseRegularizer),e.depthwiseConstraint=Dn(this.depthwiseConstraint),e.pointwiseConstraint=Dn(this.pointwiseConstraint),e}}oM.className="SeparableConv";class aM extends oM{constructor(e){super(2,e)}}aM.className="SeparableConv2D";ge(aM);class Zv extends Zh{constructor(e){super(1,e),Zv.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!ek(e.kernelSize,"number",1,1))throw new K(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Zv.className="Conv1D";ge(Zv);class lM extends rt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return Y(()=>{if(e=Ge(e),this.dataFormat==="channelsLast"){const s=Dg(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Dg(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Dg(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Dg(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}lM.className="Cropping2D";ge(lM);class uM extends rt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,bn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Fre(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,s]}else{const n=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],n,s,e[3]]}}call(e,n){return Y(()=>{let s=Ge(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=pt(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],a=this.interpolation==="nearest"?Ar.resizeNearestNeighbor(s,[i,o]):Ar.resizeBilinear(s,[i,o]);return pt(a,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?Ar.resizeNearestNeighbor(s,[i,o]):Ar.resizeBilinear(s,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}}uM.className="UpSampling2D";ge(uM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function aoe(t,e,n=[1,1],s="valid",r,i){return Y(()=>{r==null&&(r=Gi()),bn(r);let o=fk(t,r);if(t.rank!==4)throw new K(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new K(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=xm(o,e,n,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=pt(o,[0,3,1,2])),o})}class cM extends Jv{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Jt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=On(e.depthwiseConstraint),this.depthwiseRegularizer=Zt(e.depthwiseRegularizer)}build(e){if(e=wt(e),e.length<4)throw new K(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new K(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const s=e[n],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return Y(()=>{e=Ge(e);let s=aoe(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Yi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=wt(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=Vi(n,this.kernelSize[0],this.padding,this.strides[0]),o=Vi(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,o]:[e[0],i,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=rn(this.depthwiseInitializer),e.depthwiseRegularizer=zt(this.depthwiseRegularizer),e.depthwiseConstraint=Dn(this.depthwiseRegularizer),e}}cM.className="DepthwiseConv2D";ge(cM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hM(t,e,n,s){if(Array.isArray(t)){if(e!=null||n!=null)throw new K("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=t.slice(t.length-s,t.length),t=t.slice(0,t.length-s)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),n=r(n),{inputs:t,initialState:e,constants:n}}function dM(t,e,n,s=!1,r,i,o=!1,a=!1){return Y(()=>{const l=e.shape.length;if(l<3)throw new K(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(ji(2,l));e=pt(e,u),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Se(Se(r,"bool"),"float32"),r.rank===l-1&&(r=Xn(r,-1)),r=pt(r,u)),s&&(e=hi(e,0),r!=null&&(r=hi(r,0)));const c=[];let h,d=n;const p=e.shape[0],f=di(e);let m;r!=null&&(m=di(r));for(let y=0;y<p;++y){const w=f[y],b=Y(()=>t(w,d));if(r==null)h=b[0],d=b[1];else{const I=Y(()=>{const k=m[y],R=Ne(Lr(k),k),C=fe(W(b[0],k),W(d[0],R)),T=d.map((N,$)=>fe(W(b[1][$],k),W(N,R)));return{output:C,newStates:T}});h=I.output,d=I.newStates}a&&c.push(h)}let v;return a&&(v=wr(c,1)),[h,v,d]})}class Dl extends rt{constructor(e){super(e);let n;if(e.cell==null)throw new K("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new yk({cells:e.cell}):n=e.cell,n.stateSize==null)throw new K("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new An({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return ji(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){wb(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const s=n[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const i=[];for(const o of n)i.push([e[0],o]);return[r].concat(i)}else return r}computeMask(e,n){return Y(()=>{Array.isArray(n)&&(n=n[0]);const s=this.returnSequences?n:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<e;++s)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new et("Constants support is not implemented in RNN yet.");wb(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new An({shape:[n,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!ut(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new K(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new An({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){Y(()=>{if(!this.stateful)throw new uo("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new K("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Nn([s,r])):this.states_=[Nn([s,this.cell.stateSize])];else if(e==null)Ye(this.states_),this.keptStates!=null&&(Ye(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Nn([s,r])):this.states_[0]=Nn([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new K(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):Ye(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,o];if(!ut(i.shape,a))throw new K(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>Un(r.clone()))})}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const i=hM(e,s,r,this.numConstants);e=i.inputs,s=i.initialState,r=i.constants;let o=[],a=[];if(s!=null){n.initialState=s,o=o.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new An({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(n.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof Eo){const u=[e].concat(o),c=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=c;const d=super.apply(u,n);return this.inputSpec=h,d}else return super.apply(e,n)}call(e,n){return Y(()=>{const s=n==null?null:n.mask,r=n==null?null:n.training;let i=n==null?null:n.initialState;e=Ge(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new K(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=dM((f,m)=>{const v=this.cell.call([f].concat(m),a);return[v[0],v.slice(1)]},e,i,this.goBackwards,s,null,this.unroll,this.returnSequences),c=u[0],h=u[1],d=u[2];this.stateful&&this.resetStates(d,r);const p=this.returnSequences?h:c;return this.returnState?[p].concat(d):p})}getInitialState(e){return Y(()=>{let n=Nn(e.shape);return n=De(n,[1,2]),n=Nm(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?yb(n,[1,s]):n):this.cell.stateSize>1?[yb(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Dl.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),n)}static fromConfig(e,n,s={}){const r=n.cell,i=Xo(r,s);return new e(Object.assign(n,{cell:i}))}}Dl.className="RNN";ge(Dl);class ew extends rt{}class mk extends ew{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Wn(this.units,"units"),this.activation=ml(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Jt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Jt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Jt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Zt(e.kernelRegularizer),this.recurrentRegularizer=Zt(e.recurrentRegularizer),this.biasRegularizer=Zt(e.biasRegularizer),this.kernelConstraint=On(e.kernelConstraint),this.recurrentConstraint=On(e.recurrentConstraint),this.biasConstraint=On(e.biasConstraint),this.dropout=Ah([1,pl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ah([1,pl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=wt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return Y(()=>{if(e=e,e.length!==2)throw new K(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=gl({ones:()=>Lr(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=gl({ones:()=>Lr(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=Io(W(e,o),this.kernel.read()):i=Io(e,this.kernel.read()),this.bias!=null&&(i=Yi(i,this.bias.read())),a!=null&&(s=W(s,a));let l=fe(i,Io(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:fl(this.activation),useBias:this.useBias,kernelInitializer:rn(this.kernelInitializer),recurrentInitializer:rn(this.recurrentInitializer),biasInitializer:rn(this.biasInitializer),kernelRegularizer:zt(this.kernelRegularizer),recurrentRegularizer:zt(this.recurrentRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Dn(this.kernelConstraint),recurrentConstraint:Dn(this.recurrentConstraint),biasConstraint:Dn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),n)}}mk.className="SimpleRNNCell";ge(mk);class pM extends Dl{constructor(e){e.cell=new mk(e),super(e)}call(e,n){return Y(()=>{this.cell.dropoutMask!=null&&(Ye(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ye(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return new e(n)}}pM.className="SimpleRNN";ge(pM);class gk extends ew{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new K("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Wn(this.units,"units"),this.activation=ml(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ml(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Jt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Jt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Jt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Zt(e.kernelRegularizer),this.recurrentRegularizer=Zt(e.recurrentRegularizer),this.biasRegularizer=Zt(e.biasRegularizer),this.kernelConstraint=On(e.kernelConstraint),this.recurrentConstraint=On(e.recurrentConstraint),this.biasConstraint=On(e.biasConstraint),this.dropout=Ah([1,pl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ah([1,pl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=wt(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return Y(()=>{if(e=e,e.length!==2)throw new K(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training==null?!1:n.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=gl({ones:()=>Lr(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=gl({ones:()=>Lr(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=W(e,i[0]));let c=Io(e,this.kernel.read());this.useBias&&(c=Yi(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=W(r,o[0]));const h=this.recurrentKernel.read(),[d,p]=gr(h,[2*this.units,this.units],h.rank-1),f=Io(r,d),[m,v,y]=gr(c,3,c.rank-1),[w,b]=gr(f,2,f.rank-1);a=this.recurrentActivation.apply(fe(m,w)),l=this.recurrentActivation.apply(fe(v,b));const I=Io(W(l,r),p);u=this.activation.apply(fe(y,I));const k=fe(W(a,r),W(fe(1,qt(a)),u));return[k,k]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:fl(this.activation),recurrentActivation:fl(this.recurrentActivation),useBias:this.useBias,kernelInitializer:rn(this.kernelInitializer),recurrentInitializer:rn(this.recurrentInitializer),biasInitializer:rn(this.biasInitializer),kernelRegularizer:zt(this.kernelRegularizer),recurrentRegularizer:zt(this.recurrentRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Dn(this.kernelConstraint),recurrentConstraint:Dn(this.recurrentConstraint),biasConstraint:Dn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),n)}}gk.className="GRUCell";ge(gk);class fM extends Dl{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new gk(e),super(e)}call(e,n){return Y(()=>{this.cell.dropoutMask!=null&&(Ye(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ye(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}fM.className="GRU";ge(fM);class tw extends ew{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Wn(this.units,"units"),this.activation=ml(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ml(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Jt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Jt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Jt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Zt(e.kernelRegularizer),this.recurrentRegularizer=Zt(e.recurrentRegularizer),this.biasRegularizer=Zt(e.biasRegularizer),this.kernelConstraint=On(e.kernelConstraint),this.recurrentConstraint=On(e.recurrentConstraint),this.biasConstraint=On(e.biasConstraint),this.dropout=Ah([1,pl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ah([1,pl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=wt(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(n=class extends fi{apply(l,u){const c=i.apply([o]),h=new nk().apply([o]),d=i.apply([o*2]);return r$(r$(c,h),d)}},n.className="CustomInit",n)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return Y(()=>{const s=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new K(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=gl({ones:()=>Lr(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=gl({ones:()=>Lr(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,c,h;0<this.dropout&&this.dropout<1&&(e=W(e,o[0]));let d=Io(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=W(r,a[0])),d=fe(d,Io(r,this.recurrentKernel.read())),this.useBias&&(d=Yi(d,this.bias.read()));const[p,f,m,v]=gr(d,4,d.rank-1);l=this.recurrentActivation.apply(p),u=this.recurrentActivation.apply(f),c=fe(W(u,i),W(l,this.activation.apply(m))),h=this.recurrentActivation.apply(v);const y=W(h,this.activation.apply(c));return[y,y,c]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:fl(this.activation),recurrentActivation:fl(this.recurrentActivation),useBias:this.useBias,kernelInitializer:rn(this.kernelInitializer),recurrentInitializer:rn(this.recurrentInitializer),biasInitializer:rn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:zt(this.kernelRegularizer),recurrentRegularizer:zt(this.recurrentRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Dn(this.kernelConstraint),recurrentConstraint:Dn(this.recurrentConstraint),biasConstraint:Dn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),n)}}tw.className="LSTMCell";ge(tw);class mM extends Dl{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new tw(e),super(e)}call(e,n){return Y(()=>{this.cell.dropoutMask!=null&&(Ye(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ye(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}mM.className="LSTM";ge(mM);class yk extends ew{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return Y(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,n),i.push(o.slice(1))}s=[];for(const a of i.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){wb(e)&&(e=e[0]),e=e;let n;this.cells.forEach((s,r)=>{yu(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?n=s.stateSize[0]:n=s.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(n)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,n,s={}){const r=[];for(const i of n.cells)r.push(Xo(i,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.cells)n.push(...s.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return xb(e)}setWeights(e){const n=[];for(const s of this.cells){const r=s.weights.length,i=e.splice(r);for(let o=0;o<s.weights.length;++o)n.push([s.weights[o],i[o]])}uk(n)}}yk.className="StackedRNNCells";ge(yk);function gl(t){const{ones:e,rate:n,training:s=!1,count:r=1,dropoutFunc:i}=t,o=()=>i!=null?i(e(),n):oL(e(),n),a=()=>Am(o,e,s);return!r||r<=1?Un(a().clone()):Array(r).fill(void 0).map(a).map(u=>Un(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var loe=function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n};class gM extends Dl{constructor(e){if(e.unroll)throw new et("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new et("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new An({ndim:5})]}call(e,n){return Y(()=>{if(this.cell.dropoutMask!=null&&(Ye(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ye(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new K("ConvRNN2D cell does not support constants");const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return Y(()=>{const{stateSize:n}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=Nn(i);return Array.isArray(n)?Array(n.length).fill(o):[o]})}resetStates(e,n=!1){Y(()=>{if(!this.stateful)throw new uo("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new K("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Nn(i)):this.states_=[Nn(i)];else if(e==null)Ye(this.states_),this.keptStates!=null&&(Ye(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Nn(i)):this.states_[0]=Nn(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new K(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):Ye(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=i;if(!ut(l.shape,u))throw new K(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>Un(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:a}=this.cell,l=n==="channelsFirst",u=e[l?3:2],c=e[l?4:3],h=Vi(u,r[0],i,o[0],a[0]),d=Vi(c,r[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[s,h,d]:[h,d,s]]}}gM.className="ConvRNN2D";class vk extends tw{constructor(e){const{filters:n,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:n})),this.filters=n,Wn(this.filters,"filters"),this.kernelSize=ch(s,2,"kernelSize"),this.kernelSize.forEach(l=>Wn(l,"kernelSize")),this.strides=ch(r||1,2,"strides"),this.strides.forEach(l=>Wn(l,"strides")),this.padding=i||"valid",Br(this.padding),this.dataFormat=o||"channelsLast",bn(this.dataFormat),this.dilationRate=ch(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Wn(l,"dilationRate"))}build(e){var n;e=wt(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new K(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,c=this.filters;l=new(n=class extends fi{apply(d,p){const f=u.apply([c]),m=hr([c]),v=u.apply([c*2]);return tk([f,m,v])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return Y(()=>{if(e.length!==3)throw new K(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training||!1,r=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=gl({ones:()=>Lr(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(ie,he,de)=>!he||!he[de]?ie:W(he[de],ie);let c=u(r,l,0),h=u(r,l,1),d=u(r,l,2),p=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=gl({ones:()=>Lr(i),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const f=this.recurrentDropoutMask;let m=u(i,f,0),v=u(i,f,1),y=u(i,f,2),w=u(i,f,3);const b=3,[I,k,R,C]=gr(this.kernel.read(),a,b),[T,N,$,P]=this.useBias?gr(this.bias.read(),a):[null,null,null,null];c=this.inputConv(c,I,T,this.padding),h=this.inputConv(h,k,N,this.padding),d=this.inputConv(d,R,$,this.padding),p=this.inputConv(p,C,P,this.padding);const[V,O,Q,Z]=gr(this.recurrentKernel.read(),a,b);m=this.recurrentConv(m,V),v=this.recurrentConv(v,O),y=this.recurrentConv(y,Q),w=this.recurrentConv(w,Z);const ne=this.recurrentActivation.apply(fe(c,m)),le=this.recurrentActivation.apply(fe(h,v)),q=fe(W(le,o),W(ne,this.activation.apply(fe(d,y)))),J=W(this.recurrentActivation.apply(fe(p,w)),this.activation.apply(q));return[J,J,q]})}getConfig(){const e=super.getConfig(),n=loe(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),s)}inputConv(e,n,s,r){const i=dl(e,n,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Yi(i,s,this.dataFormat):i}recurrentConv(e,n){return dl(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}vk.className="ConvLSTM2DCell";ge(vk);class yM extends gM{constructor(e){const n=new vk(e);super(Object.assign(Object.assign({},e),{cell:n}))}static fromConfig(e,n){return new e(n)}}yM.className="ConvLSTM2D";ge(yM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class wk extends rt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?n[r]:this.noiseShape[r]);return s}call(e,n){return Y(()=>{this.invokeCallHook(e,n);const s=Ge(e);if(0<this.rate&&this.rate<1){const r=n.training==null?!1:n.training,i=this.getNoiseShape(s);return Am(()=>oL(s,this.rate,i,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}wk.className="Dropout";ge(wk);class vM extends wk{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}vM.className="SpatialDropout1D";ge(vM);class wM extends rt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,Wn(this.units,"units"),this.activation=ml(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Jt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Jt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=On(e.kernelConstraint),this.biasConstraint=On(e.biasConstraint),this.kernelRegularizer=Zt(e.kernelRegularizer),this.biasRegularizer=Zt(e.biasRegularizer),this.activityRegularizer=Zt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=wt(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=wt(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return Y(()=>{this.invokeCallHook(e,n);const s=Ge(e),r=ZF(this.activation.getClassName());let i;return r!=null?i=Io(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=Io(s,this.kernel.read()),this.bias!=null&&(i=Yi(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:fl(this.activation),useBias:this.useBias,kernelInitializer:rn(this.kernelInitializer),biasInitializer:rn(this.biasInitializer),kernelRegularizer:zt(this.kernelRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Dn(this.kernelConstraint),biasConstraint:Dn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}wM.className="Dense";ge(wM);class xM extends rt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=wt(e);for(const n of e.slice(1))if(n==null)throw new K(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],el(e,1)]}call(e,n){return Y(()=>{this.invokeCallHook(e,n);let s=Ge(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=pt(s,r)}return Ure(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}xM.className="Flatten";ge(xM);class bM extends rt{constructor(e){super(e),this.supportsMasking=!0,this.activation=ml(e.activation)}call(e,n){return Y(()=>{this.invokeCallHook(e,n);const s=Ge(e);return this.activation.apply(s)})}getConfig(){const e={activation:fl(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}bM.className="Activation";ge(bM);class IM extends rt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return Y(()=>(e=Ge(e),zre(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}IM.className="RepeatVector";ge(IM);class SM extends rt{constructor(e){super(e),this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const s="Total size of new array must be unchanged.",r=n.slice();let i=1,o=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(o===null)o=l;else throw new K("Can only specifiy one unknown dimension.");else i*=u}const a=el(e);if(o!==null){if(i===0||a%i!==0)throw new K(s);r[o]=a/i}else if(a!==i)throw new K(s);return r}computeOutputShape(e){let n=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return Y(()=>{this.invokeCallHook(e,n);const s=Ge(e),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return H(s,i)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}SM.className="Reshape";ge(SM);class TM extends rt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=ji(1,e.dims.length+1);if(!ut(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new An({ndim:this.dims.length+1})]}computeOutputShape(e){e=wt(e);const n=e.slice();return this.dims.forEach((s,r)=>{n[r+1]=e[s]}),n}call(e,n){return pt(Ge(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}TM.className="Permute";ge(TM);class CM extends rt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const s=Ge(e);return m1(Nh(s,this.maskValue),-1)}call(e,n){return Y(()=>{this.invokeCallHook(e,n);const s=Ge(e),o=m1(Nh(s,this.maskValue),-1,!0);return W(s,Se(o,s.dtype))})}}CM.className="Masking";ge(CM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class kM extends rt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(Ct(e.inputLength))}this.inputDim=e.inputDim,Wn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Wn(this.outputDim,"outputDim"),this.embeddingsInitializer=Jt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Zt(e.embeddingsRegularizer),this.activityRegularizer=Zt(e.activityRegularizer),this.embeddingsConstraint=On(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return Y(()=>this.maskZero?(e=Ge(e),Nh(e,ft(e))):null)}computeOutputShape(e){if(e=wt(e),this.inputLength==null)return[...e,this.outputDim];const n=Ct(this.inputLength);if(n.length!==e.length-1)throw new K(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<n.length;++r){const i=n[r],o=e[r+1];if(i!=null&&o!=null&&i!==o)throw new K(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(n[s]=o),s++}}return[e[0],...n,this.outputDim]}call(e,n){return Y(()=>{this.invokeCallHook(e,n);let s=Ge(e);s.dtype!=="int32"&&(s=bo(s,"int32"));const r=iL(this.embeddings.read(),H(s,[s.size]));return H(r,wt(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:rn(this.embeddingsInitializer),embeddingsRegularizer:zt(this.embeddingsRegularizer),activityRegularizer:zt(this.activityRegularizer),embeddingsConstraint:Dn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}kM.className="Embedding";ge(kM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ac extends rt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new et}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const s=e.slice(0,e.length-n.length);for(let r=0;r<n.length;++r){const i=e[e.length-n.length+r],o=n[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new K("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));s.push(i)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[wt(e)]),e=e,e.length<2)throw new K(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const i of e)i!=null&&i[0]!==null&&n.push(i[0]);if(n=Za(n),n.length>1)throw new K(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&Za(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return Y(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=pl(r);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=Nm(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const l of e){const u=l.rank;if(u==null){const c=l.shape,h=c[0],d=c.slice(1).concat([h]);let p=H(l,[h].concat(el(c.slice(1))));p=pt(p,[1,0]),p=H(p,d),s.push(p),i=!0}else if(u>1){const c=ji(1,u).concat([0]);s.push(pt(l,c)),i=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(i){if(a==null){const l=o.shape,u=l.length,c=l[u-1],h=[c].concat(l.slice(0,l.length-1));o=H(pt(H(o,[-1,c]),[1,0]),h)}else if(a>1){const l=[a-1].concat(ji(0,a-1));o=pt(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);n=this.computeElementwiseOpOutputShape(n,i)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=Za(s),s.length===1?n=s.concat(n):n=[null].concat(n),n}computeMask(e,n){return Y(()=>{if(n==null)return null;if(!Array.isArray(n))throw new K("`mask` should be an Array");if(!Array.isArray(e))throw new K("`inputs` should be an Array");if(n.length!==e.length)throw new K(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(r=>r==null))return null;n=n.map(r=>r==null?r:Xn(r,0));let s=n[0];for(let r=1;r<n.length-1;++r)s=ko(s,n[r]);return s})}}class EM extends ac{constructor(e){super(e)}mergeFunction(e){return Y(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=fe(n,e[s]);return n})}}EM.className="Add";ge(EM);class _M extends ac{constructor(e){super(e)}mergeFunction(e){return Y(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=W(n,e[s]);return n})}}_M.className="Multiply";ge(_M);class NM extends ac{constructor(e){super(e)}mergeFunction(e){return Y(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=fe(n,e[s]);return W(1/e.length,n)})}}NM.className="Average";ge(NM);class $M extends ac{constructor(e){super(e)}mergeFunction(e){return Y(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=ha(n,e[s]);return n})}}$M.className="Maximum";ge($M);class AM extends ac{constructor(e){super(e)}mergeFunction(e){return Y(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=zu(n,e[s]);return n})}}AM.className="Minimum";ge(AM);class RM extends ac{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new K("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const r of e)if(r!=null){n=!1;break}if(n)return;const s=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let o=!1;for(const a of s)if(ut(a,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new K("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return Y(()=>tk(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new K("A `Concatenate` layer should be called on a list of inputs.");const n=e,s=n[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of n.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new K("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new K("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new K(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return Y(()=>{let s=!0;if(n.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<e.length;++o)n[o]==null?r.push(Se(Lr(e[o]),"bool")):n[o].rank<e[o].rank?r.push(Xn(n[o],-1)):r.push(n[o]);const i=hn(r,this.axis);return FT(i,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}RM.className="Concatenate";ge(RM);function Bd(t,e){for(;t<0;)t+=e;return t}function uoe(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new et("batchDot is not implemented for tensors of 4D or higher rank yet");if(F(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),F(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new et("batchDot is not implemented for complex64-type Tensors yet.");const s=t.shape.length,r=e.shape.length;n==null&&(n=[s-1,r-2]);const i=n;return Y(()=>{let o;if(s>r){o=s-r;const l=[];for(let u=0;u<o;++u)l.push(1);e=H(e,e.shape.concat(l))}else if(r>s){o=r-s;const l=[];for(let u=0;u<o;++u)l.push(1);t=H(t,t.shape.concat(l))}else o=0;let a;if(t.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=De(W(t,e),i[0]):a=De(W(pt(t,[1,0]),e),i[1]);else{const l=i[0]!==t.shape.length-1,u=i[1]===e.shape.length-1;a=it(t,e,l,u)}if(o>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let c=l;c<l+o;++c)u.push(c);a=mn(a,u)}return a.shape.length===1&&(a=Xn(a,1)),a})}class DM extends ac{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){F(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],s=e[1];if(n.length>3||s.length>3)throw new et("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);if(n[r[0]]!==s[r[1]])throw new K(`Dimension incompatibility: ${n[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new K(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>Bd(i,e[o].shape.length)):r=[Bd(this.axes,n.shape.length),Bd(this.axes,s.shape.length)],this.normalize&&(n=b1(n,r[0]),s=b1(s,r[1])),uoe(n,s,r)}interpretAxes(e,n){let s;return Array.isArray(this.axes)?s=this.axes:s=[Bd(this.axes,e.length),Bd(this.axes,n.length)],s}computeOutputShape(e){F(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),s=e[1].slice();if(n.length>3||s.length>3)throw new et("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);n.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=n.concat(s);return i.length===1&&i.push(1),i}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}DM.className="Dot";ge(DM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class OM extends rt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return Y(()=>{this.invokeCallHook(e,n);const s=Ge(e);return Am(()=>fe(Kv(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}OM.className="GaussianNoise";ge(OM);class PM extends rt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return Y(()=>{this.invokeCallHook(e,n);const s=Ge(e);return this.rate>0&&this.rate<1?Am(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return W(s,Kv(s.shape,1,i))},()=>s,n.training||!1):s})}}PM.className="GaussianDropout";ge(PM);class FM extends rt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Ge(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return Y(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Am(()=>{const i=Ge(e),l=-1.6732632423543772*1.0507009873554805;let u=$l(rc(s),this.rate);u=bo(u,"float32");const c=((1-this.rate)*(1+this.rate*l**2))**-.5,h=-c*l*this.rate,d=fe(W(i,u),W(fe(u,-1),l));return fe(W(d,c),h)},()=>Ge(e),n.training||!1)}return e})}}FM.className="AlphaDropout";ge(FM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ef(t,e,n,s,r,i=.001){let o;if(t.rank===2)o=oP(t,e,n,s,r,i);else if(t.rank===3)o=aP(t,e,n,s,r,i);else if(t.rank===4)o=lP(t,e,n,s,r,i);else throw new et(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return o}function coe(t,e,n,s,r=.001){return Y(()=>{const i=$v(t,s),o=i.mean,a=i.variance;return[ef(t,o,a,n,e,r),o,a]})}function hoe(t,e,n,s,r=.001){return Y(()=>{const i=$v(t,s),o=i.mean,a=i.variance,l=[];for(const f of ji(0,t.rank))s.indexOf(f)!==-1?l.push(1):l.push(t.shape[f]);const u=H(o,l),c=H(a,l),h=e==null?null:H(e,l),d=n==null?null:H(n,l);return[ef(t,u,c,d,h,r),o,a]})}function doe(t,e,n,s,r=.001){return ut(s.slice().sort(),ji(0,t.rank-1))?coe(t,e,n,s,r):hoe(t,e,n,s,r)}class LM extends rt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Jt(e.betaInitializer||"zeros"),this.gammaInitializer=Jt(e.gammaInitializer||"ones"),this.movingMeanInitializer=Jt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Jt(e.movingVarianceInitializer||"ones"),this.betaConstraint=On(e.betaConstraint),this.gammaConstraint=On(e.gammaConstraint),this.betaRegularizer=Zt(e.betaRegularizer),this.gammaRegularizer=Zt(e.gammaRegularizer)}build(e){e=wt(e);const n=this.axis>=0?this.axis:this.axis+e.length,s=e[n];if(s==null)throw new K(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new An({ndim:e.length,axes:{[n]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return Y(()=>{const s=n.training==null?!1:n.training,r=Ge(e),i=r.shape,o=i.length,a=ji(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const u=Uu(1,o);u[l]=i[l];const c=a.slice();c.sort();const h=!ut(c,ji(0,o).slice(0,o-1)),d=()=>{if(h){const w=H(this.movingMean.read(),u),b=H(this.movingVariance.read(),u),I=this.center?H(this.beta.read(),u):null,k=this.scale?H(this.gamma.read(),u):null;return ef(r,w,b,I,k,this.epsilon)}else return ef(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return d();const[p,f,m]=doe(r,this.gamma.read(),this.beta.read(),a,this.epsilon),v=(w,b,I)=>{Y(()=>{const k=1-I,R=w.read(),C=W(Ne(R,b),k);w.write(Ne(R,C))})};return(()=>{v(this.movingMean,f,this.momentum),v(this.movingVariance,m,this.momentum)})(),p})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:rn(this.betaInitializer),gammaInitializer:rn(this.gammaInitializer),movingMeanInitializer:rn(this.movingMeanInitializer),movingVarianceInitializer:rn(this.movingVarianceInitializer),betaRegularizer:zt(this.betaRegularizer),gammaRegularizer:zt(this.gammaRegularizer),betaConstraint:Dn(this.betaConstraint),gammaConstraint:Dn(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}LM.className="BatchNormalization";ge(LM);class MM extends rt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Jt(e.betaInitializer||"zeros"),this.gammaInitializer=Jt(e.gammaInitializer||"ones"),this.betaRegularizer=Zt(e.betaRegularizer),this.gammaRegularizer=Zt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=wt(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=n);for(const i of this.axis)if(i<0||i>=n)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Za(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,n){const s=Ge(e),r=s.shape,i=r.length;return Y(()=>{let{mean:a,variance:l}=$v(s,this.axis,!0);const u=Uu(1,i);for(const m of this.axis)u[m]=r[m];const c=m=>m!=null&&m.shape.length!==i?H(m,u):m;let h=this.scale?c(this.gamma.read()):null,d=this.center?c(this.beta.read()):null;const p=[],f=[];for(let m=0;m<i;++m)this.axis.indexOf(m)!==-1?(p.push(r[m]),f.push(1)):(p.push(1),f.push(r[m]));return a=ti(a,p),l=ti(l,p),h!=null&&(h=ti(h,f)),d!=null&&(d=ti(d,f)),ef(s,a,l,d,h,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:rn(this.betaInitializer),gammaInitializer:rn(this.gammaInitializer),betaRegularizer:zt(this.betaRegularizer),gammaRegularizer:zt(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}MM.className="LayerNormalization";ge(MM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function poe(t,e,n){return Y(()=>{if(t.rank!==4)throw new K(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new K("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Gi()),n!=="channelsLast"&&n!=="channelsFirst")throw new K(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return n==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],Al(t,s)})}class VM extends rt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Gi():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new K(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,s;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new K(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new K(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[n,s]}this.inputSpec=[new An({ndim:4})]}computeOutputShape(e){e=wt(e);let n,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],n,s]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],n,s,e[3]])}call(e,n){return Y(()=>poe(Ge(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}VM.className="ZeroPadding2D";ge(VM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nw(t,e,n,s,r,i){return Y(()=>{bn(r),tL(i),Br(s),n==null&&(n=[1,1]),s==null&&(s="valid"),r==null&&(r=Gi()),i==null&&(i="max"),t=fk(t,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=Nv(t,e,n,a):o=bv(t,e,n,a),r==="channelsFirst"&&(o=pt(o,[0,3,1,2])),o})}function zM(t,e,n,s,r,i){return Y(()=>{bn(r),tL(i),Br(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),r==null&&(r=Gi()),i==null&&(i="max"),t=sM(t,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=RP(t,e,n,a):o=iP(t,e,n,a),r==="channelsFirst"&&(o=pt(o,[0,4,1,2,3])),o})}class BM extends rt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new K(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Wn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new K(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Wn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Br(this.padding),this.inputSpec=[new An({ndim:3})]}computeOutputShape(e){e=wt(e);const n=Vi(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return Y(()=>{this.invokeCallHook(e,n),e=Nm(Ge(e),2);const s=this.poolingFunction(Ge(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return mn(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class UM extends BM{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return bn(i),Br(r),nw(e,n,s,r,i,"max")}}UM.className="MaxPooling1D";ge(UM);class WM extends BM{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return bn(i),Br(r),nw(e,n,s,r,i,"avg")}}WM.className="AveragePooling1D";ge(WM);class jM extends rt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new K(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Wn(this.poolSize,"poolSize"),Wn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,bn(this.dataFormat),Br(this.padding),this.inputSpec=[new An({ndim:4})]}computeOutputShape(e){e=wt(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=Vi(n,this.poolSize[0],this.padding,this.strides[0]),s=Vi(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s]:[e[0],n,s,e[3]]}call(e,n){return Y(()=>(this.invokeCallHook(e,n),this.poolingFunction(Ge(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class GM extends jM{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return bn(i),Br(r),nw(e,n,s,r,i,"max")}}GM.className="MaxPooling2D";ge(GM);class HM extends jM{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return bn(i),Br(r),nw(e,n,s,r,i,"avg")}}HM.className="AveragePooling2D";ge(HM);class qM extends rt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new K(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Wn(this.poolSize,"poolSize"),Wn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,bn(this.dataFormat),Br(this.padding),this.inputSpec=[new An({ndim:5})]}computeOutputShape(e){e=wt(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=Vi(n,this.poolSize[0],this.padding,this.strides[0]),s=Vi(s,this.poolSize[1],this.padding,this.strides[1]),r=Vi(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s,r]:[e[0],n,s,r,e[4]]}call(e,n){return Y(()=>(this.invokeCallHook(e,n),this.poolingFunction(Ge(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class KM extends qM{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return bn(i),Br(r),zM(e,n,s,r,i,"max")}}KM.className="MaxPooling3D";ge(KM);class XM extends qM{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return bn(i),Br(r),zM(e,n,s,r,i,"avg")}}XM.className="AveragePooling3D";ge(XM);class YM extends rt{constructor(e){super(e),this.inputSpec=[new An({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new et}}class QM extends YM{constructor(e){super(e||{})}call(e,n){return Y(()=>{const s=Ge(e);return un(s,1)})}}QM.className="GlobalAveragePooling1D";ge(QM);class JM extends YM{constructor(e){super(e||{})}call(e,n){return Y(()=>{const s=Ge(e);return ai(s,1)})}}JM.className="GlobalMaxPooling1D";ge(JM);class ZM extends rt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,bn(this.dataFormat),this.inputSpec=[new An({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new et}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class eV extends ZM{call(e,n){return Y(()=>{const s=Ge(e);return this.dataFormat==="channelsLast"?un(s,[1,2]):un(s,[2,3])})}}eV.className="GlobalAveragePooling2D";ge(eV);class tV extends ZM{call(e,n){return Y(()=>{const s=Ge(e);return this.dataFormat==="channelsLast"?ai(s,[1,2]):ai(s,[2,3])})}}tV.className="GlobalMaxPooling2D";ge(tV);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class nV extends rt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,s={}){const r=n.layer,i=Xo(r,s);delete n.layer;const o={layer:i};return Object.assign(o,n),new e(o)}}class sV extends nV{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=wt(e),e.length<3)throw new K(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=wt(e);const n=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(n),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,n){return Y(()=>(e=Ge(e),dM((o,a)=>[Ge(this.layer.call(o,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}sV.className="TimeDistributed";ge(sV);function foe(t){oc(Pre,"BidirectionalMergeMode",t)}const moe="concat";class rV extends nV{constructor(e){super(e);const n=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=n,this.forwardLayer=Xo(s),n.goBackwards=n.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=n,this.backwardLayer=Xo(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?moe:e.mergeMode,foe(this.mergeMode),e.weights)throw new et("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,s=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let s,r,i;return this.returnState&&(i=n.slice(1)),s=n[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):Hs(r)}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const i=hM(e,s,r,this.numConstants);if(e=i.inputs,s=i.initialState,r=i.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,n);const o=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new K("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,o.push(...s);const c=s.map(h=>new An({shape:h.shape}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),a.push(...c)}if(r!=null)throw new et("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof Eo;for(const u of o)if(u instanceof Eo!==l)throw new K("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(o),c=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=c;const d=super.apply(u,n);return this.inputSpec=h,d}else return super.apply(e,n)}call(e,n){return Y(()=>{const s=n.initialState;let r,i;if(s==null)r=this.forwardLayer.call(e,n),i=this.backwardLayer.call(e,n);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(n,{initialState:u}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=hi(i,1));let a;return this.mergeMode==="concat"?a=tk([r,i]):this.mergeMode==="sum"?a=fe(r,i):this.mergeMode==="ave"?a=W(.5,fe(r,i)):this.mergeMode==="mul"?a=W(r,i):this.mergeMode==null&&(a=[r,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){yu(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),yu(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[n,n]:s=n:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const s=Xo(n.layer);if(delete n.layer,n.numConstants!=null)throw new et("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=n;return r.layer=s,new e(r)}}rV.className="Bidirectional";ge(rV);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class iV extends rt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return Y(()=>(e=Ge(e),e.dtype!=="float32"&&(e=bo(e,"float32")),fe(W(e,this.scale),this.offset)))}}iV.className="Rescaling";ge(iV);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:goe,cropAndResize:yoe}=Ar;class oV extends rt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,n,s,r,i,o,a,l){return Y(()=>{let u,c=!1;const h=n/o,d=s/a,p=(r+n)/o,f=(i+s)/a,m=[h,d,p,f],v=[];e.rank===3?(c=!0,u=wr([e])):u=e;for(let k=0;k<u.shape[0];k++)v.push(m);const y=Li(v,[v.length,4]),w=$h(0,v.length,1,"int32"),I=yoe(u,y,w,[r,i],"nearest");return bo(c?Ge(di(I)):I,l)})}upsize(e,n,s,r){return Y(()=>{const i=goe(e,[n,s]);return bo(i,r)})}call(e,n){return Y(()=>{const s=Ge(e),r=s.dtype,i=s.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,o,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=wt(e);const n=e.length-3,s=e.length-2;return e[n]=this.height,e[s]=this.width,e}}oV.className="CenterCrop";ge(oV);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function voe(t,e,n,s){let r=Ge(t);if(r.dtype!=="int32"&&(r=bo(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=Xn(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=Xn(r,-1)),r.rank>2)throw new K(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=hb(a,s,n,o):l=hb(a,[],n,o),e!=="tfIdf")return l;if(s)return W(l,s);throw new K("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class aV extends rt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){return e=wt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,n){return Y(()=>{e=Ge(e),e.dtype!=="int32"&&(e=bo(e,"int32"));let s;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new K(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);s=Ge(n.countWeights)}const r=ai(e),i=Hp(e),o=Tr(this.numTokens,r).bufferSync().get(0),a=$l(i,0).bufferSync().get(0);if(!(o&&a))throw new K(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return voe(e,this.outputMode,this.numTokens,s)})}}aV.className="CategoryEncoding";ge(aV);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const woe=["bilinear","nearest"],I$=new Set(woe);class lV extends rt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(I$.has(e.interpolation))this.interpolation=e.interpolation;else throw new K(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=wt(e);const n=e[2];return[this.height,this.width,n]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return Y(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Ar.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Ar.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...I$]} are supported`)})}}lV.className="Resizing";ge(lV);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class uV{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}uV.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class cV extends rt{constructor(e){super(e),this.randomGenerator=new uV(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(e,n),e}}cV.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const xoe=["bilinear","nearest"],S$=new Set(xoe);class hV extends cV{constructor(e){super(e);const{factor:n,interpolation:s="bilinear"}=e;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new K(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new K(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new K(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(S$.has(s))this.interpolation=s;else throw new K(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=wt(e);const n=e[2];return[this.imgHeight,-1,n]}call(e,n){return Y(()=>{const s=Ge(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=rc([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Ar.resizeBilinear(e,o);case"nearest":return Ar.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...S$]} are supported`)}})}}hV.className="RandomWidth";ge(hV);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const boe=te();boe.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var rr;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(rr||(rr={}));var T$;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(T$||(T$={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ioe={};function dV(t){return Ioe[t]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E(t,e,n,s,r){const i=e.inputParams[t];if(i&&i.inputIndexStart!==void 0){const a=i.inputIndexStart,l=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?a+1:i.inputIndexEnd,u=a<0?e.inputNames.length+a:a;if(i.type==="tensor")return Qn(e.inputNames[u],n,s,r);if(i.type==="tensors"){const d=e.inputs.slice(a,l);return e.inputNames.slice(a,l).filter((f,m)=>{var v;return((v=d[m])===null||v===void 0?void 0:v.op)!=="NoOp"}).map(f=>Qn(f,n,s,r))}const c=Qn(e.inputNames[u],n,s,r),h=c.dataSync();return i.type==="number"?h[0]:oi(c.shape,h)}const o=e.attrParams[t];return o&&o.value}function Qn(t,e,n,s){const[r,i]=ir(t,n);if(s!=null){const a=s.getHashTableHandleByName(r);if(a!=null)return a}const o=n.currentContextIds.find(a=>!!e[k1(r,a)]);return o!==void 0?e[k1(r,o)][i]:void 0}function C$(t,e,n){return e[k1(t,n.currentContextId)]}function Lo(t,e){const[n,s,r]=ir(t,e);return[k1(n,e&&e.currentContextId),s,r]}function k1(t,e){return e?`${t}-${e}`:t}function ir(t,e){if(t==="")return["",0,void 0];const n=e!=null&&e.parseNodeNameCache!=null;if(n){const i=e.parseNodeNameCache.get(t);if(i!=null)return i}const s=t.split(":");let r;if(s.length===1)r=[t,0,void 0];else{const i=s[0],o=s.length===3?s[1]:void 0,a=Number(s[s.length-1]);r=[i,a,o]}return n&&e.parseNodeNameCache.set(t,r),r}function py(t,e,n){let s=E("pad",t,e,n);if(s==="explicit"){s=E("explicitPaddings",t,e,n);const r=[[0,0],[0,0],[0,0],[0,0]];for(let i=0;i<4;i++)r[i][0]=s[i*2],r[i][1]=s[i*2+1];return r}return s}function Mo(t){return t.kept?t:Ko(t)}/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Soe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Toe=Object.freeze(Object.defineProperty({__proto__:null,json:Soe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Coe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],koe=Object.freeze(Object.defineProperty({__proto__:null,json:Coe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eoe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],_oe=Object.freeze(Object.defineProperty({__proto__:null,json:Eoe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Noe=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],$oe=Object.freeze(Object.defineProperty({__proto__:null,json:Noe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aoe=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],Roe=Object.freeze(Object.defineProperty({__proto__:null,json:Aoe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Doe=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Ooe=Object.freeze(Object.defineProperty({__proto__:null,json:Doe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Poe=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],Foe=Object.freeze(Object.defineProperty({__proto__:null,json:Poe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Loe=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],Moe=Object.freeze(Object.defineProperty({__proto__:null,json:Loe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Voe=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],zoe=Object.freeze(Object.defineProperty({__proto__:null,json:Voe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Boe=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],Uoe=Object.freeze(Object.defineProperty({__proto__:null,json:Boe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Woe=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],joe=Object.freeze(Object.defineProperty({__proto__:null,json:Woe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Goe=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],Hoe=Object.freeze(Object.defineProperty({__proto__:null,json:Goe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qoe=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],Koe=Object.freeze(Object.defineProperty({__proto__:null,json:qoe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xoe=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],Yoe=Object.freeze(Object.defineProperty({__proto__:null,json:Xoe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qoe=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Joe=Object.freeze(Object.defineProperty({__proto__:null,json:Qoe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zoe=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],eae=Object.freeze(Object.defineProperty({__proto__:null,json:Zoe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tae=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],nae=Object.freeze(Object.defineProperty({__proto__:null,json:tae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sae=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],rae=Object.freeze(Object.defineProperty({__proto__:null,json:sae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iae=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],oae=Object.freeze(Object.defineProperty({__proto__:null,json:iae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k${static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[Toe,koe,_oe,$oe,Roe,Ooe,Foe,Moe,zoe,Uoe,joe,Hoe,Koe,Yoe,Joe,eae,nae,rae,oae],n=[].concat(...e.map(s=>s.json));this.opMappers=n.reduce((s,r)=>(s[r.tfOpName]=r,s),{})}transformGraph(e,n={}){const s=e.node,r=[],i=[],o=[],a=s.reduce((m,v)=>(m[v.name]=this.mapNode(v),v.op.startsWith("Placeholder")?r.push(m[v.name]):v.op==="Const"?i.push(m[v.name]):(v.input==null||v.input.length===0)&&o.push(m[v.name]),m),{});let l=[];const u=[];let c={},h={};n!=null&&(c=this.mapSignatureEntries(n.inputs),h=this.mapSignatureEntries(n.outputs));const d=Object.keys(a);d.forEach(m=>{const v=a[m];v.inputNames.forEach((y,w)=>{const[b,,I]=Lo(y),k=a[b];if(k.outputs!=null){const R=k.outputs.indexOf(I);if(R!==-1){const C=`${b}:${R}`;v.inputNames[w]=C}}v.inputs.push(k),k.children.push(v)})}),Object.keys(h).length===0?d.forEach(m=>{const v=a[m];v.children.length===0&&u.push(v)}):Object.keys(h).forEach(m=>{const[v]=Lo(m),y=a[v];y!=null&&(y.signatureKey=h[m],u.push(y))}),Object.keys(c).length>0?Object.keys(c).forEach(m=>{const[v]=Lo(m),y=a[v];y&&(y.signatureKey=c[m],l.push(y))}):l=r;let p={};e.library!=null&&e.library.function!=null&&(p=e.library.function.reduce((m,v)=>(m[v.signature.name]=this.mapFunction(v),m),{}));const f={nodes:a,inputs:l,outputs:u,weights:i,placeholders:r,signature:n,functions:p};return o.length>0&&(f.initNodes=o),f}mapSignatureEntries(e){return Object.keys(e||{}).reduce((n,s)=>(n[e[s].name]=s,n),{})}mapNode(e){const n=dV(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const s={name:e.name,op:e.op,category:n.category,inputNames:(e.input||[]).map(r=>r.startsWith("^")?r.slice(1):r),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:n.outputs};return n.inputs!=null&&(s.inputParams=n.inputs.reduce((r,i)=>(r[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},r),{})),n.attrs!=null&&(s.attrParams=n.attrs.reduce((r,i)=>{const o=i.type;let a;switch(i.type){case"string":a=kb(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=kb(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":a=Db(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=Db(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":a=_b(e.attr,i.tfName,i.defaultValue||0),a===void 0&&i.tfDeprecatedName&&(a=_b(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":a=Rb(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=Rb(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":a=Eb(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=Eb(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":a=Pb(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=Pb(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":a=Ab(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=Ab(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":a=Ob(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=Ob(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":a=Nb(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=Nb(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":a=$b(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=$b(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":a=E$(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=E$(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${i.type} for op: ${e.op}`)}return r[i.name]={value:a,type:o},r},{})),s}mapFunction(e){const n=e.nodeDef,s=[],r=[];let i={};n!=null&&(i=n.reduce((h,d)=>(h[d.name]=this.mapNode(d),d.op==="Const"&&r.push(h[d.name]),h),{}));const o=[],a=[];e.signature.inputArg.forEach(h=>{const[d]=Lo(h.name),p={name:d,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:xk(h.type),type:"dtype"}},children:[]};p.signatureKey=h.name,o.push(p),i[d]=p}),Object.keys(i).forEach(h=>{const d=i[h];d.inputNames.forEach((p,f)=>{const[m,,v]=Lo(p),y=i[m];if(y.outputs!=null){const w=y.outputs.indexOf(v);if(w!==-1){const b=`${m}:${w}`;d.inputNames[f]=b}}d.inputs.push(y),y.children.push(d)})});const u=e.ret;e.signature.outputArg.forEach(h=>{const[d,p]=Lo(u[h.name]),f=i[d];f!=null&&(f.defaultOutput=p,a.push(f))});const c=this.mapArgsToSignature(e);return{nodes:i,inputs:o,outputs:a,weights:r,placeholders:s,signature:c}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s),n),{}),outputs:e.signature.outputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s,e.ret),n),{})}}mapArgToTensorInfo(e,n){let s=e.name;return n!=null&&(s=n[s]),{name:s,dtype:e.type}}}function aae(t){const e=te().global;if(typeof e.atob<"u")return e.atob(t);if(typeof Buffer<"u")return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function pV(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):aae(t);return e?n:n.toLowerCase()}function kb(t,e,n,s=!1){const r=t[e];return r!=null?pV(r.s,s):n}function Eb(t,e,n){const s=t[e];return s?s.b:n}function _b(t,e,n){const s=t[e]||{},r=s.i!=null?s.i:s.f!=null?s.f:n;return typeof r=="number"?r:parseInt(r,10)}function xk(t){switch(typeof t=="string"&&(t=rr[t]),t){case rr.DT_FLOAT:case rr.DT_HALF:return"float32";case rr.DT_INT32:case rr.DT_INT64:case rr.DT_INT8:case rr.DT_UINT8:return"int32";case rr.DT_BOOL:return"bool";case rr.DT_DOUBLE:return"float32";case rr.DT_STRING:return"string";case rr.DT_COMPLEX64:case rr.DT_COMPLEX128:return"complex64";default:return null}}function E$(t,e,n){const s=t[e];return s&&s.func?s.func.name:n}function Nb(t,e,n){const s=t[e];return s&&s.type?xk(s.type):n}function $b(t,e,n){const s=t[e];return s&&s.list&&s.list.type?s.list.type.map(r=>xk(r)):n}function fV(t){if(!t.unknownRank)return t.dim!=null?t.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function Ab(t,e,n){const s=t[e];return s&&s.shape?fV(s.shape):n}function Rb(t,e,n){const s=t[e];return s?((s.list.f&&s.list.f.length?s.list.f:s.list.i)||[]).map(r=>typeof r=="number"?r:parseInt(r,10)):n}function Db(t,e,n,s=!1){const r=t[e];return r&&r.list&&r.list.s?r.list.s.map(i=>pV(i,s)):n}function Ob(t,e,n){const s=t[e];return s&&s.list&&s.list.shape?s.list.shape.map(r=>fV(r)):n}function Pb(t,e,n){const s=t[e];return s&&s.list&&s.list.b?s.list.b:n}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lae{constructor(e,n,s){this.node=e,this.tensorMap=n,this.context=s,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(r=>this.getInput(r)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((r,i)=>(r[i]=this.getAttr(i),r),{}))}getInput(e){return Qn(e,this.tensorMap,this.context)}getAttr(e,n){const s=this.node.rawAttrs[e];if(s.tensor!=null)return Qn(e,this.tensorMap,this.context);if(s.i!=null||s.f!=null)return _b(this.node.rawAttrs,e,n);if(s.s!=null)return kb(this.node.rawAttrs,e,n);if(s.b!=null)return Eb(this.node.rawAttrs,e,n);if(s.shape!=null)return Ab(this.node.rawAttrs,e,n);if(s.type!=null)return Nb(this.node.rawAttrs,e,n);if(s.list!=null){if(s.list.i!=null||s.list.f!=null)return Rb(this.node.rawAttrs,e,n);if(s.list.s!=null)return Db(this.node.rawAttrs,e,n);if(s.list.shape!=null)return Ob(this.node.rawAttrs,e,n);if(s.list.b!=null)return Pb(this.node.rawAttrs,e,n);if(s.list.type!=null)return $b(this.node.rawAttrs,e,n)}return n}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const is=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:DO,abs:kn,acos:QO,acosh:JO,add:fe,addN:CX,all:FT,any:m1,argMax:Eh,argMin:ZO,asin:eP,asinh:tP,atan:nP,atan2:sP,atanh:rP,avgPool:bv,avgPool3d:iP,basicLSTMCell:KX,batchNorm:wm,batchNorm2d:oP,batchNorm3d:aP,batchNorm4d:lP,batchToSpaceND:Iv,bincount:uP,bitwiseAnd:sY,booleanMaskAsync:VZ,broadcastArgs:iY,broadcastTo:lh,buffer:tt,cast:Se,ceil:cP,clipByValue:Qs,clone:Ko,complex:ul,concat:hn,concat1d:hP,concat2d:dP,concat3d:pP,concat4d:fP,conv1d:MT,conv2d:dl,conv2dTranspose:zT,conv3d:mP,conv3dTranspose:yP,cos:Sv,cosh:BT,cosineWindow:vC,cumprod:g1,cumsum:UT,denseBincount:hb,depthToSpace:vP,depthwiseConv2d:xm,diag:_Y,dilation2d:wP,div:_e,divNoNan:xP,dot:bP,dropout:KP,einsum:Dc,elu:bm,enclosingPowerOfTwo:XP,ensureShape:MY,equal:Wi,erf:WT,euclideanNorm:TP,exp:Ps,expandDims:Xn,expm1:CP,eye:GT,fft:Lv,fill:Kh,floor:Sm,floorDiv:PT,fused:aee,gather:Tm,gatherND:XZ,greater:Tr,greaterEqual:$l,ifft:Yp,imag:Tv,image:Ar,inTopKAsync:ZZ,irfft:dC,isFinite:kP,isInf:EP,isNaN:_P,leakyRelu:Cv,less:qp,lessEqual:nc,linalg:sF,linspace:cQ,localResponseNormalization:NP,log:Fr,log1p:kv,logSigmoid:$P,logSoftmax:HT,logSumExp:Ev,logicalAnd:ko,logicalNot:_v,logicalOr:qT,logicalXor:AP,losses:Mte,lowerBound:kQ,matMul:it,max:ai,maxPool:Nv,maxPool3d:RP,maxPoolWithArgmax:$Q,maximum:ha,mean:un,meshgrid:DQ,min:Hp,minimum:zu,mirrorPad:DP,mod:OP,moments:$v,movingAverage:UZ,mul:W,multiRNNCell:VQ,multinomial:BQ,neg:qt,norm:Im,notEqual:Nh,oneHot:XT,ones:hr,onesLike:Lr,op:U,outerProduct:HQ,pad:Al,pad1d:XQ,pad2d:QQ,pad3d:ZQ,pad4d:tJ,pool:PP,pow:na,prelu:Rv,print:YO,prod:FP,raggedGather:uJ,raggedRange:hJ,raggedTensorToTensor:pJ,rand:mJ,randomGamma:PJ,randomNormal:sC,randomStandardNormal:MJ,randomUniform:rc,randomUniformInt:BJ,range:$h,real:Kp,reciprocal:MP,relu:$o,relu6:rC,reshape:H,reverse:hi,reverse1d:KJ,reverse2d:YJ,reverse3d:JJ,reverse4d:eZ,rfft:Mv,round:iC,rsqrt:oC,scalar:Be,scatterND:jZ,searchSorted:KT,selu:aC,separableConv2d:lC,setdiff1dAsync:oZ,sigmoid:Mi,sign:VP,signal:Lte,sin:uC,sinh:cC,slice:je,slice1d:Ov,slice2d:hC,slice3d:Pv,slice4d:Xp,softmax:Fv,softplus:Xh,spaceToBatchND:Av,sparse:Vte,sparseToDense:qZ,spectral:Fte,split:gr,sqrt:ns,square:Vt,squaredDifference:pC,squeeze:mn,stack:wr,step:Yh,stridedSlice:zP,string:zte,sub:Ne,sum:De,tan:BP,tanh:Vu,tensor:Li,tensor1d:Tn,tensor2d:gu,tensor3d:UP,tensor4d:kZ,tensor5d:EZ,tensor6d:_Z,tensorScatterUpdate:$Z,tile:ti,topk:jP,transpose:pt,truncatedNormal:mC,unique:GP,unsortedSegmentSum:gC,unstack:di,upperBound:FZ,variable:HP,where:ys,whereAsync:qP,zeros:Nn,zerosLike:ft},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uae=(t,e,n,s=is)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[s.add(E("a",t,e,n),E("b",t,e,n))];case"AddN":return[s.addN(E("tensors",t,e,n))];case"FloorMod":case"Mod":return[s.mod(E("a",t,e,n),E("b",t,e,n))];case"Mul":return[s.mul(E("a",t,e,n),E("b",t,e,n))];case"RealDiv":case"Div":return[s.div(E("a",t,e,n),E("b",t,e,n))];case"DivNoNan":return[s.divNoNan(E("a",t,e,n),E("b",t,e,n))];case"FloorDiv":return[s.floorDiv(E("a",t,e,n),E("b",t,e,n))];case"Sub":return[s.sub(E("a",t,e,n),E("b",t,e,n))];case"Minimum":return[s.minimum(E("a",t,e,n),E("b",t,e,n))];case"Maximum":return[s.maximum(E("a",t,e,n),E("b",t,e,n))];case"Pow":return[s.pow(E("a",t,e,n),E("b",t,e,n))];case"SquaredDifference":return[s.squaredDifference(E("a",t,e,n),E("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cae=(t,e,n,s=is)=>{switch(t.op){case"Abs":case"ComplexAbs":return[s.abs(E("x",t,e,n))];case"Acos":return[s.acos(E("x",t,e,n))];case"Acosh":return[s.acosh(E("x",t,e,n))];case"Asin":return[s.asin(E("x",t,e,n))];case"Asinh":return[s.asinh(E("x",t,e,n))];case"Atan":return[s.atan(E("x",t,e,n))];case"Atan2":return[s.atan2(E("x",t,e,n),E("y",t,e,n))];case"Atanh":return[s.atanh(E("x",t,e,n))];case"Ceil":return[s.ceil(E("x",t,e,n))];case"Complex":return[s.complex(E("real",t,e,n),E("imag",t,e,n))];case"Cos":return[s.cos(E("x",t,e,n))];case"Cosh":return[s.cosh(E("x",t,e,n))];case"Elu":return[s.elu(E("x",t,e,n))];case"Erf":return[s.erf(E("x",t,e,n))];case"Exp":return[s.exp(E("x",t,e,n))];case"Expm1":return[s.expm1(E("x",t,e,n))];case"Floor":return[s.floor(E("x",t,e,n))];case"Log":return[s.log(E("x",t,e,n))];case"Log1p":return[s.log1p(E("x",t,e,n))];case"Imag":return[s.imag(E("x",t,e,n))];case"Neg":return[s.neg(E("x",t,e,n))];case"Reciprocal":return[s.reciprocal(E("x",t,e,n))];case"Real":return[s.real(E("x",t,e,n))];case"Relu":return[s.relu(E("x",t,e,n))];case"Round":return[s.round(E("x",t,e,n))];case"Selu":return[s.selu(E("x",t,e,n))];case"Sigmoid":return[s.sigmoid(E("x",t,e,n))];case"Sin":return[s.sin(E("x",t,e,n))];case"Sign":return[s.sign(E("x",t,e,n))];case"Sinh":return[s.sinh(E("x",t,e,n))];case"Softplus":return[s.softplus(E("x",t,e,n))];case"Sqrt":return[s.sqrt(E("x",t,e,n))];case"Square":return[s.square(E("x",t,e,n))];case"Tanh":return[s.tanh(E("x",t,e,n))];case"Tan":return[s.tan(E("x",t,e,n))];case"ClipByValue":return[s.clipByValue(E("x",t,e,n),E("clipValueMin",t,e,n),E("clipValueMax",t,e,n))];case"Relu6":return[s.relu6(E("x",t,e,n))];case"Rsqrt":return[s.rsqrt(Qn(t.inputNames[0],e,n))];case"LeakyRelu":return[s.leakyRelu(E("x",t,e,n),E("alpha",t,e,n))];case"Prelu":return[s.prelu(E("x",t,e,n),E("alpha",t,e,n))];case"IsNan":return[s.isNaN(Qn(t.inputNames[0],e,n))];case"IsInf":return[s.isInf(Qn(t.inputNames[0],e,n))];case"IsFinite":return[s.isFinite(Qn(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hr(t,e,n=""){if(!(typeof t=="number"||typeof e=="number")){F(t.length===e.length,()=>n+` Shapes ${t} and ${e} must match`);for(let s=0;s<t.length;s++){const r=t[s],i=e[s];F(r<0||i<0||r===i,()=>n+` Shapes ${t} and ${e} must match`)}}}function _$(t){return!(typeof t=="number"||t.some(e=>e<0))}function Ud(t,e,n){let s=Fb(t,n);const r=!_$(s);if(r&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${s}`);if(r&&e.forEach(i=>{s=Fb(i.shape,s)}),!_$(s))throw new Error(`Non-fully-defined elementShape: ${s}`);return s}function Fb(t,e){if(typeof t=="number")return e;if(typeof e=="number")return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let s=0;s<t.length;++s){const r=t[s],i=e[s];if(r>=0&&i>=0&&r!==i)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[s]=r>=0?r:i}return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hae{constructor(e,n,s,r,i,o,a){this.name=e,this.dtype=n,this.maxSize=s,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=Be(0),Un(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.tensor.id))&&n.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const n=this.tensors[e];if(n.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(n.cleared=!0),n.read=!0,n.tensor}readMany(e){return e.map(n=>this.read(n))}write(e,n){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const s=this.tensors[e]||{};if(n.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${n.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=n.shape),Hr(this.elementShape,n.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),s.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(s.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);s.tensor=n,Un(n),s.written=!0,this.tensors[e]=s}writeMany(e,n){if(e.length!==n.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${n.length}.`);e.forEach((s,r)=>this.write(s,n[r]))}gather(e,n){if(n&&n!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${n}`);if(e)e=e.slice(0,this.size());else{e=[];for(let r=0;r<this.size();r++)e.push(r)}if(e.length===0)return Li([],[0].concat(this.elementShape));const s=this.readMany(e);return Hr(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),wr(s,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return Li([],[0].concat(this.elementShape));const n=[];for(let r=0;r<this.size();r++)n.push(r);const s=this.readMany(n);return Hr(this.elementShape,s[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${s[0].shape})`),hn(s,0)}scatter(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const s=Math.max(...e);if(!this.dynamicSize&&s>=this.maxSize)throw new Error(`Max index must be < array size (${s}  vs. ${this.maxSize})`);this.writeMany(e,di(n,0))}split(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);let s=0;const r=e.map(l=>(s+=l,s));if(s!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${n.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const i=s===0?0:n.size/s,o=[];Y(()=>{n=H(n,[1,s,i]);for(let l=0;l<e.length;++l){const c=[0,l===0?0:r[l-1],0],h=[1,e[l],i];o[l]=H(je(n,c,h),this.elementShape)}return o});const a=[];for(let l=0;l<e.length;l++)a[l]=l;this.writeMany(a,o)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wu{get id(){return this.idTensor.id}constructor(e,n,s,r=-1){this.tensors=e,this.elementShape=n,this.elementDtype=s,e!=null&&e.forEach(i=>{if(s!==i.dtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${i.dtype}`);Hr(n,i.shape,"TensorList shape mismatch: "),Un(i)}),this.idTensor=Be(0),this.maxNumElements=r,Un(this.idTensor)}copy(){return new Wu([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.id))&&n.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,n,s=-1){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(s!==-1&&this.tensors.length!==s)throw new Error(`Operation expected a list with ${s} elements but got a list with ${this.tensors.length} elements.`);Hr(e,this.elementShape,"TensorList shape mismatch: ");const r=Ud(this.elementShape,this.tensors,e);return Y(()=>{const i=this.tensors.map(o=>H(o,r));return wr(i,0)})}popBack(e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const s=Ud(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,Hr(r.shape,e,"TensorList shape mismatch: "),H(r,s)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(Hr(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Un(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const n=new Wu([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=e;for(let s=0;s<Math.min(this.tensors.length,e);++s)n.tensors[s]=this.tensors[s];return n}getItem(e,n,s){if(s!==this.elementDtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);Hr(this.tensors[e].shape,n,"TensorList shape mismatch: ");const r=Ud(this.elementShape,this.tensors,n);return H(this.tensors[e],r)}setItem(e,n){if(n.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);Hr(this.elementShape,n.shape,"TensorList shape mismatch: "),Un(n),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=n}gather(e,n,s){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);Hr(this.elementShape,s,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=Ud(this.elementShape,this.tensors,s);return e.length===0?Li([],[0].concat(r)):Y(()=>{const i=e.map(o=>H(this.tensors[o],r));return wr(i,0)})}concat(e,n){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);Hr(this.elementShape,n,"TensorList shape mismatch: ");const s=Ud(this.elementShape,this.tensors,n);return this.size()===0?Li([],[0].concat(s)):Y(()=>{const r=this.tensors.map(i=>H(i,s));return hn(r,0)})}}function dae(t,e,n){const s=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);const r=t.shape.slice(1);Hr(r,e,"TensorList shape mismatch: ");const i=di(t);return new Wu(i,e,s)}function pae(t,e,n,s){return new Wu([],t,e,s)}function fae(t,e,n,s){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const r=Math.max(...e);if(s!=null&&s!==-1&&r>=s)throw new Error(`Max index must be < array size (${r}  vs. ${s})`);const i=new Wu([],n,t.dtype,s),o=di(t,0);return e.forEach((a,l)=>{i.setItem(a,o[l])}),i}function mae(t,e,n){let s=0;const r=e.map(c=>(s+=c,s));if(s!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${t.shape}`);const i=t.shape.slice(1),o=Fb(i,n),a=s===0?0:t.size/s,l=Y(()=>{const c=[];t=H(t,[1,s,a]);for(let h=0;h<e.length;++h){const p=[0,h===0?0:r[h-1],0],f=[1,e[h],a];c[h]=H(je(t,p,f),o)}return t.dispose(),c}),u=new Wu([],n,t.dtype,e.length);for(let c=0;c<l.length;c++)u.setItem(c,l[c]);return u}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gae=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const s=E("thenBranch",t,e,n),r=E("elseBranch",t,e,n),i=E("cond",t,e,n),o=E("args",t,e,n);return(await i.data())[0]?n.functionMap[s].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap):n.functionMap[r].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const s=E("body",t,e,n),r=E("cond",t,e,n),i=E("args",t,e,n),o=await n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap),a=i.map(c=>c.id);let l=await o[0].data();o.forEach(c=>{!c.kept&&a.indexOf(c.id)===-1&&c.dispose()});let u=i;for(;l[0];){const c=u;u=await n.functionMap[s].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);const h=u.map(p=>p.id);c.forEach(p=>{!p.kept&&a.indexOf(p.id)===-1&&h.indexOf(p.id)===-1&&p.dispose()});const d=await n.functionMap[r].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);l=await d[0].data(),d.forEach(p=>{!p.kept&&a.indexOf(p.id)===-1&&h.indexOf(p.id)===-1&&p.dispose()})}return u}case"LoopCond":{const s=E("pred",t,e,n);return[Mo(s)]}case"Switch":{const s=E("pred",t,e,n);let r=E("data",t,e,n);return r.kept||(r=Mo(r)),(await s.data())[0]?[void 0,r]:[r,void 0]}case"Merge":{const s=t.inputNames.find(r=>Qn(r,e,n)!==void 0);if(s){const r=Qn(s,e,n);return[Mo(r)]}return}case"Enter":{const s=E("frameName",t,e,n),r=E("tensor",t,e,n);return n.enterFrame(s),[Mo(r)]}case"Exit":{const s=E("tensor",t,e,n);return n.exitFrame(),[Mo(s)]}case"NextIteration":{const s=E("tensor",t,e,n);return n.nextIteration(),[Mo(s)]}case"TensorArrayV3":{const s=E("size",t,e,n),r=E("dtype",t,e,n),i=E("elementShape",t,e,n),o=E("dynamicSize",t,e,n),a=E("clearAfterRead",t,e,n),l=E("identicalElementShapes",t,e,n),u=E("name",t,e,n),c=new hae(u,r,s,i,l,o,a);return n.addTensorArray(c),[c.idTensor,Be(1)]}case"TensorArrayWriteV3":{const s=E("tensorArrayId",t,e,n),r=E("index",t,e,n),i=E("tensor",t,e,n),o=n.getTensorArray(s.id);return o.write(r,i),[o.idTensor]}case"TensorArrayReadV3":{const s=E("tensorArrayId",t,e,n),r=E("index",t,e,n);return[n.getTensorArray(s.id).read(r)]}case"TensorArrayGatherV3":{const s=E("tensorArrayId",t,e,n),r=E("indices",t,e,n),i=E("dtype",t,e,n);return[n.getTensorArray(s.id).gather(r,i)]}case"TensorArrayScatterV3":{const s=E("tensorArrayId",t,e,n),r=E("indices",t,e,n),i=E("tensor",t,e,n),o=n.getTensorArray(s.id);return o.scatter(r,i),[o.idTensor]}case"TensorArrayConcatV3":{const s=E("tensorArrayId",t,e,n),r=n.getTensorArray(s.id),i=E("dtype",t,e,n);return[r.concat(i)]}case"TensorArraySplitV3":{const s=E("tensorArrayId",t,e,n),r=E("tensor",t,e,n),i=E("lengths",t,e,n),o=n.getTensorArray(s.id);return o.split(i,r),[o.idTensor]}case"TensorArraySizeV3":{const s=E("tensorArrayId",t,e,n),r=n.getTensorArray(s.id);return[Be(r.size(),"int32")]}case"TensorArrayCloseV3":{const s=E("tensorArrayId",t,e,n),r=n.getTensorArray(s.id);return r.clearAndClose(),[r.idTensor]}case"TensorListSetItem":{const s=E("tensorListId",t,e,n),r=E("index",t,e,n),i=E("tensor",t,e,n),o=n.getTensorList(s.id);return o.setItem(r,i),[o.idTensor]}case"TensorListGetItem":{const s=E("tensorListId",t,e,n),r=E("index",t,e,n),i=E("elementShape",t,e,n),o=E("elementDType",t,e,n);return[n.getTensorList(s.id).getItem(r,i,o)]}case"TensorListScatterV2":case"TensorListScatter":{const s=E("indices",t,e,n),r=E("tensor",t,e,n),i=E("elementShape",t,e,n),o=E("numElements",t,e,n),a=fae(r,s,i,o);return n.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const s=E("elementShape",t,e,n),r=E("elementDType",t,e,n);let i;t.op==="TensorListReserve"?i="numElements":i="maxNumElements";const o=E(i,t,e,n),a=t.op==="TensorListReserve"?-1:o,l=pae(s,r,o,a);return n.addTensorList(l),[l.idTensor]}case"TensorListGather":{const s=E("tensorListId",t,e,n),r=E("indices",t,e,n),i=E("elementShape",t,e,n),o=E("elementDType",t,e,n);return[n.getTensorList(s.id).gather(r,o,i)]}case"TensorListStack":{const s=E("tensorListId",t,e,n),r=E("elementShape",t,e,n),i=E("elementDType",t,e,n),o=E("numElements",t,e,n);return[n.getTensorList(s.id).stack(r,i,o)]}case"TensorListFromTensor":{const s=E("tensor",t,e,n),r=E("elementShape",t,e,n),i=E("elementDType",t,e,n),o=dae(s,r,i);return n.addTensorList(o),[o.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const s=E("tensorListId",t,e,n),r=n.getTensorList(s.id),i=E("dtype",t,e,n),o=E("elementShape",t,e,n);return[r.concat(i,o)]}case"TensorListPushBack":{const s=E("tensorListId",t,e,n),r=E("tensor",t,e,n),i=n.getTensorList(s.id);return i.pushBack(r),[i.idTensor]}case"TensorListPopBack":{const s=E("tensorListId",t,e,n),r=E("elementShape",t,e,n),i=E("elementDType",t,e,n);return[n.getTensorList(s.id).popBack(r,i)]}case"TensorListSplit":{const s=E("tensor",t,e,n),r=E("elementShape",t,e,n),i=E("lengths",t,e,n),o=mae(s,i,r);return n.addTensorList(o),[o.idTensor]}case"TensorListLength":{const s=E("tensorListId",t,e,n),r=n.getTensorList(s.id);return[Be(r.size(),"int32")]}case"TensorListResize":{const s=E("tensorListId",t,e,n),r=E("size",t,e,n),o=n.getTensorList(s.id).resize(r);return n.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N$(t,e,n){const[s,r]=E("fusedOps",t,e,n),i=s==="biasadd",o=!i,a=r==="prelu",l=s==="fusedbatchnorm",u=E("numArgs",t,e,n);if(i){if(a&&u!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&i&&u!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const c=E("strides",t,e,n),h=py(t,e,n),d=E("dataFormat",t,e,n).toUpperCase(),p=E("dilations",t,e,n);let[f,m]=E("args",t,e,n);o&&(m=f,f=void 0);const v=E("leakyreluAlpha",t,e,n);return{stride:c,pad:h,dataFormat:d,dilations:p,biasArg:f,preluArg:m,activationFunc:r,leakyreluAlpha:v}}const yae=(t,e,n,s=is)=>{switch(t.op){case"Conv1D":{const r=E("stride",t,e,n),i=E("pad",t,e,n),o=E("dataFormat",t,e,n).toUpperCase(),a=E("dilation",t,e,n);return[s.conv1d(E("x",t,e,n),E("filter",t,e,n),r,i,o,a)]}case"Conv2D":{const r=E("strides",t,e,n),i=py(t,e,n),o=E("dataFormat",t,e,n).toUpperCase(),a=E("dilations",t,e,n);return[s.conv2d(E("x",t,e,n),E("filter",t,e,n),[r[1],r[2]],i,o,[a[1],a[2]])]}case"_FusedConv2D":{const{stride:r,pad:i,dataFormat:o,dilations:a,biasArg:l,preluArg:u,activationFunc:c,leakyreluAlpha:h}=N$(t,e,n);return[s.fused.conv2d({x:E("x",t,e,n),filter:E("filter",t,e,n),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:c,preluActivationWeights:u,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:i,dataFormat:o,dilations:a,biasArg:l,preluArg:u,activationFunc:c,leakyreluAlpha:h}=N$(t,e,n);return[s.fused.depthwiseConv2d({x:E("x",t,e,n),filter:E("filter",t,e,n),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:c,preluActivationWeights:u,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=E("outputShape",t,e,n),i=E("strides",t,e,n),o=py(t,e,n);return[s.conv2dTranspose(E("x",t,e,n),E("filter",t,e,n),r,[i[1],i[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=E("strides",t,e,n),i=py(t,e,n),o=E("dilations",t,e,n),a=E("dataFormat",t,e,n).toUpperCase();return[s.depthwiseConv2d(E("input",t,e,n),E("filter",t,e,n),[r[1],r[2]],i,a,[o[1],o[2]])]}case"Conv3D":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("dataFormat",t,e,n).toUpperCase(),a=E("dilations",t,e,n);return[s.conv3d(E("x",t,e,n),E("filter",t,e,n),[r[1],r[2],r[3]],i,o,[a[1],a[2],a[3]])]}case"AvgPool":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n);return[s.avgPool(E("x",t,e,n),[o[1],o[2]],[r[1],r[2]],i)]}case"MaxPool":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n);return[s.maxPool(E("x",t,e,n),[o[1],o[2]],[r[1],r[2]],i)]}case"MaxPoolWithArgmax":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n),a=E("includeBatchInIndex",t,e,n),{result:l,indexes:u}=s.maxPoolWithArgmax(E("x",t,e,n),[o[1],o[2]],[r[1],r[2]],i,a);return[l,u]}case"AvgPool3D":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n);return[s.avgPool3d(E("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],i)]}case"MaxPool3D":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n);return[s.maxPool3d(E("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],i)]}case"Dilation2D":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("dilations",t,e,n),a=r[1],l=r[2],u=o[1],c=o[2];return[s.dilation2d(E("x",t,e,n),E("filter",t,e,n),[a,l],i,[u,c],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vae=(t,e,n,s=is)=>{switch(t.op){case"Fill":{const r=E("shape",t,e,n),i=E("dtype",t,e,n),o=E("value",t,e,n);return[s.fill(r,o,i)]}case"LinSpace":{const r=E("start",t,e,n),i=E("stop",t,e,n),o=E("num",t,e,n);return[s.linspace(r,i,o)]}case"Multinomial":{const r=E("logits",t,e,n),i=E("numSamples",t,e,n),o=E("seed",t,e,n);return[s.multinomial(r,i,o)]}case"OneHot":{const r=E("indices",t,e,n),i=E("depth",t,e,n),o=E("onValue",t,e,n),a=E("offValue",t,e,n),l=E("dtype",t,e,n);return[s.oneHot(r,i,o,a,l)]}case"Ones":return[s.ones(E("shape",t,e,n),E("dtype",t,e,n))];case"OnesLike":return[s.onesLike(E("x",t,e,n))];case"RandomStandardNormal":return[s.randomStandardNormal(E("shape",t,e,n),E("dtype",t,e,n),E("seed",t,e,n))];case"RandomUniform":return[s.randomUniform(E("shape",t,e,n),E("minval",t,e,n),E("maxval",t,e,n),E("dtype",t,e,n))];case"RandomUniformInt":return[s.randomUniformInt(E("shape",t,e,n),E("minval",t,e,n),E("maxval",t,e,n),E("seed",t,e,n))];case"Range":{const r=E("start",t,e,n),i=E("stop",t,e,n),o=E("step",t,e,n);return[s.range(r,i,o,E("dtype",t,e,n))]}case"TruncatedNormal":{const r=E("shape",t,e,n),i=E("mean",t,e,n),o=E("stdDev",t,e,n),a=E("seed",t,e,n);return[s.truncatedNormal(r,i,o,E("dtype",t,e,n),a)]}case"Zeros":return[s.zeros(E("shape",t,e,n),E("dtype",t,e,n))];case"ZerosLike":return[s.zerosLike(E("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vx(t,e,n){const s=E("boxes",t,e,n),r=E("scores",t,e,n),i=E("maxOutputSize",t,e,n),o=E("iouThreshold",t,e,n),a=E("scoreThreshold",t,e,n),l=E("softNmsSigma",t,e,n);return{boxes:s,scores:r,maxOutputSize:i,iouThreshold:o,scoreThreshold:a,softNmsSigma:l}}const wae=async(t,e,n,s,r=is)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u,softNmsSigma:c}=vx(t,e,n),h=await r.image.nonMaxSuppressionWithScoreAsync(i,o,a,l,u,c);return[h.selectedIndices,h.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u}=vx(t,e,n),c=E("padToMaxOutputSize",t,e,n),h=await r.image.nonMaxSuppressionPaddedAsync(i,o,a,l,u,c);return[h.selectedIndices,h.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:u}=vx(t,e,n);return[await r.image.nonMaxSuppressionAsync(i,o,a,l,u)]}case"Where":{const i=r.cast(E("condition",t,e,n),"bool"),o=[await r.whereAsync(i)];return i.dispose(),o}case"ListDiff":return r.setdiff1dAsync(E("x",t,e,n),E("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xae=(t,e,n,s=is)=>{switch(t.op){case"LowerBound":{const r=E("sortedSequence",t,e,n),i=E("values",t,e,n);return[s.lowerBound(r,i)]}case"TopKV2":{const r=E("x",t,e,n),i=E("k",t,e,n),o=E("sorted",t,e,n),a=s.topk(r,i,o);return[a.values,a.indices]}case"UpperBound":{const r=E("sortedSequence",t,e,n),i=E("values",t,e,n);return[s.upperBound(r,i)]}case"Unique":{const r=E("x",t,e,n),i=s.unique(r);return[i.values,i.indices]}case"UniqueV2":{const r=E("x",t,e,n),i=E("axis",t,e,n),o=s.unique(r,i);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bae=(t,e,n,s=is)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=E("default",t,e,n);return[Qn(t.name,e,n)||r];case"Placeholder":return[Qn(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const c=E("x",t,e,n);return[Mo(c)]}case"IdentityN":return E("x",t,e,n).map(c=>Mo(c));case"Snapshot":const i=E("x",t,e,n);return[Mo(i)];case"Shape":return[s.tensor1d(E("x",t,e,n).shape,"int32")];case"ShapeN":return E("x",t,e,n).map(c=>s.tensor1d(c.shape));case"Size":return[s.scalar(E("x",t,e,n).size,"int32")];case"Rank":return[s.scalar(E("x",t,e,n).rank,"int32")];case"NoOp":return[s.scalar(1)];case"Print":const o=E("x",t,e,n),a=E("data",t,e,n),l=E("message",t,e,n),u=E("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(let c=0;c<a.length;c++)console.log(Array.prototype.slice.call(a[c].dataSync()).slice(0,u));return[o];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Iae{get id(){return this.handle.id}constructor(e,n){this.keyDType=e,this.valueDType=n,this.handle=Be(0),this.tensorMap=new Map,Un(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Be(this.size(),"int32")}async import(e,n){this.checkKeyAndValueTensor(e,n);const s=await e.data();return this.tensorMap.forEach(r=>r.dispose()),this.tensorMap.clear(),Y(()=>{const r=di(n),i=s.length,o=r.length;F(i===o,()=>`The number of elements doesn't match, keys has ${i} elements, the values has ${o} elements.`);for(let a=0;a<i;a++){const l=s[a],u=r[a];Un(u),this.tensorMap.set(l,u)}return this.handle})}async find(e,n){this.checkKeyAndValueTensor(e,n);const s=await e.data();return Y(()=>{const r=[];for(let i=0;i<s.length;i++){const o=s[i],a=this.findWithDefault(o,n);r.push(a)}return wr(r)})}findWithDefault(e,n){const s=this.tensorMap.get(e);return s??n}checkKeyAndValueTensor(e,n){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(n.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${n.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sae=async(t,e,n,s)=>{switch(t.op){case"HashTable":case"HashTableV2":{const r=s.getHashTableHandleByName(t.name);if(r!=null)return[r];{const i=E("keyDType",t,e,n),o=E("valueDType",t,e,n),a=new Iae(i,o);return s.addHashTable(t.name,a),[a.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const r=E("tableHandle",t,e,n,s),i=E("keys",t,e,n),o=E("values",t,e,n);return[await s.getHashTableById(r.id).import(i,o)]}case"LookupTableFind":case"LookupTableFindV2":{const r=E("tableHandle",t,e,n,s),i=E("keys",t,e,n),o=E("defaultValue",t,e,n);return[await s.getHashTableById(r.id).find(i,o)]}case"LookupTableSize":case"LookupTableSizeV2":{const r=E("tableHandle",t,e,n,s);return[s.getHashTableById(r.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tae=(t,e,n,s=is)=>{switch(t.op){case"ResizeBilinear":{const r=E("images",t,e,n),i=E("size",t,e,n),o=E("alignCorners",t,e,n),a=E("halfPixelCenters",t,e,n);return[s.image.resizeBilinear(r,[i[0],i[1]],o,a)]}case"ResizeNearestNeighbor":{const r=E("images",t,e,n),i=E("size",t,e,n),o=E("alignCorners",t,e,n),a=E("halfPixelCenters",t,e,n);return[s.image.resizeNearestNeighbor(r,[i[0],i[1]],o,a)]}case"CropAndResize":{const r=E("image",t,e,n),i=E("boxes",t,e,n),o=E("boxInd",t,e,n),a=E("cropSize",t,e,n),l=E("method",t,e,n),u=E("extrapolationValue",t,e,n);return[s.image.cropAndResize(r,i,o,a,l,u)]}case"ImageProjectiveTransformV3":{const r=E("images",t,e,n),i=E("transforms",t,e,n),o=E("outputShape",t,e,n),a=E("fillValue",t,e,n),l=E("interpolation",t,e,n),u=E("fillMode",t,e,n);return[s.image.transform(r,i,l.toLowerCase(),u.toLowerCase(),a,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cae=(t,e,n,s=is)=>{switch(t.op){case"Equal":return[s.equal(E("a",t,e,n),E("b",t,e,n))];case"NotEqual":return[s.notEqual(E("a",t,e,n),E("b",t,e,n))];case"Greater":return[s.greater(E("a",t,e,n),E("b",t,e,n))];case"GreaterEqual":return[s.greaterEqual(E("a",t,e,n),E("b",t,e,n))];case"Less":return[s.less(E("a",t,e,n),E("b",t,e,n))];case"LessEqual":return[s.lessEqual(E("a",t,e,n),E("b",t,e,n))];case"LogicalAnd":return[s.logicalAnd(E("a",t,e,n),E("b",t,e,n))];case"LogicalNot":return[s.logicalNot(E("a",t,e,n))];case"LogicalOr":return[s.logicalOr(E("a",t,e,n),E("b",t,e,n))];case"Select":case"SelectV2":return[s.where(E("condition",t,e,n),E("a",t,e,n),E("b",t,e,n))];case"BitwiseAnd":return[s.bitwiseAnd(E("a",t,e,n),E("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kae=(t,e,n,s=is)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[s.matMul(E("a",t,e,n),E("b",t,e,n),E("transposeA",t,e,n),E("transposeB",t,e,n))];case"Einsum":return[s.einsum(E("equation",t,e,n),...E("tensors",t,e,n))];case"Transpose":return[s.transpose(E("x",t,e,n),E("perm",t,e,n))];case"_FusedMatMul":const[r,i]=E("fusedOps",t,e,n),o=r==="biasadd",a=i==="prelu",l=E("numArgs",t,e,n),u=E("leakyreluAlpha",t,e,n);if(o){if(a&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,h]=E("args",t,e,n);return[s.fused.matMul({a:E("a",t,e,n),b:E("b",t,e,n),transposeA:E("transposeA",t,e,n),transposeB:E("transposeB",t,e,n),bias:c,activation:i,preluActivationWeights:h,leakyreluAlpha:u})];case"MatrixBandPart":return[s.linalg.bandPart(E("a",t,e,n),E("numLower",t,e,n),E("numUpper",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eae=(t,e,n,s=is)=>{switch(t.op){case"EuclideanNorm":return[s.euclideanNorm(E("x",t,e,n),E("axis",t,e,n),E("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":return[s.batchNorm(E("x",t,e,n),E("mean",t,e,n),E("variance",t,e,n),E("offset",t,e,n),E("scale",t,e,n),E("epsilon",t,e,n))];case"FusedBatchNormV3":return[s.batchNorm(E("x",t,e,n),E("mean",t,e,n),E("variance",t,e,n),E("offset",t,e,n),E("scale",t,e,n),E("epsilon",t,e,n))];case"LRN":return[s.localResponseNormalization(E("x",t,e,n),E("radius",t,e,n),E("bias",t,e,n),E("alpha",t,e,n),E("beta",t,e,n))];case"Softmax":return[s.softmax(E("x",t,e,n))];case"LogSoftmax":return[s.logSoftmax(E("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ae=(t,e,n,s=is)=>{switch(t.op){case"RaggedGather":{const{outputNestedSplits:r,outputDenseValues:i}=s.raggedGather(E("paramsNestedSplits",t,e,n),E("paramsDenseValues",t,e,n),E("indices",t,e,n),E("outputRaggedRank",t,e,n));return r.concat(i)}case"RaggedRange":{const{rtNestedSplits:r,rtDenseValues:i}=s.raggedRange(E("starts",t,e,n),E("limits",t,e,n),E("splits",t,e,n));return[r,i]}case"RaggedTensorToTensor":return[s.raggedTensorToTensor(E("shape",t,e,n),E("values",t,e,n),E("defaultValue",t,e,n),E("rowPartitionTensors",t,e,n),E("rowPartitionTypes",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nae=(t,e,n,s=is)=>{switch(t.op){case"Max":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.max(E("x",t,e,n),a,l)]}case"Mean":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.mean(E("x",t,e,n),a,l)]}case"Min":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.min(E("x",t,e,n),a,l)]}case"Sum":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.sum(E("x",t,e,n),a,l)]}case"All":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.all(E("x",t,e,n),a,l)]}case"Any":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.any(E("x",t,e,n),a,l)]}case"ArgMax":{const a=E("axis",t,e,n);return[s.argMax(E("x",t,e,n),a)]}case"ArgMin":{const a=E("axis",t,e,n);return[s.argMin(E("x",t,e,n),a)]}case"Prod":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.prod(E("x",t,e,n),a,l)]}case"Cumprod":{const a=E("axis",t,e,n),l=E("exclusive",t,e,n),u=E("reverse",t,e,n);return[s.cumprod(E("x",t,e,n),a,l,u)]}case"Cumsum":{const a=E("axis",t,e,n),l=E("exclusive",t,e,n),u=E("reverse",t,e,n);return[s.cumsum(E("x",t,e,n),a,l,u)]}case"Bincount":const r=E("x",t,e,n),i=E("weights",t,e,n),o=E("size",t,e,n);return[s.bincount(r,i,o)];case"DenseBincount":{const a=E("x",t,e,n),l=E("weights",t,e,n),u=E("size",t,e,n),c=E("binaryOutput",t,e,n);return[s.denseBincount(a,l,u,c)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ae=(t,e,n,s=is)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=E("n",t,e,n),i=E("axis",t,e,n);let o=E("tensors",t,e,n);return o=o.slice(0,r),[s.concat(o,i)]}case"Gather":{const r=E("x",t,e,n),i=E("indices",t,e,n);return[s.gather(r,s.cast(i,"int32"),0)]}case"GatherV2":{const r=E("axis",t,e,n),i=E("batchDims",t,e,n),o=E("x",t,e,n),a=E("indices",t,e,n);return[s.gather(o,s.cast(a,"int32"),r,i)]}case"Reverse":{const r=E("dims",t,e,n),i=[];for(let a=0;a<r.length;a++)r[a]&&i.push(a);const o=E("x",t,e,n);return[s.reverse(o,i)]}case"ReverseV2":{const r=E("axis",t,e,n),i=E("x",t,e,n);return[s.reverse(i,r)]}case"Slice":{const r=E("begin",t,e,n),i=E("size",t,e,n);return[s.slice(E("x",t,e,n),r,i)]}case"StridedSlice":{const r=E("begin",t,e,n),i=E("end",t,e,n),o=E("strides",t,e,n),a=E("beginMask",t,e,n),l=E("endMask",t,e,n),u=E("ellipsisMask",t,e,n),c=E("newAxisMask",t,e,n),h=E("shrinkAxisMask",t,e,n),d=E("x",t,e,n);return[s.stridedSlice(d,r,i,o,a,l,u,c,h)]}case"Pack":return Y(()=>{const r=E("axis",t,e,n),i=E("tensors",t,e,n),o=i[0].shape,a=s.squeeze(i[0]).shape,l=i.map(u=>{const c=ut(u.shape,o);if(!c&&!ut(s.squeeze(u).shape,a))throw new Error("the input tensors shape does not match");return c?u:s.reshape(u,o)});return[s.stack(l,r)]});case"Unpack":{const r=E("axis",t,e,n),i=E("tensor",t,e,n);return s.unstack(i,r)}case"Tile":{const r=E("reps",t,e,n);return[s.tile(E("x",t,e,n),r)]}case"Split":case"SplitV":{const r=E("axis",t,e,n),i=E("numOrSizeSplits",t,e,n),o=E("x",t,e,n);return s.split(o,i,r)}case"ScatterNd":{const r=E("indices",t,e,n),i=E("values",t,e,n),o=E("shape",t,e,n);return[s.scatterND(r,i,o)]}case"GatherNd":{const r=E("x",t,e,n),i=E("indices",t,e,n);return[s.gatherND(r,i)]}case"SparseToDense":{const r=E("sparseIndices",t,e,n),i=E("outputShape",t,e,n),o=E("sparseValues",t,e,n),a=E("defaultValue",t,e,n);return[s.sparseToDense(r,o,i,o.dtype===a.dtype?a:s.cast(a,o.dtype))]}case"TensorScatterUpdate":{const r=E("indices",t,e,n),i=E("values",t,e,n),o=E("tensor",t,e,n);return[s.tensorScatterUpdate(o,r,i)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aae=(t,e,n,s=is)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:i,emptyRowIndicator:o,reverseIndexMap:a}=s.sparse.sparseFillEmptyRows(E("indices",t,e,n),E("values",t,e,n),E("denseShape",t,e,n),E("defaultValue",t,e,n));return[r,i,o,a]}case"SparseReshape":{const{outputIndices:r,outputShape:i}=s.sparse.sparseReshape(E("inputIndices",t,e,n),E("inputShape",t,e,n),E("newShape",t,e,n));return[r,i]}case"SparseSegmentMean":return[s.sparse.sparseSegmentMean(E("data",t,e,n),E("indices",t,e,n),E("segmentIds",t,e,n))];case"SparseSegmentSum":return[s.sparse.sparseSegmentSum(E("data",t,e,n),E("indices",t,e,n),E("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rae=(t,e,n,s=is)=>{switch(t.op){case"FFT":return[s.fft(E("x",t,e,n))];case"IFFT":return[s.ifft(E("x",t,e,n))];case"RFFT":return[s.rfft(E("x",t,e,n))];case"IRFFT":return[s.irfft(E("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dae=(t,e,n,s=is)=>{switch(t.op){case"StaticRegexReplace":return[s.string.staticRegexReplace(E("input",t,e,n),E("pattern",t,e,n),E("rewrite",t,e,n),E("replaceGlobal",t,e,n))];case"StringNGrams":{const{nGrams:r,nGramsSplits:i}=s.string.stringNGrams(E("data",t,e,n),E("dataSplits",t,e,n),E("separator",t,e,n),E("nGramWidths",t,e,n),E("leftPad",t,e,n),E("rightPad",t,e,n),E("padWidth",t,e,n),E("preserveShortSequences",t,e,n));return[r,i]}case"StringSplit":{const{indices:r,values:i,shape:o}=s.string.stringSplit(E("input",t,e,n),E("delimiter",t,e,n),E("skipEmpty",t,e,n));return[r,i,o]}case"StringToHashBucketFast":return[s.string.stringToHashBucketFast(E("input",t,e,n),E("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oae=(t,e,n,s=is)=>{switch(t.op){case"Cast":return[s.cast(E("x",t,e,n),E("dtype",t,e,n))];case"ExpandDims":{const r=E("axis",t,e,n);return[s.expandDims(E("x",t,e,n),r)]}case"Squeeze":{const r=E("axis",t,e,n);return[s.squeeze(E("x",t,e,n),r)]}case"Reshape":return[s.reshape(E("x",t,e,n),E("shape",t,e,n))];case"EnsureShape":return[s.ensureShape(E("x",t,e,n),E("shape",t,e,n))];case"MirrorPad":return[s.mirrorPad(E("x",t,e,n),E("padding",t,e,n),E("mode",t,e,n))];case"PadV2":case"Pad":return[s.pad(E("x",t,e,n),E("padding",t,e,n),E("constantValue",t,e,n))];case"SpaceToBatchND":{const r=E("blockShape",t,e,n),i=E("paddings",t,e,n);return[s.spaceToBatchND(E("x",t,e,n),r,i)]}case"BatchToSpaceND":{const r=E("blockShape",t,e,n),i=E("crops",t,e,n);return[s.batchToSpaceND(E("x",t,e,n),r,i)]}case"DepthToSpace":{const r=E("blockSize",t,e,n),i=E("dataFormat",t,e,n).toUpperCase();return[s.depthToSpace(E("x",t,e,n),r,i)]}case"BroadcastTo":return[s.broadcastTo(E("x",t,e,n),E("shape",t,e,n))];case"BroadcastArgs":return[s.broadcastArgs(E("s0",t,e,n),E("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $$(t,e,n,s,r=Y){const i=((o,a,l)=>{switch(o.category){case"arithmetic":return r(()=>uae(o,a,l));case"basic_math":return r(()=>cae(o,a,l));case"control":return gae(o,a,l);case"convolution":return r(()=>yae(o,a,l));case"creation":return r(()=>vae(o,a,l));case"dynamic":return wae(o,a,l);case"evaluation":return r(()=>xae(o,a,l));case"image":return r(()=>Tae(o,a,l));case"graph":return r(()=>bae(o,a,l));case"logical":return r(()=>Cae(o,a,l));case"matrices":return r(()=>kae(o,a,l));case"normalization":return r(()=>Eae(o,a,l));case"ragged":return r(()=>_ae(o,a,l));case"reduction":return r(()=>Nae(o,a,l));case"slice_join":return r(()=>$ae(o,a,l));case"sparse":return r(()=>Aae(o,a,l));case"spectral":return r(()=>Rae(o,a,l));case"string":return r(()=>Dae(o,a,l));case"transformation":return r(()=>Oae(o,a,l));case"hash_table":return Sae(o,a,l,s);case"custom":const u=dV(o.op);if(u&&u.customExecutor)return u.customExecutor(new lae(o,a,l));throw TypeError(`Custom op ${o.op} is not registered.`);default:throw TypeError(`Unknown op '${o.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return Du(i)?i.then(o=>[].concat(o)):[].concat(i)}class A${constructor(e={},n={},s={},r={},i){this.weightMap=e,this.tensorArrayMap=n,this.tensorListMap=s,this.functionMap=r,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,n){return{id:e,frameName:n,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let n=0;n<this.contexts.length-1;n++){const s=this.contexts.slice(0,this.contexts.length-n);e.push(this.contextIdforContexts(s))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(n=>n.id===0&&n.iterationId===0?"":`${n.frameName}-${n.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const n in this.tensorArrayMap)this.tensorArrayMap[n].clearAndClose(e);for(const n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R$(t,e,n,s){const r=new Set,i=[];let o=null,a=null;const l=new Set,u=new Set(Object.keys(t).map(d=>ir(d)[0]));s=s||[];const c=new Set(s.map(d=>ir(d.name)[0])),h=[...e];for(;h.length>0;){const d=h.pop();if((nu(d)||Uae(d)||Wae(d))&&o==null&&(o=d,a=o.children.map(p=>p.name).filter(p=>r.has(p))),r.add(d.name),n[d.name]==null&&!u.has(d.name)&&!c.has(d.name)){if(d.inputs.length===0){i.push(d.name);continue}d.inputs.forEach(p=>{l.has(p.name)||(l.add(p.name),h.push(p))})}}return{inputs:t,outputs:e,usedNodes:r,missingInputs:i,dynamicNode:o,syncInputs:a}}function Pae(t,e){const{usedNodes:n,inputs:s}=e,r=Object.keys(s).map(v=>ir(v)[0]).map(v=>t.nodes[v]),i=t.initNodes||[],o=v=>n.has(typeof v=="string"?v:v.name);function a(v){return[...new Map(v.map(y=>[y.name,y])).values()]}const l=a([...r,...t.weights,...i]).filter(o),u=a([...l,...Object.values(t.nodes)]).filter(o),c=new Map(u.map(v=>[v.name,v])),h={};for(const v of u){h[v.name]=h[v.name]||0;for(const y of v.children)o(y)||(h[y.name]=Number.POSITIVE_INFINITY),h[y.name]=(h[y.name]||0)+1}const d=Object.entries(h).filter(([,v])=>v===0).map(([v])=>v),p=[...d];for(;d.length>0;){const v=d.pop(),y=c.get(v);for(const w of y.children.filter(o))--h[w.name]===0&&(p.push(w.name),d.push(w.name))}const f=p.map(v=>c.get(v)),m=Fae(f,l);return Lae(m,l),m}function Fae(t,e){const n=new Map(t.map(o=>[o.name,o])),s=e.map(o=>o.name),r=new Set(s);for(;s.length>0;){const o=s.pop(),a=n.get(o);for(const l of a.children)!n.has(l.name)||r.has(l.name)||(r.add(l.name),s.push(l.name))}return t.filter(o=>r.has(o.name))}class Pg extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}}function Lae(t,e){const n=new Map(t.map((a,l)=>[a.name,l])),s=new Set(e.map(a=>a.name)),r=a=>s.has(typeof a=="string"?a:a.name),i=new Set(t.map(a=>a.name)),o=a=>i.has(typeof a=="string"?a:a.name);for(const a of t){for(const l of a.children.filter(o)){if(!n.has(l.name))throw new Pg(`Child ${l.name} of node ${a.name} is unreachable.`);if(n.get(a.name)>n.get(l.name))throw new Pg(`Node ${a.name} is scheduled to run after its child ${l.name}.`)}if(!r(a))for(const l of a.inputs){if(!n.has(l.name))throw new Pg(`Input ${l.name} of node ${a.name} is unreachable.`);if(n.get(l.name)>n.get(a.name))throw new Pg(`Node ${a.name} is scheduled to run before its input ${l.name}.`)}}}function Mae(t){const e=new Map(t.map((a,l)=>[a.name,l])),n=Number.MAX_SAFE_INTEGER,s=t.map((a,l)=>nu(a)?n:l),r=a=>{const l=s[e.get(a.name)];return l??-1},i=t.map((a,l)=>a.children.map(r).reduce((u,c)=>Math.max(u,c),s[l])),o=new Map;for(let a=0;a<t.length;++a){const l=i[a];if(l===n)continue;const u=t[a],c=t[l];o.has(c.name)||o.set(c.name,[]),o.get(c.name).push(u)}return o}const Vae=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),zae=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),Bae=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function nu(t){return Vae.has(t.op)}function Uae(t){return zae.has(t.op)}function Wae(t){return Bae.has(t.op)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E1{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const n=Object.keys(e).map(s=>e[s].map(r=>r.id));this._weightIds=[].concat(...n),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const n=e.signatureKey||e.name;return e.defaultOutput?`${n}:${e.defaultOutput}`:n})}get functions(){return Object.keys(this._functions).reduce((e,n)=>(e[n]=this._functions[n].signature,e),{})}constructor(e,n){this.graph=e,this.parent=n,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(s=>{this._functionExecutorMap[s]=new E1(e.functions[s],this)})}getCompilationKey(e,n){const s=e.map(i=>i.name).sort(),r=n.map(i=>i.name).sort();return s.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}compile(e,n){const s=R$(e,n,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:i,syncInputs:o}=s;if(i!=null)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const u=n.map(h=>h.name),c=Object.keys(e);throw new Error(`Cannot compute the outputs [${u}] from the provided inputs [${c}]. Missing the following inputs: [${r}]`)}const a=Pae(this.graph,s),l=Mae(a);return{orderedNodes:a,nodeLiveUntilMap:l}}cloneAndKeepTensor(e){if(e==null)return null;const n=e.clone();return Un(n),n}cloneTensorList(e){return e?e.map(s=>this.cloneAndKeepTensor(s)):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(([n,s])=>[n,this.cloneTensorList(s)]))}execute(e,n){this.disposeIntermediateTensors(),e=this.mapInputs(e);const s=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n);const r=s.map(d=>this.graph.nodes[ir(d)[0]]),i=n.map(d=>ir(d)[0]),o=new Set(i);let a=i.map(d=>this.graph.nodes[d]);a.length===0&&(a=this._outputs);const l=this.getCompilationKey(r,a);let u=this.compiledMap.get(l);u==null&&(u=this.compile(e,a),this.compiledMap.set(l,u));try{this.keepIntermediateTensors=te().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){this.keepIntermediateTensors=!1,console.warn(d.message)}const c={},h={};return Y(()=>{const d=new A$(this.weightMap,c,h,this.functionExecutorMap,this.parseNodeNameCache),p=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(y=>{const[w,b]=ir(y,d),I=[];I[b]=e[y],p[w]=I,this.keepIntermediateTensors&&(this.clonedTensorsMap[w]=this.cloneTensorList(I))});const f=this.getFrozenTensorIds(p),{orderedNodes:m,nodeLiveUntilMap:v}=u;for(const y of m){if(p[y.name])continue;const w=$$(y,p,d,this._resourceManager);if(Du(w))throw new Error(`The execution of the op '${y.op}' returned a promise. Please use model.executeAsync() instead.`);p[y.name]=w,this.keepIntermediateTensors&&(this.clonedTensorsMap[y.name]=this.cloneTensorList(w)),this.checkTensorForDisposalWithNodeLiveUntilInfo(y,p,d,f,o,v.get(y.name))}return this.parent==null&&d.dispose(f),n.map(y=>Qn(y,p,d))})}getFrozenTensorIds(e){const n=[].concat.apply([],Object.keys(e).map(s=>e[s]).map(s=>s.map(r=>r.id)));return new Set(n)}checkTensorForDisposal(e,n,s,r,i,o,a){if(!(nu(n)||o.has(e))){for(const l of s[e])l!=null&&(a[l.id]=(a[l.id]||0)+n.children.length);for(const l of n.inputs){if(nu(l))continue;const u=C$(l.name,s,r);if(u!=null)for(const c of u){if(!c||c.kept||i.has(c.id))continue;const h=a[c.id];h===1?(c.dispose(),delete a[c.id]):h!=null&&a[c.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,n,s,r,i,o){function a(l){return nu(l)||i.has(l.name)}if(!(nu(e)||o==null))for(const l of o){if(a(l))continue;const u=C$(l.name,n,s);for(const c of u)!c||c.kept||r.has(c.id)||c.dispose()}}async executeAsync(e,n){return this._executeAsync(e,n)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const n of e)n&&!n.isDisposed&&n.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,n,s=!1,r={},i={}){this.disposeIntermediateTensors(),s||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=te().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){this.keepIntermediateTensors=!1,console.warn(d.message)}const o=new A$(this.weightMap,r,i,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const a=await this.executeWithControlFlow(e,o,n,s),l=n.map(d=>Qn(d,a,o)),u=l.map(d=>d.id),c=Object.keys(e).map(d=>e[d].id),h=new Set([...u,...c,...this.weightIds]);return Object.values(a).forEach(d=>{d.forEach(p=>{p&&!p.isDisposed&&!h.has(p.id)&&p.dispose()})}),this.parent==null&&o.dispose(h),l}async executeFunctionAsync(e,n,s){const r=e.reduce((i,o,a)=>(i[this.inputs[a].name]=o,i),{});return this._executeAsync(r,this.outputNodes,!0,n,s)}async executeWithControlFlow(e,n,s,r){const i=Object.keys(e),o=i.map(I=>this.graph.nodes[ir(I)[0]]),a=s.map(I=>ir(I)[0]),l=new Set(a);let u=a.map(I=>this.graph.nodes[I]);u.length===0&&(u=this._outputs);const{usedNodes:c,missingInputs:h,dynamicNode:d,syncInputs:p}=R$(e,u,this.weightMap,this._initNodes),f=[...o,...this.graph.weights,...this._initNodes||[]].map(I=>({node:I,contexts:n.currentContext})),m=Object.assign({},this.weightMap);Object.keys(e).forEach(I=>{const[k,R]=ir(I),C=[];C[R]=e[I],m[k]=C});const v={},y=this.getFrozenTensorIds(m),w={};for(;f.length>0;){const I=this.processStack(o,f,n,m,w,y,l,v,c);await Promise.all(I)}d==null&&!r&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const b=u.filter(I=>!nu(I)&&!Qn(I.name,m,n)).map(I=>I.name);if(b.length>0){let I="";throw d!=null&&(I=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${p}]`),new Error(`Cannot compute the outputs [${b}] from the provided inputs [${i}]. Consider providing the following inputs: [${h}]. ${I}`)}return m}processStack(e,n,s,r,i,o,a,l,u){const c=[];for(;n.length>0;){const h=n.pop();s.currentContext=h.contexts;let d="";if(h.node.op==="Enter"&&E("isConstant",h.node,r,s)&&([d]=Lo(h.node.name,s)),r[h.node.name]==null){const p=$$(h.node,r,s,this._resourceManager);d||([d]=Lo(h.node.name,s));const f=s.currentContext;Du(p)?c.push(p.then(m=>(r[d]=m,this.keepIntermediateTensors&&(this.clonedTensorsMap[d]=this.cloneTensorList(m)),s.currentContext=f,this.checkTensorForDisposal(d,h.node,r,s,o,a,l),this.processChildNodes(h.node,n,s,r,i,u),m))):(r[d]=p,this.keepIntermediateTensors&&(this.clonedTensorsMap[d]=this.cloneTensorList(p)),this.checkTensorForDisposal(d,h.node,r,s,o,a,l),this.processChildNodes(h.node,n,s,r,i,u))}else this.processChildNodes(h.node,n,s,r,i,u)}return c}processChildNodes(e,n,s,r,i,o){e.children.forEach(a=>{const[l]=Lo(a.name,s);i[l]||!o.has(a.name)||(a.op==="Merge"?a.inputNames.some(u=>!!Qn(u,r,s))&&(i[l]=!0,n.push({contexts:s.currentContext,node:a})):a.inputNames.every(u=>!!Qn(u,r,s))&&(i[l]=!0,n.push({contexts:s.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(n=>n.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(n=>{const s=e[n],[r]=ir(n),i=this.graph.nodes[r];if(i.attrParams.shape&&i.attrParams.shape.value){const o=i.attrParams.shape.value,a=o.length===s.shape.length&&s.shape.every((l,u)=>o[u]===-1||o[u]===l);F(a,()=>`The shape of dict['${i.name}'] provided in model.execute(dict) must be [${o}], but was [${s.shape}]`)}i.attrParams.dtype&&i.attrParams.dtype.value&&F(s.dtype===i.attrParams.dtype.value,()=>`The dtype of dict['${i.name}'] provided in model.execute(dict) must be ${i.attrParams.dtype.value}, but was ${s.dtype}`)})}mapInputs(e){var n,s;const r={};for(const i in e){const o=(s=(n=this._signature)===null||n===void 0?void 0:n.inputs)===null||s===void 0?void 0:s[i];o!=null?r[o.name]=e[i]:r[i]=e[i]}return r}checkInputs(e){const n=Object.keys(e).filter(s=>{const[r]=ir(s);return this.graph.nodes[r]==null});if(n.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${n}] that are not part of graph`)}mapOutputs(e){return e.map(n=>{var s,r;const i=(r=(s=this._signature)===null||s===void 0?void 0:s.outputs)===null||r===void 0?void 0:r[n];return i!=null?i.name:n},{})}checkOutputs(e){e.forEach(n=>{const[s]=ir(n);if(!this.graph.nodes[s])throw new Error(`The output '${n}' is not found in the graph`)})}}class jae{constructor(e={},n={}){this.hashTableNameToHandle=e,this.hashTableMap=n}addHashTable(e,n){this.hashTableNameToHandle[e]=n.handle,this.hashTableMap[n.id]=n}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gae="?tfjs-format=file",Hae="model.json";class qae{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,n={},s=mF){this.modelUrl=e,this.loadOptions=n,this.version="n/a",this.io=s,n==null&&(this.loadOptions={}),this.resourceManager=new jae}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const n=this.io.getLoadHandlers(e,this.loadOptions);if(n.length===0)n.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(n.length>1)throw new Error(`Found more than one (${n.length}) load handlers for URL '${[e]}'`);this.handler=n[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return Du(e)?e.then(n=>n.getWeightStream==null?this.loadSync(n):this.loadStreaming(n)):this.loadSync(e)}loadSync(e){const n=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,n)}async loadStreaming(e){if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");const n=await MO(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,n)}loadWithWeightMap(e,n){this.artifacts=e;const s=this.artifacts.modelTopology;let r=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const i=this.artifacts.userDefinedMetadata;i.signature!=null&&(r=i.signature),i.structuredOutputKeys!=null&&(this.structuredOutputKeys=i.structuredOutputKeys)}if(this.signature=r,this.version=`${s.versions.producer}.${s.versions.minConsumer}`,this.executor=new E1(k$.Instance.transformGraph(s,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(n),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const i=k$.Instance.transformGraph(e.modelInitializer);this.initializer=new E1(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,n){if(typeof e=="string"){const s=this.io.getSaveHandlers(e);if(s.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(s.length>1)throw new Error(`Found more than one (${s.length}) save handlers for URL '${e}'`);e=s[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const n=e instanceof Mt?[e]:e,s={};return n.forEach((r,i)=>s[this.structuredOutputKeys[i]]=r),s}return e}predict(e,n){const s=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(s)}async predictAsync(e,n){const s=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(s)}normalizeInputs(e){var n;if(!(e instanceof Mt)&&!Array.isArray(e)){const i=(n=this.signature)===null||n===void 0?void 0:n.inputs;if(i!=null)for(const o in i){const a=i[o];a.resourceId!=null&&(e[o]=this.resourceIdToCapturedInput[a.resourceId])}return e}e=Array.isArray(e)?e:[e];const s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-s} non-resource placeholders, while there are ${e.length} input tensors provided.`);let r=0;return this.inputNodes.reduce((i,o)=>{var a,l,u;const c=(u=(l=(a=this.signature)===null||a===void 0?void 0:a.inputs)===null||l===void 0?void 0:l[o])===null||u===void 0?void 0:u.resourceId;return c!=null?i[o]=this.resourceIdToCapturedInput[c]:i[o]=e[r++],i},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const n=this.initializerSignature.outputs,s=Object.keys(n);for(let r=0;r<s.length;r++){const i=s[r],o=n[i];this.resourceIdToCapturedInput[o.resourceId]=e[r]}}}execute(e,n){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const s=this.executor.execute(e,n);return s.length>1?s:s[0]}async executeAsync(e,n){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const s=await this.executor.executeAsync(e,n);return s.length>1?s:s[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((n,s)=>(n[s]=[e[s]],n),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Ye(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function Kae(t,e={},n=mF){if(t==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof t=="string"&&(t=Xae(t));const s=new qae(t,e,n);return await s.load(),s}function Xae(t){return t.endsWith("/")||(t=t+"/"),`${t}${Hae}${Gae}`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var D$;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(D$||(D$={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oe(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&F(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yae=yC;class sw extends SS{nextDataId(){return sw.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new oO(this,ao())}write(e,n,s){this.firstUse&&(this.firstUse=!1,te().get("IS_NODE")&&Nr(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&bf(s[0])){const i=s.map(o=>Ja(o));r=this.write(i,e,n)}else r=this.write(s,e,n);return{dataId:r,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,s,r,i){this.data.set(e,{values:n,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:s}=this.data.get(e);if(n==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return ra(r,i)}return Jq(this.data.get(e).values,n)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>ll(r));return tt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return tt(e.shape,e.dtype,n)}makeOutput(e,n,s){return ao().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=Gs();return e(),{kernelMs:Gs()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Oe([e],"where");const n=this.readSync(e.dataId);return Yae(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}sw.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mV(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const Qae=t=>{const{x:e}=t.inputs,n=t.backend;Oe(e,"abs");let s=new Float32Array(re(e.shape));const r=n.data.get(e.dataId).values;return s=mV(r),n.makeOutput(s,e.shape,e.dtype)},Jae={kernelName:y0,backendName:"cpu",kernelFunc:Qae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function In(t){return(e,n,s,r,i)=>{const o=Qe(e,n),a=o.length,l=Ve(o),u=re(o),c=ts(i,u),h=e.length,d=n.length,p=Ve(e),f=Ve(n),m=_h(e,o),v=_h(n,o);if(m.length+v.length===0)for(let y=0;y<c.length;++y)c[y]=t(s[y%s.length],r[y%r.length]);else for(let y=0;y<c.length;++y){const w=Hh(y,a,l),b=w.slice(-h);m.forEach(C=>b[C]=0);const I=wo(b,h,p),k=w.slice(-d);v.forEach(C=>k[C]=0);const R=wo(k,d,f);c[y]=t(s[I],r[R])}return[c,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lr(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,a=n.makeTensorInfo(s.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",i),imag:n.makeTensorInfo(r.shape,"float32",o)},a}const Zae={kernelName:DS,backendName:"cpu",kernelFunc:lr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _1(t,e,n="float32"){if(n==="complex64"){const r=_1(t,e,"float32"),i=_1(t,e,"float32");return lr({inputs:{real:r,imag:i},backend:t})}const s=ws(re(e),n);return t.makeTensorInfo(e,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _o(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const ele={kernelName:Uf,backendName:"cpu",kernelFunc:_o};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ju(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.real,i=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,i)}const tle={kernelName:hT,backendName:"cpu",kernelFunc:ju};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gV(t,e,n,s){if(s==="int32"){const r=Int32Array.from(t);return[e,"int32",r]}if(s==="bool"){const r=tc([0],n),[i,o]=In((a,l)=>a!==l?1:0)(e,[],t,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}function yl(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return _o({inputs:{x:r},backend:n});const c=_1(n,r.shape,r.dtype),h=yl({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),d=lr({inputs:{real:h,imag:c},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),d}if(r.dtype==="complex64"){const c=ju({inputs:{input:r},backend:n}),h=yl({inputs:{x:c},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(c),h}if(!lO(r.dtype,i)){const c=_o({inputs:{x:r},backend:n});return{dataId:c.dataId,shape:c.shape,dtype:i}}const o=n.data.get(r.dataId).values,[a,l,u]=gV(o,r.shape,r.dtype,i);return n.makeTensorInfo(a,l,u)}const nle={kernelName:Nf,backendName:"cpu",kernelFunc:yl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fn(t,e,n,s){return n==null?({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;Oe([o,a],t);const u=l.data.get(o.dataId).values,c=l.data.get(a.dataId).values,h=o.dtype==="string"?ia(u):u,d=o.dtype==="string"?ia(c):c,p=s||o.dtype,[f,m]=e(o.shape,a.shape,h,d,p);return l.makeTensorInfo(m,p,f)}:({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const u=yl({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),c=l.data.get(u.dataId),h=c.complexTensorInfos.real,d=c.complexTensorInfos.imag,p=l.data.get(h.dataId).values,f=l.data.get(d.dataId).values,m=yl({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),v=l.data.get(m.dataId),y=v.complexTensorInfos.real,w=v.complexTensorInfos.imag,b=l.data.get(y.dataId).values,I=l.data.get(w.dataId).values,[k,R,C]=n(o.shape,a.shape,p,f,b,I),T=l.makeTensorInfo(C,"float32",k),N=l.makeTensorInfo(C,"float32",R),$=lr({inputs:{real:T,imag:N},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(m),l.disposeIntermediateTensorInfo(T),l.disposeIntermediateTensorInfo(N),$}else{const u=l.data.get(o.dataId).values,c=l.data.get(a.dataId).values,h=s||o.dtype,[d,p]=e(o.shape,a.shape,u,c,h);return l.makeTensorInfo(p,h,d)}}}function bk(t){return(e,n,s,r,i,o)=>{const a=Qe(e,n),l=re(a),u=a.length,c=Ve(a),h=ts("float32",l),d=ts("float32",l),p=_h(e,a),f=_h(n,a),m=ra(s,r),v=ra(i,o),y=e.length,w=Ve(e),b=n.length,I=Ve(n);if(p.length+f.length===0)for(let k=0;k<h.length;k++){const R=k%m.length,C=k%v.length,T=t(m[R*2],m[R*2+1],v[C*2],v[C*2+1]);h[k]=T.real,d[k]=T.imag}else for(let k=0;k<h.length;k++){const R=Hh(k,u,c),C=R.slice(-y);p.forEach(V=>C[V]=0);const T=wo(C,y,w),N=R.slice(-b);f.forEach(V=>N[V]=0);const $=wo(N,b,I),P=t(m[T*2],m[T*2+1],v[$*2],v[$*2+1]);h[k]=P.real,d[k]=P.imag}return[h,d,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yV=In((t,e)=>t+e),sle=bk((t,e,n,s)=>({real:t+n,imag:e+s})),Rh=Fn(qh,yV,sle),rle={kernelName:qh,backendName:"cpu",kernelFunc:Rh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ik(t,e,n,s,r){const i=re(s),o=ws(r,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function vV(t,e,n,s=!1){const r=t.shape[0],i=t.shape[1],o=tt([r,n],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<i;l++){const u=t.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=n||(s?o.set(1,a,u):e.size>0?o.set(o.get(a,u)+e.get(a,l),a,u):o.set(o.get(a,u)+1,a,u))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wV=In((t,e)=>t&e),ile=Fn(C0,wV),ole={kernelName:C0,backendName:"cpu",kernelFunc:ile};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ao(t){return(e,n,s)=>{const r=yn(n,e.length);for(let i=0;i<e.length;++i)r[i]=t(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Et(t,e,n){const s=Ao(e);return Ol(t,s,n)}function Ol(t,e,n){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;Oe(o,t);const a=i,l=a.data.get(o.dataId).values;let u;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=ia(l)}else u=l;const c=n||o.dtype,h=e(u,c,r);return a.makeTensorInfo(o.shape,c,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xV=Ao(t=>Math.ceil(t)),ale=Ol($f,xV),lle={kernelName:$f,backendName:"cpu",kernelFunc:ale};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bV(t,e,n,s){const r=yn(n,re(e));if(s&&n!=="string"){let i=0;t.forEach(o=>{const a=re(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;t.forEach(o=>{const a=n==="string"?ia(o.vals):o.vals;let l=0;for(let u=0;u<o.shape[0];++u){const c=u*e[1]+i;for(let h=0;h<o.shape[1];++h)r[c+h]=a[l++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IV=In((t,e)=>t===e?1:0),SV=Fn(O0,IV,null,"bool"),ule={kernelName:O0,backendName:"cpu",kernelFunc:SV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TV=Ao(t=>Math.exp(t)),CV=Ol(Lf,TV,"float32"),cle={kernelName:Lf,backendName:"cpu",kernelFunc:CV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kV=Ao(t=>Math.expm1(t)),hle=Ol(Mf,kV),dle={kernelName:Mf,backendName:"cpu",kernelFunc:hle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EV=Ao(t=>Math.floor(t)),ple=Ol(Vf,EV),fle={kernelName:Vf,backendName:"cpu",kernelFunc:ple};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _V=In((t,e)=>Math.floor(t/e)),mle=Fn(zf,_V,null,"int32"),gle={kernelName:zf,backendName:"cpu",kernelFunc:mle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NV(t,e,n,s,r,i,o,a,l){const u=tt([s,i],n);for(let c=0;c<s;c++){const h=[];let d=0;for(let p=0;p<r;p++){const f=t[c*r+p];d+=f*o[p],h.push(f)}if(d<0||d>=l/i)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let p=0;p<i;p++)u.values[c*i+p]=e.get(...e.indexToLoc(d*i+p))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $V(t,e,n){const s=tt(n,t.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],l=o[2],u=e.locToIndex([a,l]);o[2]=e.values[u];const c=t.locToIndex(o);0<=c&&c<t.values.length&&(s.values[r]=t.values[c])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AV=In((t,e)=>t>e?1:0),yle=Fn(M0,AV,null,"bool"),vle={kernelName:M0,backendName:"cpu",kernelFunc:yle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RV=In((t,e)=>t>=e?1:0),wle=Fn(Bf,RV,null,"bool"),xle={kernelName:Bf,backendName:"cpu",kernelFunc:wle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DV=In((t,e)=>t<e?1:0),ble=Fn(z0,DV,null,"bool"),Ile={kernelName:z0,backendName:"cpu",kernelFunc:ble};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OV=In((t,e)=>t<=e?1:0),Sle=Fn(B0,OV,null,"bool"),Tle={kernelName:B0,backendName:"cpu",kernelFunc:Sle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PV(t,e,n){const s=(e-t)/(n-1),r=ws(n,"float32");r[0]=t;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FV=Ao(t=>Math.log(t)),Cle=Ol(Hf,FV),kle={kernelName:Hf,backendName:"cpu",kernelFunc:Cle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LV(t,e,n,s){const r=ts(s,re(n));for(let i=0;i<r.length;++i){const o=i*e;let a=t[o];for(let l=0;l<e;++l){const u=t[o+l];(Number.isNaN(u)||u>a)&&(a=u)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MV=In((t,e)=>Math.max(t,e)),Ele=Fn(Kf,MV),_le={kernelName:Kf,backendName:"cpu",kernelFunc:Ele};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VV=In((t,e)=>Math.min(t,e)),Nle=Fn(Xf,VV),$le={kernelName:Xf,backendName:"cpu",kernelFunc:Nle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sk=In((t,e)=>t*e),Ale=bk((t,e,n,s)=>({real:t*n-e*s,imag:t*s+e*n})),rw=Fn(Qf,Sk,Ale),Rle={kernelName:Qf,backendName:"cpu",kernelFunc:rw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zV(t,e,n){const s=Cl(-1,n);return Sk([],e,s,t,n)}function Dle(t){const{inputs:e,backend:n}=t,{x:s}=e;Oe(s,"neg");const r=n.data.get(s.dataId).values,[i,o]=zV(r,s.shape,s.dtype);return n.makeTensorInfo(o,s.dtype,i)}const Ole={kernelName:J0,backendName:"cpu",kernelFunc:Dle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BV=In((t,e)=>t!==e?1:0),Ple=Fn(Z0,BV,null,"bool"),Fle={kernelName:Z0,backendName:"cpu",kernelFunc:Ple};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tk(t,e,n,s,r){const i=e.length,o=re(e),a=Ve(e),l=Ve(r),u=ts(n,re(r));for(let c=0;c<o;++c){const h=Hh(c,i,a),d=new Array(h.length);for(let f=0;f<d.length;f++)d[f]=h[s[f]];const p=wo(d,i,l);u[p]=t[c]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Js(t){const{inputs:e,attrs:n,backend:s}=t,{x:r}=e,{perm:i}=n;Oe(r,"transpose");const o=r.shape.length,a=new Array(o);for(let h=0;h<a.length;h++)a[h]=r.shape[i[h]];const l=s.data.get(r.dataId).values,u=Tk(l,r.shape,r.dtype,i,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const Lle={kernelName:ih,backendName:"cpu",kernelFunc:Js};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UV(t,e,n,s){const[r,i]=Gn(t,s),o=vr(e,"int32"),a=ws(re(r),o),l=re(i);for(let u=0;u<a.length;++u){const c=u*l;let h=1;for(let d=0;d<l;++d)h*=n[c+d];a[u]=h}return{outVals:a,outShape:r,outDtype:o}}function Mle(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;Oe(r,"prod");const a=r.shape.length,l=st(i,r.shape),u=on(l,a);let c=l,h=r;const d=[];u!=null&&(h=Js({inputs:{x:r},backend:n,attrs:{perm:u}}),d.push(h),c=xn(c.length,a));const p=n.data.get(h.dataId).values,{outVals:f,outShape:m,outDtype:v}=UV(h.shape,h.dtype,p,c);let y=m;return o&&(y=wn(m,l)),d.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(y,v,f)}const Vle={kernelName:iv,backendName:"cpu",kernelFunc:Mle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zle(t,e,n){t.forEach((s,r)=>{if(s<0||s>=n){const i=Hh(r,e.length,Ve(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${n})`)}})}function Ble(t,e){for(let n=0;n<t.length;++n){const s=t[n],r=n===t.length-1?e:t[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function Ule(t,e,n,s){const r=[];let i=0;const o=e.length-1+n.length,a=new Array(o).fill(null).map(()=>[0]);Ble(n,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const c=e[u+1];for(let h=1;h<l+1;++h)a[u].push(h*c)}for(let u=0;u<t.length;++u){let c=t[u],h=t[u]+1;for(let d=0;d<n.length;++d){const p=n[d],f=d+e.length-1;if(f>=0){const m=a[f],v=m[m.length-1]-p[c];for(let y=c;y<h;++y)a[f].push(p[y+1]+v)}c=p[c],h=p[h]}h!==c&&(r.push([c,h]),i+=h-c)}return{outSplits:a,valueSlices:r,numValues:i}}function Wle(t){const e=[];for(let n=0;n<t.length;++n){const s=t[n].length,r=yn("int32",s);e.push(r),t[n].forEach((i,o)=>r[o]=i)}return e}function O$(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let s=e;s<t.length;s++)n[e-1]*=t[s];return n}function jle(t,e,n,s,r,i){const o=O$(e,2)[1],a=O$(i,2)[1];let l=0;for(const u of n)for(let c=u[0];c<u[1];++c){for(let h=0;h<s;++h)r[l*a+h]=t[c*o+h];++l}}function Gle(t,e,n,s,r){const i=e.slice();i[0]=r;const o=yn(n,re(i)),a=t.length,l=a===0?0:a/e[0];return jle(t,e,s,l,o,i),[o,i]}function WV(t,e,n,s,r,i,o,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(zle(i,o,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:c,valueSlices:h,numValues:d}=Ule(i,o,t,u),p=Wle(c),f=Gle(n,s,r,h,d);return[p,f[0],f[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P$=2147483647;function jV(t,e,n,s,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,u=o.length===0,c=[];a||c.push(e[0]),l||c.push(r[0]),u||c.push(o[0]);for(let v=1;v<c.length;++v)if(c[v]!==c[v-1])throw new Error("starts, limits, and deltas must have the same shape");const h=c.length===0?1:c[0],d=yn("int32",h+1);d[0]=0;for(let v=0;v<h;++v){const y=a?t[0]:t[v],w=l?s[0]:s[v],b=u?i[0]:i[v];if(b===0)throw new Error("Requires delta != 0");let I;if(b>0&&w<y||b<0&&w>y)I=0;else if(I=Math.ceil(Math.abs((w-y)/b)),I>P$)throw new Error(`Requires ((limit - start) / delta) <= ${P$}`);d[v+1]=d[v]+I}const p=d[h],f=yn(n,p);let m=0;for(let v=0;v<h;++v){const y=d[v+1]-d[v];let w=a?t[0]:t[v];const b=u?i[0]:i[v];for(let I=0;I<y;++I)f[m++]=w,w+=b}return[d,f]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var jr=$i;class N1{constructor(e,n,s,r,i,o,a,l,u,c){this.shape=e,this.shapeShape=n,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=kF(c),this.raggedRank=EF(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===jr.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===jr.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case jr.VALUE_ROWIDS:return N1.getMaxWidthValueRowID(n);case jr.ROW_SPLITS:return N1.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${jr[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let s=0;for(let r=0;r<n-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let s=0,r=e[0],i=0;for(let o=1;o<n;++o){const a=e[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(n-s,i)}tensorShapeFromTensor(e,n,s=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return L$(e,s)}calculateOutputSize(e){const n=this.valuesShape,s=this.defaultValueShape;_F(s,n);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=CF(this.raggedRank,r,n);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,n,s){const r=Math.min(e,s),i=[];let o=0;for(let a=0;a<r;++a,o+=n)i.push(o);for(let a=r;a<e;++a)i.push(-1);return F(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,n,s,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let u=Math.min(r,l),c=n[a];c===-1&&(u=0);for(let h=0;h<u;++h)o.push(c),c+=s;for(let h=0;h<l-u;++h)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,n,s,r){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let u=n[l];o.push(u);for(let c=1;c<i;++c){const h=e[c];if(h===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=h,h>=n.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${n.length}`);u=n[h]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,n,s,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case jr.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,n,s,r);case jr.ROW_SPLITS:if(i.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(i,n,s,r);default:throw new Error(`Unsupported partition type: ${jr[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case jr.FIRST_DIM_SIZE:return e[0];case jr.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case jr.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${jr[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=L$(s,!1),o=yn(this.valuesDType,re(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(n,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,n,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(e+1);const l=re(a),u=n.length;let c=this.defaultValue;if(c.length!==l&&c.length!==1){const f=this.defaultValueShape;Y(()=>{const m=H(c,f);c=lh(m,a).dataSync()})}let h=0,d=0,p=0;for(let f=0;f<=u;++f){let m=f<u?n[f]:-1;if(m===p){++p;continue}if(d<p){const v=i.subarray(h*l),y=o.subarray(d*l),w=(p-d)*l;F$(y,v,w)}if(f>=u){const v=s.length;m=Math.floor(v/l)}if(m>p)if(this.defaultValue.length===1)o.subarray(p*l,m*l).fill(this.defaultValue[0]),p=m;else for(;m>p;){const v=o.slice(p*l);F$(v,c,l),++p}m<0?(h=f+1,d=p):(h=f,d=p,p=d+1)}}}function F$(t,e,n){for(let s=0;s<n;s++)t[s]=e[s]}function L$(t,e){const n=[];for(let s of t){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function GV(t,e,n,s,r,i,o,a,l,u){return new N1(t,e,n,s,r,i,o,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HV(t,e,n,s){const r=t===e,i=t<e&&n<0,o=e<t&&n>1;if(r||i||o)return ws(0,s);const a=Math.abs(Math.ceil((e-t)/n)),l=ws(a,s);e<t&&n===1&&(n=-1),l[0]=t;for(let u=1;u<l.length;u++)l[u]=l[u-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qV=Ao(t=>1/Math.sqrt(t)),Hle=Ol(sm,qV),qle={kernelName:sm,backendName:"cpu",kernelFunc:Hle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hu(t,e,n,s,r,i,o,a,l,u){const c=[s/r,r],h=t.values,d=e.values;if(s===0)return tt(n,e.dtype);const p=l instanceof Rn?l:tt(c,e.dtype);typeof l=="string"||typeof l=="number"?p.values.fill(l):typeof l=="boolean"&&p.values.fill(+l);for(let f=0;f<i;f++){const m=[];let v=0;for(let y=0;y<o;y++){const w=h[f*o+y];m.push(w),v+=w*a[y]}if(v<0||v>=s/r)throw new Error(`Invalid indices: ${m} does not index into ${n}`);for(let y=0;y<r;y++)u?p.values[v*r+y]+=d[f*r+y]:p.values[v*r+y]=e.rank===0?d[0]:d[f*r+y]}return p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kle=Ao(t=>1/(1+Math.exp(-t))),KV=Et(lm,t=>1/(1+Math.exp(-t))),Xle={kernelName:lm,backendName:"cpu",kernelFunc:KV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XV(t,e,n,s,r){const i=$C(s,e,n),o=re(n),a=Ve(s);if(i){const h=AC(e,a);return r==="string"?t.slice(h,h+o):t.subarray(h,h+o)}const l=r==="string"?ia(t):t,u=tt(s,r,l),c=tt(n,r);for(let h=0;h<c.size;++h){const d=c.indexToLoc(h),p=d.map((f,m)=>f+e[m]);c.set(u.get(...p),...d)}return r==="string"?KF(c.values):c.values}function Gu(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,size:o}=s;Oe(r,"slice");const[a,l]=Wv(r,i,o);_C(r,a,l);const u=n.data.get(r.dataId).values,c=XV(u,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,c)}const Yle={kernelName:hv,backendName:"cpu",kernelFunc:Gu};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YV(t,e,n,s,r,i,o){const a=e[0],l=i[0],u=new Array(l),c=new Array(a),h=e[1];if(l===0){if(a!==0)throw new Error(PF(a));const v=yn(n,0),y=yn(r,0);return[v,[0,h],y,u,c]}let d=!0,p=0;const f=new Array(l).fill(0);for(let v=0;v<a;++v){const y=t[v*h];if(y<0)throw new Error(FF(v,y));if(y>=l)throw new Error(LF(v,y,l));++f[y],d=d&&y>=p,p=y}let m=!0;for(let v=0;v<l;++v){const y=f[v]===0;u[v]=y,m=m&&!y,f[v]=Math.max(f[v],1),v>0&&(f[v]+=f[v-1])}if(m&&d){const v=t,y=s;for(let w=0;w<a;++w)c[w]=w;return[v,[a,h],y,u,c]}else{const v=f[l-1],y=yn(n,v*h),w=yn(r,v),b=new Array(l).fill(0);for(let I=0;I<a;++I){const k=t[I*h],R=b[k],C=(k===0?0:f[k-1])+R;b[k]++;for(let T=0;T<h;++T)y[C*h+T]=t[I*h+T];w[C]=s[I],c[I]=C}for(let I=0;I<l;++I)if(b[I]===0){const R=I===0?0:f[I-1];y[R*h+0]=I;for(let C=1;C<h;++C)y[R*h+C]=0;w[R]=o}return[y,[v,h],w,u,c]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QV(t,e,n,s,r){const i=re(s),o=e[0],a=r.length,l=[];let u=1,c=-1;for(let v=0;v<a;++v){const y=r[v];if(y===-1){if(c!==-1)throw new Error(MF(c,v));c=v,l.push(1)}else{if(y<0)throw new Error(VF(v,y));u*=y,l.push(y)}}if(c!==-1){if(u<=0)throw new Error(zF());const v=Math.trunc(i/u);if(u*v!==i)throw new Error(BF(s,l));l[c]=v}if(re(l)!==i)throw new Error(UF(s,l));const d=s.length,p=[];if(d>0){p[d-1]=1;for(let v=d-2;v>=0;--v)p[v]=p[v+1]*s[v+1]}const f=[];if(a>0){f[a-1]=1;for(let v=a-2;v>=0;--v)f[v]=f[v+1]*l[v+1]}const m=yn(n,o*a);for(let v=0;v<o;++v){let y=0;for(let w=0;w<d;++w)y+=t[v*d+w]*p[w];for(let w=0;w<a;++w)m[v*a+w]=Math.trunc(y/f[w]),y%=f[w]}return[m,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ck(t,e,n,s,r,i=!1,o=0){const a=s.length,l=[e[0],t.length/e[0]],u=l[1],h=a>0?r[a-1]+1:0;if(h<0)throw new Error(mb());const d=e.slice();d[0]=h;const p=d.reduce((b,I)=>b*I,1),f=yn(n,p);if(a===0)return h>0&&f.fill(o),[f,d];if(h<=0)throw new Error(mb());let m=0,v=1,y=0,w=r[m];for(;;){let b=0;if(v<a){if(b=r[v],w===b){++v;continue}if(w>=b)throw new Error(WF())}if(w<0||w>=h)throw new Error(jF(w,h));w>y&&f.fill(o,y*u,w*u);for(let I=m;I<v;++I){const k=s[I];if(k<0||k>=l[0])throw new Error(GF(I,s[I],l[0]));for(let R=0;R<u;R++)f[w*u+R]+=t[k*u+R]}if(i)for(let I=0;I<u;I++)f[w*u+I]/=v-m;if(m=v,++v,y=w+1,w=b,v>a)break}return y<h&&f.fill(o,y*u,h*u),[f,d]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qle=Ao(t=>Math.sqrt(t)),Jle=Et(cm,t=>Math.sqrt(t)),Zle={kernelName:cm,backendName:"cpu",kernelFunc:Jle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JV=In((t,e)=>{const n=t-e;return n*n}),eue=Fn(hm,JV),tue={kernelName:hm,backendName:"cpu",kernelFunc:eue};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZV=Ao((t,e)=>{const{pattern:n,replaceGlobal:s,rewrite:r}=e;return t.replace(new RegExp(n,s?"g":""),r)}),nue=Ol(gv,ZV),sue={kernelName:gv,backendName:"cpu",kernelFunc:nue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e6(t,e,n,s){const r=tt(t,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*n[l]+s[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rue{constructor(e,n,s,r,i,o){this.separator=Ja(e),this.nGramWidths=n,this.leftPad=Ja(s),this.rightPad=Ja(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const s=this.getPadWidth(n);return Math.max(0,e+2*s-n+1)}createNGrams(e,n,s,r,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),u=Math.max(0,l-a),c=Math.max(0,l-(i-(a+1))),h=o-(u+c),d=n+(u>0?0:a-l);let p=0;p+=u*this.leftPad.length;for(let w=0;w<h;++w)p+=e[d+w].length;p+=c*this.rightPad.length;const f=u+c+h-1;p+=f*this.separator.length,s[r+a]=new Uint8Array(p);const m=s[r+a];let v=0;const y=w=>w.forEach(b=>m[v++]=b);for(let w=0;w<u;++w)y(this.leftPad),y(this.separator);for(let w=0;w<h-1;++w)y(e[d+w]),y(this.separator);if(h>0){y(e[d+h-1]);for(let w=0;w<c;++w)y(this.separator),y(this.rightPad)}else{for(let w=0;w<c-1;++w)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(e,n){const s=e.length,r=n.length;if(r>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let c=n[u]>=l;if(c=c&&n[u]<=s,!c)throw new Error(`Invalid split value ${n[u]}, must be in [${l}, ${s}]`);l=n[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,o=yn("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=i;++u)o[u]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const u=n[l]-n[l-1];let c=0;this.nGramWidths.forEach(h=>{c+=this.getNumNGrams(u,h)}),this.preserveShort&&u>0&&c===0&&(c=1),o[l]=o[l-1]+c}const a=new Array(o[i]);for(let l=0;l<i;++l){const u=n[l];let c=o[l];if(this.nGramWidths.forEach(h=>{const d=n[l+1]-n[l],p=this.getNumNGrams(d,h);this.createNGrams(e,u,a,c,p,h),c+=p}),this.preserveShort&&c===o[l]){const h=n[l+1]-n[l];if(h===0)continue;const d=h+2*this.padWidth;this.createNGrams(e,u,a,c,1,d)}}return[a,o]}}function t6(t,e,n,s,r,i,o,a){return new rue(n,s,r,i,o,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iue(t,e,n,s){if(!t.length)return;if(e.length===0){for(let i=0;i<t.length;++i)s.push(t.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=t.indexOf(i);for(;o!==-1;){const a=t.subarray(0,o);(!n||a.length!==0)&&s.push(a),t=t.subarray(o+1),o=t.indexOf(i)}(!n||t.length!==0)&&s.push(t);return}let r=0;for(let i=0;i<t.length+1;i++)if(i===t.length||e.indexOf(t[i])!==-1){const o=t.subarray(r,i);(!n||o.length!==0)&&s.push(o),r=i+1}}function n6(t,e,n){const s=t.length,r=[];let i=0,o=0;const a=new Array(s);for(let d=0;d<s;++d){const p=r.length;iue(t[d],e,n,r);const f=r.length-p;a[d]=f,i+=f,o=Math.max(o,f)}const l=yn("int32",i*2),u=new Array(i),c=[s,o];let h=0;for(let d=0;d<s;++d)for(let p=0;p<a[d];++p)l[h*2]=d,l[h*2+1]=p,u[h]=r[h],++h;return[l,u,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s6(t,e){const n=yn("int32",t.length);for(let s=0;s<t.length;++s)n[s]=gK(t[s]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r6=In((t,e)=>t-e),oue=bk((t,e,n,s)=>({real:t-n,imag:e-s})),kk=Fn(dm,r6,oue),aue={kernelName:dm,backendName:"cpu",kernelFunc:kk};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i6(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const s=tt(n,t.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(t.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%t.shape[l];const a=t.locToIndex(o);s.values[r]=t.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zd=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function o6(t,e,n=0,s=t.length-1){for(;s>n;){if(s-n>600){const a=s-n+1,l=e-n+1,u=Math.log(a),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(a-c)/a)*Math.sign(l-a/2),d=Math.max(n,Math.floor(e-l*c/a+h)),p=Math.min(s,Math.floor(e+(a-l)*c/a+h));o6(t,e,d,p)}const r=t[e];let i=n,o=s;for($c(t,n,e),Zd(t[s],r)>0&&$c(t,n,s);i<o;){for($c(t,i,o),i++,o--;Zd(t[i],r)<0;)i=i+1;for(;Zd(t[o],r)>0;)o=o-1}Zd(t[n],r)===0?$c(t,n,o):(o=o+1,$c(t,o,s)),o<=e&&(n=o+1),e<=o&&(s=o-1)}}function a6(t,e,n,s,r){const i=e[e.length-1],[o,a]=[t.length/i,i],l=ts(n,o*s),u=ts("int32",o*s);for(let h=0;h<o;h++){const d=h*a,p=t.subarray(d,d+a);let f=new Array(p.length);p.forEach((w,b)=>f[b]={value:w,index:b}),s<f.length&&(o6(f,s),f=f.slice(0,s)),r&&f.sort(Zd);const m=h*s,v=l.subarray(m,m+s),y=u.subarray(m,m+s);for(let w=0;w<s;w++)v[w]=f[w].value,y[w]=f[w].index}const c=e.slice();return c[c.length-1]=s,[tt(c,n,l),tt(c,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l6(t,e,n,s){const r=st(e,n)[0],i=[1,n[0],1];for(let f=0;f<r;f++)i[0]*=n[f];i[1]=n[r];for(let f=r+1;f<n.length;f++)i[2]*=n[f];const o=new Map,a=new Int32Array(n[r]),l=new Rn(i,s,t),u=[],c=i[0]===1&&i[2]===1;for(let f=0;f<n[r];f++){let m;if(c)m=t[f].toString();else{const y=[];for(let w=0;w<i[0];w++)for(let b=0;b<i[2];b++)y.push(l.get(w,f,b));m=y.join(",")}const v=o.get(m);if(v!=null)a[f]=v;else{const y=o.size;o.set(m,y),a[f]=y,u.push(f)}}const h=i.slice();h[1]=o.size;const d=new Rn(h,s);u.forEach((f,m)=>{for(let v=0;v<i[0];v++)for(let y=0;y<i[2];y++)d.set(l.get(v,f,y),v,m,y)});const p=n.slice();return p[r]=h[1],{outputValues:d.values,outputShape:p,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lue=Object.freeze(Object.defineProperty({__proto__:null,addImpl:yV,bincountImpl:Ik,bincountReduceImpl:vV,bitwiseAndImpl:wV,castImpl:gV,ceilImpl:xV,concatImpl:bV,equalImpl:IV,expImpl:TV,expm1Impl:kV,floorDivImpl:_V,floorImpl:EV,gatherNdImpl:NV,gatherV2Impl:$V,greaterEqualImpl:RV,greaterImpl:AV,lessEqualImpl:OV,lessImpl:DV,linSpaceImpl:PV,logImpl:FV,maxImpl:LV,maximumImpl:MV,minimumImpl:VV,multiplyImpl:Sk,negImpl:zV,notEqualImpl:BV,prodImpl:UV,raggedGatherImpl:WV,raggedRangeImpl:jV,raggedTensorToTensorImpl:GV,rangeImpl:HV,rsqrtImpl:qV,scatterImpl:hu,sigmoidImpl:Kle,simpleAbsImpl:mV,sliceImpl:XV,sparseFillEmptyRowsImpl:YV,sparseReshapeImpl:QV,sparseSegmentReductionImpl:Ck,sqrtImpl:Qle,squaredDifferenceImpl:JV,staticRegexReplaceImpl:ZV,stridedSliceImpl:e6,stringNGramsImpl:t6,stringSplitImpl:n6,stringToHashBucketFastImpl:s6,subImpl:r6,tileImpl:i6,topKImpl:a6,transposeImpl:Tk,uniqueImpl:l6},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */OO("cpu",()=>new sw,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u6=Et(Pf,t=>t>=0?t:Math.exp(t)-1),uue={kernelName:Pf,backendName:"cpu",kernelFunc:u6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c6(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:i}=s;Oe([r],"leakyRelu");const o=re(r.shape),a=n.data.get(r.dataId).values,l=ts("float32",o);for(let u=0;u<a.length;u++)l[u]=a[u]<0?i*a[u]:a[u];return n.makeTensorInfo(r.shape,"float32",l)}const cue={kernelName:V0,backendName:"cpu",kernelFunc:c6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hue=In((t,e)=>t<0?e*t:t);function h6(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e;Oe([s,r],"prelu");const i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,[a,l]=hue(s.shape,r.shape,i,o,"float32");return n.makeTensorInfo(l,"float32",a)}const due={kernelName:rv,backendName:"cpu",kernelFunc:h6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d6=Et(em,t=>Math.max(0,t)),pue={kernelName:em,backendName:"cpu",kernelFunc:d6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p6=Et(tm,t=>Math.min(Math.max(0,t),6)),fue={kernelName:tm,backendName:"cpu",kernelFunc:p6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $1(t,e,n,s,r){if(n==="linear")return _o({inputs:{x:e},backend:t});if(n==="relu")return d6({inputs:{x:e},backend:t});if(n==="elu")return u6({inputs:{x:e},backend:t});if(n==="relu6")return p6({inputs:{x:e},backend:t});if(n==="prelu")return h6({inputs:{x:e,alpha:s},backend:t});if(n==="leakyrelu")return c6({inputs:{x:e},backend:t,attrs:{alpha:r}});if(n==="sigmoid")return KV({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wt(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:i}=s,o=re(r.shape),a=aO(i,o),l=re(a);F(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),n.incRef(r.dataId);const u=n.data.get(r.dataId);if(u.complexTensorInfos!=null){const c=u.complexTensorInfos.real,h=u.complexTensorInfos.imag;c.shape=a,h.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const mue={kernelName:ov,backendName:"cpu",kernelFunc:Wt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f6(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;Oe([r,i],"matMul");const l=r.shape.length,u=i.shape.length,c=o?r.shape[l-2]:r.shape[l-1],h=a?i.shape[u-1]:i.shape[u-2],d=o?r.shape[l-1]:r.shape[l-2],p=a?i.shape[u-2]:i.shape[u-1],f=r.shape.slice(0,-2),m=i.shape.slice(0,-2),v=re(f),y=re(m),b=Qe(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,p]);F(c===h,()=>`Error in matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const I=o?[v,c,d]:[v,d,c],k=a?[y,p,h]:[y,h,p],R=Wt({inputs:{x:r},backend:n,attrs:{shape:I}}),C=Wt({inputs:{x:i},backend:n,attrs:{shape:k}}),T=o?R.shape[1]:R.shape[2],N=o?R.shape[2]:R.shape[1],$=a?C.shape[1]:C.shape[2],P=Math.max(v,y),V=n.data.get(R.dataId).values,O=n.data.get(C.dataId).values,Q=Ve(R.shape),Z=Ve(C.shape),[ne,le,q]=o?[Q[0],1,Q[1]]:[Q[0],Q[1],1],[J,ie,he]=a?[1,Z[1],Z[0]]:[Z[1],1,Z[0]],de=N*$,pe=tt([P,N,$],R.dtype),xe=pe.values,ye=n.blockSize;for(let Ie=0;Ie<P;Ie++){const $e=Ie%v,ze=Ie%y;for(let Me=0;Me<N;Me+=ye){const Ue=Math.min(Me+ye,N);for(let Ke=0;Ke<$;Ke+=ye){const Je=Math.min(Ke+ye,$);for(let nt=0;nt<T;nt+=ye){const _t=Math.min(nt+ye,T);for(let yt=Me;yt<Ue;yt++)for(let ht=Ke;ht<Je;ht++){let Nt=0;for(let St=nt;St<_t;St++){const Ot=V[$e*ne+yt*le+St*q],Pt=O[St*J+ht*ie+ze*he];Nt+=Ot*Pt}xe[Ie*de+(yt*$+ht)]+=Nt}}}}}return n.disposeIntermediateTensorInfo(R),n.disposeIntermediateTensorInfo(C),n.makeTensorInfo(b,pe.dtype,pe.values)}const gue={kernelName:S0,backendName:"cpu",kernelFunc:f6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yue(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=s;let d,p,f;const m=[];d=f6({inputs:{a:r,b:i},attrs:{transposeA:l,transposeB:u},backend:n}),o&&(p=Rh({inputs:{a:d,b:o},backend:n}),m.push(d),d=p),c&&(f=$1(n,d,c,a,h),m.push(d),d=f);for(const y of m)n.disposeIntermediateTensorInfo(y);return d}const vue={kernelName:l1,backendName:"cpu",kernelFunc:yue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wue=Et(If,t=>Math.acos(t)),xue={kernelName:If,backendName:"cpu",kernelFunc:wue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bue=Et(Sf,t=>Math.acosh(t)),Iue={kernelName:Sf,backendName:"cpu",kernelFunc:bue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sue(t){const{inputs:e,backend:n}=t,s=e;Oe(e,"addN");const r=s.map(a=>n.data.get(a.dataId).values),i=tt(s[0].shape,s[0].dtype),o=i.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<o.length;u++)o[u]+=l[u]}return n.makeTensorInfo(i.shape,i.dtype,i.values)}const Tue={kernelName:v0,backendName:"cpu",kernelFunc:Sue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cue(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;Oe(r,"all");const a=st(i,r.shape);let l=a;const u=on(l,r.shape.length);let c=r;u!=null&&(c=Js({inputs:{x:r},backend:n,attrs:{perm:u}}),l=xn(l.length,r.shape.length)),rs("all",l,c.shape.length);const[h,d]=Gn(c.shape,l),p=re(d),f=ws(re(h),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){const w=y*p;let b=m[w];for(let I=0;I<p;++I){const k=m[w+I];b=b&&k}f[y]=b}u!=null&&n.disposeIntermediateTensorInfo(c);const v=n.makeTensorInfo(h,c.dtype,f);if(o){const y=wn(h,a),w=Wt({inputs:{x:v},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(v),w}return v}const kue={kernelName:ES,backendName:"cpu",kernelFunc:Cue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eue(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;Oe(r,"any");const a=st(i,r.shape);let l=a;const u=on(l,r.shape.length);let c=r;u!=null&&(c=Js({inputs:{x:r},backend:n,attrs:{perm:u}}),l=xn(l.length,r.shape.length)),rs("any",l,c.shape.length);const[h,d]=Gn(c.shape,l),p=re(d),f=ws(re(h),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){const w=y*p;let b=m[w];for(let I=0;I<p;++I){const k=m[w+I];b=b||k}f[y]=b}u!=null&&n.disposeIntermediateTensorInfo(c);const v=n.makeTensorInfo(h,c.dtype,f);if(o){const y=wn(h,a),w=Wt({inputs:{x:v},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(v),w}return v}const _ue={kernelName:_S,backendName:"cpu",kernelFunc:Eue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nue(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;Oe(r,"argMax");let o=st(i,r.shape);const a=on(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Js({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),o=xn(o.length,l.shape.length)),o=[o[0]],rs("argMax",o,l.shape.length);const[c,h]=Gn(l.shape,o),d=re(c),p=ws(d,"int32"),f=re(h),m=n.data.get(l.dataId).values;for(let v=0;v<p.length;++v){const y=v*f;let w=m[y],b=0;for(let I=0;I<f;++I){const k=m[y+I];k>w&&(w=k,b=I)}p[v]=b}return u.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.makeTensorInfo(c,"int32",p)}const $ue={kernelName:w0,backendName:"cpu",kernelFunc:Nue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aue(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;Oe(r,"argMin");let o=st(i,r.shape);const a=on(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Js({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),o=xn(o.length,l.shape.length)),o=[o[0]],rs("argMin",o,l.shape.length);const[c,h]=Gn(l.shape,o),d=re(c),p=ws(d,"int32"),f=re(h),m=n.data.get(l.dataId).values;for(let v=0;v<p.length;++v){const y=v*f;let w=m[y],b=0;for(let I=0;I<f;++I){const k=m[y+I];k<w&&(w=k,b=I)}p[v]=b}return u.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.makeTensorInfo(c,"int32",p)}const Rue={kernelName:x0,backendName:"cpu",kernelFunc:Aue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Due=Et(Tf,t=>Math.asin(t)),Oue={kernelName:Tf,backendName:"cpu",kernelFunc:Due};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pue=Et(Cf,t=>Math.asinh(t)),Fue={kernelName:Cf,backendName:"cpu",kernelFunc:Pue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lue=Et(kf,t=>Math.atan(t)),Mue={kernelName:kf,backendName:"cpu",kernelFunc:Lue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vue=In((t,e)=>Math.atan2(t,e)),zue=Fn(_f,Vue),Bue={kernelName:_f,backendName:"cpu",kernelFunc:zue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uue=Et(Ef,t=>Math.atanh(t)),Wue={kernelName:Ef,backendName:"cpu",kernelFunc:Uue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ek(t,e,n,s,r,i){const o=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,f=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=tt(r.outShape,n),v=m.values,y=r.outShape[1]*r.outShape[2]*r.outShape[3],w=r.outShape[2]*r.outShape[3],b=r.outShape[3];for(let I=0;I<r.batchSize;++I){const k=I*y,R=I*s[0];for(let C=0;C<r.inChannels;++C)for(let T=0;T<r.outHeight;++T){const N=T*o-d,$=Math.max(0,N),P=Math.min(r.inHeight,c+N),V=k+T*w;for(let O=0;O<r.outWidth;++O){const Q=O*a-p,Z=Math.max(0,Q),ne=Math.min(r.inWidth,h+Q);let le=f,q=0,J=0;for(let he=$;he<P;he+=l){const de=R+he*s[1];for(let pe=Z;pe<ne;pe+=u){const xe=de+pe*s[2],ye=t[xe+C];i==="max"&&ye>le?le=ye:i==="avg"&&(q+=ye,J++)}if(isNaN(le))break}const ie=V+O*b+C;v[ie]=i==="avg"?q/J:le}}}return m}function m6(t,e,n,s,r=!1,i=!1){const o=tt(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,c=s.dilationWidth,h=s.effectiveFilterHeight,d=s.effectiveFilterWidth,p=s.padInfo.top,f=s.padInfo.left,m=tt(e,n,t);for(let v=0;v<s.batchSize;++v)for(let y=0;y<s.inChannels;++y)for(let w=0;w<s.outHeight;++w){const b=w*a-p;let I=b;for(;I<0;)I+=u;const k=Math.min(s.inHeight,h+b);for(let R=0;R<s.outWidth;++R){const C=R*l-f;let T=C;for(;T<0;)T+=c;const N=Math.min(s.inWidth,d+C);let $=Number.NEGATIVE_INFINITY,P=-1;for(let V=I;V<k;V+=u){const O=V-b;for(let Q=T;Q<N;Q+=c){const Z=Q-C,ne=m.get(v,V,Q,y);ne>$&&($=ne,r?P=i?((v*s.inHeight+V)*s.inWidth+Q)*s.inChannels+y:(V*s.inWidth+Q)*s.inChannels+y:P=O*d+Z)}}o.set(P,v,w,R,y)}}return o}function g6(t,e,n,s,r,i){const o=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,h=r.dilationWidth,d=r.effectiveFilterDepth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,m=r.padInfo.front,v=r.padInfo.top,y=r.padInfo.left,w=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=tt(r.outShape,n),I=b.values,k=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],R=r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[3]*r.outShape[4],T=r.outShape[4];for(let N=0;N<r.batchSize;++N){const $=N*k,P=N*s[0];for(let V=0;V<r.inChannels;++V)for(let O=0;O<r.outDepth;++O){const Q=O*o-m;let Z=Q;for(;Z<0;)Z+=u;const ne=Math.min(r.inDepth,d+Q),le=$+O*R;for(let q=0;q<r.outHeight;++q){const J=q*a-v;let ie=J;for(;ie<0;)ie+=c;const he=Math.min(r.inHeight,p+J),de=le+q*C;for(let pe=0;pe<r.outWidth;++pe){const xe=pe*l-y;let ye=xe;for(;ye<0;)ye+=h;const Ie=Math.min(r.inWidth,f+xe),$e=de+pe*T;let ze=w,Me=0,Ue=0;for(let Je=Z;Je<ne;Je+=u){const nt=P+Je*s[1];for(let _t=ie;_t<he;_t+=c){const yt=nt+_t*s[2];for(let ht=ye;ht<Ie;ht+=h){const Nt=yt+ht*s[3],St=t[Nt+V];if(i==="max"&&St>ze?ze=St:i==="avg"&&(Me+=St,Ue++),isNaN(ze))break}if(isNaN(ze))break}if(isNaN(ze))break}const Ke=$e+V;I[Ke]=i==="avg"?Me/Math.max(Ue,1):ze}}}}return b}function jue(t,e){const n=tt(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,p=e.padInfo.top,f=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let v=0;v<e.inChannels;++v)for(let y=0;y<e.outDepth;++y){const w=y*s-d;let b=w;for(;b<0;)b+=o;const I=Math.min(e.inDepth,u+w);for(let k=0;k<e.outHeight;++k){const R=k*r-p;let C=R;for(;C<0;)C+=a;const T=Math.min(e.inHeight,c+R);for(let N=0;N<e.outWidth;++N){const $=N*i-f;let P=$;for(;P<0;)P+=l;const V=Math.min(e.inWidth,h+$);let O=Number.NEGATIVE_INFINITY,Q=-1;for(let Z=b;Z<I;Z+=o){const ne=Z-w;for(let le=C;le<T;le+=a){const q=le-R;for(let J=P;J<V;J+=l){const ie=J-$,he=t.get(m,Z,le,J,v);he>=O&&(O=he,Q=ne*c*h+q*c+ie)}}}n.set(Q,m,y,k,N,v)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gue(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Oe(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;F(ss(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=pi(r.shape,i,o,u,a,l);let h;if(c.filterWidth===1&&c.filterHeight===1&&ut(c.inShape,c.outShape))h=_o({inputs:{x:r},backend:n});else{const d=n.data.get(r.dataId).values,p=Ve(r.shape),f=Ek(d,r.shape,r.dtype,p,c,"avg");h=n.makeTensorInfo(c.outShape,r.dtype,f.values)}return h}const Hue={kernelName:b0,backendName:"cpu",kernelFunc:Gue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function que(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;Oe(r,"avgPool3d");const c=ua(r.shape,i,o,1,a,l,u),h=n.data.get(r.dataId).values,d=g6(h,r.shape,r.dtype,Ve(r.shape),c,"avg");return n.makeTensorInfo(d.shape,"float32",d.values)}const Kue={kernelName:I0,backendName:"cpu",kernelFunc:que};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xue(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;Oe([r,i],"avgPool3DGrad");const c=ua(i.shape,o,a,1,l,u),h=c.strideDepth,d=c.strideHeight,p=c.strideWidth,f=c.filterDepth,m=c.filterHeight,v=c.filterWidth,y=c.dilationDepth,w=c.dilationHeight,b=c.dilationWidth,I=c.effectiveFilterDepth,k=c.effectiveFilterHeight,R=c.effectiveFilterWidth,C=I-1-c.padInfo.front,T=R-1-c.padInfo.left,N=k-1-c.padInfo.top,$=tt(i.shape,"float32"),P=1/(f*m*v),V=n.bufferSync(r);for(let O=0;O<c.batchSize;++O)for(let Q=0;Q<c.inChannels;++Q)for(let Z=0;Z<c.inDepth;++Z)for(let ne=0;ne<c.inHeight;++ne)for(let le=0;le<c.inWidth;++le){const q=Z-C,J=ne-N,ie=le-T;let he=0;for(let de=0;de<I;de+=y){const pe=(q+de)/h;if(!(pe<0||pe>=c.outDepth||Math.floor(pe)!==pe))for(let xe=0;xe<k;xe+=w){const ye=(J+xe)/d;if(!(ye<0||ye>=c.outHeight||Math.floor(ye)!==ye))for(let Ie=0;Ie<R;Ie+=b){const $e=(ie+Ie)/p;if($e<0||$e>=c.outWidth||Math.floor($e)!==$e)continue;const ze=V.get(O,pe,ye,$e,Q);he+=ze}}}$.set(he*P,O,Z,ne,le,Q)}return n.makeTensorInfo($.shape,$.dtype,$.values)}const Yue={kernelName:$S,backendName:"cpu",kernelFunc:Xue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Que(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i;Oe([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,c=pi(o.shape,a,l,1,u),h=c.strideHeight,d=c.strideWidth,p=c.filterHeight,f=c.filterWidth,m=c.dilationHeight,v=c.dilationWidth,y=c.effectiveFilterHeight,w=c.effectiveFilterWidth,b=w-1-c.padInfo.left,I=y-1-c.padInfo.top,k=tt(o.shape,"float32"),R=1/(p*f),C=n.data.get(r.dataId).values,T=tt(r.shape,"float32",C);for(let N=0;N<c.batchSize;++N)for(let $=0;$<c.inChannels;++$)for(let P=0;P<c.inHeight;++P)for(let V=0;V<c.inWidth;++V){const O=P-I,Q=V-b;let Z=0;for(let ne=0;ne<y;ne+=m){const le=(O+ne)/h;if(!(le<0||le>=c.outHeight||Math.floor(le)!==le))for(let q=0;q<w;q+=v){const J=(Q+q)/d;if(J<0||J>=c.outWidth||Math.floor(J)!==J)continue;const ie=T.get(N,le,J,$);Z+=ie}}k.set(Z*R,N,P,V,$)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const Jue={kernelName:NS,backendName:"cpu",kernelFunc:Que};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zue(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,scale:i,offset:o,mean:a,variance:l}=e;F(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),F(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),F(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Oe([r,a,l,i,o],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const c=n.data.get(r.dataId).values,h=n.data.get(a.dataId).values,d=n.data.get(l.dataId).values,p=i?n.data.get(i.dataId).values:new Float32Array([1]),f=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(c.length),v=f.length,y=p.length,w=d.length,b=h.length;let I=0,k=0,R=0,C=0;for(let T=0;T<c.length;++T)m[T]=f[I++]+(c[T]-h[k++])*p[R++]/Math.sqrt(d[C++]+u),I>=v&&(I=0),k>=b&&(k=0),R>=y&&(R=0),C>=w&&(C=0);return n.makeTensorInfo(r.shape,r.dtype,m)}const ece={kernelName:F0,backendName:"cpu",kernelFunc:Zue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,crops:o}=s;Oe([r],"batchToSpaceND");const a=i.reduce((y,w)=>y*w),l=Cm(r.shape,i,a),u=km(l.length,i.length),c=Em(r.shape,i,a),h=FC(o,i.length),d=LC(c,o,i.length),p=Wt({inputs:{x:r},backend:n,attrs:{shape:l}}),f=Js({inputs:{x:p},backend:n,attrs:{perm:u}}),m=Wt({inputs:{x:f},backend:n,attrs:{shape:c}}),v=Gu({inputs:{x:m},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}const nce={kernelName:T0,backendName:"cpu",kernelFunc:tce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o}=s,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,u=Ik(a,l,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}const rce={kernelName:AS,backendName:"cpu",kernelFunc:sce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ice(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,a=Qe(Array.from(i),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const oce={kernelName:RS,backendName:"cpu",kernelFunc:ice};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ace=Et(Af,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),lce={kernelName:Af,backendName:"cpu",kernelFunc:ace};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uce=t=>{const{x:e}=t.inputs,n=t.backend,s=new Float32Array(re(e.shape)),r=n.data.get(e.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values;for(let u=0;u<a.length;u++){const c=a[u],h=l[u];s[u]=Math.hypot(c,h)}return n.makeOutput(s,e.shape,"float32")},cce={kernelName:k0,backendName:"cpu",kernelFunc:uce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dh(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.imag,i=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,i)}const hce={kernelName:QS,backendName:"cpu",kernelFunc:Dh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oh(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,i=st(r,e[0].shape)[0],o=e.map(m=>m.shape);DC(o,i);let a=xo(e.map(m=>m.shape),i);if(re(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(m=>re(m.shape)>0);if(l.length===1)return _o({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){const m=l.map(I=>ju({inputs:{input:I},backend:n})),v=l.map(I=>Dh({inputs:{input:I},backend:n})),y=Oh({inputs:m,backend:n,attrs:{axis:i}}),w=Oh({inputs:v,backend:n,attrs:{axis:i}}),b=lr({inputs:{real:y,imag:w},backend:n});return m.forEach(I=>n.disposeIntermediateTensorInfo(I)),v.forEach(I=>n.disposeIntermediateTensorInfo(I)),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(w),b}const u=l.map(m=>{const y=[-1,re(m.shape.slice(i))];return Wt({inputs:{x:m},backend:n,attrs:{shape:y}})}),c=u.map(m=>({vals:n.data.get(m.dataId).values,shape:m.shape}));a=xo(u.map(m=>m.shape),1);const h=u[0].shape[0]===1,d=bV(c,a,e[0].dtype,h),p=xo(l.map(m=>m.shape),i),f=n.makeTensorInfo(p,e[0].dtype,d);return u.forEach(m=>n.disposeIntermediateTensorInfo(m)),f}const dce={kernelName:E0,backendName:"cpu",kernelFunc:Oh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y6(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=s;Oe([r,i],"conv2d");const h=ca(l),d=jn(r.shape,i.shape,o,u,a,c,!1,h),p=d.filterHeight,f=d.filterWidth,m=d.dilationHeight,v=d.dilationWidth,y=d.padInfo.left,w=d.padInfo.top,b=d.dataFormat==="channelsLast",I=new Rn(d.outShape,r.dtype),k=Ve(r.shape),R=Ve(i.shape),C=k[0],T=b?k[1]:k[2],N=b?k[2]:1,$=b?1:k[1],P=I.strides[0],V=b?I.strides[1]:I.strides[2],O=b?I.strides[2]:1,Q=b?1:I.strides[1],Z=n.data.get(r.dataId).values,ne=n.data.get(i.dataId).values,le=I.values;for(let q=0;q<d.batchSize;++q){const J=q*C,ie=q*P;for(let he=0;he<d.outHeight;++he){const de=ie+he*V,pe=he*d.strideHeight-w;for(let xe=0;xe<p;++xe){const ye=pe+xe*m;if(ye<0||ye>=d.inHeight)continue;const Ie=xe*R[0],$e=J+ye*T;for(let ze=0;ze<d.outWidth;++ze){const Me=de+ze*O,Ue=ze*d.strideWidth-y;for(let Ke=0;Ke<f;++Ke){const Je=Ue+Ke*v;if(Je<0||Je>=d.inWidth)continue;const nt=Ie+Ke*R[1],_t=$e+Je*N;let yt=nt;for(let ht=0;ht<d.inChannels;++ht){const Nt=Z[_t+ht*$];for(let St=0;St<d.outChannels;++St)le[Me+St*Q]+=Nt*ne[yt+St];yt+=d.outChannels}}}}}}return n.makeTensorInfo(I.shape,I.dtype,le)}const pce={kernelName:_0,backendName:"cpu",kernelFunc:y6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=s;Oe([r,i],"conv2dBackpropFilter");const h=ca(l),d=jn(r.shape,c,o,1,a,u,!1,h),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:v}=d,y=d.dataFormat==="channelsLast",w=new Rn(d.filterShape,"float32"),b=d.padInfo.left,I=d.padInfo.top,k=n.data.get(r.dataId).values,R=n.data.get(i.dataId).values,C=new Rn(r.shape,r.dtype,k),T=new Rn(i.shape,i.dtype,R);for(let N=0;N<m;++N){const $=Math.max(0,Math.ceil((I-N)/p)),P=Math.min(d.outHeight,(d.inHeight+I-N)/p);for(let V=0;V<v;++V){const O=Math.max(0,Math.ceil((b-V)/f)),Q=Math.min(d.outWidth,(d.inWidth+b-V)/f);for(let Z=0;Z<d.inChannels;++Z)for(let ne=0;ne<d.outChannels;++ne){let le=0;for(let q=0;q<d.batchSize;++q)for(let J=$;J<P;++J){const ie=N+J*p-I;for(let he=O;he<Q;++he){const de=V+he*f-b;y?le+=C.get(q,ie,de,Z)*T.get(q,J,he,ne):le+=C.get(q,Z,ie,de)*T.get(q,ne,J,he)}}w.set(le,N,V,Z,ne)}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const mce={kernelName:OS,backendName:"cpu",kernelFunc:fce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gce(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=s;Oe([r,i],"conv2dBackpropInput");const h=Ve(i.shape),d=Ve(r.shape);let p=ca(u);const f=jn(o,i.shape,a,1,l,c,!1,p),m=new Rn(f.inShape,"float32"),v=m.values,y=n.data.get(r.dataId).values,w=n.data.get(i.dataId).values,[b,I,k]=h,{batchSize:R,filterHeight:C,filterWidth:T,inChannels:N,inHeight:$,inWidth:P,outChannels:V,outHeight:O,outWidth:Q,strideHeight:Z,strideWidth:ne}=f;p=f.dataFormat;const le=C-1-f.padInfo.top,q=T-1-f.padInfo.left,J=p==="channelsLast",ie=m.strides[0],he=J?m.strides[1]:m.strides[2],de=J?m.strides[2]:1,pe=J?1:m.strides[1],xe=d[0],ye=J?d[1]:d[2],Ie=J?d[2]:1,$e=J?1:d[1];for(let ze=0;ze<R;++ze)for(let Me=0;Me<N;++Me)for(let Ue=0;Ue<$;++Ue){const Ke=Ue-le,Je=Math.max(0,Math.ceil(Ke/Z)),nt=Math.min(O,(C+Ke)/Z);for(let _t=0;_t<P;++_t){const yt=_t-q,ht=Math.max(0,Math.ceil(yt/ne)),Nt=Math.min(Q,(T+yt)/ne);let St=0;for(let Pt=Je;Pt<nt;++Pt){const tr=Pt*Z-Ke;for(let Ln=ht;Ln<Nt;++Ln){const Mn=Ln*ne-yt,Hn=xe*ze+ye*Pt+Ie*Ln,Vs=b*(C-1-tr)+I*(T-1-Mn)+k*Me;for(let Tt=0;Tt<V;++Tt){const $t=y[Hn+$e*Tt],zs=w[Vs+Tt];St+=$t*zs}}}const Ot=ie*ze+he*Ue+de*_t+pe*Me;v[Ot]=St}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const yce={kernelName:N0,backendName:"cpu",kernelFunc:gce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s;Oe([r,i],"conv3d");const u=_l(r.shape,i.shape,o,l,a),{filterDepth:c,filterHeight:h,filterWidth:d,dilationDepth:p,dilationHeight:f,dilationWidth:m,padInfo:v}=u,y=v.front,w=v.left,b=v.top,I=new Rn(u.outShape,r.dtype),k=n.data.get(r.dataId).values,R=n.data.get(i.dataId).values,C=I.values,T=Ve(r.shape),N=Ve(i.shape);for(let $=0;$<u.batchSize;++$){const P=$*T[0],V=$*I.strides[0];for(let O=0;O<u.outDepth;++O){const Q=V+O*I.strides[1],Z=O*u.strideDepth-y;for(let ne=0;ne<c;++ne){const le=Z+ne*p;if(le<0||le>=u.inDepth)continue;const q=ne*N[0],J=P+le*T[1];for(let ie=0;ie<u.outHeight;++ie){const he=Q+ie*I.strides[2],de=ie*u.strideHeight-b;for(let pe=0;pe<h;++pe){const xe=de+pe*f;if(xe<0||xe>=u.inHeight)continue;const ye=q+pe*N[1],Ie=J+xe*T[2];for(let $e=0;$e<u.outWidth;++$e){const ze=he+$e*u.outChannels,Me=$e*u.strideWidth-w;for(let Ue=0;Ue<d;++Ue){const Ke=Me+Ue*m;if(Ke<0||Ke>=u.inWidth)continue;const Je=ye+Ue*N[2],nt=Ie+Ke*u.inChannels;let _t=Je;for(let yt=0;yt<u.inChannels;++yt){const ht=k[nt+yt];for(let Nt=0;Nt<u.outChannels;++Nt)C[ze+Nt]+=ht*R[_t+Nt];_t+=u.outChannels}}}}}}}}return n.makeTensorInfo(I.shape,I.dtype,I.values)}const wce={kernelName:$0,backendName:"cpu",kernelFunc:vce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s;Oe([r,i],"conv3dBackpropFilterV2");const u=Ve(r.shape),c=Ve(i.shape),h=_l(r.shape,l,o,1,a),d=h.strideDepth,p=h.strideHeight,f=h.strideWidth,m=h.filterDepth,v=h.filterHeight,y=h.filterWidth,w=new Rn(h.filterShape,"float32"),b=w.values,[I,k,R,C]=w.strides,T=n.data.get(i.dataId).values,[N,$,P,V]=c,O=n.data.get(r.dataId).values,[Q,Z,ne,le]=u,q=h.padInfo.front,J=h.padInfo.left,ie=h.padInfo.top;for(let he=0;he<m;++he){const de=Math.max(0,Math.ceil((q-he)/d)),pe=Math.min(h.outDepth,(h.inDepth+q-he)/d),xe=he*I;for(let ye=0;ye<v;++ye){const Ie=Math.max(0,Math.ceil((ie-ye)/p)),$e=Math.min(h.outHeight,(h.inHeight+ie-ye)/p),ze=ye*k+xe;for(let Me=0;Me<y;++Me){const Ue=Math.max(0,Math.ceil((J-Me)/f)),Ke=Math.min(h.outWidth,(h.inWidth+J-Me)/f),Je=Me*R+ze;for(let nt=0;nt<h.inChannels;++nt){const _t=nt*C+Je;for(let yt=0;yt<h.outChannels;++yt){let ht=0;for(let Nt=0;Nt<h.batchSize;++Nt){const St=Nt*Q,Ot=Nt*N;for(let Pt=de;Pt<pe;++Pt){const Ln=(he+Pt*d-q)*Z+St,Mn=Pt*$+Ot;for(let Hn=Ie;Hn<$e;++Hn){const Tt=(ye+Hn*p-ie)*ne+Ln,$t=Hn*P+Mn;for(let zs=Ue;zs<Ke;++zs){const fa=(Me+zs*f-J)*le+Tt,Qi=zs*V+$t;ht+=O[fa+nt]*T[Qi+yt]}}}}b[_t+yt]=ht}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const bce={kernelName:PS,backendName:"cpu",kernelFunc:xce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ice(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s;Oe([r],"conv3dBackpropInputV2");const u=Ve(r.shape),c=Ve(i.shape),h=_l(l,i.shape,a,1,o),d=new Rn(h.inShape,"float32"),p=d.values,[f,m,v,y]=d.strides,w=n.data.get(r.dataId).values,[b,I,k,R]=u,C=n.data.get(i.dataId).values,[T,N,$,P]=c,{batchSize:V,filterDepth:O,filterHeight:Q,filterWidth:Z,inChannels:ne,inDepth:le,inHeight:q,inWidth:J,outChannels:ie,outDepth:he,outHeight:de,outWidth:pe,strideDepth:xe,strideHeight:ye,strideWidth:Ie}=h,$e=O-1-h.padInfo.front,ze=Q-1-h.padInfo.top,Me=Z-1-h.padInfo.left;for(let Ue=0;Ue<V;++Ue)for(let Ke=0;Ke<ne;++Ke)for(let Je=0;Je<le;++Je){const nt=Je-$e,_t=Math.max(0,Math.ceil(nt/xe)),yt=Math.min(he,(O+nt)/xe);for(let ht=0;ht<q;++ht){const Nt=ht-ze,St=Math.max(0,Math.ceil(Nt/ye)),Ot=Math.min(de,(Q+Nt)/ye);for(let Pt=0;Pt<J;++Pt){const tr=Pt-Me,Ln=Math.max(0,Math.ceil(tr/Ie)),Mn=Math.min(pe,(Z+tr)/Ie);let Hn=0;for(let Vs=_t;Vs<yt;++Vs){const Tt=Vs*xe-nt;for(let $t=St;$t<Ot;++$t){const zs=$t*ye-Nt;for(let Bs=Ln;Bs<Mn;++Bs){const fa=Bs*Ie-tr,Qi=b*Ue+I*Vs+k*$t+R*Bs,Ji=T*(O-1-Tt)+N*(Q-1-zs)+$*(Z-1-fa)+P*Ke;for(let Zi=0;Zi<ie;++Zi){const eo=w[Qi+Zi],gi=C[Ji+Zi];Hn+=eo*gi}}}}p[f*Ue+m*Je+v*ht+y*Pt+Ke]=Hn}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}const Sce={kernelName:FS,backendName:"cpu",kernelFunc:Ice};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tce=Et(Rf,t=>Math.cos(t)),Cce={kernelName:Rf,backendName:"cpu",kernelFunc:Tce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kce=Et(Df,t=>Math.cosh(t)),Ece={kernelName:Df,backendName:"cpu",kernelFunc:kce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ce(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[c,h,d,p]=r.shape,f=i.shape[0],[m,v]=a,y=tt([f,m,v,p],"float32"),w=n.data.get(i.dataId).values,b=n.data.get(o.dataId).values,I=n.data.get(r.dataId).values,k=Ve(r.shape),R=Ve(y.shape);for(let C=0;C<f;C++){const T=C*4,N=w[T],$=w[T+1],P=w[T+2],V=w[T+3],O=b[C];if(O>=c)continue;const Q=m>1?(P-N)*(h-1)/(m-1):0,Z=v>1?(V-$)*(d-1)/(v-1):0;for(let ne=0;ne<m;ne++){const le=m>1?N*(h-1)+ne*Q:.5*(N+P)*(h-1);if(le<0||le>h-1){for(let q=0;q<v;q++)for(let J=0;J<p;J++){const ie=J+q*R[2]+ne*R[1]+C*R[0];y.values[ie]=u}continue}if(l==="bilinear"){const q=Math.floor(le),J=Math.ceil(le),ie=le-q;for(let he=0;he<v;he++){const de=v>1?$*(d-1)+he*Z:.5*($+V)*(d-1);if(de<0||de>d-1){for(let Ie=0;Ie<p;Ie++){const $e=Ie+he*R[2]+ne*R[1]+C*R[0];y.values[$e]=u}continue}const pe=Math.floor(de),xe=Math.ceil(de),ye=de-pe;for(let Ie=0;Ie<p;Ie++){let $e=Ie+pe*k[2]+q*k[1]+O*k[0];const ze=I[$e];$e=Ie+xe*k[2]+q*k[1]+O*k[0];const Me=I[$e];$e=Ie+pe*k[2]+J*k[1]+O*k[0];const Ue=I[$e];$e=Ie+xe*k[2]+J*k[1]+O*k[0];const Ke=I[$e],Je=ze+(Me-ze)*ye,nt=Ue+(Ke-Ue)*ye;$e=Ie+he*R[2]+ne*R[1]+C*R[0],y.values[$e]=Je+(nt-Je)*ie}}}else for(let q=0;q<v;++q){const J=v>1?$*(d-1)+q*Z:.5*($+V)*(d-1);if(J<0||J>d-1){for(let de=0;de<p;de++){const pe=de+q*R[2]+ne*R[1]+C*R[0];y.values[pe]=u}continue}const ie=Math.round(J),he=Math.round(le);for(let de=0;de<p;de++){const pe=de+ie*k[2]+he*k[1]+O*k[0],xe=de+q*R[2]+ne*R[1]+C*R[0];y.values[xe]=I[pe]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const Nce={kernelName:MS,backendName:"cpu",kernelFunc:_ce};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;Oe(r,"cumprod");const l=on([i],r.shape.length);let u=r;l!=null&&(u=Js({inputs:{x:r},backend:n,attrs:{perm:l}}));const c=xn(1,r.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const h=vr(u.dtype,"int32"),d=CS(re(u.shape),h),p=n.data.get(u.dataId).values,f=u.shape[u.shape.length-1],m=a?(y,w)=>y+f-w-1:(y,w)=>y+w;for(let y=0;y<p.length;y+=f)for(let w=0;w<f;w++){const b=m(y,w);if(w===0)d[b]=o?1:p[b];else{const I=m(y,w-1);d[b]=o?p[I]*d[I]:p[b]*d[I]}}const v=n.makeTensorInfo(u.shape,h,d);if(l!=null){const y=Nl(l),w=Js({inputs:{x:v},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(u),w}return v}const Ace={kernelName:LS,backendName:"cpu",kernelFunc:$ce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;Oe(r,"cumsum");const l=on([i],r.shape.length);let u=r;l!=null&&(u=Js({inputs:{x:r},backend:n,attrs:{perm:l}}));const c=xn(1,r.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const h=vr(u.dtype,"int32"),d=ws(re(u.shape),h),p=n.data.get(u.dataId).values,f=u.shape[u.shape.length-1],m=a?(y,w)=>y+f-w-1:(y,w)=>y+w;for(let y=0;y<p.length;y+=f)for(let w=0;w<f;w++){const b=m(y,w);if(w===0)d[b]=o?0:p[b];else{const I=m(y,w-1);d[b]=o?p[I]+d[I]:p[b]+d[I]}}const v=n.makeTensorInfo(u.shape,h,d);if(l!=null){const y=Nl(l),w=Js({inputs:{x:v},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(u),w}return v}const Dce={kernelName:A0,backendName:"cpu",kernelFunc:Rce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,c=Ik(l,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}else if(r.shape.length===2){const l=n.bufferSync(r),u=n.bufferSync(i),c=vV(l,u,o,a);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Pce={kernelName:VS,backendName:"cpu",kernelFunc:Oce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:i,dataFormat:o}=s;F(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],c=r.shape[3],h=l*i,d=u*i,p=c/(i*i),f=n.data.get(r.dataId).values,m=new Float32Array(a*h*d*p);let v=0;for(let y=0;y<a;++y)for(let w=0;w<h;++w){const b=Math.floor(w/i),I=w%i;for(let k=0;k<d;++k){const R=Math.floor(k/i),C=k%i,T=(I*i+C)*p;for(let N=0;N<p;++N){const P=N+T+c*(R+u*(b+l*y));m[v++]=f[P]}}}return n.makeTensorInfo([a,h,d,p],r.dtype,m)}const Lce={kernelName:zS,backendName:"cpu",kernelFunc:Fce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v6(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;Oe([r,i],"depthwiseConv2DNative");const c=Ve(r.shape),h=Ve(i.shape);let d=l;d==null&&(d=[1,1]),F(ss(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const p=jn(r.shape,i.shape,o,d,a,u,!0),{filterHeight:f,filterWidth:m,dilationHeight:v,dilationWidth:y,padInfo:w}=p,b=w.left,I=w.top,k=p.outChannels/p.inChannels,R=new Rn(p.outShape,r.dtype),C=n.data.get(r.dataId).values,T=n.data.get(i.dataId).values,N=R.values;for(let $=0;$<p.batchSize;++$){const P=$*c[0],V=$*R.strides[0];for(let O=0;O<p.outHeight;++O){const Q=V+O*R.strides[1],Z=O*p.strideHeight-I;for(let ne=0;ne<f;++ne){const le=Z+ne*v;if(le<0||le>=p.inHeight)continue;const q=ne*h[0],J=P+le*c[1];for(let ie=0;ie<p.outWidth;++ie){const he=Q+ie*R.strides[2],de=ie*p.strideWidth-b;for(let pe=0;pe<m;++pe){const xe=de+pe*y;if(xe<0||xe>=p.inWidth)continue;const ye=q+pe*h[1],Ie=J+xe*p.inChannels;let $e=he,ze=ye;for(let Me=0;Me<p.inChannels;++Me){const Ue=C[Ie+Me];for(let Ke=0;Ke<k;++Ke)N[$e+Ke]+=Ue*T[ze+Ke];$e+=k,ze+=k}}}}}}return n.makeTensorInfo(R.shape,R.dtype,R.values)}const Mce={kernelName:R0,backendName:"cpu",kernelFunc:v6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=s;Oe([r,i],"depthwiseConv2dNativeBackpropFilter");const h=jn(r.shape,c,o,a,l,u,!0),{strideHeight:d,strideWidth:p,filterHeight:f,filterWidth:m}=h,v=new Rn(h.filterShape,"float32"),y=h.padInfo.left,w=h.padInfo.top,b=h.outChannels/h.inChannels,I=n.data.get(r.dataId).values,k=new Rn(r.shape,r.dtype,I),R=n.data.get(i.dataId).values,C=new Rn(i.shape,i.dtype,R);for(let T=0;T<f;++T){const N=Math.max(0,Math.ceil((w-T)/d)),$=Math.min(h.outHeight,(h.inHeight+w-T)/d);for(let P=0;P<m;++P){const V=Math.max(0,Math.ceil((y-P)/p)),O=Math.min(h.outWidth,(h.inWidth+y-P)/p);for(let Q=0;Q<h.outChannels;++Q){const Z=Math.trunc(Q/b),ne=Q%b;let le=0;for(let q=0;q<h.batchSize;++q)for(let J=N;J<$;++J){const ie=T+J*d-w;for(let he=V;he<O;++he){const de=P+he*p-y;le+=k.get(q,ie,de,Z)*C.get(q,J,he,Q)}}v.set(le,T,P,Z,ne)}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const zce={kernelName:BS,backendName:"cpu",kernelFunc:Vce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bce(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=s;Oe([r,i],"depthwiseConv2DNativeBackpropInput");const h=Ve(r.shape),d=Ve(i.shape),p=jn(c,i.shape,o,a,l,u,!0),f=new Rn(p.inShape,"float32"),m=f.values,[v,y,w]=f.strides,b=n.data.get(r.dataId).values,[I,k,R]=h,C=n.data.get(i.dataId).values,[T,N,$]=d,{batchSize:P,filterHeight:V,filterWidth:O,inChannels:Q,inHeight:Z,inWidth:ne,outChannels:le,outHeight:q,outWidth:J,strideHeight:ie,strideWidth:he}=p,de=V-1-p.padInfo.top,pe=O-1-p.padInfo.left,xe=le/Q;for(let ye=0;ye<P;++ye)for(let Ie=0;Ie<Q;++Ie)for(let $e=0;$e<Z;++$e){const ze=$e-de,Me=Math.max(0,Math.ceil(ze/ie)),Ue=Math.min(q,(V+ze)/ie);for(let Ke=0;Ke<ne;++Ke){const Je=Ke-pe,nt=Math.max(0,Math.ceil(Je/he)),_t=Math.min(J,(O+Je)/he);let yt=0;for(let ht=Me;ht<Ue;++ht){const Nt=ht*ie-ze;for(let St=nt;St<_t;++St){const Ot=St*he-Je,Pt=I*ye+k*ht+R*St,tr=T*(V-1-Nt)+N*(O-1-Ot)+$*Ie;for(let Ln=0;Ln<xe;++Ln){const Mn=Ie*xe+Ln,Hn=b[Pt+Mn],Vs=C[tr+Ln];yt+=Hn*Vs}}}m[v*ye+y*$e+w*Ke+Ie]=yt}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}const Uce={kernelName:US,backendName:"cpu",kernelFunc:Bce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wce(t){const{inputs:e,backend:n}=t,{x:s}=e,r=re(s.shape),i=n.data.get(s.dataId).values,o=tt([r,r],s.dtype),a=o.values;for(let u=0;u<i.length;u++)a[u*r+u]=i[u];const l=[...s.shape,...s.shape];return n.makeTensorInfo(l,o.dtype,o.values)}const jce={kernelName:WS,backendName:"cpu",kernelFunc:Wce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gce={kernelName:D0,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r}=t,{strides:i,pad:o,dilations:a}=n,l=e,u=l.data.get(s.dataId).values,c=s.shape.length,h=l.data.get(r.dataId).values,d=r.shape.length,{batchSize:p,inHeight:f,inWidth:m,inChannels:v,outHeight:y,outWidth:w,padInfo:b,strideHeight:I,strideWidth:k,filterHeight:R,filterWidth:C,dilationHeight:T,dilationWidth:N,outShape:$}=vm(s.shape,r.shape,i,o,"NHWC",a),P=re($),V=$.length,O=yn(s.dtype,P);for(let Z=0;Z<p;++Z)for(let ne=0;ne<y;++ne){const le=ne*I-b.top;for(let q=0;q<w;++q){const J=q*k-b.left;for(let ie=0;ie<v;++ie){let he=Number.MIN_SAFE_INTEGER;for(let pe=0;pe<R;++pe){const xe=le+pe*T;if(xe>=0&&xe<f)for(let ye=0;ye<C;++ye){const Ie=J+ye*N;if(Ie>=0&&Ie<m){const $e=wo([Z,xe,Ie,ie],c,Ve(s.shape)),ze=wo([pe,ye,ie],d,Ve(r.shape)),Me=u[$e]+h[ze];Me>he&&(he=Me)}}}const de=wo([Z,ne,q,ie],V,Ve($));O[de]=he}}}return{dataId:l.write(tc(O,s.dtype),$,s.dtype),shape:$,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hce={kernelName:X2,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:i}=t,{strides:o,pad:a,dilations:l}=n,u=e,c=oi(s.shape,u.data.get(s.dataId).values),h=oi(r.shape,u.data.get(r.dataId).values),{batchSize:d,inHeight:p,inWidth:f,inChannels:m,outHeight:v,outWidth:y,padInfo:w,strideHeight:b,strideWidth:I,filterHeight:k,filterWidth:R,dilationHeight:C,dilationWidth:T,outShape:N}=vm(s.shape,r.shape,o,a,"NHWC",l);F(i.rank===N.length,()=>`Error in ${X2}, dy must have the same rank as output ${N.length}, but got ${i.rank}`);const $=oi(N,u.data.get(i.dataId).values),P=cO(r.shape,r.dtype);for(let O=0;O<d;++O)for(let Q=0;Q<v;++Q){const Z=Q*b-w.top;for(let ne=0;ne<y;++ne){const le=ne*I-w.left;for(let q=0;q<m;++q){let J=Number.MIN_SAFE_INTEGER,ie=0,he=0;for(let de=0;de<k;++de){const pe=Z+de*C;if(pe>=0&&pe<p)for(let xe=0;xe<R;++xe){const ye=le+xe*T;if(ye>=0&&ye<f){const Ie=c[O][pe][ye][q]+h[de][xe][q];Ie>J&&(J=Ie,ie=de,he=xe)}}}P[ie][he][q]+=$[O][Q][ne][q]}}}return{dataId:u.write(tc(P,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qce={kernelName:K2,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:i}=t,{strides:o,pad:a,dilations:l}=n,u=e,c=oi(s.shape,u.data.get(s.dataId).values),h=oi(r.shape,u.data.get(r.dataId).values),{batchSize:d,inHeight:p,inWidth:f,inChannels:m,outHeight:v,outWidth:y,padInfo:w,strideHeight:b,strideWidth:I,filterHeight:k,filterWidth:R,dilationHeight:C,dilationWidth:T,outShape:N}=vm(s.shape,r.shape,o,a,"NHWC",l);F(i.rank===N.length,()=>`Error in ${K2}, dy must have the same rank as output ${N.length}, but got ${i.rank}`);const $=oi(N,u.data.get(i.dataId).values),P=cO(s.shape,s.dtype);for(let O=0;O<d;++O)for(let Q=0;Q<v;++Q){const Z=Q*b-w.top;for(let ne=0;ne<y;++ne){const le=ne*I-w.left;for(let q=0;q<m;++q){let J=Number.MIN_SAFE_INTEGER,ie=Z<0?0:Z,he=le<0?0:le;for(let de=0;de<k;++de){const pe=Z+de*C;if(pe>=0&&pe<p)for(let xe=0;xe<R;++xe){const ye=le+xe*T;if(ye>=0&&ye<f){const Ie=c[O][pe][ye][q]+h[de][xe][q];Ie>J&&(J=Ie,ie=pe,he=ye)}}}P[O][ie][he][q]+=$[O][Q][ne][q]}}}return{dataId:u.write(tc(P,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kce(t){const{inputs:e,backend:n,attrs:s}=t,{image:r}=e,{canvas:i,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},u=(l==null?void 0:l.alpha)||1,c=(a==null?void 0:a.contextType)||"2d";if(c!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const h=i.getContext(c,(a==null?void 0:a.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${c} type.`);const[d,p]=r.shape.slice(0,2),f=r.shape.length===2?1:r.shape[2],m=n.data.get(r.dataId).values,v=r.dtype==="float32"?255:1,y=new Uint8ClampedArray(p*d*4);for(let b=0;b<d*p;++b){const I=[0,0,0,255*u];for(let R=0;R<f;R++){const C=m[b*f+R];if(r.dtype==="float32"){if(C<0||C>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${C}.`)}else if(r.dtype==="int32"&&(C<0||C>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${C}.`);f===1?(I[0]=C*v,I[1]=C*v,I[2]=C*v):I[R]=C*v}const k=b*4;y[k+0]=Math.round(I[0]),y[k+1]=Math.round(I[1]),y[k+2]=Math.round(I[2]),y[k+3]=Math.round(I[3])}i.width=p,i.height=d;const w=new ImageData(y,p,d);return h.putImageData(w,0,0),r}const Xce={kernelName:oK,backendName:"cpu",kernelFunc:Kce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fm(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;Oe(r,"sum");let a;r.dtype==="bool"?a=yl({inputs:{x:r},backend:n,attrs:{dtype:"int32"}}):a=_o({inputs:{x:r},backend:n});const l=a.shape.length,u=st(i,a.shape),c=on(u,l);let h=u,d=a;c!=null&&(d=Js({inputs:{x:a},backend:n,attrs:{perm:c}}),h=xn(h.length,l)),rs("sum",h,d.shape.length);const[p,f]=Gn(d.shape,h),m=vr(d.dtype,"int32");let v=_1(n,p,m);const y=re(f),w=n.data.get(v.dataId).values,b=n.data.get(d.dataId).values;for(let I=0;I<w.length;++I){const k=I*y;let R=0;for(let C=0;C<y;++C)R+=b[k+C];w[I]=R}if(o){const I=wn(v.shape,u),k=v;v=Wt({inputs:{x:v},backend:n,attrs:{shape:I}}),n.disposeIntermediateTensorInfo(k)}return n.disposeIntermediateTensorInfo(a),c!=null&&n.disposeIntermediateTensorInfo(d),v}const Yce={kernelName:dv,backendName:"cpu",kernelFunc:Fm};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qce(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=GC(r,i.length);qC(o.length,l,i);const{path:u,steps:c}=KC(a,l),h=c.length;let d=null,p=o.length;const f=[];for(let m=0;m<h;++m){for(const v of c[m]){const{permutationIndices:y,expandDims:w}=HC(p,l[v]);let b;XC(y)?b=i[v]:(b=Js({inputs:{x:i[v]},backend:n,attrs:{perm:y}}),f.push(b));const I=b.shape.slice();for(let k=0;k<w.length;++k)I.splice(w[k],0,1);ut(b.shape,I)||(b=Wt({inputs:{x:b},backend:n,attrs:{shape:I}}),f.push(b)),d===null?d=b:(d=rw({inputs:{a:b,b:d},backend:n}),f.push(d))}m<h-1&&(u[m]>=0&&(d=Fm({inputs:{x:d},backend:n,attrs:{axis:u[m]-(o.length-p),keepDims:!1}}),f.push(d)),p--)}for(const m of f)m!==d&&n.disposeIntermediateTensorInfo(m);return d}const Jce={kernelName:jS,backendName:"cpu",kernelFunc:Qce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zce(t){const{inputs:e,backend:n}=t,{dy:s,y:r}=e;Oe([s,r],"eluGrad");const i=new Float32Array(re(r.shape)),o=n.data.get(r.dataId).values,a=n.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const u=o[l];u>=0?i[l]=a[l]:i[l]=a[l]*(u+1)}return n.makeTensorInfo(r.shape,"float32",i)}const ehe={kernelName:GS,backendName:"cpu",kernelFunc:Zce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const the=MC,nhe=VC,she=zC,rhe=BC,ihe=UC,ohe=WC,ahe=Et(Ff,t=>{const e=Math.sign(t),n=Math.abs(t),s=1/(1+the*n);return e*(1-((((ohe*s+ihe)*s+rhe)*s+she)*s+nhe)*s*Math.exp(-n*n))}),lhe={kernelName:Ff,backendName:"cpu",kernelFunc:ahe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A1(t){const{inputs:e,backend:n,attrs:s}=t,{input:r}=e,{dim:i}=s,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(F(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),Wt({inputs:{x:r},backend:n,attrs:{shape:a}})}const uhe={kernelName:P0,backendName:"cpu",kernelFunc:A1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const che=In((t,e)=>t/e),_k=Fn(Of,che),Lb={kernelName:Of,backendName:"cpu",kernelFunc:_k};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w6(t,e,n){const s=t.shape,r=s[0],i=s[1],o=n.data.get(t.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,u=[r,i],c=re(u),h=ts("float32",c),d=ts("float32",c);for(let v=0;v<r;v++){const y=Gu({inputs:{x:a},backend:n,attrs:{begin:[v,0],size:[1,i]}}),w=Gu({inputs:{x:l},backend:n,attrs:{begin:[v,0],size:[1,i]}}),b=lr({inputs:{real:y,imag:w},backend:n}),{real:I,imag:k}=hhe(b,e,n),R=ra(I,k);for(let C=0;C<i;C++){const T=jC(R,C);h[v*i+C]=T.real,d[v*i+C]=T.imag}n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(b)}const p=n.makeTensorInfo(u,"float32",h),f=n.makeTensorInfo(u,"float32",d),m=lr({inputs:{real:p,imag:f},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),m}function hhe(t,e,n){const s=re(t.shape),r=n.data.get(t.dataId),i=n.data.get(r.complexTensorInfos.real.dataId).values,o=n.data.get(r.complexTensorInfos.imag.dataId).values;if(dhe(s)){const a=Mb(i,o,s,e,n),l=[t.shape[0],t.shape[1]];if(e){const u=n.makeTensorInfo(l,"float32",a.real),c=n.makeTensorInfo(l,"float32",a.imag),h=n.makeTensorInfo([],"float32",Cl(s,"float32")),d=_o({inputs:{x:h},backend:n}),p=Lb.kernelFunc({inputs:{a:u,b:h},backend:n}),f=Lb.kernelFunc({inputs:{a:c,b:d},backend:n}),m=n.data.get(p.dataId).values,v=n.data.get(f.dataId).values;return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),{real:m,imag:v}}return a}else{const a=ra(i,o),l=phe(a,s,e);return NF(l)}}function dhe(t){return(t&t-1)===0}function Mb(t,e,n,s,r){if(n===1)return{real:t,imag:e};const i=ra(t,e),o=n/2,a=$F(i),l=a.real,u=a.imag,c=[l.length],h=r.makeTensorInfo(c,"float32",l),d=r.makeTensorInfo(c,"float32",u),p=lr({inputs:{real:h,imag:d},backend:r}),f=AF(i),m=f.real,v=f.imag,y=[m.length],w=r.makeTensorInfo(y,"float32",m),b=r.makeTensorInfo(y,"float32",v),I=lr({inputs:{real:w,imag:b},backend:r}),k=Mb(l,u,o,s,r),R=k.real,C=k.imag,T=[R.length],N=r.makeTensorInfo(T,"float32",R),$=r.makeTensorInfo(T,"float32",C),P=lr({inputs:{real:N,imag:$},backend:r}),V=Mb(m,v,o,s,r),O=V.real,Q=V.imag,Z=[O.length],ne=r.makeTensorInfo(Z,"float32",O),le=r.makeTensorInfo(Z,"float32",Q),q=lr({inputs:{real:ne,imag:le},backend:r}),J=DF(n,s),ie=[J.real.length],he=r.makeTensorInfo(ie,"float32",J.real),de=r.makeTensorInfo(ie,"float32",J.imag),pe=lr({inputs:{real:he,imag:de},backend:r}),xe=rw({inputs:{a:pe,b:q},backend:r}),ye=Rh({inputs:{a:P,b:xe},backend:r}),Ie=kk({inputs:{a:P,b:xe},backend:r}),$e=ju({inputs:{input:ye},backend:r}),ze=ju({inputs:{input:Ie},backend:r}),Me=Dh({inputs:{input:ye},backend:r}),Ue=Dh({inputs:{input:Ie},backend:r}),Ke=Oh({inputs:[$e,ze],backend:r,attrs:{axis:0}}),Je=Oh({inputs:[Me,Ue],backend:r,attrs:{axis:0}}),nt=r.data.get(Ke.dataId).values,_t=r.data.get(Je.dataId).values;return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(I),r.disposeIntermediateTensorInfo(N),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(P),r.disposeIntermediateTensorInfo(ne),r.disposeIntermediateTensorInfo(le),r.disposeIntermediateTensorInfo(q),r.disposeIntermediateTensorInfo(he),r.disposeIntermediateTensorInfo(de),r.disposeIntermediateTensorInfo(pe),r.disposeIntermediateTensorInfo(xe),r.disposeIntermediateTensorInfo(ye),r.disposeIntermediateTensorInfo(Ie),r.disposeIntermediateTensorInfo($e),r.disposeIntermediateTensorInfo(Me),r.disposeIntermediateTensorInfo(ze),r.disposeIntermediateTensorInfo(Ue),r.disposeIntermediateTensorInfo(Ke),r.disposeIntermediateTensorInfo(Je),{real:nt,imag:_t}}function phe(t,e,n){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,o=0;for(let a=0;a<e;a++){const l=OF(r*a,e,n),u=jC(t,a);i+=u.real*l.real-u.imag*l.imag,o+=u.real*l.imag+u.imag*l.real}n&&(i/=e,o/=e),RF(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fhe(t){const{inputs:e,backend:n}=t,{input:s}=e,r=re(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=Wt({inputs:{x:s},backend:n,attrs:{shape:[o,i]}}),l=w6(a,!1,n),u=Wt({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}const mhe={kernelName:HS,backendName:"cpu",kernelFunc:fhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nk(t){const{backend:e,attrs:n}=t,{shape:s,value:r,dtype:i}=n,o=i||Gh(r),a=yn(o,re(s));return yhe(a,r,o),e.makeTensorInfo(s,o,a)}const ghe={kernelName:qS,backendName:"cpu",kernelFunc:Nk};function yhe(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vhe={kernelName:KS,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,r=n,i=ts(s.dtype,re(s.shape)),[o,a,l,u]=s.shape,c=r.data.get(s.dataId).values;for(let d=0;d<o;d++){const p=d*l*a*u;for(let f=0;f<a;f++){const m=f*(l*u);for(let v=0;v<l;v++){const y=v*u;for(let w=0;w<u;w++){const b=Math.round(l-v-1),I=p+m+y+w;let k=c[I];if(b>=0&&b<l){const R=b*u,C=p+m+R+w;k=c[C]}i[I]=k}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function whe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=s;let m=y6({inputs:{x:r,filter:i},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d}});if(o){const v=m;if(c==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const y=Wt({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=Rh({inputs:{a:m,b:y},backend:n}),n.disposeIntermediateTensorInfo(y)}else m=Rh({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(v)}if(p){const v=m;if(c==="NCHW"&&p==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=Wt({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});m=$1(n,m,p,y,f),n.disposeIntermediateTensorInfo(y)}else m=$1(n,m,p,a,f);n.disposeIntermediateTensorInfo(v)}return m}const xhe={kernelName:u1,backendName:"cpu",kernelFunc:whe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bhe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=s;let m=v6({inputs:{x:r,filter:i},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d}});if(o){const v=m;m=Rh({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(p){const v=m;m=$1(n,m,p,a,f),n.disposeIntermediateTensorInfo(v)}return m}const Ihe={kernelName:c1,backendName:"cpu",kernelFunc:bhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function She(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,i=re(s.shape),o=r.shape,a=o[o.length-1],[l,u,c,h]=EC(s,r);if(u===0)return n.makeTensorInfo(l,s.dtype,[]);const d=n.data.get(r.dataId).values,p=n.bufferSync(s),f=NV(d,p,s.dtype,u,a,c,h,s.shape,i);return n.makeTensorInfo(l,s.dtype,f.values)}const The={kernelName:XS,backendName:"cpu",kernelFunc:She};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Che(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:i}=e,{axis:o,batchDims:a}=s;Oe([r,i],"gatherV2");const l=st(o,r.shape)[0],u=n.data.get(i.dataId).values,c=r.shape[l];for(let I=0;I<u.length;++I){const k=u[I];F(k<=c-1&&k>=0,()=>`GatherV2: the index value ${k} is not in [0, ${c-1}]`)}let h=a;a==null&&(h=0);const d=re(i.shape),p=QC(r,i,l,h),f=Wt({inputs:{x:r},backend:n,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),m=Wt({inputs:{x:i},backend:n,attrs:{shape:[p.batchSize,d/p.batchSize]}}),v=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize],y=n.bufferSync(m),w=n.bufferSync(f),b=$V(w,y,v);return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(p.outputShape,b.dtype,b.values)}const khe={kernelName:L0,backendName:"cpu",kernelFunc:Che};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ehe(t){const{inputs:e,backend:n}=t,{input:s}=e,r=re(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=Wt({inputs:{x:s},backend:n,attrs:{shape:[o,i]}}),l=w6(a,!0,n),u=Wt({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}const _he={kernelName:YS,backendName:"cpu",kernelFunc:Ehe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nhe=Et(Wf,t=>Number.isFinite(t)?1:0,"bool"),$he={kernelName:Wf,backendName:"cpu",kernelFunc:Nhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ahe=Et(jf,t=>Math.abs(t)===1/0?1:0,"bool"),Rhe={kernelName:jf,backendName:"cpu",kernelFunc:Ahe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dhe=Et(Gf,t=>Number.isNaN(t)?1:0,"bool"),Ohe={kernelName:Gf,backendName:"cpu",kernelFunc:Dhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Phe(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:i}=n,o=PV(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const Fhe={kernelName:JS,backendName:"cpu",kernelFunc:Phe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lhe=Et(qf,t=>Math.log1p(t)),Mhe={kernelName:qf,backendName:"cpu",kernelFunc:Lhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vhe=In((t,e)=>t&&e),zhe=Fn(U0,Vhe,null,"bool"),Bhe={kernelName:U0,backendName:"cpu",kernelFunc:zhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uhe=Et(W0,t=>t?0:1,"bool"),Whe={kernelName:W0,backendName:"cpu",kernelFunc:Uhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jhe=In((t,e)=>t||e),Ghe=Fn(j0,jhe,null,"bool"),Hhe={kernelName:j0,backendName:"cpu",kernelFunc:Ghe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qhe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s;Oe(r,"LRN");const u=r.shape[3],c=u-1,h=n.data.get(r.dataId).values,d=re(r.shape),p=new Float32Array(d);function f(m){const v=m%u;let y=m-v+Math.max(0,v-i);const w=m-v+Math.min(v+i,c);let b=0;for(;y<=w;y++){const I=h[y];b+=I*I}return b}for(let m=0;m<d;m++){const v=f(m),y=h[m]*Math.pow(o+a*v,-l);p[m]=y}return n.makeTensorInfo(r.shape,r.dtype,p)}const Khe={kernelName:G0,backendName:"cpu",kernelFunc:qhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xhe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=s;Oe(o,"LRNGrad");const h=re(o.shape),d=o.shape[3],p=n.data.get(o.dataId).values,f=n.data.get(r.dataId).values,m=n.data.get(i.dataId).values,v=new Float32Array(h),y=h;for(let w=0;w<y;w++){const b=w%d,I=w-b+Math.max(0,b-a),k=w-b+Math.min(d,b+a+1);let R=0;for(let C=I;C<k;C++)R+=Math.pow(f[C],2);R=u*R+l;for(let C=I;C<k;C++){let T=-2*u*c*f[C]*m[w]/R;w===C&&(T+=Math.pow(R,-c)),T*=p[w],v[C]+=T}}return n.makeTensorInfo(o.shape,r.dtype,v)}const Yhe={kernelName:ZS,backendName:"cpu",kernelFunc:Xhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x6(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=n;let l=r.shape;const u=l.length,c=st(i,l);let h=c;const d=on(h,u);let p=a.data.get(r.dataId).values;if(d!=null){const I=new Array(u);for(let k=0;k<I.length;k++)I[k]=l[d[k]];p=Tk(p,l,r.dtype,d,I),h=xn(h.length,u),l=I}Oe(r,"max"),rs("max",h,u);const[f,m]=Gn(l,h),v=re(m),y=LV(p,v,f,r.dtype),w=a.write(y,f,r.dtype);let b=f;return o&&(b=wn(f,c)),{dataId:w,shape:b,dtype:r.dtype}}const Qhe={kernelName:H0,backendName:"cpu",kernelFunc:x6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jhe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Oe(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;F(ss(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=pi(r.shape,i,o,u,a,l);let h;if(c.filterWidth===1&&c.filterHeight===1&&ut(c.inShape,c.outShape))h=_o({inputs:{x:r},backend:n});else{const d=n.data.get(r.dataId).values,p=Ve(r.shape),f=Ek(d,r.shape,r.dtype,p,c,"max");h=n.makeTensorInfo(c.outShape,r.dtype,f.values)}return h}const Zhe={kernelName:q0,backendName:"cpu",kernelFunc:Jhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ede(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;Oe(r,"maxPool3d");const c=ua(r.shape,i,o,1,a,l,u),h=n.data.get(r.dataId).values,d=g6(h,r.shape,r.dtype,Ve(r.shape),c,"max");return n.makeTensorInfo(d.shape,"float32",d.values)}const tde={kernelName:K0,backendName:"cpu",kernelFunc:ede};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nde(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;Oe([r,i],"maxPool3DGrad");const c=ua(i.shape,o,a,1,l,u),h=n.bufferSync(i),d=jue(h,c),p=c.strideDepth,f=c.strideHeight,m=c.strideWidth,v=c.dilationDepth,y=c.dilationHeight,w=c.dilationWidth,b=c.effectiveFilterDepth,I=c.effectiveFilterHeight,k=c.effectiveFilterWidth,R=b-1-c.padInfo.front,C=k-1-c.padInfo.left,T=I-1-c.padInfo.top,N=tt(i.shape,"float32"),$=n.bufferSync(r);for(let P=0;P<c.batchSize;++P)for(let V=0;V<c.inChannels;++V)for(let O=0;O<c.inDepth;++O)for(let Q=0;Q<c.inHeight;++Q)for(let Z=0;Z<c.inWidth;++Z){const ne=O-R,le=Q-T,q=Z-C;let J=0;for(let ie=0;ie<b;ie+=v){const he=(ne+ie)/p;if(!(he<0||he>=c.outDepth||Math.floor(he)!==he))for(let de=0;de<I;de+=y){const pe=(le+de)/f;if(!(pe<0||pe>=c.outHeight||Math.floor(pe)!==pe))for(let xe=0;xe<k;xe+=w){const ye=(q+xe)/m;if(ye<0||ye>=c.outWidth||Math.floor(ye)!==ye)continue;const Ie=b*I*k-1-d.get(P,he,pe,ye,V),$e=ie*I*k+de*k+xe,ze=Ie===$e?1:0;if(ze===0)continue;const Me=$.get(P,he,pe,ye,V);J+=Me*ze}}}N.set(J,P,O,Q,Z,V)}return n.makeTensorInfo(N.shape,N.dtype,N.values)}const sde={kernelName:tT,backendName:"cpu",kernelFunc:nde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rde(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i,output:o}=e,a=i;Oe([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=s,d=pi(a.shape,l,u,1,c,h),p=n.data.get(a.dataId).values,f=tt(d.outShape,a.dtype,m6(p,a.shape,a.dtype,d).values),m=d.strideHeight,v=d.strideWidth,y=d.dilationHeight,w=d.dilationWidth,b=d.effectiveFilterHeight,I=d.effectiveFilterWidth,k=I-1-d.padInfo.left,R=b-1-d.padInfo.top,C=tt(a.shape,"float32"),T=n.data.get(r.dataId).values,N=tt(r.shape,"float32",T);for(let $=0;$<d.batchSize;++$)for(let P=0;P<d.inChannels;++P)for(let V=0;V<d.inHeight;++V)for(let O=0;O<d.inWidth;++O){const Q=V-R,Z=O-k;let ne=0;for(let le=0;le<b;le+=y){const q=(Q+le)/m;if(!(q<0||q>=d.outHeight||Math.floor(q)!==q))for(let J=0;J<I;J+=w){const ie=(Z+J)/v;if(ie<0||ie>=d.outWidth||Math.floor(ie)!==ie)continue;const he=b*I-1-f.get($,q,ie,P),de=le*I+J,pe=he===de?1:0;if(pe===0)continue;const xe=N.get($,q,ie,P);ne+=xe*pe}}C.set(ne,$,V,O,P)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}const ide={kernelName:eT,backendName:"cpu",kernelFunc:rde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ode(t,e,n,s,r){const i=Ve(e),o=Ek(t,e,n,i,r,"max"),a=m6(t,e,n,r,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ade={kernelName:nT,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=n;Oe(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,c=pi(s.shape,r,i,[1,1],o),[h,d]=ode(u,s.shape,s.dtype,a,c),p=l.write(h,c.outShape,s.dtype),f=l.write(d,c.outShape,s.dtype);return[{dataId:p,shape:c.outShape,dtype:s.dtype},{dataId:f,shape:c.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lde(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=st(i,r.shape),u=Gn(r.shape,a)[1],c=re(u),h=[],d=n.makeTensorInfo([],"float32",new Float32Array([c]));h.push(d);const p=yl({inputs:{x:r},backend:n,attrs:{dtype:"float32"}});h.push(p);const f=_k({inputs:{a:p,b:d},backend:n});h.push(f);const m=Fm({inputs:{x:f},backend:n,attrs:{axis:i,keepDims:o}});return h.forEach(v=>n.disposeIntermediateTensorInfo(v)),m}const ude={kernelName:X0,backendName:"cpu",kernelFunc:lde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cde(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;Oe(r,"min");const a=st(i,r.shape);let l=a;const u=on(l,r.shape.length);let c=r;u!=null&&(c=Js({inputs:{x:r},backend:n,attrs:{perm:u}}),l=xn(l.length,r.shape.length)),rs("min",l,c.shape.length);const[h,d]=Gn(c.shape,l),p=re(d),f=ws(re(h),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){const w=y*p;let b=m[w];for(let I=0;I<p;++I){const k=m[w+I];(Number.isNaN(k)||k<b)&&(b=k)}f[y]=b}u!=null&&n.disposeIntermediateTensorInfo(c);const v=n.makeTensorInfo(h,c.dtype,f);if(o){const y=wn(h,a),w=Wt({inputs:{x:v},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(v),w}return v}const hde={kernelName:Y0,backendName:"cpu",kernelFunc:cde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dde(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,mode:o}=s;Oe(r,"mirrorPad");const a=i.map((b,I)=>b[0]+r.shape[I]+b[1]),l=i.map(b=>b[0]),u=i.map((b,I)=>b[0]+r.shape[I]),c=o==="reflect"?0:1,h=n.data.get(r.dataId).values,d=r.shape.length,p=Ve(r.shape),f=re(a),m=a.length,v=Ve(a),y=ts(r.dtype,f);for(let b=0;b<f;b++){let I=Hh(b,m,v);for(let R=0;R<m;R++)I[R]<l[R]?I[R]=l[R]*2-I[R]-c:I[R]>=u[R]&&(I[R]=(u[R]-1)*2-I[R]+c);I=I.map((R,C)=>R-l[C]);const k=wo(I,d,p);y[b]=h[k]}return{dataId:n.write(y,a,r.dtype),shape:a,dtype:r.dtype}}const pde={kernelName:Q0,backendName:"cpu",kernelFunc:dde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fde=In((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),mde=Fn(Yf,fde),gde={kernelName:Yf,backendName:"cpu",kernelFunc:mde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b6(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:i}=s,o=r.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=st([a],r.shape),u=x6({inputs:{x:r},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),c=wn(u.shape,l),h=Wt({inputs:{x:u},backend:n,attrs:{shape:c}}),d=kk({inputs:{a:r,b:h},backend:n}),p=CV({inputs:{x:d},backend:n}),f=Fm({inputs:{x:p},backend:n,attrs:{axis:l,keepDims:!1}}),m=Wt({inputs:{x:f},backend:n,attrs:{shape:c}}),v=_k({inputs:{a:p,b:m},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}const yde={kernelName:mv,backendName:"cpu",kernelFunc:b6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vde(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s;Oe(r,"multinomial");const l=a?r:b6({inputs:{logits:r},backend:n,attrs:{dim:-1}}),u=l.shape[0],c=l.shape[1],h=n.data.get(l.dataId).values,d=[u,i],p=ws(re(d),"int32");for(let f=0;f<u;++f){const m=f*c,v=new Float32Array(c-1);v[0]=h[m];for(let b=1;b<v.length;++b)v[b]=v[b-1]+h[m+b];const y=Dv.alea(o.toString()),w=f*i;for(let b=0;b<i;++b){const I=y();p[w+b]=v.length;for(let k=0;k<v.length;k++)if(I<v[k]){p[w+b]=k;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(d,"int32",p)}const wde={kernelName:sT,backendName:"cpu",kernelFunc:vde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xde=xC;function bde(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;Oe(r,"NonMaxSuppression");const u=n.data.get(r.dataId).values,c=n.data.get(i.dataId).values,{selectedIndices:h}=xde(u,c,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const Ide={kernelName:rT,backendName:"cpu",kernelFunc:bde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sde=bC;function Tde(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;Oe(r,"NonMaxSuppressionPadded");const c=n.data.get(r.dataId).values,h=n.data.get(i.dataId).values,{selectedIndices:d,validOutputs:p}=Sde(c,h,o,a,l,u);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}const Cde={kernelName:iT,backendName:"cpu",kernelFunc:Tde};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kde=IC;function Ede(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;Oe(r,"NonMaxSuppressionWithScore");const c=n.data.get(r.dataId).values,h=n.data.get(i.dataId).values,d=o,p=a,f=l,m=u,{selectedIndices:v,selectedScores:y}=kde(c,h,d,p,f,m);return[n.makeTensorInfo([v.length],"int32",new Int32Array(v)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const _de={kernelName:oT,backendName:"cpu",kernelFunc:Ede};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nde(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s;Oe(r,"oneHot");const u=re(r.shape),c=new Float32Array(u*o);c.fill(l);const h=n.data.get(r.dataId).values;for(let d=0;d<u;++d)h[d]>=0&&h[d]<o&&(c[d*o+h[d]]=a);return n.makeTensorInfo([...r.shape,o],i,c)}const $de={kernelName:tv,backendName:"cpu",kernelFunc:Nde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R1(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=ju({inputs:{input:s},backend:n}),i=R1({inputs:{x:r},backend:n}),o=Dh({inputs:{input:s},backend:n}),a=R1({inputs:{x:o},backend:n}),l=lr({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Nk({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const Ade={kernelName:wv,backendName:"cpu",kernelFunc:R1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I6(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=ju({inputs:{input:s},backend:n}),i=I6({inputs:{x:r},backend:n}),o=Dh({inputs:{input:s},backend:n}),a=R1({inputs:{x:o},backend:n}),l=lr({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Nk({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const Rde={kernelName:ev,backendName:"cpu",kernelFunc:I6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S6(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return A1({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(c=>{Ir(i,c.shape,"All tensors passed to stack must have matching shapes"),F(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const h=A1({inputs:{input:c},backend:n,attrs:{dim:r}});return a.push(h),h}),u=Oh({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),u}const Dde={kernelName:nv,backendName:"cpu",kernelFunc:S6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ode(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,constantValue:o}=s;Oe(r,"pad");const a=i.map((w,b)=>w[0]+r.shape[b]+w[1]),l=i.map(w=>w[0]),u=n.data.get(r.dataId).values,c=re(r.shape),h=r.shape.length,d=Ve(r.shape),p=re(a),f=a.length,m=Ve(a),v=ts(r.dtype,p);o!==0&&v.fill(o);for(let w=0;w<c;w++){const I=Hh(w,h,d).map((R,C)=>R+l[C]),k=wo(I,f,m);v[k]=u[w]}return{dataId:n.write(v,a,r.dtype),shape:a,dtype:r.dtype}}const T6={kernelName:sv,backendName:"cpu",kernelFunc:Ode};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pde=In((t,e)=>Math.pow(t,e)),Fde=Fn(Jf,Pde),Lde={kernelName:Jf,backendName:"cpu",kernelFunc:Fde};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mde(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,a=r.map(v=>n.data.get(v.dataId).values),l=r.map(v=>v.shape),u=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values,[h,d,p]=WV(a,l,u,i.shape,i.dtype,c,o.shape),f=h.map(v=>n.makeTensorInfo([v.length],"int32",v)),m=n.makeTensorInfo(p,i.dtype,d);return f.concat([m])}const Vde={kernelName:aT,backendName:"cpu",kernelFunc:Mde};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zde(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:i}=e,o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[u,c]=jV(o,s.shape,s.dtype,a,r.shape,l,i.shape),h=n.makeTensorInfo([u.length],"int32",u),d=n.makeTensorInfo([c.length],s.dtype,c);return[h,d]}const Bde={kernelName:lT,backendName:"cpu",kernelFunc:zde};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ude(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=n.data.get(r.dataId).values,c=n.data.get(i.dataId).values,h=n.data.get(o.dataId).values,d=a.map(v=>n.data.get(v.dataId).values),p=a.map(v=>v.shape),[f,m]=GV(u,r.shape,c,i.shape,i.dtype,h,o.shape,d,p,l);return n.makeTensorInfo(f,i.dtype,m)}const Wde={kernelName:uT,backendName:"cpu",kernelFunc:Ude};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jde(t){const{backend:e,attrs:n}=t,{start:s,stop:r,dtype:i,step:o}=n,a=HV(s,r,o,i);return e.makeTensorInfo([a.length],i,a)}const Gde={kernelName:cT,backendName:"cpu",kernelFunc:jde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hde=Et(Zf,t=>1/t),qde={kernelName:Zf,backendName:"cpu",kernelFunc:Hde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kde(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;Oe(r,"resizeBilinear");const l=Ve(r.shape),[u,c]=a,[h,d,p,f]=r.shape,m=n.data.get(r.dataId).values,v=new Float32Array(re([h,u,c,f])),y=[i&&u>1?d-1:d,i&&c>1?p-1:p],w=[i&&u>1?u-1:u,i&&c>1?c-1:c];let b=0;const I=y[0]/w[0],k=y[1]/w[1];for(let R=0;R<h;R++)for(let C=0;C<u;C++){let T;o?T=I*(C+.5)-.5:T=I*C;const N=Math.max(0,Math.floor(T)),$=T-N,P=Math.min(d-1,Math.ceil(T)),V=R*l[0]+N*l[1],O=R*l[0]+P*l[1];for(let Q=0;Q<c;Q++){let Z;o?Z=k*(Q+.5)-.5:Z=k*Q;const ne=Math.max(0,Math.floor(Z)),le=Z-ne,q=Math.min(p-1,Math.ceil(Z)),J=V+ne*l[2],ie=O+ne*l[2],he=V+q*l[2],de=O+q*l[2];for(let pe=0;pe<f;pe++){const xe=m[J+pe],ye=m[ie+pe],Ie=m[he+pe],$e=m[de+pe],ze=xe+(Ie-xe)*le,Me=ye+($e-ye)*le,Ue=ze+(Me-ze)*$;v[b++]=Ue}}}return n.makeTensorInfo([h,u,c,f],"float32",v)}const Xde={kernelName:lv,backendName:"cpu",kernelFunc:Kde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yde(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s;Oe([i,r],"resizeBilinearGrad");const a=Ve(r.shape),[l,u,c,h]=r.shape,[,d,p]=i.shape,f=new Float32Array(l*u*c*h),m=[o&&d>1?u-1:u,o&&p>1?c-1:c],v=[o&&d>1?d-1:d,o&&p>1?p-1:p],y=m[0]/v[0],w=m[1]/v[1],b=n.data.get(i.dataId).values;let I=0;for(let k=0;k<l;k++){const R=k*a[0];for(let C=0;C<d;C++){const T=C*y,N=Math.floor(T),$=Math.min(Math.ceil(T),u-1),P=R+N*a[1],V=R+$*a[1],O=T-N,Q=1-O;for(let Z=0;Z<p;Z++){const ne=Z*w,le=Math.floor(ne),q=Math.min(Math.ceil(ne),c-1),J=ne-le,ie=1-J,he=P+le*a[2],de=P+q*a[2],pe=V+le*a[2],xe=V+q*a[2],ye=Q*ie,Ie=Q*J,$e=O*ie,ze=O*J;for(let Me=0;Me<h;Me++){const Ue=b[I++];f[he+Me]+=Ue*ye,f[de+Me]+=Ue*Ie,f[pe+Me]+=Ue*$e,f[xe+Me]+=Ue*ze}}}}return n.makeTensorInfo([l,c,u,h],"float32",f)}const Qde={kernelName:pT,backendName:"cpu",kernelFunc:Yde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jde(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;Oe(r,"resizeNearestNeighbor");const l=Ve(r.shape),[u,c]=a,[h,d,p,f]=r.shape,m=n.data.get(r.dataId).values,v=new Float32Array(h*u*c*f),y=[i&&u>1?d-1:d,i&&c>1?p-1:p],w=[i&&u>1?u-1:u,i&&c>1?c-1:c],b=y[0]/w[0],I=y[1]/w[1];let k=0;for(let R=0;R<h;R++){const C=R*l[0];for(let T=0;T<u;T++){const N=o?b*(T+.5):b*T;let $=Math.min(d-1,i?Math.round(N):Math.floor(N));o&&($=Math.max(0,$));const P=C+$*l[1];for(let V=0;V<c;V++){const O=o?I*(V+.5):I*V;let Q=Math.min(p-1,i?Math.round(O):Math.floor(O));o&&(Q=Math.max(0,Q));const Z=P+Q*l[2];for(let ne=0;ne<f;ne++){const le=m[Z+ne];v[k++]=le}}}}return n.makeTensorInfo([h,u,c,f],r.dtype,v)}const Zde={kernelName:av,backendName:"cpu",kernelFunc:Jde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function epe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s;Oe([i,r],"resizeNearestNeighborGrad");const a=Ve(r.shape),l=Ve(i.shape),[u,c,h,d]=r.shape,[,p,f]=i.shape,m=new Float32Array(u*c*h*d),v=n.data.get(i.dataId).values,y=[o&&p>1?c-1:c,o&&f>1?h-1:h],w=[o&&p>1?p-1:p,o&&f>1?f-1:f],b=y[0]/w[0],I=y[1]/w[1],k=1/b,R=1/I,C=Math.ceil(k)*2+2,T=Math.ceil(R)*2+2;for(let N=0;N<u;N++){const $=N*a[0];for(let P=0;P<c;P++){const V=$+P*a[1],O=Math.floor(P*k),Q=Math.floor(O-C/2);for(let Z=0;Z<h;Z++){const ne=V+Z*a[2],le=Math.floor(Z*R),q=Math.floor(le-T/2);for(let J=0;J<d;J++){let ie=0;for(let he=0;he<C;he++){const de=he+Q;if(de<0||de>=p)continue;const pe=$+de*l[1],xe=de*b,ye=Math.min(c-1,o?Math.round(xe):Math.floor(xe));if(P===ye)for(let Ie=0;Ie<T;Ie++){const $e=Ie+q;if($e<0||$e>=f)continue;const ze=pe+$e*l[2],Me=$e*I,Ue=Math.min(h-1,o?Math.round(Me):Math.floor(Me));Z===Ue&&(ie+=v[ze+J])}}m[ne+J]=ie}}}}return n.makeTensorInfo(r.shape,r.dtype,m)}const tpe={kernelName:dT,backendName:"cpu",kernelFunc:epe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function npe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:i}=s;Oe(r,"reverse");const o=r.shape.length,a=st(i,r.shape);if(o===0)return _o({inputs:{x:r},backend:n});const l=new Rn(r.shape,r.dtype),u=n.bufferSync(r);for(let c=0;c<l.size;c++){const h=l.indexToLoc(c),d=h.slice();a.forEach(p=>d[p]=r.shape[p]-1-d[p]),l.set(u.get(...d),...h)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const spe={kernelName:uv,backendName:"cpu",kernelFunc:npe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rpe={kernelName:$T,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:i,center:o}=e,a=n,l=ts(s.dtype,re(s.shape)),[u,c,h,d]=s.shape,[p,f]=PC(o,c,h),m=255,v=Math.sin(r),y=Math.cos(r),w=a.data.get(s.dataId).values;for(let I=0;I<u;I++){const k=I*h*c*d;for(let R=0;R<c;R++){const C=R*(h*d);for(let T=0;T<h;T++){const N=T*d;for(let $=0;$<d;$++){const P=[u,R,T,$],V=P[2],O=P[1];let Q=(V-p)*y-(O-f)*v,Z=(V-p)*v+(O-f)*y;Q=Math.round(Q+p),Z=Math.round(Z+f);let ne=i;if(typeof i!="number"&&($===3?ne=m:ne=i[$]),Q>=0&&Q<h&&Z>=0&&Z<c){const q=Z*(h*d),J=Q*d,ie=k+q+J+$;ne=w[ie]}const le=k+C+N+$;l[le]=ne}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ipe=Et(nm,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),ope={kernelName:nm,backendName:"cpu",kernelFunc:ipe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ape(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=ic(i,r,o),d=!0,p=n.bufferSync(r),f=n.bufferSync(i),m=hu(p,f,o,h,u,l,a,c,0,d);return n.makeTensorInfo(o,m.dtype,m.values)}const lpe={kernelName:fT,backendName:"cpu",kernelFunc:ape};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function upe(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<e?n=r+1:s=r;return s}function cpe(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<=e?n=r+1:s=r;return s}function hpe(t,e,n,s,r,i){const o=yn("int32",n*r);for(let a=0;a<n;++a){const l=t.slice(a*s,(a+1)*s),u=a*r;for(let c=0;c<r;++c)o[u+c]=i==="left"?upe(l,e[c+u]):cpe(l,e[c+u])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dpe(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:i}=e,{side:o}=s,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,u=hpe(a,l,r.shape[0],r.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",u)}const ppe={kernelName:gT,backendName:"cpu",kernelFunc:dpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fpe(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:i}=e;Oe([s,r,i],"select");const o=s.shape.length,a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,c=vr(r.dtype,i.dtype),h=ws(re(r.shape),c);let d=0;const p=o===0||o>1||r.shape.length===1?1:re(r.shape.slice(1));for(let f=0;f<a.length;f++)for(let m=0;m<p;m++)a[f]===1?h[d++]=l[f]:h[d++]=u[f];return n.makeTensorInfo(r.shape,c,h)}const mpe={kernelName:cv,backendName:"cpu",kernelFunc:fpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gpe=Gv,ype=Hv,vpe=Et(rm,t=>t>=0?ype*t:gpe*(Math.exp(t)-1)),wpe={kernelName:rm,backendName:"cpu",kernelFunc:vpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xpe=Et(am,t=>t<0?-1:t>0?1:0),bpe={kernelName:am,backendName:"cpu",kernelFunc:xpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ipe=Et(im,t=>Math.sin(t)),Spe={kernelName:im,backendName:"cpu",kernelFunc:Ipe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tpe=Et(om,t=>Math.sinh(t)),Cpe={kernelName:om,backendName:"cpu",kernelFunc:Tpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kpe=11920928955078125e-23,M$=Math.log(kpe)+2,Epe=Et(um,t=>{const e=t>-M$,n=t<M$,s=Math.exp(t);let r;return n?r=s:e?r=t:r=Math.log(1+s),r}),_pe={kernelName:um,backendName:"cpu",kernelFunc:Epe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Npe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,paddings:o}=s;Oe([r],"spaceToBatchND");const a=re(i),l=[[0,0]];l.push(...o);for(let R=1+i.length;R<r.shape.length;++R)l.push([0,0]);const u=T6.kernelFunc({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),c=Cm(u.shape,i,a,!1),h=km(c.length,i.length,!1),d=Em(u.shape,i,a,!1),m=Wt({inputs:{x:u},backend:n,attrs:{shape:c}}),w=Js({inputs:{x:m},backend:n,attrs:{perm:h}}),k=Wt({inputs:{x:w},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(w),k}const $pe={kernelName:pv,backendName:"cpu",kernelFunc:Npe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ape(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values[0],[h,d,p,f,m]=YV(a,s.shape,s.dtype,l,r.dtype,u,c);return[n.makeTensorInfo(d,s.dtype,h),n.makeTensorInfo([d[0]],r.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(v=>Number(v)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const Rpe={kernelName:yT,backendName:"cpu",kernelFunc:Ape};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dpe(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(n.data.get(r.dataId).values),a=n.data.get(s.dataId).values,l=Array.from(n.data.get(i.dataId).values),[u,c,h]=QV(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(c,s.dtype,u),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const Ope={kernelName:vT,backendName:"cpu",kernelFunc:Dpe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ppe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[u,c]=Ck(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(c,s.dtype,u)}const Fpe={kernelName:wT,backendName:"cpu",kernelFunc:Ppe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lpe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[u,c]=Ck(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(c,s.dtype,u)}const Mpe={kernelName:xT,backendName:"cpu",kernelFunc:Lpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vpe(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:d}=ic(i,r,a),p=!1,f=n.bufferSync(r);let m;switch(i.dtype){case"bool":{const v=n.bufferSync(i),y=!!n.data.get(o.dataId).values[0];m=hu(f,v,a,d,c,u,l,h,y,p);break}case"float32":{const v=n.bufferSync(i),y=n.data.get(o.dataId).values[0];m=hu(f,v,a,d,c,u,l,h,y,p);break}case"int32":{const v=n.bufferSync(i),y=n.data.get(o.dataId).values[0];m=hu(f,v,a,d,c,u,l,h,y,p);break}case"string":{const v=n.bufferSync(i),y=ll(n.data.get(o.dataId).values[0]);m=hu(f,v,a,d,c,u,l,h,y,p);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return n.makeTensorInfo(a,m.dtype,m.values)}const zpe={kernelName:bT,backendName:"cpu",kernelFunc:Vpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bpe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=st(o,r.shape)[0],l=YC(r,i,a),u=new Array(r.shape.length).fill(0),c=r.shape.slice();return l.map(h=>{const d=[...c];d[a]=h;const p=Gu({inputs:{x:r},backend:n,attrs:{begin:u,size:d}});return u[a]+=h,p})}const Upe={kernelName:fv,backendName:"cpu",kernelFunc:Bpe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wpe={kernelName:IT,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e;Oe(n,"square");const r=s.data.get(n.dataId).values,i=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];i[a]=l*l}return{dataId:s.write(i,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jpe=Et(gm,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),Gpe={kernelName:gm,backendName:"cpu",kernelFunc:jpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hpe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=s;Oe(r,"stridedSlice");const{finalShapeSparse:p,finalShape:f,isIdentity:m,sliceDim0:v,isSimpleSlice:y,begin:w,end:b,strides:I}=RC(r.shape,i,o,a,l,u,c,h,d);let k;if(m)k=Wt({inputs:{x:r},backend:n,attrs:{shape:f}});else if(v||y){F(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const R=NC(w,b,I),C=Gu({inputs:{x:r},backend:n,attrs:{begin:w,size:R}});k=Wt({inputs:{x:C},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(C)}else{const R=n.bufferSync(r),C=e6(p,R,I,w);k=n.makeTensorInfo(f,C.dtype,C.values)}return k}const qpe={kernelName:ST,backendName:"cpu",kernelFunc:Hpe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kpe(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:c,dataSplits:h}=e,d=n.data.get(c.dataId).values,p=n.data.get(h.dataId).values,[f,m]=t6(d,p,r,i,o,a,l,u);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",m)]}const Xpe={kernelName:TT,backendName:"cpu",kernelFunc:Kpe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ype(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],[u,c,h]=n6(a,l,r),d=c.length;return[n.makeTensorInfo([d,2],"int32",u),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const Qpe={kernelName:CT,backendName:"cpu",kernelFunc:Ype};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jpe(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=n.data.get(i.dataId).values,a=s6(o,r);return n.makeTensorInfo(i.shape,"int32",a)}const Zpe={kernelName:kT,backendName:"cpu",kernelFunc:Jpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const efe=Et(pm,t=>Math.tan(t)),tfe={kernelName:pm,backendName:"cpu",kernelFunc:efe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nfe=Et(fm,t=>Math.tanh(t)),sfe={kernelName:fm,backendName:"cpu",kernelFunc:nfe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rfe(t){const{inputs:e,backend:n}=t,{tensor:s,indices:r,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:u,outputSize:c}=ic(i,r,s.shape),h=!1,d=n.bufferSync(r),p=n.bufferSync(i),f=n.bufferSync(s),m=hu(d,p,s.shape,c,l,a,o,u,f,h);return n.makeTensorInfo(s.shape,m.dtype,m.values)}const ife={kernelName:mT,backendName:"cpu",kernelFunc:rfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ofe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:i}=s;Oe(r,"tile");const o=i6(n.bufferSync(r),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const afe={kernelName:mm,backendName:"cpu",kernelFunc:ofe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lfe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:i,sorted:o}=s;Oe(r,"topk");const a=n.data.get(r.dataId).values,[l,u]=a6(a,r.shape,r.dtype,i,o);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}const ufe={kernelName:ET,backendName:"cpu",kernelFunc:lfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cfe(t){const{inputs:e,attrs:n,backend:s}=t,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=n,[c,h,d,p]=r.shape,[f,m]=u??[h,d],v=[c,f,m,p],y=Ve(r.shape),w=y[0],b=y[1],I=y[2],k=Ve(v),R=k[0],C=k[1],T=k[2],N=ts(r.dtype,re(v));N.fill(l);const $=s.data.get(r.dataId).values,P=s.data.get(i.dataId).values;for(let O=0;O<c;++O){const Q=i.shape[0]===1?P:P.subarray(O*8,O*8+8);for(let Z=0;Z<f;++Z)for(let ne=0;ne<m;++ne)for(let le=0;le<p;++le){let q;const J=Q[6]*ne+Q[7]*Z+1;if(J===0)continue;const ie=(Q[0]*ne+Q[1]*Z+Q[2])/J,he=(Q[3]*ne+Q[4]*Z+Q[5])/J,de=V$(ie,d,a),pe=V$(he,h,a);switch(o){case"nearest":q=gfe($,h,d,w,b,I,O,pe,de,le,l);break;case"bilinear":q=yfe($,h,d,w,b,I,O,pe,de,le,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const xe=O*R+Z*C+ne*T+le;N[xe]=q}return s.makeTensorInfo(v,r.dtype,N)}return{dataId:s.write(N,v,r.dtype),shape:r.shape,dtype:r.dtype}}const hfe={kernelName:_T,backendName:"cpu",kernelFunc:cfe};function V$(t,e,n){switch(n){case"reflect":return dfe(t,e);case"wrap":return pfe(t,e);case"nearest":return mfe(t,e);case"constant":default:return ffe(t)}}function dfe(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=2*e;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-e?n+s:-n-1}else if(n>e-1)if(e<=1)n=0;else{const s=2*e;n-=s*Math.trunc(n/s),n>=e&&(n=s-n-1)}return Ru(0,n,e-1)}function pfe(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=e-1;n+=e*(Math.trunc(-n/s)+1)}else if(n>e-1)if(e<=1)n=0;else{const s=e-1;n-=e*Math.trunc(n/s)}return Ru(0,n,e-1)}function ffe(t,e){return t}function mfe(t,e){return Ru(0,t,e-1)}function ep(t,e,n,s,r,i,o,a,l,u,c){const h=o*s+a*r+l*i+u;return 0<=a&&a<e&&0<=l&&l<n?t[h]:c}function gfe(t,e,n,s,r,i,o,a,l,u,c){const h=Math.round(a),d=Math.round(l);return ep(t,e,n,s,r,i,o,h,d,u,c)}function yfe(t,e,n,s,r,i,o,a,l,u,c){const h=Math.floor(a),d=Math.floor(l),p=h+1,f=d+1,m=(f-l)*ep(t,e,n,s,r,i,o,h,d,u,c)+(l-d)*ep(t,e,n,s,r,i,o,h,f,u,c),v=(f-l)*ep(t,e,n,s,r,i,o,p,d,u,c)+(l-d)*ep(t,e,n,s,r,i,o,p,f,u,c);return(p-a)*m+(a-h)*v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vfe(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:i}=e;Oe(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:u}=l6(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const wfe={kernelName:NT,backendName:"cpu",kernelFunc:vfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xfe(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,a=r.shape[i],l=new Array(o-1);let u=0;for(let p=0;p<o;p++)p!==i&&(l[u++]=r.shape[p]);const c=new Array(o).fill(0),h=r.shape.slice();h[i]=1;const d=new Array(a);for(let p=0;p<d.length;p++){c[i]=p;const f=Gu({inputs:{x:r},backend:n,attrs:{begin:c,size:h}});d[p]=Wt({inputs:{x:f},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(f)}return d}const bfe={kernelName:yv,backendName:"cpu",kernelFunc:xfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ife(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:i}=e,{numSegments:o}=s;Oe(r,"unsortedSegmentSum");const a=r.shape.length,l=i.shape.length,u=[],c=[],h=a-l;let d=i;for(let f=0;f<h;++f){const m=A1({inputs:{input:d},backend:n,attrs:{dim:f+1}});d=m,c.push(m)}for(let f=0;f<o;++f){const m=Cl(f,"int32"),v=n.makeTensorInfo([],"int32",m),y=SV({inputs:{a:v,b:d},backend:n}),w=yl({inputs:{x:y},backend:n,attrs:{dtype:"float32"}}),b=rw({inputs:{a:w,b:r},backend:n}),I=Fm({inputs:{x:b},backend:n,attrs:{axis:0,keepDims:!1}});u.push(I),c.push(v),c.push(y),c.push(w),c.push(b),c.push(I)}const p=S6({inputs:u,backend:n,attrs:{axis:0}});return c.forEach(f=>n.disposeIntermediateTensorInfo(f)),p}const Sfe={kernelName:vv,backendName:"cpu",kernelFunc:Ife};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tfe=[vue,Jae,xue,Iue,rle,Tue,kue,_ue,$ue,Rue,Oue,Fue,Mue,Bue,Wue,Hue,Kue,Yue,Jue,gue,ece,nce,rce,ole,oce,nle,lle,lce,Zae,cce,dce,pce,mce,yce,wce,bce,Sce,Cce,Ece,Nce,Ace,Dce,Pce,Lce,Mce,zce,Uce,jce,Gce,Hce,qce,Xce,Jce,uue,ehe,ule,lhe,cle,uhe,dle,mhe,ghe,vhe,fle,gle,xhe,Ihe,The,khe,vle,xle,ele,_he,hce,$he,Rhe,Ohe,cue,Ile,Tle,Fhe,kle,Mhe,Bhe,Whe,Hhe,Khe,Yhe,Qhe,_le,Zhe,tde,sde,ide,ade,ude,hde,$le,pde,gde,wde,Rle,Ole,Ide,Cde,_de,Fle,$de,Rde,Dde,T6,Lde,due,Vle,Vde,Bde,Wde,Gde,tle,Lb,qde,pue,fue,mue,Xde,Qde,Zde,tpe,spe,rpe,ope,qle,lpe,ppe,mpe,wpe,Xle,bpe,Spe,Cpe,Yle,yde,_pe,$pe,Rpe,Ope,Fpe,Mpe,zpe,Upe,Zle,Wpe,tue,sue,Gpe,qpe,Xpe,Qpe,Zpe,aue,Yce,tfe,sfe,ife,afe,ufe,hfe,Lle,wfe,bfe,Sfe,Ade];for(const t of Tfe)pO(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const su={},Fg={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Cfe(t,e){su[t]=e}function Hi(t,e){if(!(t in su)||e!=null){const s=Efe(t,e);if(s!==null)su[t]=s;else return console.log("Could not get context for WebGL version",t),null}const n=su[t];return n==null||n.isContextLost()?(delete su[t],Hi(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),su[t])}function kfe(t){if(!te().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Efe(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??kfe(t);return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete su[t]},!1),te().getBool("SOFTWARE_WEBGL_ENABLED")&&(Fg.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",Fg)||n.getContext("experimental-webgl",Fg):n.getContext("webgl2",Fg)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var tf;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(tf||(tf={}));var Rr;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(Rr||(Rr={}));var Jn;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Jn||(Jn={}));function Lm(t,e){return[e,t]}function _fe(t,e){return t*e}function Lg(t){const e=re(t),n=Math.ceil(e/4);return j2(n)}function ed(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function Nfe(t,e){const[n,s]=ed(t,e);return n*s*4}function $k(t,e){const n=t;let s,r,i,o,a,l,u,c,h,d;return te().getNumber("WEBGL_VERSION")===2?(s=n.R32F,r=n.R16F,i=n.RGBA16F,o=n.RGBA32F,a=n.RED,u=4,c=1,h=n.HALF_FLOAT,d=n.FLOAT,l=n.RGBA8):(s=t.RGBA,r=t.RGBA,i=t.RGBA,o=n.RGBA,a=t.RGBA,u=4,c=4,h=e!=null?e.HALF_FLOAT_OES:null,d=t.FLOAT,l=t.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:d}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ee(t,e){const n=e();return te().getBool("DEBUG")&&$fe(t),n}function $fe(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Ofe(t,e))}const Afe=596e-10,Rfe=65504;function Dfe(t){return!!(te().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||Afe<Math.abs(t)&&Math.abs(t)<Rfe)}function Ofe(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Mg(t,e){return pa(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function Pfe(t,e){const n=pa(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Ee(t,()=>t.shaderSource(n,e)),Ee(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function Ffe(t,e){const n=pa(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Ee(t,()=>t.shaderSource(n,e)),Ee(t,()=>t.compileShader(n)),te().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw C6(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const Lfe=/ERROR: [0-9]+:([0-9]+):/g;function C6(t,e){const n=Lfe.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const s=+n[1],r=t.split(`
`),i=r.length.toString().length+2,o=r.map((h,d)=>rh((d+1).toString(),i)+h);let a=0;for(let h=0;h<o.length;h++)a=Math.max(o[h].length,a);const l=o.slice(0,s-1),u=o.slice(s-1,s),c=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${rh(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function Mfe(t){return pa(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function Vfe(t,e){if(Ee(t,()=>t.linkProgram(e)),!te().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function wx(t,e){if(Ee(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function zfe(t,e){const n=pa(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Ee(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),Ee(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function Bfe(t,e){const n=pa(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Ee(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),Ee(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function Ufe(t){return pa(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function Wfe(t,e){const n=te().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const s=`[${t}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,r=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function jfe(t){return pa(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function z$(t,e,n,s,r,i,o){const a=t.getAttribLocation(e,n);return a===-1?!1:(Ee(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),Ee(t,()=>t.vertexAttribPointer(a,r,t.FLOAT,!1,i,o)),Ee(t,()=>t.enableVertexAttribArray(a)),!0)}function Gfe(t,e,n){Yfe(t,n),Ee(t,()=>t.activeTexture(t.TEXTURE0+n)),Ee(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function Hfe(t,e,n){return pa(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function qfe(t,e,n){return t.getUniformLocation(e,n)}function Kfe(t,e,n,s){Ee(t,()=>Gfe(t,e,s)),Ee(t,()=>t.uniform1i(n,s))}function xx(t,e,n){Ee(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),Ee(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function B$(t,e){Ee(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),Ee(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function Vg(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Xfe(t,e))}function Xfe(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function pa(t,e,n){const s=Ee(t,()=>e());if(s==null)throw new Error(n);return s}function Yfe(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const r=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Ph(t,e=2){return re(t.slice(0,t.length-e))}function Fh(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function zg(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Ph(t),...Fh(t)]),e}function Qfe(t,e=!1){let n=te().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=te().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&te().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),e&&(n=n*2,s=s*2,t=t.map((a,l)=>l>=t.length-2?TS(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=Tl(t).newShape);let r=re(t),i=null;t.length<=1&&r<=n?i=[1,r]:t.length===2&&t[0]<=n&&t[1]<=n?i=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?i=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?i=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?i=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(i=[t[0],t[1]*t[2]*t[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=Ph(t);let l=2,u=2;t.length&&([l,u]=Fh(t)),r=a*(l/2)*(u/2),i=j2(r).map(c=>c*2)}else i=j2(r);return i}function Bg(t){return t%2===0}function D1(t,e){if(t=t.slice(-2),e=e.slice(-2),ut(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],s=e[e.length-1];if(n===s||Bg(n)&&Bg(s)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&Bg(t[0])&&Bg(e[0])}let bx,Ix;function Jfe(t){if(bx==null){const e=Hi(t);bx=e.getParameter(e.MAX_TEXTURE_SIZE)}return bx}function Zfe(t){if(Ix==null){const e=Hi(t);Ix=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ix)}function eme(t){if(t===0)return 0;let e;const n=Hi(t);return si(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:si(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function si(t,e){return t.getExtension(e)!=null}function U$(t){try{if(Hi(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function tme(t){if(t===0)return!1;const e=Hi(t);if(t===1){if(!si(e,"OES_texture_float"))return!1}else if(!si(e,"EXT_color_buffer_float"))return!1;return Vb(e)}function nme(t){if(t===0)return!1;const e=Hi(t);if(t===1){if(!si(e,"OES_texture_float")||!si(e,"WEBGL_color_buffer_float"))return!1}else{if(si(e,"EXT_color_buffer_float"))return Vb(e);const s="EXT_color_buffer_half_float";if(si(e,s)){const r=e.getExtension(s);return sme(e,r)}return!1}return Vb(e)}function Vb(t){const e=$k(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(i),o}function sme(t,e){const n=$k(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(o),a}function rme(t){return t!==2?!1:Hi(t).fenceSync!=null}function Mm(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&F(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pe=te();Pe.registerFlag("HAS_WEBGL",()=>Pe.getNumber("WEBGL_VERSION")>0);Pe.registerFlag("WEBGL_VERSION",()=>U$(2)?2:U$(1)?1:0);Pe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Pe.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Pe.get("WEBGL_VERSION")===2);Pe.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Pe.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Pe.registerFlag("WEBGL_PACK",()=>Pe.getBool("HAS_WEBGL"));Pe.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_CLIP",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_REDUCE",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_LAZILY_UNPACK",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_CONV_IM2COL",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>Jfe(Pe.getNumber("WEBGL_VERSION")));Pe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>Zfe(Pe.getNumber("WEBGL_VERSION")));Pe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=Pe.getNumber("WEBGL_VERSION");return t===0?0:eme(t)});Pe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Pe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!$O());Pe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>tme(Pe.getNumber("WEBGL_VERSION")));Pe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Pe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Pe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Pe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>nme(Pe.getNumber("WEBGL_VERSION")));Pe.registerFlag("WEBGL_FENCE_API_ENABLED",()=>rme(Pe.getNumber("WEBGL_VERSION")));Pe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Pe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Pe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});Pe.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>$O()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});Pe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Pe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Pe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Pe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Pe.registerFlag("WEBGL_EXP_CONV",()=>!1);Pe.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Pe.getBool("IS_TEST"));Pe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Pe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Pe.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Pe.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ms(){let t,e,n,s,r,i,o,a,l,u;return te().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=te().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lc(t,e,n="index"){const s=Ve(e);return s.map((r,i)=>{const o=`int ${t[i]} = ${n} / ${r}`,a=i===s.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${r}`:`index -= ${t[i]} * ${r}`;return`${o}; ${a};`}).join("")}function iw(t,e,n="index"){const s=Ve(e);return s.map((r,i)=>{const o=`int ${t[i]} = ${n} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * outShapeStrides[${i}]`:`index -= ${t[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function ime(t,e){const n=t.length,s=t.map(i=>`${e}[${i}]`),r=new Array(n-1);r[n-2]=s[n-1];for(let i=n-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function ome(t,e,n="index"){const s=t.map((i,o)=>o),r=ime(s,e);return r.map((i,o)=>{const a=`int ${t[o]} = ${n} / ${r[o]}`,l=o===r.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${r[o]}`:`index -= ${t[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function Ak(t){const e=Ve(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function Rk(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const k6=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:E6}=Ine;function ame(t,e,n){const s=[];if(t.forEach(p=>{const f=re(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?s.push(`uniform float ${p.name}${f>1?`[${f}]`:""};`):(s.push(`uniform sampler2D ${p.name};`),s.push(`uniform int offset${p.name};`)),n.enableShapeUniforms){const{uniformShape:m}=Dk(n.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape);switch(m.length){case 1:s.push(`uniform int ${p.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${p.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${p.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${p.name}Shape;`);break}s.push(`uniform ivec2 ${p.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(p=>{s.push(`uniform ${p.type} ${p.name}${p.arrayIndex?`[${p.arrayIndex}]`:""};`)});const r=s.join(`
`),i=t.map(p=>lme(p,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=e.texShape,a=Ms(),l=hme(a);let u,c,h=fme(a);return e.isPacked?(u=ume(e.logicalShape,o,n.enableShapeUniforms),c=pme(a)):(u=cme(e.logicalShape,o,n.enableShapeUniforms),c=dme(a)),n.packedInputs&&(h+=vme),[h,l,c,r,u,i,n.userCode].join(`
`)}function td(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return $me(t,e);case 1:return Rme(t,e);case 2:return Ome(t,e);case 3:return Fme(t,e);case 4:return Mme(t,e);case 5:return Vme(t);case 6:return zme(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function _6(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return Nme(t);case 1:return Ame(t,e);case 2:return Dme(t,e);case 3:return Pme(t,e);default:return Lme(t,e)}}function lme(t,e,n=!1,s){let r="";n?r+=_6(t,s):r+=td(t,s);const i=t.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(n?r+=Bme(t,e):r+=Ume(t,e)),r}function ume(t,e,n){switch(t.length){case 0:return N6();case 1:return wme(t,e,n);case 2:return Eme(t,e,n);case 3:return bme(t,e,n);default:return Sme(t,e,n)}}function cme(t,e,n){switch(t.length){case 0:return N6();case 1:return xme(t,e,n);case 2:return _me(t,e,n);case 3:return Ime(t,e,n);case 4:return Tme(t,e,n);case 5:return Cme(t,e);case 6:return kme(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function hme(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function dme(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function pme(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function fme(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${mme}
    ${gme}
    ${yme}
  `}const mme=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,gme=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,yme=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,vme=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function N6(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function wme(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function xme(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function bme(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),i=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function Ime(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${iw(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const s=lc(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function Sme(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),i=r*Math.ceil(t[t.length-2]/2);let o=i,a="",l="b, r, c";for(let u=2;u<t.length-1;u++)o*=t[t.length-u-1],a=`
      int b${u} = index / ${o};
      index -= b${u} * ${o};
    `+a,l=`b${u}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${l});
    }
  `}function Tme(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${iw(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const s=lc(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function Cme(t,e){const n=lc(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function kme(t,e){const n=lc(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Eme(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(ut(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function _me(t,e,n){return ut(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function uc(t){return`offset${t}`}function Nme(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=Ms();return`
    vec4 ${n}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function $me(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[r,i]=t.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=uc(n);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function Ame(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,i=Ms();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${n}, uv);
    }
  `}function Rme(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${nd(t)}
      }
    `;const r=t.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=uc(n);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${n}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function Dme(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape,o=i[0],a=i[1],l=Ms();if(i!=null&&ut(n,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function Ome(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape;if(i!=null&&ut(n,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const d=i[0],p=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${d}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=Tl(n),l=o;if(l.length<n.length){const d=sd(t,l),p=["row","col"];return`
      ${td(d,e)}
      float ${r}(int row, int col) {
        return ${r}(${rd(p,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${nd(t)}
      }
    `;const u=i[0],c=i[1],h=uc(s);return c===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${h};
    vec2 uv = uvFromFlat(${u}, ${c}, index);
    return sampleTexture(${s}, uv);
  }
`}function Pme(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(n[0]===1){const d=n.slice(1),p=[1,2],f=sd(t,d),m=["b","row","col"];return`
        ${_6(f,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${rd(m,p)});
        }
      `}const a=Ms();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],u=o[1],c=Math.ceil(n[2]/2),h=c*Math.ceil(n[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${h}, ${c}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function Fme(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n[1]*n[2],o=n[2],{newShape:a,keptDims:l}=Tl(n),u=a;if(u.length<n.length){const m=sd(t,u),v=["row","col","depth"];return`
        ${td(m,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${rd(v,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${nd(t)}
      }
    `;const c=t.shapeInfo.texShape,h=c[0],d=c[1],p=t.shapeInfo.flatOffset;if(d===i&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${h}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(d===o&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `;const f=uc(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${f};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${f};
        vec2 uv = uvFromFlat(${h}, ${d}, index);
        return sampleTexture(${s}, uv);
      }
  `}function Lme(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=Ms();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${n}, uv);
    }
  `;const i=t.shapeInfo.logicalShape,o=i.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],c=l[1],h=Math.ceil(i[o-1]/2);let d=h*Math.ceil(i[o-2]/2),p="int b, int row, int col",f=`b * ${d} + (row / 2) * ${h} + (col / 2)`;for(let m=2;m<o-1;m++)p=`int b${m}, `+p,d*=i[o-m-1],f=`b${m} * ${d} + `+f;return`
    vec4 ${s}(${p}) {
      int index = ${f};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${u});
      return ${r.texture2D}(${n}, uv);
    }
  `}function Mme(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n[3],o=n[2]*i,a=n[1]*o,{newShape:l,keptDims:u}=Tl(n);if(l.length<n.length){const w=sd(t,l),b=["row","col","depth","depth2"];return`
      ${td(w,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${rd(b,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${nd(t)}
      }
    `;const c=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],p=h[1],f=`int stride2 = ${s}Shape[3];`,m=`int stride1 = ${s}Shape[2] * stride2;`,v=`int stride0 = ${s}Shape[1] * stride1;`;if(p===a&&c==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${f}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(p===i&&c==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${s}, uv);
      }
    `;const y=uc(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${f}
      ${m}
      ${v}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${y});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${d}, ${p}, index + ${y});
      return sampleTexture(${s}, uv);
    }
  `}function Vme(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:u}=Tl(e);if(l.length<e.length){const m=sd(t,l),v=["row","col","depth","depth2","depth3"];return`
      ${td(m)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${rd(v,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${nd(t)}
      }
    `;const c=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],p=h[1];if(p===a&&c==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===r&&c==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;const f=uc(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${f};
      vec2 uv = uvFromFlat(${d}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function zme(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:i}=Tl(e);if(r.length<e.length){const v=sd(t,r),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${td(v)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${rd(y,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,u=e[2]*l,c=e[1]*u;if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${nd(t)}
      }
    `;const h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],f=d[1];if(f===c&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===o&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;const m=uc(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${m};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${n}, uv);
    }
  `}function nd(t){const e=t.name,n=re(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function Bme(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",i=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=E6(t.shapeInfo.logicalShape,e.logicalShape),l=Dt(o),u=o-i;let c;const h=["x","y","z","w","u","v"];i===0?c="":o<2&&a.length>=1?c="coords = 0;":c=a.map(w=>`coords.${h[w+u]} = 0;`).join(`
`);let d="";o<2&&i>0?d="coords":d=t.shapeInfo.logicalShape.map((w,b)=>`coords.${h[b+u]}`).join(", ");let p="return outputValue;";const m=re(t.shapeInfo.logicalShape)===1,y=re(e.logicalShape)===1;if(i===1&&!m&&!y)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!y)o===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(a.length){const w=i-2,b=i-1;a.indexOf(w)>-1&&a.indexOf(b)>-1?p="return vec4(outputValue.x);":a.indexOf(w)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(b)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${s}(${d});
      ${p}
    }
  `}function Ume(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&ut(o,i))return`
      float ${r}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const u=Dt(l),c=E6(t.shapeInfo.logicalShape,e.logicalShape),h=l-a;let d;const p=["x","y","z","w","u","v"];a===0?d="":l<2&&c.length>=1?d="coords = 0;":d=c.map(m=>`coords.${p[m+h]} = 0;`).join(`
`);let f="";return l<2&&a>0?f="coords":f=t.shapeInfo.logicalShape.map((m,v)=>`coords.${p[v+h]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${d}
      return get${s}(${f});
    }
  `}function Dt(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function Dk(t,e,n){const{newShape:s,keptDims:r}=Tl(e),i=e.length,o=t&&i===3&&e[0]===1,a=o?e.slice(1):s,l=!t&&i>1&&!ut(e,n)&&s.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function sd(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function rd(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wme(t,e,n,s){const r=n.map((c,h)=>{const d={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(d.flatOffset=c.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:d}}),i=r.map(c=>c.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=ame(r,o,e),l=Ffe(t.gl,a),u=t.createProgram(l);return te().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o},$6(t,e,u)))}function $6(t,e,n){const s=[],r=[];let i,o,a,l=null,u=null;u=t.getUniformLocation(n,"NAN",!1),te().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const c=!1;for(const h of e.variableNames){const d={name:h,uniform:t.getUniformLocation(n,h,c),offset:t.getUniformLocation(n,`offset${h}`,c)};e.enableShapeUniforms&&(d.shape=t.getUniformLocation(n,`${h}Shape`,c),d.texShape=t.getUniformLocation(n,`${h}TexShape`,c)),s.push(d)}if(e.enableShapeUniforms&&(i=t.getUniformLocation(n,"outShape",c),a=t.getUniformLocation(n,"outShapeStrides",c),o=t.getUniformLocation(n,"outTexShape",c)),e.customUniforms)for(const h of e.customUniforms)r.push(t.getUniformLocation(n,h.name,c));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function W$(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,s)=>{const r=n.logicalShape,i=e[s],o=i.shape;if(!ut(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(n.isUniform&&i.isUniform)return;const a=n.texShape,l=i.isUniform?null:i.texData.texShape;if(!ut(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function jme(t,e,n,s,r){e.program.enableShapeUniforms||(W$(e.inShapeInfos,n),W$([e.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):t.setOutputMatrixTexture(i.texture,o[0],o[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),te().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const u=n[l],{uniform:c,offset:h,shape:d,texShape:p}=e.variablesLocations[l];if(d){const{uniformShape:f}=Dk(e.program.packedInputs,u.shape,u.texData.texShape);switch(f.length){case 1:t.gl.uniform1iv(d,new Int32Array(f));break;case 2:t.gl.uniform2iv(d,new Int32Array(f));break;case 3:t.gl.uniform3iv(d,new Int32Array(f));break;case 4:t.gl.uniform4iv(d,new Int32Array(f));break}}if(p&&t.gl.uniform2i(p,u.texData.texShape[0],u.texData.texShape[1]),c!=null){if(u.isUniform){if(re(u.shape)<2)t.gl.uniform1f(c,u.uniformValues[0]);else{let f=u.uniformValues;f instanceof Float32Array||(f=new Float32Array(f)),t.gl.uniform1fv(c,f)}continue}u.texData.slice!=null&&h!=null&&t.gl.uniform1i(h,u.texData.slice.flatOffset),t.setInputMatrixTexture(u.texData.texture.texture,c,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=Ve(s.shape);switch(s.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],c=e.customUniformLocations[l],h=r[l];if(u.type==="float")t.gl.uniform1fv(c,h);else if(u.type==="vec2")t.gl.uniform2fv(c,h);else if(u.type==="vec3")t.gl.uniform3fv(c,h);else if(u.type==="vec4")t.gl.uniform4fv(c,h);else if(u.type==="int")t.gl.uniform1iv(c,h);else if(u.type==="ivec2")t.gl.uniform2iv(c,h);else if(u.type==="ivec3")t.gl.uniform3iv(c,h);else if(u.type==="ivec4")t.gl.uniform4iv(c,h);else throw Error(`uniform type ${u.type} is not supported yet.`)}t.executeProgram()}function Gme(t,e,n){let s="";e.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:u,uniformShape:c,keptDims:h}=Dk(t.packedInputs,o.shape,l);let d="",p="",f="";if(c.length===1&&t.packedInputs){const k=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];d=`${k[0]>1}_${k[1]>1}`}else if(c.length===2&&!t.packedInputs)p=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!t.packedInputs){const k=Ve(c);f=`${k[0]===l[1]}_${k[k.length-1]===l[1]}`}const m=o.shape.length,v=c.length===2&&ut(o.shape,l),y=re(o.shape)===1,w=_h(o.shape,n.shape),b=!t.packedInputs&&m===n.shape.length&&ut(l,n.texData.texShape),I=t.packedInputs||c.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${m}_${b}_${u?h:""}_${c.length}_${y}_${w}_${v}_${d}_${p}_${f}_${I}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const r=t.userCode;let i=t.constructor.name;return i+="_"+s+"_"+r+`${te().getNumber("WEBGL_VERSION")}`,i}function bs(t){return te().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hme{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=tf.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Ms();this.outputShape=e,this.enableShapeUniforms=bs(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?iw(["r","c","d"],e):lc(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qme{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=tf.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Ms();this.outputShape=e,this.enableShapeUniforms=bs(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?iw(["r","c","d"],e):lc(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kme{constructor(e){this.variableNames=["A"],this.outTexUsage=Rr.DOWNLOAD;const n=Ms();this.outputShape=e,this.userCode=`
      ${k6}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xme{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Rr.DOWNLOAD;const n=Ms();this.outputShape=e,this.userCode=`
      ${k6}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yme={R:0,G:1,B:2,A:3};class j${constructor(e,n=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Ms();this.outputShape=e,this.enableShapeUniforms=bs(this.outputShape.length);let i="result";n&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${Yme[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Rk():Ak(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qme{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Ms();this.outputShape=e,this.enableShapeUniforms=bs(this.outputShape.length);let r="",i="result";n&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Rk():Ak(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jme(t){const e=Ms(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return Pfe(t,n)}function Zme(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return zfe(t,e)}function ege(t){const e=new Uint16Array([0,1,2,2,1,3]);return Bfe(t,e)}function Vm(t,e,n,s,r,i){Wfe(e,n);const o=Ufe(t),a=t.TEXTURE_2D;return Ee(t,()=>t.bindTexture(a,o)),Ee(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),Ee(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),Ee(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),Ee(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),te().getNumber("WEBGL_VERSION")===1?Ee(t,()=>t.texImage2D(a,0,s,e,n,0,r,i,null)):Ee(t,()=>t.texStorage2D(a,1,s,e,n)),Ee(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:o,texShape:[n,e]}}function A6(t){return t.internalFormatFloat}function tge(t,e,n,s){const[r,i]=Lm(e,n);return Vm(t,r,i,A6(s),s.textureFormatFloat,t.FLOAT)}function R6(t){return t.internalFormatHalfFloat}function nge(t,e,n,s){const[r,i]=Lm(e,n);return Vm(t,r,i,R6(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function D6(t){return t.downloadTextureFormat}function sge(t,e,n,s){const[r,i]=Lm(e,n);return Vm(t,r,i,D6(s),t.RGBA,t.UNSIGNED_BYTE)}function O6(t){return t.internalFormatPackedFloat}function rge(t,e,n,s){const[r,i]=ed(e,n);return Vm(t,r,i,O6(s),t.RGBA,t.FLOAT)}function P6(t){return t.internalFormatPackedHalfFloat}function ige(t,e,n,s){const[r,i]=ed(e,n);return Vm(t,r,i,P6(s),t.RGBA,s.textureTypeHalfFloat)}function oge(t,e,n){return Ee(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),z$(t,e,"clipSpacePos",n,3,20,0)&&z$(t,e,"uv",n,2,20,12)}function age(t,e,n,s,r,i){Ee(t,()=>t.bindTexture(t.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(n*s*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(o=new Float32Array(n*s*4),a=t.FLOAT,l=i.internalFormatPackedFloat),o.set(r),te().getNumber("WEBGL_VERSION")===2?Ee(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,s,t.RGBA,a,o)):Ee(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,s,0,t.RGBA,a,o)),Ee(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function lge(t,e,n){Ee(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?te().getNumber("WEBGL_VERSION")===2?Ee(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):Ee(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):te().getNumber("WEBGL_VERSION")===2?Ee(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):Ee(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),Ee(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function uge(t,e,n,s){const r=t.createBuffer();Ee(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,r));const a=4*4*e*n;return Ee(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),Ee(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),Ee(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),r}function cge(t,e,n){const s=t,r=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function hge(t,e,n,s){const[r,i]=Lm(e,n),o=4,a=new Uint8Array(_fe(e*n,o));return Ee(t,()=>t.readPixels(0,0,r,i,s.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function dge(t,e,n,s,r,i,o,a){const l=t,u=new Float32Array(Nfe(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function pge(t,e,n){const s=new Float32Array(e*n*4);return Ee(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sx{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=te().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,Cfe(n,e)):this.gl=Hi(n),e=this.gl,te().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>Ee(i,()=>i.createVertexArray()),this.bindVertexArray=o=>Ee(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>Ee(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>Ee(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Ee(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>Ee(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Ee(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>Ee(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),te().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=Mg(this.gl,i),si(this.gl,o))this.textureHalfFloatExtension=Mg(this.gl,o);else if(te().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),si(this.gl,r))this.colorBufferHalfFloatExtension=Mg(this.gl,r);else if(te().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",si(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(si(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Zme(this.gl),this.indexBuffer=ege(this.gl),this.framebuffer=jfe(this.gl),this.textureConfig=$k(this.gl,this.textureHalfFloatExtension)}get debug(){return te().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Ee(e,()=>e.finish()),Ee(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Ee(e,()=>e.deleteFramebuffer(this.framebuffer)),Ee(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Ee(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Ee(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),tge(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),nge(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),sge(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),lge(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,s,r){this.throwIfDisposed(),age(this.gl,e,n,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),ige(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),rge(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(B$(this.gl,this.framebuffer),this.outputTexture=null),Ee(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,s){return this.downloadMatrixDriver(e,()=>hge(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,s,r,i,o){return dge(this.gl,e,n,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return cge(this.gl,e,n)}createBufferFromTexture(e,n,s){this.bindTextureToFrameBuffer(e);const r=uge(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,s;if(te().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},n=i}else te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(e,n,s){return this.downloadMatrixDriver(e,()=>pge(this.gl,n,s))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=Jme(n));const s=Mfe(n);Ee(n,()=>n.attachShader(s,this.vertexShader)),Ee(n,()=>n.attachShader(s,e)),Vfe(n,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&wx(n,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;Ee(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),oge(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Ee(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&wx(this.gl,this.program),Ee(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,s=!0){return this.throwIfDisposed(),s?Hfe(this.gl,e,n):qfe(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),Ee(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),Kfe(this.gl,e,n,s)}setOutputMatrixTexture(e,n,s){this.setOutputMatrixTextureDriver(e,s,n)}setOutputPackedMatrixTexture(e,n,s){this.throwIfDisposed();const[r,i]=ed(n,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,n,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,n)}setOutputPackedMatrixWriteRegion(e,n,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&wx(this.gl,this.program),Vg(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Ee(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Ee(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Mg(this.gl,te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await CN(()=>this.disposed||this.isQueryAvailable(e,te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=fge(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in te().platform&&(s=te().platform.setTimeoutCustom.bind(te().platform)),CN(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),xx(this.gl,e,this.framebuffer),this.debug&&Vg(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(xx(this.gl,this.outputTexture,this.framebuffer),this.debug&&Vg(this.gl)):B$(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,n,s){this.throwIfDisposed();const r=this.gl;xx(r,e,this.framebuffer),this.debug&&Vg(r),this.outputTexture=e,Ee(r,()=>r.viewport(0,0,n,s)),Ee(r,()=>r.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(e,n,s,r){this.throwIfDisposed(),Ee(this.gl,()=>this.gl.scissor(e,n,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function fge(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:mge,bincountImpl:F6,bincountReduceImpl:gge,bitwiseAndImpl:yge,castImpl:vge,ceilImpl:wge,concatImpl:xge,equalImpl:bge,expImpl:Ige,expm1Impl:Sge,floorImpl:Tge,gatherNdImpl:Cge,gatherV2Impl:kge,greaterImpl:Ege,greaterEqualImpl:_ge,lessImpl:Nge,lessEqualImpl:$ge,linSpaceImpl:Age,logImpl:Rge,maxImpl:Dge,maximumImpl:Oge,minimumImpl:Pge,multiplyImpl:Fge,negImpl:Lge,notEqualImpl:Mge,prodImpl:Vge,raggedGatherImpl:zge,raggedRangeImpl:Bge,raggedTensorToTensorImpl:Uge,rangeImpl:Wge,rsqrtImpl:jge,scatterImpl:Gge,sigmoidImpl:Hge,simpleAbsImpl:L6,sliceImpl:qge,sparseFillEmptyRowsImpl:Kge,sparseReshapeImpl:Xge,sparseSegmentReductionImpl:M6,sqrtImpl:Yge,staticRegexReplaceImpl:Qge,stridedSliceImpl:Jge,stringNGramsImpl:Zge,stringSplitImpl:eye,stringToHashBucketFastImpl:tye,subImpl:nye,tileImpl:sye,topKImpl:rye,transposeImpl:Ok,uniqueImpl:iye}=lue;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V6(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function Rs(t,e){return e===1?[t]:V6(t,e)}function oye(t,e){if(t===1)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aye{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=bs(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=Rs("rc",this.rank),s=Dt(this.rank),r=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;n.push(i)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z6{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=bs(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${lye(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Rk():Ak(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function lye(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?ome(["r","c","d"],"inputShape"):lc(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uye{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,s){const r=H$(n,s),i=q$(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=G$(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return r===Jn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Jn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Jn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Jn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Jn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,n,s,r){if(this.freeTextures==null)return;const i=H$(s,r),o=q$(n,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=G$(n,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=te().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[o],c=u&&u.indexOf(e);if(c==null||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[c]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function cye(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function G$(t,e,n,s,r){const i=hye(e,s);let o;if(r){const[l,u]=ed(t[0],t[1]);o=l*u}else{const[l,u]=Lm(t[0],t[1]);o=l*u}const a=cye(n,i);return o*a}function hye(t,e){switch(t){case Jn.PACKED_2X2_FLOAT32:return O6(e);case Jn.PACKED_2X2_FLOAT16:return P6(e);case Jn.UNPACKED_FLOAT32:return A6(e);case Jn.UNPACKED_FLOAT16:return R6(e);case Jn.PACKED_4X1_UNSIGNED_BYTE:return D6(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function dye(t){return te().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Jn.PACKED_2X2_FLOAT32:Jn.UNPACKED_FLOAT32:t?Jn.PACKED_2X2_FLOAT16:Jn.UNPACKED_FLOAT16}function H$(t,e){if(t===Rr.UPLOAD)return Jn.PACKED_2X2_FLOAT32;if(t===Rr.RENDER||t==null)return dye(e);if(t===Rr.DOWNLOAD||t===Rr.PIXELS)return Jn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function q$(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fo{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=bs(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const mi="if (isnan(x)) return x;",pye="return x;",K$="return abs(x);",fye="return (x >= 0.0) ? x : (exp(x) - 1.0);",mye=mi+`
  return (x < 0.0) ? 0.0 : x;
`,gye=mi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Na="return x;",yye="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vye="return x;",wye=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,xye=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,bye=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Iye="return 1.0 / (1.0 + exp(-1.0 * x));";class za{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=bs(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sye{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=bs(this.outputShape.length);const n=e.length,s=Rs("rc",n),r=Dt(n),i=oye(n,s),o=s.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tye=yC,Cye=1e-7,kye=1e-4,Ug={};function Eye(t){return t in Ug||(Ug[t]={}),Ug[t]}const _ye=te().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Nye=600;function $ye(){return te().global.screen==null?1024:te().global.screen.height*te().global.screen.width*window.devicePixelRatio*Nye/1024/1024}class ow extends SS{nextDataId(){return ow.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!te().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof Sx)n=e;else{const s=Hi(te().getNumber("WEBGL_VERSION"),e);n=new Sx(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Hi(te().getNumber("WEBGL_VERSION"));n=new Sx(s),this.binaryCache=Eye(te().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new uye(this.gpgpu),this.numMBBeforeWarning=$ye(),this.texData=new oO(this,ao())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,s,r,i,o){const a=this.makeTensorInfo(n,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const u=zg(n),c=new j$(u,!1,o),h=this.runWebGLProgram(c,[a],s,[[r,i]]);return h.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(e,n,s){if((te().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||te().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:n,dtype:s,values:e,usage:Rr.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,s,r,i){if(te().getBool("DEBUG")&&this.checkNumericalProblems(n),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:n,usage:Rr.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=n;if(o!=null){let d;l?d=new za(a,Na):d=new fo(a,Na);const p=this.runWebGLProgram(d,[{dataId:e,shape:a,dtype:r}],r),f=this.readSync(p.dataId);return this.disposeIntermediateTensorInfo(p),f}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let c;u&&(c=Gs());let h;if(r==="complex64"){const d=this.readSync(i.real.dataId),p=this.readSync(i.imag.dataId);h=ra(d,p)}else h=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=Gs()-c),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const f=this.pendingRead.get(e);return new Promise(m=>f.push(m))}const n=this.texData.get(e),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=n;if(i!=null){let f;l?f=new za(r,Na):f=new fo(r,Na);const m=this.runWebGLProgram(f,[{dataId:e,shape:r,dtype:o}],o),v=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),v}if(s!=null)return this.convertAndCacheOnCPU(e);if(te().getBool("DEBUG")&&!te().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&te().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,c;if(o!=="complex64"&&te().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(e);const f=this.texData.get(c.dataId);u=this.gpgpu.createBufferFromTexture(f.texture.texture,...Lg(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(o==="complex64"){const f=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=f[0],v=f[1];h=ra(m,v)}else if(u==null)h=this.getValuesFromTexture(e);else{const f=re(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(u,f)}if(c!=null&&this.disposeIntermediateTensorInfo(c),u!=null){const f=this.gpgpu.gl;Ee(f,()=>f.deleteBuffer(u))}const d=this.convertAndCacheOnCPU(e,h),p=this.pendingRead.get(e);return this.pendingRead.delete(e),p.forEach(f=>f(d)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&ao().removeDataId(e,this),this.pendingDeletes--),d}readToGPU(e,n={}){const s=this.texData.get(e),{values:r,shape:i,slice:o,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let p;l?p=new za(i,Na):p=new fo(i,Na);const f=this.runWebGLProgram(p,[{dataId:e,shape:i,dtype:a}],a),m=this.readToGPU(f,n);return this.disposeIntermediateTensorInfo(f),m}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(e,n.customTexShape),h=ao().makeTensorFromTensorInfo(c),d=this.texData.get(c.dataId);return Object.assign({tensorRef:h},d.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>ll(r));return tt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return tt(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const s=e[n];if(!Dfe(s))throw te().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:s,isPacked:r}=this.texData.get(e),i=re(n);if(te().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const d=this.decode(e),p=this.texData.get(d.dataId),f=this.gpgpu.downloadMatrixFromPackedTexture(p.texture.texture,...Lg(n)).subarray(0,i);return this.disposeIntermediateTensorInfo(d),f}const o=te().getBool("WEBGL_PACK")&&r===!0,a=o?zg(n):n,l=o?new Xme(a):new Kme(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),c=this.texData.get(u.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),h}timerAvailable(){return te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=Ou(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Ou(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=Hq(l),a.getExtraProfileInfo=()=>l.map((u,c)=>({name:o[c],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Gs(),endMs:null}}endTimer(e){return te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Gs(),e)}async getQueryTime(e){if(te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(n,r,i,o)));const c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=_ye){return te().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&re(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){Nr("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return Tye(e.shape,n)}packedUnaryOp(e,n,s){const r=new za(e.shape,n),i=this.compileAndRun(r,[e],s);return ao().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=L6(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(te().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,K$,e.dtype);const n=new fo(e.shape,K$),s=this.compileAndRun(n,[e]);return ao().makeTensorFromTensorInfo(s)}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&bf(s[0])){const i=s.map(o=>Ja(o));r=this.write(i,e,n)}else r=this.write(s,e,n);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:n}}makeOutput(e,n,s){return ao().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,s),this)}unpackTensor(e){const n=new Sye(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new aye(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const s=[Ph(e.shape),...Fh(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[Ph(n),...Fh(n)],o=new z6(i,s),a=!0,l=[s],u=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:u.dataId,shape:n,dtype:u.dtype}}decode(e,n){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=s;if(n!=null){const d=re(i),p=n[0]*n[1]*4;F(d<=p,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=zg(i);let l;r?l=new qme(a):l=new Hme(a);const u=!0,c=[n??Lg(a)],h=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,c,u,n);return{dtype:o,shape:i,dataId:h.dataId}}runWebGLProgram(e,n,s,r,i=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===tf.DENSE){const y=o??Lg(e.outputShape);l.texShape=y.map(w=>w*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),re(a.shape)===0)return l.values=ts(a.dtype,0),a;const u=[],c=n.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let w=this.texData.get(y.dataId);if(w.texture==null){if(!e.packedInputs&&re(y.shape)<=te().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:w.values};e.packedInputs&&(w.isPacked=!0,w.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!w.isPacked!=!!e.packedInputs)y=w.isPacked?this.unpackTensor(y):this.packTensor(y),u.push(y),w=this.texData.get(y.dataId);else if(w.isPacked&&!D1(w.shape,y.shape)){const b=y,I=y.shape;y.shape=w.shape,y=this.packedReshape(y,I),u.push(y),w=this.texData.get(y.dataId),b.shape=I}return{shape:y.shape,texData:w,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:l,isUniform:!1},d=Gme(e,c,h),p=this.getAndSaveBinary(d,()=>Wme(this.gpgpu,e,c,h)),f=this.activeTimers!=null;let m;f&&(m=this.startTimer()),te().get("ENGINE_COMPILE_ONLY")||jme(this.gpgpu,p,c,h,r),u.forEach(y=>this.disposeIntermediateTensorInfo(y)),f&&(m=this.endTimer(m),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(m)}));const v=te().getNumber("WEBGL_FLUSH_THRESHOLD");if(v>0){const y=Gs();y-this.lastGlFlushTime>v&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!te().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(e,n,s,r,i=!1){return s=s||n[0].dtype,this.runWebGLProgram(e,n,s,r,i)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(te().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Y(()=>{if(!te().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=te().getBool("DEBUG");te().set("DEBUG",!1);const n=this.abs(Be(1e-8)).dataSync()[0];if(te().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Cye:kye}uploadToGPU(e){const n=this.texData.get(e),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:l}=n;if(o!=null)return;const u=this.activeTimers!=null;let c;u&&(c=Gs());let h=n.texShape;if(h==null&&(h=Qfe(s,l),n.texShape=h),i!=null){const d=zg(s);let p,f=h[1],m=h[0];const v=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!v)&&([f,m]=ed(h[0],h[1])),l?p=new Qme(d,v):p=new j$(d,v);const y=v?[m,f]:h,w=this.makeTensorInfo(y,r),b=this.texData.get(w.dataId);v?b.usage=Rr.PIXELS:b.usage=Rr.UPLOAD,b.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),f,m,i);const I=[[m,f]],R=this.runWebGLProgram(p,[w],r,I,!0),C=this.texData.get(R.dataId);n.texShape=C.texShape,n.isPacked=C.isPacked,n.usage=C.usage,te().get("ENGINE_COMPILE_ONLY")?this.disposeData(R.dataId):(n.texture=C.texture,n.values=null,this.texData.delete(R.dataId)),this.disposeIntermediateTensorInfo(w),u&&(this.uploadWaitMs+=Gs()-c)}else{const d=this.acquireTexture(h,a,r,l);n.texture=d}}convertAndCacheOnCPU(e,n){const s=this.texData.get(e),{dtype:r}=s;return n!=null&&(s.values=Aye(n,r)),s.values}acquireTexture(e,n,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,r)}computeBytes(e,n){return e[0]*e[1]*a1(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(n),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await TF(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(C6(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=$6(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=e,l=ao().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,n,s,i,o,a);return ao().makeTensorFromDataId(u,n,s,l)}}ow.nextDataId=0;function Aye(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let s=0;s<n.length;++s)n[s]=Math.round(t[s]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */AO()&&OO("webgl",()=>new ow,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pk=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Hu{constructor(e,n,s){this.variableNames=["A","B"],this.outputShape=Qe(n,s),this.enableShapeUniforms=bs(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cc=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class id{constructor(e,n,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Qe(n,s);const i=this.outputShape.length;this.enableShapeUniforms=bs(i);let o="";if(r)if(i===0||re(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${Dt(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=Rs("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function br(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const Rye={kernelName:Uf,backendName:"webgl",kernelFunc:br};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pl(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,i=n.makeTensorInfo(s.shape,"complex64"),o=n.texData.get(i.dataId),a=br({inputs:{x:s},backend:n}),l=br({inputs:{x:r},backend:n});return o.complexTensorInfos={real:a,imag:l},i}const Dye={kernelName:DS,backendName:"webgl",kernelFunc:Pl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B6="return (a < 0.) ? b * a : a;",U6=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Oye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:i}=s,o=n.makeTensorInfo([],"float32",Cl(i,"float32")),a=te().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new id(U6,r.shape,o.shape):new Hu(B6,r.shape,o.shape),l=n.runWebGLProgram(a,[r,o],"float32");return n.disposeIntermediateTensorInfo(o),l}const Pye={kernelName:V0,backendName:"webgl",kernelFunc:Oye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W6="return (a < 0.) ? b * a : a;",j6=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Fye(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e,i=te().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new id(j6,s.shape,r.shape):new Hu(W6,s.shape,r.shape);return n.runWebGLProgram(i,[s,r],"float32")}const Lye={kernelName:rv,backendName:"webgl",kernelFunc:Fye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const od="if (isnan(x)) return x;";function gt({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const h=a.texData.get(o.dataId),d=n(h.values,l);return a.makeTensorInfo(o.shape,l,d)}const u=te().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let c;return u?c=new za(o.shape,e):c=new fo(o.shape,t),a.runWebGLProgram(c,[o],l)}}function os({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:u}=o,c=a;if(s&&l.dtype==="complex64"){const f=c.texData.get(l.dataId),m=c.texData.get(u.dataId),[v,y]=[[f.complexTensorInfos.real,m.complexTensorInfos.real],[f.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(b=>{const[I,k]=b,R={dataId:I.dataId,dtype:I.dtype,shape:l.shape},C={dataId:k.dataId,dtype:k.dtype,shape:u.shape},T=new Hu(t,l.shape,u.shape);return c.runWebGLProgram(T,[R,C],vr(I.dtype,k.dtype))}),w=Pl({inputs:{real:v,imag:y},backend:c});return c.disposeIntermediateTensorInfo(v),c.disposeIntermediateTensorInfo(y),w}const h=i||vr(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||c.shouldExecuteOnCPU([l,u]))&&r!=null){const f=c.texData.get(l.dataId).values,m=c.texData.get(u.dataId).values,v=l.dtype==="string"?ia(f):f,y=l.dtype==="string"?ia(m):m,[w,b]=r(l.shape,u.shape,v,y,h),I=c.makeTensorInfo(b,h),k=c.texData.get(I.dataId);return k.values=w,I}const d=te().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let p;return d?p=new id(e,l.shape,u.shape,n):p=new Hu(t,l.shape,u.shape),c.runWebGLProgram(p,[l,u],h)}}function nf(t,e=!1){if(t==="linear")return e?vye:pye;if(t==="relu")return e?xye:mye;if(t==="elu")return e?wye:fye;if(t==="relu6")return e?bye:gye;if(t==="prelu")return e?j6:W6;if(t==="leakyrelu")return e?U6:B6;if(t==="sigmoid")return e?Iye:yye;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G6{constructor(e,n,s,r=!1,i=!1,o=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=bs(this.outputShape.length);const c=r?e[1]:e[2],h=Math.ceil(c/2),d=r?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",f=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let v="",y="";a&&(l?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:v=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const w=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let b="rc.x",I="rc.x";e[0]<n[0]?b=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(I=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${v}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${b};
        int batchB = ${I};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${d});
          vec4 b = getMatrixB(batchB, ${p});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${f[0]} * ${m[0]});
          result += (${f[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${w}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X$={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class Y${constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Qe(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q$="return a * b;";function Fk(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,i=vr(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),u=new Y$(X$.REAL,s.shape,r.shape),c=new Y$(X$.IMAG,s.shape,r.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],d=n.runWebGLProgram(u,h,"float32"),p=n.runWebGLProgram(c,h,"float32"),f=Pl({inputs:{real:d,imag:p},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}if(n.shouldExecuteOnCPU([s,r])){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),[u,c]=Fge(s.shape,r.shape,a.values,l.values,i),h=n.makeTensorInfo(c,i),d=n.texData.get(h.dataId);return d.values=u,h}let o;return te().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new id(Q$,s.shape,r.shape):o=new Hu(Q$,s.shape,r.shape),n.runWebGLProgram(o,[s,r],i)}const Mye={kernelName:Qf,backendName:"webgl",kernelFunc:Fk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vye(t,e,n){const s=[Ph(t.shape),...Fh(t.shape)],r={dtype:t.dtype,shape:s,dataId:t.dataId},i=[Ph(e),...Fh(e)],o=new z6(i,s),a=!0,l=[s],u=n.runWebGLProgram(o,[r],t.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:i}=s,o=n,a=re(r.shape),l=aO(i,a),u=re(l);F(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const c=o.texData.get(r.dataId);return c.isPacked&&!D1(r.shape,l)&&!(c.texture!==null&&D1(c.shape,l))?Vye(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const zye={kernelName:ov,backendName:"webgl",kernelFunc:Ce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J${constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(n!=null){const h=1/n;u=`sumValue += dot(values * ${Th(h)?h.toPrecision(2):h}, ones);`}let c="";i%s>0&&(c=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bye{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?u="sumValue":n==="prod"?u="prodValue":n==="all"?u="allValue":n==="any"&&(u="anyValue");const c=Math.floor(s/4)*4,h=s%4;let d=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";n==="all"?(a="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):n==="any"&&(a="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");let f="";i%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${d}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===2}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===3}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${d}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uye(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],s=jv(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function hc(t,e,n,s){const r=Uye(t.shape);let i=t;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:u}=r[o];let c,h;n==="mean"?c=o===0?new J$({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},a):new J$({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u}):c=new Bye({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},n),h=i,i=s.runWebGLProgram(c,[i],e),h.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(h)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wye{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[n[o]];this.outputShape=s,this.rank=s.length;const r=Dt(this.rank),i=jye(n);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function jye(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<t.length;r++)s[t[r]]=n[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gye{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let c=0;c<s.length;c++)s[c]=e[n[c]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Dt(this.rank),i=V6("rc",this.rank),o=new Array(this.rank);for(let c=0;c<n.length;c++)o[n[c]]=i[c];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aw(t,e,n){const s=te().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Gye(t.shape,e):new Wye(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hye(t,e,n,s){const r=e,i=t.shape.length,o=st(r,t.shape);let a=o;const l=on(a,i),u=l!=null;let c=t;u&&(c=aw(t,l,s),a=xn(a.length,i)),rs("sum",a,i);const[h,d]=Gn(c.shape,a);let p=h;n&&(p=wn(h,o));const f=re(d),v=re(t.shape)/f,y=Ce({inputs:{x:c},attrs:{shape:[v,f]},backend:s}),w=RT(t.dtype),b=hc(y,w,"sum",s),I=Ce({inputs:{x:b},attrs:{shape:p},backend:s});return s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(b),u&&s.disposeIntermediateTensorInfo(c),I}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lw(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;return Hye(r,i,o,n)}const qye={kernelName:dv,backendName:"webgl",kernelFunc:lw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fs(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{perm:i}=s,o=n,a=r.shape.length,l=new Array(a);for(let c=0;c<l.length;c++)l[c]=r.shape[i[c]];let u;if(o.shouldExecuteOnCPU([r])){const h=o.texData.get(r.dataId).values,d=Ok(h,r.shape,r.dtype,i,l);u=o.makeTensorInfo(l,r.dtype);const p=o.texData.get(u.dataId);p.values=d}else u=aw(r,i,o);return u}const Kye={kernelName:ih,backendName:"webgl",kernelFunc:Fs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H6=1e3;function O1({a:t,b:e,transposeA:n,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=t.shape.length,c=e.shape.length,h=n?t.shape[u-2]:t.shape[u-1],d=s?e.shape[c-1]:e.shape[c-2],p=n?t.shape[u-1]:t.shape[u-2],f=s?e.shape[c-2]:e.shape[c-1],m=t.shape.slice(0,-2),v=e.shape.slice(0,-2),y=re(m),w=re(v),I=Qe(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,f]);F(h===d,()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const k=n?[y,h,p]:[y,p,h],R=s?[w,f,d]:[w,d,f],C=Ce({inputs:{x:t},backend:r,attrs:{shape:k}}),T=Ce({inputs:{x:e},backend:r,attrs:{shape:R}}),N=[C,T],$=Math.max(y,w),P=n?C.shape[1]:C.shape[2],V=i!=null,O=o!=null,Q=l==="leakyrelu",Z=l!=null?nf(l,!0):null,ne=V||O||Q||Z!=null;let le;if((p===1||f===1)&&P>H6&&ne===!1){let J=C,ie=T;n&&(J=Fs({inputs:{x:C},backend:r,attrs:{perm:[0,2,1]}}),N.push(J)),s&&(ie=Fs({inputs:{x:T},backend:r,attrs:{perm:[0,2,1]}}),N.push(ie));const he=f!==1,de=f===1;let pe=J;he&&(pe=Ce({inputs:{x:J},backend:r,attrs:{shape:[$,P,1]}}),N.push(pe));const xe=f===1?2:1;let ye=ie;de&&(ye=Ce({inputs:{x:ie},backend:r,attrs:{shape:[$,1,P]}}),N.push(ye));const Ie=Fk({inputs:{a:pe,b:ye},backend:r});le=lw({inputs:{x:Ie},backend:r,attrs:{axis:xe,keepDims:!0}}),N.push(Ie)}else{const J=vr(t.dtype,e.dtype),ie=new G6(k,R,[$,p,f],n,s,V,Z,O,Q),he=[C,T];if(i!=null&&he.push(i),O&&he.push(o),Q){const de=r.makeTensorInfo([],"float32",Cl(a,"float32"));he.push(de),N.push(de)}le=r.runWebGLProgram(ie,he,J)}const q=Ce({inputs:{x:le},backend:r,attrs:{shape:I}});N.push(le);for(const J of N)r.disposeIntermediateTensorInfo(J);return q}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xye(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=s;return O1({a:r,b:i,transposeA:l,transposeB:u,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:c})}const Yye={kernelName:l1,backendName:"webgl",kernelFunc:Xye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z$="return abs(x);";function Qye(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=n.texData.get(s.dataId),o=L6(i.values);return n.makeTensorInfo(s.shape,s.dtype,o)}let r;return te().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new za(s.shape,Z$):r=new fo(s.shape,Z$),n.runWebGLProgram(r,[s],s.dtype)}const Jye={kernelName:y0,backendName:"webgl",kernelFunc:Qye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zye=mi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,e1e=gt({opSnippet:Zye}),t1e={kernelName:If,backendName:"webgl",kernelFunc:e1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n1e=mi+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,s1e=gt({opSnippet:n1e}),r1e={kernelName:Sf,backendName:"webgl",kernelFunc:s1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eA="return a + b;",i1e=os({opSnippet:eA,packedOpSnippet:eA,supportsComplex:!0,cpuKernelImpl:mge}),o1e={kernelName:qh,backendName:"webgl",kernelFunc:i1e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a1e{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l1e{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fy(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return br({inputs:{x:s[0]},backend:n});if(s.length>te().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=fy({inputs:s.slice(0,l),backend:n}),c=fy({inputs:s.slice(l),backend:n});return fy({inputs:[u,c],backend:n})}const r=s.map(l=>l.dtype).reduce((l,u)=>vr(l,u)),i=s.map(l=>l.shape),a=te().getBool("WEBGL_PACK")?new l1e(s[0].shape,i):new a1e(s[0].shape,i);return n.runWebGLProgram(a,s,r)}const u1e={kernelName:v0,backendName:"webgl",kernelFunc:fy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=st(i,r.shape);let u=l;const c=on(u,a);let h=r;c!=null&&(h=Fs({inputs:{x:r},backend:n,attrs:{perm:c}}),u=xn(u.length,a)),rs("all",u,a);const[d,p]=Gn(h.shape,u),f=re(p),m=Ce({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),v=hc(m,m.dtype,"all",n);let y;if(o){const w=wn(d,l);y=Ce({inputs:{x:v},backend:n,attrs:{shape:w}})}else y=Ce({inputs:{x:v},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),c!=null&&n.disposeIntermediateTensorInfo(h),y}const h1e={kernelName:ES,backendName:"webgl",kernelFunc:c1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=st(i,r.shape);let u=l;const c=on(u,a);let h=r;c!=null&&(h=Fs({inputs:{x:r},backend:n,attrs:{perm:c}}),u=xn(u.length,a)),rs("any",u,a);const[d,p]=Gn(h.shape,u),f=re(p),m=Ce({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),v=hc(m,m.dtype,"any",n);let y;if(o){const w=wn(d,l);y=Ce({inputs:{x:v},backend:n,attrs:{shape:w}})}else y=Ce({inputs:{x:v},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),c!=null&&n.disposeIntermediateTensorInfo(h),y}const p1e={kernelName:_S,backendName:"webgl",kernelFunc:d1e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f1e{constructor(e,n,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=n==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m1e{constructor(e,n,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,F(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/n);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=Dt(l),c=Rs("coords",l);let h,d;if(o===1){d=l+1;const T=Dt(d);h=`
        ${T} sourceLocR = ${T}(${c.join()}, 0);
        ++${c[l-1]};
        ${T} sourceLocG = ${T}(${c.join()}, 0);
        ++${c[l-2]};
        ${T} sourceLocA = ${T}(${c.join()}, 0);
        --${c[l-1]};
        ${T} sourceLocB = ${T}(${c.join()}, 0);
        --${c[l-2]};`}else d=l,h=`
        ${u} sourceLocR = coords;
        ++${c[l-1]};
        ${u} sourceLocG = coords;
        ++${c[l-2]};
        ${u} sourceLocA = coords;
        --${c[l-1]};
        ${u} sourceLocB = coords;
        --${c[l-2]};`;const p=["x","y","z","w","u","v"].slice(0,d),f="."+p[d-1],m=p.map(T=>"int "+T),v=Rs("sourceLocR",d-1).concat("inIdx.r"),y=Rs("sourceLocG",d-1).concat("inIdx.g"),w=Rs("sourceLocB",d-1).concat("inIdx.b"),b=Rs("sourceLocA",d-1).concat("inIdx.a"),I=s==="max"?"greaterThan":"lessThan",k=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${b.join()})));`,R=`vec4(
            getAChannel(${v.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${w.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,C=r?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${p.join()}),
                                          vec2(${p.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${p.join()}),
                               vec2(${p.slice(-2).join()}));
      }
      ${C}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${c[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${c[l-2]} < ${a[l-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},
          sourceLocB${f}, sourceLocA${f}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${R};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${k}
          vec4 candidate = ${R};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${I}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q6(t,e,n,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=jv(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},l=new f1e(a,n,s==null),u=[e];s!=null&&u.push(s);const c=t.runWebGLProgram(l,u,"int32");if(c.shape[1]===1)return c;const h=q6(t,e,n,c);return t.disposeIntermediateTensorInfo(c),h}function K6(t,e,n,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],o=jv(i),a=new m1e(r,o,n,s==null),l=s==null?[e]:[e,s],u=t.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const c=K6(t,e,n,u);return t.disposeIntermediateTensorInfo(u),c}return u}function X6(t,e,n,s){const r=[n];if(rs("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!te().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=t.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=t.unpackTensor(e),i.push(l));const[u,c]=Gn(l.shape,r),h=re(c),d=Ce({inputs:{x:l},backend:t,attrs:{shape:[-1,h]}});i.push(d);const p=q6(t,d,s);i.push(p);const f=Ce({inputs:{x:p},backend:t,attrs:{shape:u}});return i.forEach(m=>t.disposeIntermediateTensorInfo(m)),f}return K6(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;let o=st(i,r.shape);const a=on(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Fs({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),o=xn(o.length,l.shape.length)),rs("argMax",[o[0]],l.shape.length);const c=X6(n,l,o[0],"max");return u.forEach(h=>n.disposeIntermediateTensorInfo(h)),c}const y1e={kernelName:w0,backendName:"webgl",kernelFunc:g1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;let o=st(i,r.shape);const a=on(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Fs({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),o=xn(o.length,l.shape.length)),rs("argMin",[o[0]],l.shape.length);const c=X6(n,l,o[0],"min");return u.forEach(h=>n.disposeIntermediateTensorInfo(h)),c}const w1e={kernelName:x0,backendName:"webgl",kernelFunc:v1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x1e=mi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,b1e=gt({opSnippet:x1e}),I1e={kernelName:Tf,backendName:"webgl",kernelFunc:b1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S1e=mi+"return log(x + sqrt(x * x + 1.0));",T1e=gt({opSnippet:S1e}),C1e={kernelName:Cf,backendName:"webgl",kernelFunc:T1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k1e=mi+`
  return atan(x);
`,E1e=gt({opSnippet:k1e}),_1e={kernelName:kf,backendName:"webgl",kernelFunc:E1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N1e=Pk+`
  return atan(a, b);
`,$1e=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+cc+`
  return result;
`,A1e=os({opSnippet:N1e,packedOpSnippet:$1e}),R1e={kernelName:_f,backendName:"webgl",kernelFunc:A1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D1e=mi+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,O1e=gt({opSnippet:D1e}),P1e={kernelName:Ef,backendName:"webgl",kernelFunc:O1e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sf{constructor(e,n,s,r=!1,i=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;const m=n==="avg",v=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,y=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let w="0.0";if(m||(w="-1.0 / 1e-20"),s){const T=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${p}, ${f});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${T} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?v:y:`wR * ${d} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const b="max";let I=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(I="avgValue / max(count, 1.0)");const k=Math.floor(o/4)*4,R=o%4,C=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${p}, ${f});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${k}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${C}
          }

          int xC = xCCorner + ${k};
          if (${R===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${C}
          } else if (${R===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${C}
          } else if (${R===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${C}
          }
        }
        setOutput(${I});
      }
    `}}class Lk{constructor(e,n,s,r=!1,i=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,c=e.dilationDepth,h=e.dilationHeight,d=e.dilationWidth,p=e.effectiveFilterDepth,f=e.effectiveFilterHeight,m=e.effectiveFilterWidth,v=e.padInfo.front,y=e.padInfo.top,w=e.padInfo.left;this.outputShape=e.outShape;const b=n==="avg";let I="0.0";if(b||(I="-1.0 / 1e-20"),s){const $=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${v}, ${y}, ${w});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${p};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${f};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${d}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${$} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${f} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const k="max";let R=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(R="avgValue / max(count, 1.0)");const C=Math.floor(o/4)*4,T=o%4,N=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${k}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${v}, ${y}, ${w});
      const float initializationValue = ${I};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${I});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${C}; wC += 4) {
              int xC = xCCorner + wC * ${d};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                getValue(batch, xD, xR, xC + 3 * ${d}, ch)
              );

              ${N}
            }

            int xC = xCCorner + ${C};
            if (${T===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${N}
            } else if (${T===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                initializationValue,
                initializationValue
              );

              ${N}
            } else if (${T===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                initializationValue
              );

              ${N}
            }
          }
        }
        setOutput(${R});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Mm(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;F(ss(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=pi(r.shape,i,o,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&ut(c.inShape,c.outShape))return br({inputs:{x:r},backend:n});const h=new sf(c,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}const L1e={kernelName:b0,backendName:"webgl",kernelFunc:F1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s,c=[1,1,1],h=ua(r.shape,i,o,c,a,l,u),d=new Lk(h,"avg",!1);return n.runWebGLProgram(d,[r],"float32")}const V1e={kernelName:I0,backendName:"webgl",kernelFunc:M1e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z1e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=l-1-e.padInfo.top,h=u-1-e.padInfo.left,d=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${h});
      const float avgMultiplier = float(${d});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class B1e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,h=e.effectiveFilterDepth,d=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=h-1-e.padInfo.front,m=d-1-e.padInfo.top,v=p-1-e.padInfo.left,y=1/(n*s*r);this.userCode=`
      const ivec3 pads = ivec3(${f}, ${m}, ${v});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${d};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U1e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=s,h=[1,1,1],d=ua(o.shape,a,l,h,u,c),p=new B1e(d);return n.runWebGLProgram(p,[r],o.dtype)}const W1e={kernelName:$S,backendName:"webgl",kernelFunc:U1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j1e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i;Mm([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,c=pi(o.shape,a,l,1,u),h=new z1e(c);return n.runWebGLProgram(h,[r],o.dtype)}const G1e={kernelName:NS,backendName:"webgl",kernelFunc:j1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H1e(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return O1({a:r,b:i,transposeA:o,transposeB:a,backend:n})}const q1e={kernelName:S0,backendName:"webgl",kernelFunc:H1e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K1e{constructor(e,n,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Qe(e,n),Qe(e,s);let a="0.0";r!=null&&(Qe(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(Qe(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X1e{constructor(e,n,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Qe(e,n),Qe(e,s);let a="vec4(0.0)";r!=null&&(Qe(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(Qe(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y1e=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=t;F(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),F(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),F(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const u=[s,r,i];let c=null;o!=null&&(c=o.shape,u.push(o));let h=null;a!=null&&(h=a.shape,u.push(a));const d=te().getBool("WEBGL_PACK_NORMALIZATION")?new X1e(s.shape,r.shape,i.shape,c,h,l):new K1e(s.shape,r.shape,i.shape,c,h,l);return e.runWebGLProgram(d,u,u[0].dtype)},Q1e={kernelName:F0,backendName:"webgl",kernelFunc:Y1e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J1e{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=Dt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=Z1e(this.rank);let r;const i=e.map((o,a)=>`sourceLoc.${zb[a]} = start[${a}] + coords.${zb[a]};`);r=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const zb=["x","y","z","w","u","v"];function Z1e(t){if(t===1)return"sourceLoc";if(t<=6)return zb.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e0e{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=Dt(this.rank),s=Rs("coords",this.rank),r=Rs("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((c,h)=>`start[${h}]`).join()});`:e.map((c,h)=>`${r[h]} = ${s[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t0e(t,e,n,s){const r=s.texData.get(t.dataId),i=s.makeTensorInfo(n,t.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=AC(e,Ve(t.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),i}function ad(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,size:o}=s,[a,l]=Wv(r,i,o);if(_C(r,a,l),re(l)===0)return n.makeTensorInfo(l,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=n.texData.get(r.dataId),d=qge(h.values,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,d)}const{isPacked:u}=n.texData.get(r.dataId),c=$C(r.shape,a,l);if(u||!c){const h=te().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new e0e(l):new J1e(l),d=[a];return n.runWebGLProgram(h,[r],r.dtype,d)}return n.uploadToGPU(r.dataId),t0e(r,a,l,n)}const n0e={kernelName:hv,backendName:"webgl",kernelFunc:ad};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s0e=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,crops:o}=s;F(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((w,b)=>w*b),l=Cm(r.shape,i,a),u=km(l.length,i.length),c=Em(r.shape,i,a),h=FC(o,i.length),d=LC(c,o,i.length),p=[],f=Ce({inputs:{x:r},backend:n,attrs:{shape:l}}),m=Fs({inputs:{x:f},backend:n,attrs:{perm:u}}),v=Ce({inputs:{x:m},backend:n,attrs:{shape:c}}),y=ad({inputs:{x:v},backend:n,attrs:{begin:h,size:d}});return p.push(f),p.push(m),p.push(v),p.forEach(w=>n.disposeIntermediateTensorInfo(w)),y},r0e={kernelName:T0,backendName:"webgl",kernelFunc:s0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o}=s,a=n.readSync(r.dataId),l=n.readSync(i.dataId),u=F6(a,l,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}const o0e={kernelName:AS,backendName:"webgl",kernelFunc:i0e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a0e=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,l0e=`
  return float(int(a.r) & int(b.r));
`;function u0e(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,i=te().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=te().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([s,r])||o===1){const l=n.texData.get(s.dataId).values,u=n.texData.get(r.dataId).values,[c,h]=yge(s.shape,r.shape,l,u,s.dtype),d=n.makeTensorInfo(h,s.dtype),p=n.texData.get(d.dataId);return p.values=c,d}let a;return i?a=new id(a0e,s.shape,r.shape,!1):a=new Hu(l0e,s.shape,r.shape),n.runWebGLProgram(a,[s,r],s.dtype)}const c0e={kernelName:C0,backendName:"webgl",kernelFunc:u0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h0e(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,i=n.readSync(s.dataId),o=n.readSync(r.dataId),a=Qe(Array.from(i),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const d0e={kernelName:RS,backendName:"webgl",kernelFunc:h0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p0e="return float(a != b);",Y6=os({opSnippet:p0e,cpuKernelImpl:Mge,dtype:"bool"}),f0e={kernelName:Z0,backendName:"webgl",kernelFunc:Y6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zm(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return br({inputs:{x:r.complexTensorInfos.real},backend:n})}const m0e={kernelName:hT,backendName:"webgl",kernelFunc:zm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g0e="return float(int(x));";function y0e(t,e){const n=new fo(t.shape,g0e),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bb(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return br({inputs:{x:r},backend:n});const o=Nn(r.shape),a=Bb({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),l=Pl({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=zm({inputs:{input:r},backend:n}),a=Bb({inputs:{x:o},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(o),a}if(!lO(r.dtype,i)){const o=br({inputs:{x:r},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(n.shouldExecuteOnCPU([r])){const o=n.texData.get(r.dataId).values,[a,l,u]=vge(o,r.shape,r.dtype,i);return n.makeTensorInfo(a,l,u)}if(i==="int32")return y0e(r,n);if(i==="bool"){const o=n.makeTensorInfo([],"bool",ts("bool",1)),l=Y6({inputs:{a:r,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const v0e={kernelName:Nf,backendName:"webgl",kernelFunc:Bb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tA="return ceil(x);",w0e=gt({opSnippet:tA,packedOpSnippet:tA,cpuKernelImpl:wge}),x0e={kernelName:$f,backendName:"webgl",kernelFunc:w0e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b0e{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I0e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;te().getBool("WEBGL_PACK_CLIP")?a=new I0e(r.shape):a=new b0e(r.shape);const l=[[i],[o]];return n.runWebGLProgram(a,[r],r.dtype,l)}const T0e={kernelName:Af,backendName:"webgl",kernelFunc:S0e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C0e{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nA(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function k0e(t){const{inputs:e,backend:n}=t,{x:s}=e,r=n.texData.get(s.dataId),i=new C0e(s.shape),o=[nA(s,r.complexTensorInfos.real),nA(s,r.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}const E0e={kernelName:k0,backendName:"webgl",kernelFunc:k0e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _0e{constructor(e){this.outputShape=[],this.outputShape=xo(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+e[o][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];s.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=n.length,i=n[n.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class N0e{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=xo(e,n);const s=this.outputShape,r=s.length,i=Dt(r),o=Rs("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((m,v)=>`T${v}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let m=1;m<l.length;m++)l[m]=l[m-1]+e[m][n];const u=a[n],c=a.slice(-2),h=a.join();let d=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${h}), vec2(${c.join()}));
        }`;for(let m=1;m<l.length;m++){const v=l[m-1];d+=`
        if (${u} < ${l[m]}  && ${u} >= ${l[m-1]}) {
          return getChannel(
            getT${m}(${Wg(a,u,v)}),
            vec2(${Wg(c,u,v)}));
        }`}const p=l.length,f=l[l.length-1];d+=`
        return getChannel(
          getT${p}(${Wg(a,u,f)}),
          vec2(${Wg(c,u,f)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${d}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function Wg(t,e,n){const s=t.indexOf(e);return t.map((i,o)=>o===s?`${i} - ${n}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uw(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return br({inputs:{x:r.complexTensorInfos.imag},backend:n})}const $0e={kernelName:QS,backendName:"webgl",kernelFunc:uw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tp(t,e,n){const s=t[0].dtype;if(s==="complex64"){const p=t.map(w=>zm({inputs:{input:w},backend:n})),f=t.map(w=>uw({inputs:{input:w},backend:n})),m=tp(p,e,n),v=tp(f,e,n),y=Pl({inputs:{real:m,imag:v},backend:n});return p.forEach(w=>n.disposeIntermediateTensorInfo(w)),f.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),y}let r=n.shouldExecuteOnCPU(t);if(s==="string"&&(r=!0),r){const p=t.map(I=>{const R=[-1,re(I.shape.slice(e))];return Ce({inputs:{x:I},backend:n,attrs:{shape:R}})}),f=p.map(I=>({vals:n.readSync(I.dataId),shape:I.shape})),m=xo(p.map(I=>I.shape),1),v=p[0].shape[0]===1,y=xge(f,m,s,v),w=xo(t.map(I=>I.shape),e),b=n.makeTensorInfo(w,s,y);return p.forEach(I=>n.disposeIntermediateTensorInfo(I)),b}const i=t.filter(p=>re(p.shape)>0),o=te().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const p=o?new fo(t[0].shape,Na):new za(t[0].shape,Na);return n.runWebGLProgram(p,t,s)}const a=te().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const p=[];for(let m=0;m<i.length;m+=a){const v=i.slice(m,m+a);p.push(tp(v,e,n))}const f=tp(p,e,n);for(const m of p)n.disposeIntermediateTensorInfo(m);return f}if(o){const p=new N0e(i.map(f=>f.shape),e);return n.runWebGLProgram(p,i,s)}const{tensors2D:l,outShape:u}=A0e(i,e,n),c=new _0e(l.map(p=>p.shape)),h=n.runWebGLProgram(c,l,s);l.forEach(p=>n.disposeIntermediateTensorInfo(p));const d=Ce({inputs:{x:h},attrs:{shape:u},backend:n});return n.disposeIntermediateTensorInfo(h),d}function A0e(t,e,n){const s=xo(t.map(i=>i.shape),e);return{tensors2D:t.map(i=>Ce({inputs:{x:i},attrs:{shape:[-1,re(i.shape.slice(e))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q6(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,i=st(r,e[0].shape)[0],o=e.map(u=>u.shape);DC(o,i);const a=xo(e.map(u=>u.shape),i);if(re(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>re(u.shape)>0);return l.length===1?br({inputs:{x:l[0]},backend:n}):tp(l,i,n)}const R0e={kernelName:E0,backendName:"webgl",kernelFunc:Q6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J6{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,d=e.filterHeight,p=e.filterWidth,f=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,v=e.dataFormat==="channelsLast",y=v?1:2,w=v?2:3,b=v?3:1;let I="",k="";s&&(r?I=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?I=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:I=`
          float activation(float x) {
            ${s}
          }
        `,k="result = activation(result);");const R=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${I}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${b}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${w}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${d}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${p}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${f}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${v}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${v}) {
                dotProd +=
                    getX(batch, xR, xC, ${f}) *
                    getW(wR, wC, ${f}, d2);
              } else {
                dotProd +=
                    getX(batch, ${f}, xR, xC) *
                    getW(wR, wC, ${f}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${f}, d2),
                getW(wR, wC, ${f} + 1, d2)
              );

              if (${v}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${f}),
                  getX(batch, xR, xC, ${f} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${f}, xR, xC),
                  getX(batch, ${f} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${f}, d2),
                getW(wR, wC, ${f} + 1, d2),
                getW(wR, wC, ${f} + 2, d2)
              );

              if (${v}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${f}),
                  getX(batch, xR, xC, ${f} + 1),
                  getX(batch, xR, xC, ${f} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${f}, xR, xC),
                  getX(batch, ${f} + 1, xR, xC),
                  getX(batch, ${f} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${R}
        ${k}
        setOutput(result);
      }
    `}}class D0e{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,h=e.filterDepth,d=e.filterHeight,p=e.filterWidth,f=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${d}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${f}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${f}) *
                  getW(wF, wR, wC, ${f}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${f}),
                  getX(batch, xF, xR, xC, ${f} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${f}, d2),
                  getW(wF, wR, wC, ${f} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${f}),
                  getX(batch, xF, xR, xC, ${f} + 1),
                  getX(batch, xF, xR, xC, ${f} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${f}, d2),
                  getW(wF, wR, wC, ${f} + 1, d2),
                  getW(wF, wR, wC, ${f} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z6{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=bs(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,c=e.filterWidth,h=c;let d=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let v=0;v<c;v++)d+=`
           vec4 xTexelC${v*2};
           int xTexelC${v*2}Ready;
           vec4 xTexelC${v*2+1};
           int xTexelC${v*2+1}Ready;
           vec4 xC${v};`;d+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let v=0;v<c;v++)d+=`
           xTexelC${v*2} = vec4(0.0);
           xTexelC${v*2}Ready = 0;
           xTexelC${v*2+1} = vec4(0.0);
           xTexelC${v*2+1}Ready = 0;
           xC${v} = vec4(0.0);`;d+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let v=0;v<(h+1)/2;v++){const y=v*2;if(d+=`
           xC = xCCorner + ${y*l};
           `,a===1){if(y<c&&(o%2===1?(d+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,l===1&&y>0?d+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:d+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):d+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<c)){const w=o%2===0?TS(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(d+=`
                   xCOffset = xC + imod(pads[1], 2) + ${w};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,l>1?d+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:d+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):w===1?d+=`
                     xC${y+1} = xTexelC${y};
                     `:d+=`
                     xCOffset = xC + ${w};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<c&&(o%2===1?(d+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<c&&(d+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(d+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<c&&(d+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<c&&(d+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<c&&(d+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}d+=`
     }
   `,d+=`
     }
   `,d+=`
     }
   `;let p="",f="";s&&(r?p=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?p=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:p=`vec4 activation(vec4 x) {
           ${s}
         }`,f="result = activation(result);");const m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${p}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${d}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${f}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O0e{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=bs(this.outputShape.length);const{dataFormat:s}=n,r=Ms(),i=s==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)u+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${c};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P1(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function ez({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=t.shape,u=s.texData.get(t.dataId),c=n.inChannels,h=l[0]*l[1]*l[2],d=n.outChannels,p=n.dataFormat==="channelsLast",f=!1,m=!1;let v;const y=[];if(i!=null){const I=P1(i.shape,p);I!=null&&(i=Ce({inputs:{x:i},backend:s,attrs:{shape:I}}),y.push(i))}if(r!=null){const I=P1(r.shape,p);I!=null&&(r=Ce({inputs:{x:r},backend:s,attrs:{shape:I}}),y.push(r))}if(!((h===1||d===1)&&c>H6)&&u.isPacked&&p&&u.texture!=null&&l[2]%2!==0&&ut(u.shape.slice(-3),l.slice(-3))){const I=l[0]*l[1]*(l[2]+1),k={dataId:t.dataId,shape:[1,I,n.inChannels],dtype:t.dtype},R=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,F(D1(u.shape,k.shape),()=>`packed reshape ${u.shape} to ${k.shape} isn't free`);const C=Ce({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push(C);const T=O1({a:k,b:C,backend:s,transposeA:f,transposeB:m,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),N=s.texData.get(T.dataId);F(N.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=R,N.shape=n.outShape,v=br({inputs:{x:T},backend:s}),v.shape=n.outShape,y.push(T)}else{const I=n.outHeight*n.outWidth,k=Ce({inputs:{x:t},backend:s,attrs:{shape:p?[n.batchSize,I,n.inChannels]:[n.batchSize,n.inChannels,I]}}),R=Ce({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),C=O1({a:p?k:R,b:p?R:k,transposeA:!p,transposeB:m,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});v=Ce({inputs:{x:C},backend:s,attrs:{shape:n.outShape}}),y.push(k),y.push(R),y.push(C)}for(const I of y)s.disposeIntermediateTensorInfo(I);return v}function tz({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:c,outWidth:h,outHeight:d,dataFormat:p}=n,f=p==="channelsLast",m=l*u*c,v=d*h,y=[n.batchSize,m,v],w=!0,b=!1,I=[];if(i!=null){const q=P1(i.shape,f);q!=null&&(i=Ce({inputs:{x:i},backend:s,attrs:{shape:q}}),I.push(i))}if(r!=null){const q=P1(r.shape,f);q!=null&&(r=Ce({inputs:{x:r},backend:s,attrs:{shape:q}}),I.push(r))}const k=Ce({inputs:{x:e},backend:s,attrs:{shape:[1,m,re(e.shape)/m]}});I.push(k);const R=new O0e(y,n),C=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],T=s.runWebGLProgram(R,[t],"float32",C),N=Ce({inputs:{x:T},backend:s,attrs:{shape:y}});I.push(T),I.push(N);const $=r!=null,P=i!=null,V=a==="leakyrelu",O=a?nf(a,!0):null,Q=new G6(f?N.shape:k.shape,f?k.shape:N.shape,f?[n.batchSize,v,n.outChannels]:[n.batchSize,n.outChannels,v],w,b,$,O,P,V),Z=f?[N,k]:[k,N];if(r&&Z.push(r),P&&Z.push(i),V){const q=s.makeTensorInfo([],"float32",Cl(o,"float32"));Z.push(q),I.push(q)}const ne=s.runWebGLProgram(Q,Z,"float32"),le=Ce({inputs:{x:ne},backend:s,attrs:{shape:n.outShape}});I.push(ne);for(const q of I)s.disposeIntermediateTensorInfo(q);return le}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=s,h=ca(l),d=jn(r.shape,i.shape,o,u,a,c,!1,h);let p;if(d.filterHeight===1&&d.filterWidth===1&&d.dilationHeight===1&&d.dilationWidth===1&&d.strideHeight===1&&d.strideWidth===1&&(d.padInfo.type==="SAME"||d.padInfo.type==="VALID"))p=ez({x:r,filter:i,convInfo:d,backend:n});else if(d.strideWidth<=2&&h==="channelsLast"&&te().getBool("WEBGL_EXP_CONV")){const m=new Z6(d),v=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];p=n.runWebGLProgram(m,[r,i],"float32",v)}else if(te().getBool("WEBGL_CONV_IM2COL"))p=tz({x:r,filter:i,convInfo:d,backend:n});else{const m=new J6(d);p=n.runWebGLProgram(m,[r,i],"float32")}const f=Ce({inputs:{x:p},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(p),f}const F0e={kernelName:_0,backendName:"webgl",kernelFunc:P0e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L0e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class M0e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=s-1-e.padInfo.left,u=o?1:2,c=o?2:3,h=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class V0e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class z0e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,u=s-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=s,h=ca(l),d=jn(r.shape,c,o,1,a,u,!1,h),p=new L0e(d);return n.runWebGLProgram(p,[r,i],"float32")}const U0e={kernelName:OS,backendName:"webgl",kernelFunc:B0e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W0e{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=bs(this.outputShape.length);const n=e.filterHeight,s=e.filterWidth,r=n-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j0e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=s,h=ca(u),d=jn(o,i.shape,a,1,l,c,!1,h);if(te().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const p=[[d.strideHeight,d.strideWidth]],f=new W0e(d);return n.runWebGLProgram(f,[r,i],"float32",p)}else{const p=new M0e(d);return n.runWebGLProgram(p,[r,i],"float32")}}const G0e={kernelName:N0,backendName:"webgl",kernelFunc:j0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=_l(r.shape,i.shape,o,l,a),c=new D0e(u);return n.runWebGLProgram(c,[r,i],"float32")}const q0e={kernelName:$0,backendName:"webgl",kernelFunc:H0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,u=_l(r.shape,l,o,1,a),c=new V0e(u);return n.runWebGLProgram(c,[r,i],"float32")}const X0e={kernelName:PS,backendName:"webgl",kernelFunc:K0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y0e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s,u=_l(l,i.shape,a,1,o),c=new z0e(u);return n.runWebGLProgram(c,[r,i],"float32")}const Q0e={kernelName:FS,backendName:"webgl",kernelFunc:Y0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J0e=od+`
  return cos(x);
`,Z0e=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${cc}
  return result;
`,eve=gt({opSnippet:J0e,packedOpSnippet:Z0e}),tve={kernelName:Rf,backendName:"webgl",kernelFunc:eve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nve=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,sve=gt({opSnippet:nve}),rve={kernelName:Df,backendName:"webgl",kernelFunc:sve};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ive{constructor(e,n,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,u]=e,[c]=n,[h,d]=s;this.outputShape=[c,h,d,u];const p=r==="bilinear"?1:0,[f,m]=[`${a-1}.0`,`${l-1}.0`],[v,y,w]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${f}`],[b,I,k]=d>1?[`${(l-1)/(d-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${v});
      const float width_ratio = float(${b});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${I};

        float in_y = ${w};
        if( in_y < 0.0 || in_y > ${f} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${k};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${p} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ove=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,c=new ive(r.shape,i.shape,a,l,u);return n.runWebGLProgram(c,[r,i,o],"float32")},ave={kernelName:MS,backendName:"webgl",kernelFunc:ove};var rf;(function(t){t.Prod="*",t.Sum="+"})(rf||(rf={}));class sA{constructor(e,n,s,r){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===rf.Prod?"1.0":"0.0",a=s?o:`getX(${rA(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",c="";s?(u=r?`end != ${l-1}`:"end != 0",c=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",c=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Dt(i)} coords = getOutputCoords();
        int end = ${iA(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${c};
          ${iA(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${rA(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function rA(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function iA(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nz(t,e,n,s,r,i){const o=e.shape.length,a=on([s],o);let l=e;a!=null&&(l=Fs({inputs:{x:e},backend:n,attrs:{perm:a}}));const u=xn(1,o)[0];if(u!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const c=l.shape[u];let h=br({inputs:{x:l},backend:n});for(let d=0;d<=Math.ceil(Math.log2(c))-1;d++){const p=new sA(t,l.shape,!1,i),f=[[d]],m=h;h=n.runWebGLProgram(p,[h],h.dtype,f),n.disposeIntermediateTensorInfo(m)}if(r){const d=new sA(t,l.shape,r,i),p=h;h=n.runWebGLProgram(d,[h],h.dtype),n.disposeIntermediateTensorInfo(p)}if(a!=null){const d=Nl(a),p=Fs({inputs:{x:h},backend:n,attrs:{perm:d}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),p}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return nz(rf.Prod,r,n,i,o,a)}const uve={kernelName:LS,backendName:"webgl",kernelFunc:lve};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return nz(rf.Sum,r,n,i,o,a)}const hve={kernelName:A0,backendName:"webgl",kernelFunc:cve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=n.readSync(r.dataId),u=n.readSync(i.dataId),c=F6(l,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}else if(r.shape.length===2){const l=n.bufferSync(r),u=n.bufferSync(i),c=gge(l,u,o,a);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const pve={kernelName:VS,backendName:"webgl",kernelFunc:dve};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fve{constructor(e,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],u=o==="NHWC"?r.shape[2]:r.shape[3],c=o==="NHWC"?r.shape[3]:r.shape[1],h=l*i,d=u*i,p=c/(i*i),f=o==="NHWC"?[a,h,d,p]:[a,p,h,d],m=new fve(f,i,o);return n.runWebGLProgram(m,[r],r.dtype)}const gve={kernelName:zS,backendName:"webgl",kernelFunc:mve};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sz{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=bs(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",c="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,c="result = activation(result);");const h=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rz{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=bs(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,h=e.filterWidth,d=h;let p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<h;y++)p+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;p+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let y=0;y<h;y++)p+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(d+1)/2;y++){const w=y*2;if(p+=`
          xC = xCCorner + ${w*u};
          `,l===1){if(w<h&&(a%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }
              `,u===1&&w>0?p+=`
                xC${w} = vec4(xTexelC${w-2}.zw, xTexelC${w}.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${w} = vec4(previous.zw, xTexelC${w}.xy);
                  } else {
                    xC${w} = vec4(0.0, 0.0, xTexelC${w}.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xC${w} = xTexelC${w};
                `,w+1<h)){const b=a%2===0?TS(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + ${b};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                    xTexelC${w+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${w+1}.zw = vec2(0.0);
                    }
                    xTexelC${w+1}Ready = 1;
                  }
                  `,u>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${w+1} = vec4(previous.zw, xTexelC${w+1}.xy);
                    } else {
                     xC${w+1} = vec4(0.0, 0.0, xTexelC${w+1}.xy);
                    }
                    `:p+=`
                    xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.xy);
                    `):b===1?p+=`
                    xC${w+1} = xTexelC${w};
                    `:p+=`
                    xCOffset = xC + ${b};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                      xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${w+1}.zw = vec2(0.0);
                      }
                      xTexelC${w+1}Ready = 1;
                    }

                    xC${w+1} = xTexelC${w+1};
                    `}}else w<h&&(a%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.0);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
              `,w+1<h&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${w+1} = vec4(xTexelC${w+1}.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(
                  xTexelC${w}.xy, xTexelC${w+1}.xy);
              `,w+1<h&&(p+=`
                  xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
                `)));w<h&&(p+=`
            wTexel = getW(r, ${w}, d1, q);
            dotProd += xC${w} * vec4(wTexel.xz, wTexel.xz);
          `,w+1<h&&(p+=`
              wTexel = getW(r, ${w+1}, d1, q);
              dotProd += xC${w+1} * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;let f="",m="";s&&(r?f=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?f=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:f=`vec4 activation(vec4 x) {
          ${s}
        }`,m="result = activation(result);");const v=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${f}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${p}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${v}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;let c=l;c==null&&(c=[1,1]),F(ss(o,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=jn(r.shape,i.shape,o,c,a,u,!0);let d;te().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?d=new rz(h):d=new sz(h);const p=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(d,[r,i],"float32",p)}const vve={kernelName:R0,backendName:"webgl",kernelFunc:yve};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wve{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class xve{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=n-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=s,h=jn(r.shape,c,o,a,l,u,!0),d=new wve(h);return n.runWebGLProgram(d,[r,i],"float32")}const Ive={kernelName:BS,backendName:"webgl",kernelFunc:bve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sve(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=s,h=jn(c,i.shape,o,a,l,u,!0),d=new xve(h);return n.runWebGLProgram(d,[r,i],"float32")}const Tve={kernelName:US,backendName:"webgl",kernelFunc:Sve};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cve{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kve(t){const{inputs:e,backend:n}=t,{x:s}=e,r=[...s.shape,...s.shape],i=re(s.shape),o=Ce({inputs:{x:s},backend:n,attrs:{shape:[i]}}),a=new Cve(i),l=n.runWebGLProgram(a,[o],o.dtype),u=Ce({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),u}const Eve={kernelName:WS,backendName:"webgl",kernelFunc:kve};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ve{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:c}=e,{top:h,left:d}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${h}, ${d});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=vm(r.shape,i.shape,o,a,"NHWC",l);let c;const h=new _ve(u);c=n.runWebGLProgram(h,[r,i],"float32");const d=Ce({inputs:{x:c},backend:n,attrs:{shape:u.outShape}});return n.disposeIntermediateTensorInfo(c),d}const $ve={kernelName:D0,backendName:"webgl",kernelFunc:Nve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ave(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=GC(r,i.length);qC(o.length,l,i);const{path:u,steps:c}=KC(a,l),h=c.length;let d=null,p=o.length;const f=[];for(let m=0;m<h;++m){for(const v of c[m]){const{permutationIndices:y,expandDims:w}=HC(p,l[v]);let b;XC(y)?b=i[v]:(b=Fs({inputs:{x:i[v]},backend:n,attrs:{perm:y}}),f.push(b));const I=b.shape.slice();for(let k=0;k<w.length;++k)I.splice(w[k],0,1);ut(b.shape,I)||(b=Ce({inputs:{x:b},backend:n,attrs:{shape:I}}),f.push(b)),d===null?d=b:(d=Fk({inputs:{a:b,b:d},backend:n}),f.push(d))}m<h-1&&(u[m]>=0&&(d=lw({inputs:{x:d},backend:n,attrs:{axis:u[m]-(o.length-p),keepDims:!1}}),f.push(d)),p--)}for(const m of f)m!==d&&n.disposeIntermediateTensorInfo(m);return d}const Rve={kernelName:jS,backendName:"webgl",kernelFunc:Ave};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dve="return (x >= 0.0) ? x : (exp(x) - 1.0);",Ove=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Pve=gt({opSnippet:Dve,packedOpSnippet:Ove}),Fve={kernelName:Pf,backendName:"webgl",kernelFunc:Pve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lve="return (b >= 0.0) ? a : a * (b + 1.0);",Mve=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Vve=t=>{const{inputs:e,backend:n}=t,{dy:s,y:r}=e,i=te().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new id(Mve,s.shape,r.shape):new Hu(Lve,s.shape,r.shape);return n.runWebGLProgram(i,[s,r],s.dtype)},zve={kernelName:GS,backendName:"webgl",kernelFunc:Vve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bve=`
  return vec4(equal(a, b));
`,Uve="return float(a == b);",Wve=os({opSnippet:Uve,packedOpSnippet:Bve,dtype:"bool",cpuKernelImpl:bge}),jve={kernelName:O0,backendName:"webgl",kernelFunc:Wve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gve=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${MC};
  float a1 = ${VC};
  float a2 = ${zC};
  float a3 = ${BC};
  float a4 = ${UC};
  float a5 = ${WC};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Hve=gt({opSnippet:Gve}),qve={kernelName:Ff,backendName:"webgl",kernelFunc:Hve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kve=od+`
  return exp(x);
`,Xve=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,iz=gt({opSnippet:Kve,packedOpSnippet:Xve,cpuKernelImpl:Ige,dtype:"float32"}),Yve={kernelName:Lf,backendName:"webgl",kernelFunc:iz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ub(t){const{inputs:e,attrs:n,backend:s}=t,{dim:r}=n,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(F(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),Ce({inputs:{x:i},backend:s,attrs:{shape:a}})}const Qve={kernelName:P0,backendName:"webgl",kernelFunc:Ub};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oA="return exp(x) - 1.0;",Jve=gt({opSnippet:oA,packedOpSnippet:oA,cpuKernelImpl:Sge}),Zve={kernelName:Mf,backendName:"webgl",kernelFunc:Jve};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aA{constructor(e,n,s){this.variableNames=["real","imag"];const r=n[1];this.outputShape=n;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oz(t,e,n){const s=n.texData.get(t.dataId),r=re(t.shape),i=t.shape[t.shape.length-1],o=r/i,a=Ce({inputs:{x:t},backend:n,attrs:{shape:[o,i]}}),l=a.shape,u=new aA("real",l,e),c=new aA("imag",l,e),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],d=n.runWebGLProgram(u,h,"float32"),p=n.runWebGLProgram(c,h,"float32"),f=Pl({inputs:{real:d,imag:p},backend:n});n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p);const m=Ce({inputs:{x:f},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(f),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ewe(t){const{inputs:e,backend:n}=t,{input:s}=e;return oz(s,!1,n)}const twe={kernelName:HS,backendName:"webgl",kernelFunc:ewe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nwe{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bm(t){const{backend:e,attrs:n}=t,{shape:s,value:r}=n;let{dtype:i}=n;if(i=i||Gh(r),i==="string"){const o=yn(i,re(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new nwe(s,r),a=[[r]];return e.runWebGLProgram(o,[],i,a)}}const swe={kernelName:qS,backendName:"webgl",kernelFunc:Bm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rwe{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iwe={kernelName:KS,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,r=new rwe(n.shape);return s.runWebGLProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lA="return floor(x);",owe=gt({opSnippet:lA,packedOpSnippet:lA,cpuKernelImpl:Tge}),awe={kernelName:Vf,backendName:"webgl",kernelFunc:owe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lwe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,uwe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,cwe=os({opSnippet:lwe,packedOpSnippet:uwe,dtype:"int32"}),hwe={kernelName:zf,backendName:"webgl",kernelFunc:cwe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dwe{constructor(e){this.variableNames=["A"];const n=Ms(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pwe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=Ms(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fwe={kernelName:Y2,backendName:"webgl",kernelFunc:mwe};let Ec,Tx=te().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function mwe(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:r}=e;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],c=[u,l],h=[u,l,i];if(a||o){const m=te().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Ec==null||m!==Tx)&&(Tx=m,Ec=document.createElement("canvas").getContext("2d",{willReadFrequently:Tx})),Ec.canvas.width=l,Ec.canvas.height=u,Ec.drawImage(r,0,0,l,u),r=Ec.canvas}const d=n.makeTensorInfo(c,"int32");n.texData.get(d.dataId).usage=Rr.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),r);const p=te().getBool("WEBGL_PACK")?new pwe(h):new dwe(h),f=n.runWebGLProgram(p,[d],"int32");return n.disposeData(d.dataId),f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=s,m=ca(c),v=jn(r.shape,i.shape,l,h,u,d,!1,m);let y;const w=[],b=o!=null,I=a!=null,k=p==="leakyrelu",R=()=>{const T=[r,i],N=($,P)=>{if(P==="NCHW"&&$.shape.length===1&&$.shape[0]!==1){const V=Ce({inputs:{x:$},backend:n,attrs:{shape:[$.shape[0],1,1]}});return w.push(V),V}return $};if(b&&T.push(N(o,c)),I&&T.push(N(a,c)),k){const $=n.makeTensorInfo([],"float32",Cl(f,"float32"));T.push($),w.push($)}return T};if(v.filterHeight===1&&v.filterWidth===1&&v.dilationHeight===1&&v.dilationWidth===1&&v.strideHeight===1&&v.strideWidth===1&&(v.padInfo.type==="SAME"||v.padInfo.type==="VALID"))y=ez({x:r,filter:i,convInfo:v,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else if(v.strideWidth<=2&&m==="channelsLast"&&te().getBool("WEBGL_EXP_CONV")){const T=p?nf(p,!0):null,N=new Z6(v,b,T,I,k),$=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],P=R();y=n.runWebGLProgram(N,P,"float32",$)}else if(te().getBool("WEBGL_CONV_IM2COL"))y=tz({x:r,filter:i,convInfo:v,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else{const T=p?nf(p,!1):null,N=new J6(v,b,T,I,k),$=R();y=n.runWebGLProgram(N,$,"float32")}const C=Ce({inputs:{x:y},backend:n,attrs:{shape:v.outShape}});return w.push(y),w.forEach(T=>n.disposeIntermediateTensorInfo(T)),C}const ywe={kernelName:u1,backendName:"webgl",kernelFunc:gwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:c,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=s,f=[];let m=c;m==null&&(m=[1,1]),F(ss(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const v=jn(r.shape,i.shape,l,m,u,h,!0),y=te().getBool("WEBGL_PACK_DEPTHWISECONV")&&v.strideWidth<=2&&v.outChannels/v.inChannels===1,w=d?nf(d,y):null,b=[r,i],I=o!=null,k=a!=null,R=d==="leakyrelu";if(I&&b.push(o),k&&b.push(a),R){const $=n.makeTensorInfo([],"float32",Cl(p,"float32"));b.push($),f.push($)}let C;y?C=new rz(v,I,w,k,R):C=new sz(v,I,w,k,R);const T=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],N=n.runWebGLProgram(C,b,"float32",T);return f.forEach($=>n.disposeIntermediateTensorInfo($)),N}const wwe={kernelName:c1,backendName:"webgl",kernelFunc:vwe};class xwe{constructor(e,n,s,r){this.sliceDim=e,this.strides=n,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=Dt(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bwe(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=re(s.shape),[l,u,c,h]=EC(s,r),d=Ce({inputs:{x:r},backend:n,attrs:{shape:[u,o]}}),p=Ce({inputs:{x:s},backend:n,attrs:{shape:[re(s.shape)/c,c]}});if(n.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const y=n.readSync(r.dataId),w=n.bufferSync(s),b=Cge(y,w,s.dtype,u,o,c,h,s.shape,a);return n.makeTensorInfo(l,s.dtype,b.values)}const f=new xwe(o,h,[u,c],s.shape),m=n.runWebGLProgram(f,[p,d],p.dtype),v=Ce({inputs:{x:m},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),v}const Iwe={kernelName:XS,backendName:"webgl",kernelFunc:bwe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Swe{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=Dt(this.rank),r=Twe(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function Twe(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<t.length;r++)r===2?s.push("index"):s.push(`${n[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function az(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=st(o,r.shape)[0];if(te().get("DEBUG")){const w=n.readSync(i.dataId),b=r.shape[l];for(let I=0;I<w.length;++I){const k=w[I];F(k<=b-1&&k>=0,()=>`GatherV2: the index value ${k} is not in [0, ${b-1}]`)}}const u=QC(r,i,l,a),c=re(i.shape),h=[],d=Ce({inputs:{x:r},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),p=Ce({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,c/u.batchSize]}});h.push(d),h.push(p);const f=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const w=n.bufferSync(p),b=n.bufferSync(d),I=kge(b,w,f);return h.forEach(k=>n.disposeIntermediateTensorInfo(k)),n.makeTensorInfo(u.outputShape,I.dtype,I.values)}const m=new Swe(d.shape,f),v=n.runWebGLProgram(m,[d,p],d.dtype);h.push(v);const y=Ce({inputs:{x:v},backend:n,attrs:{shape:u.outputShape}});return h.forEach(w=>n.disposeIntermediateTensorInfo(w)),y}const Cwe={kernelName:L0,backendName:"webgl",kernelFunc:az};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kwe="return float(a > b);",Ewe=`
  return vec4(greaterThan(a, b));
`,_we=os({opSnippet:kwe,packedOpSnippet:Ewe,cpuKernelImpl:Ege,dtype:"bool"}),Nwe={kernelName:M0,backendName:"webgl",kernelFunc:_we};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $we="return float(a >= b);",Awe=`
  return vec4(greaterThanEqual(a, b));
`,Rwe=os({opSnippet:$we,packedOpSnippet:Awe,dtype:"bool",cpuKernelImpl:_ge}),Dwe={kernelName:Bf,backendName:"webgl",kernelFunc:Rwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Owe(t){const{inputs:e,backend:n}=t,{input:s}=e;return oz(s,!0,n)}const Pwe={kernelName:YS,backendName:"webgl",kernelFunc:Owe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fwe="return float(!isnan(x) && !isinf(x));",Lwe=gt({opSnippet:Fwe,dtype:"bool"}),Mwe={kernelName:Wf,backendName:"webgl",kernelFunc:Lwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vwe="return float(isinf(x));",zwe=gt({opSnippet:Vwe,dtype:"bool"}),Bwe={kernelName:jf,backendName:"webgl",kernelFunc:zwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uwe="return float(isnan(x));",Wwe=gt({opSnippet:Uwe,dtype:"bool"}),jwe={kernelName:Gf,backendName:"webgl",kernelFunc:Wwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gwe="return float(a < b);",Hwe=`
  return vec4(lessThan(a, b));
`,qwe=os({opSnippet:Gwe,packedOpSnippet:Hwe,cpuKernelImpl:Nge,dtype:"bool"}),Kwe={kernelName:z0,backendName:"webgl",kernelFunc:qwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xwe="return float(a <= b);",Ywe=`
  return vec4(lessThanEqual(a, b));
`,Qwe=os({opSnippet:Xwe,packedOpSnippet:Ywe,cpuKernelImpl:$ge,dtype:"bool"}),Jwe={kernelName:B0,backendName:"webgl",kernelFunc:Qwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zwe(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:i}=n,o=Age(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const exe={kernelName:JS,backendName:"webgl",kernelFunc:Zwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const txe=od+`
  return x < 0.0 ? 0./0. : log(x);
`,nxe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,sxe=gt({opSnippet:txe,packedOpSnippet:nxe,cpuKernelImpl:Rge}),rxe={kernelName:Hf,backendName:"webgl",kernelFunc:sxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ixe=od+`
  return log(1.0 + x);
`,oxe=gt({opSnippet:ixe}),axe={kernelName:qf,backendName:"webgl",kernelFunc:oxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lxe="return float(a >= 1.0 && b >= 1.0);",uxe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,cxe=os({opSnippet:lxe,packedOpSnippet:uxe,dtype:"bool"}),hxe={kernelName:U0,backendName:"webgl",kernelFunc:cxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dxe="return float(!(x >= 1.0));",pxe=gt({opSnippet:dxe}),fxe={kernelName:W0,backendName:"webgl",kernelFunc:pxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mxe="return float(a >= 1.0 || b >= 1.0);",gxe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,yxe=os({opSnippet:mxe,packedOpSnippet:gxe,dtype:"bool"}),vxe={kernelName:j0,backendName:"webgl",kernelFunc:yxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wxe{constructor(e,n,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=n,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xxe{constructor(e,n,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bxe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s,u=te().getBool("WEBGL_PACK_NORMALIZATION")?new xxe(r.shape,i,o,a,l):new wxe(r.shape,i,o,a,l);return n.runWebGLProgram(u,[r],r.dtype)},Ixe={kernelName:G0,backendName:"webgl",kernelFunc:bxe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sxe{constructor(e,n,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Txe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=s,h=new Sxe(r.shape,a,l,u,c);return n.runWebGLProgram(h,[r,i,o],r.dtype)},Cxe={kernelName:ZS,backendName:"webgl",kernelFunc:Txe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kxe(t,e,n,s){const r=re(e),o=re(t.shape)/r,a=Ce({inputs:{x:t},attrs:{shape:[o,r]},backend:s}),l=hc(a,t.dtype,"max",s),u=Ce({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lz(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,l=st(i,r.shape);let u=l;const c=on(u,a),h=c!=null,d=n.shouldExecuteOnCPU([r]);let p=r;if(h){if(d){const b=n.texData.get(p.dataId).values,I=new Array(a);for(let C=0;C<I.length;C++)I[C]=r.shape[c[C]];const k=Ok(b,r.shape,r.dtype,c,I);p=n.makeTensorInfo(I,r.dtype);const R=n.texData.get(p.dataId);R.values=k}else p=aw(r,c,n);u=xn(u.length,a)}rs("max",u,a);const[f,m]=Gn(p.shape,u);let v=f;o&&(v=wn(f,l));let y;if(d){const b=n.texData.get(p.dataId).values,I=Dge(b,re(m),v,r.dtype);y=n.makeTensorInfo(v,r.dtype);const k=n.texData.get(y.dataId);k.values=I}else y=kxe(p,m,v,n);return h&&n.disposeIntermediateTensorInfo(p),y}const Exe={kernelName:H0,backendName:"webgl",kernelFunc:lz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _xe=Pk+`
  return max(a, b);
`,Nxe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+cc+`
  return result;
`,$xe=os({opSnippet:_xe,packedOpSnippet:Nxe,cpuKernelImpl:Oge}),Axe={kernelName:Kf,backendName:"webgl",kernelFunc:$xe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Mm(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;F(ss(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=pi(r.shape,i,o,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&ut(c.inShape,c.outShape))return br({inputs:{x:r},backend:n});const h=new sf(c,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}const Dxe={kernelName:q0,backendName:"webgl",kernelFunc:Rxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:u}=s,c=[1,1,1],h=ua(r.shape,i,o,c,a,u,l),d=new Lk(h,"max",!1);return n.runWebGLProgram(d,[r],r.dtype)}const Pxe={kernelName:K0,backendName:"webgl",kernelFunc:Oxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fxe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Lxe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,h=l-1-e.padInfo.front,d=u-1-e.padInfo.top,p=c-1-e.padInfo.left,f=l*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${d}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${f} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mxe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=s,h=[1,1,1],d=ua(o.shape,a,l,h,u,c),p=new Lk(d,"max",!0),f=n.runWebGLProgram(p,[o],o.dtype),m=new Lxe(d),v=n.runWebGLProgram(m,[r,f],o.dtype);return n.disposeIntermediateTensorInfo(f),v}const Vxe={kernelName:tT,backendName:"webgl",kernelFunc:Mxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zxe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i,output:o}=e,a=i;Mm([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=s,d=pi(a.shape,l,u,1,c,h),p=!0,f=new sf(d,"max",p),m=n.runWebGLProgram(f,[a],a.dtype),v=new Fxe(d),y=n.runWebGLProgram(v,[r,m],a.dtype);return n.disposeIntermediateTensorInfo(m),y}const Bxe={kernelName:eT,backendName:"webgl",kernelFunc:zxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uxe(t,e,n,s){let r=new sf(n,"max",!1);const i=s.runWebGLProgram(r,[t],"float32");r=new sf(n,"max",!0,!0,e);const o=s.runWebGLProgram(r,[t],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wxe={kernelName:nT,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=n;F(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];F(ss(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const c=pi(s.shape,r,i,u,o),[h,d]=Uxe(s,a,c,l);return[h,d]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jxe(t,e,n,s){const r=re(e),o=re(t.shape)/r,a=Ce({inputs:{x:t},attrs:{shape:[o,r]},backend:s}),l=hc(a,"float32","mean",s),u=Ce({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gxe={kernelName:X0,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:r,axis:i}=e,o=n,a=s.shape.length,l=st(i,s.shape);let u=l;const c=on(u,a),h=c!=null,d=o.shouldExecuteOnCPU([s]),p=[];let f=s;if(h){if(d){const I=o.texData.get(f.dataId).values,k=new Array(a);for(let T=0;T<k.length;T++)k[T]=s.shape[c[T]];const R=Ok(I,s.shape,s.dtype,c,k);f=o.makeTensorInfo(k,s.dtype);const C=o.texData.get(f.dataId);C.values=R}else f=aw(s,c,o);p.push(f),u=xn(u.length,a)}rs("sum",u,a);const[m,v]=Gn(f.shape,u);let y=m;r&&(y=wn(m,l));const w=jxe(f,v,y,o);for(const b of p)o.disposeIntermediateTensorInfo(b);return w}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=st(i,r.shape);let u=l;const c=on(u,a);let h=r;c!=null&&(h=Fs({inputs:{x:r},backend:n,attrs:{perm:c}}),u=xn(u.length,r.shape.length)),rs("min",u,a);const[d,p]=Gn(h.shape,u),f=re(p),m=Ce({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),v=hc(m,m.dtype,"min",n);let y;if(o){const w=wn(d,l);y=Ce({inputs:{x:v},backend:n,attrs:{shape:w}})}else y=Ce({inputs:{x:v},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),c!=null&&n.disposeIntermediateTensorInfo(h),y}const qxe={kernelName:Y0,backendName:"webgl",kernelFunc:Hxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kxe=Pk+`
  return min(a, b);
`,Xxe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+cc+`
  return result;
`,Yxe=os({opSnippet:Kxe,packedOpSnippet:Xxe,cpuKernelImpl:Pge}),Qxe={kernelName:Xf,backendName:"webgl",kernelFunc:Yxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jxe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=n.map((c,h)=>c[0]+e[h]+c[1]);const r=e.length,i=Dt(r),o=n.map(c=>c[0]).join(","),a=n.map((c,h)=>c[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zxe{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((f,m)=>f[0]+e[m]+f[1]);const r=e.length,i=Dt(r),o=n.map(f=>f[0]).join(","),a=n.map((f,m)=>f[0]+e[m]).join(","),l=Rs("rc",r),u=Rs("source",r),c=`${l[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${u.slice(-2).join()})`,d=s==="reflect"?0:1;let p="";if(r===1){const f=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${d};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${d};
        }
        source -= start;
      `;p=`
        ${i} rc = outputLoc;
        ${f}
        result[0] = getChannel(getX(${u.join()}), ${h});
        ${l[r-1]} += 1;
        if(${c}) {
          ${f}
          result[1] = getChannel(getX(${u.join()}), ${h});
        }
      `}else{const f=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${d}) +
                gte * ((end - 1) * 2 - source + ${d});
        source -= start;
      `;p=`
        ${i} rc = outputLoc;
        ${f}
        result[0] = getChannel(getX(${u.join()}), ${h});
        ${l[r-1]} += 1;
        if(${c}) {
          ${f}
          result[1] = getChannel(getX(${u.join()}), ${h});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${f}
          result[2] = getChannel(getX(${u.join()}), ${h});
          ${l[r-1]} += 1;
          if(${c}) {
            ${f}
            result[3] = getChannel(getX(${u.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e2e=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:r,mode:i}=n,o=te().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Zxe(s.shape,r,i):new Jxe(s.shape,r,i);return e.runWebGLProgram(o,[s],s.dtype)},t2e={kernelName:Q0,backendName:"webgl",kernelFunc:e2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n2e=`if (b == 0.0) return NAN;
  return mod(a, b);`,s2e=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+cc+`
  return result;
`,r2e=os({opSnippet:n2e,packedOpSnippet:s2e}),i2e={kernelName:Yf,backendName:"webgl",kernelFunc:r2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o2e{constructor(e,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a2e=`
if (a == b) {
  return 1.0;
};
return a / b;`,l2e=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,uz=os({opSnippet:a2e,packedOpSnippet:l2e,checkOutOfBounds:!0}),u2e={kernelName:Of,backendName:"webgl",kernelFunc:uz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uA="return a - b;",cz=os({opSnippet:uA,packedOpSnippet:uA,supportsComplex:!0,cpuKernelImpl:nye}),c2e={kernelName:dm,backendName:"webgl",kernelFunc:cz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hz(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:i}=s,o=st([i],r.shape),a=lz({inputs:{x:r},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=wn(a.shape,o),u=Ce({inputs:{x:a},backend:n,attrs:{shape:l}}),c=cz({inputs:{a:r,b:u},backend:n}),h=iz({inputs:{x:c},backend:n}),d=lw({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),p=Ce({inputs:{x:d},backend:n,attrs:{shape:l}}),f=uz({inputs:{a:h,b:p},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}const h2e={kernelName:mv,backendName:"webgl",kernelFunc:hz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d2e(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:hz({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),u=l.shape[0],c=l.shape[1],h=new o2e(u,c,i),d=[[o]],p=n.runWebGLProgram(h,[l],"int32",d);return a||n.disposeIntermediateTensorInfo(l),p}const p2e={kernelName:sT,backendName:"webgl",kernelFunc:d2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f2e=mi+`
  return -x;
`,m2e=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function g2e(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const i=n.texData.get(s.dataId),[o,a]=Lge(i.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,o)}let r;return te().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new za(s.shape,m2e):r=new fo(s.shape,f2e),n.runWebGLProgram(r,[s],s.dtype)}const y2e={kernelName:J0,backendName:"webgl",kernelFunc:g2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v2e=xC;function w2e(t){Nr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,u=n.readSync(r.dataId),c=n.readSync(i.dataId),{selectedIndices:h}=v2e(u,c,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const x2e={kernelName:rT,backendName:"webgl",kernelFunc:w2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b2e=bC;function I2e(t){Nr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,c=n.readSync(r.dataId),h=n.readSync(i.dataId),{selectedIndices:d,validOutputs:p}=b2e(c,h,o,a,l,u);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}const S2e={kernelName:iT,backendName:"webgl",kernelFunc:I2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T2e=IC;function C2e(t){Nr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,c=n.readSync(r.dataId),h=n.readSync(i.dataId),d=o,p=a,f=l,m=u,{selectedIndices:v,selectedScores:y}=T2e(c,h,d,p,f,m);return[n.makeTensorInfo([v.length],"int32",new Int32Array(v)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const k2e={kernelName:oT,backendName:"webgl",kernelFunc:C2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E2e{constructor(e,n,s,r){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _2e=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,u=re(r.shape),c=new E2e(u,o,a,l),h=Ce({inputs:{x:r},backend:n,attrs:{shape:[u]}}),d=n.runWebGLProgram(c,[h],i);n.disposeIntermediateTensorInfo(h);const p=[...r.shape,o],f=Ce({inputs:{x:d},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(d),f},N2e={kernelName:tv,backendName:"webgl",kernelFunc:_2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F1(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const r=zm({inputs:{input:s},backend:n}),i=F1({inputs:{x:r},backend:n}),o=uw({inputs:{input:s},backend:n}),a=F1({inputs:{x:o},backend:n}),l=Pl({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Bm({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const $2e={kernelName:wv,backendName:"webgl",kernelFunc:F1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dz(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=zm({inputs:{input:s},backend:n}),i=dz({inputs:{x:r},backend:n}),o=uw({inputs:{input:s},backend:n}),a=F1({inputs:{x:o},backend:n}),l=Pl({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Bm({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const A2e={kernelName:ev,backendName:"webgl",kernelFunc:dz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R2e(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return Ub({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(c=>{Ir(i,c.shape,"All tensors passed to stack must have matching shapes"),F(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const h=Ub({inputs:{input:c},backend:n,attrs:{dim:r}});return a.push(h),h}),u=Q6({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),u}const D2e={kernelName:nv,backendName:"webgl",kernelFunc:R2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O2e{constructor(e,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((u,c)=>u[0]+e[c]+u[1]);const r=e.length,i=Dt(r),o=n.map(u=>u[0]).join(","),a=n.map((u,c)=>u[0]+e[c]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P2e{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((m,v)=>m[0]+e[v]+m[1]);const r=e.length,i=Dt(r),o=n.map(m=>m[0]).join(","),a=n.map((m,v)=>m[0]+e[v]).join(","),l=Rs("rc",r),u=Rs("source",r),c=`${l[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${u.slice(-2).join()})`,d=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${c}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${c}) {`],p=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let f="";for(let m=0,v=r===1?2:4;m<v;m++)f+=`
        ${d[m]}
        if (${p}) {
          result[${m}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${m}] = getChannel(getX(${u.join()}), ${h});
        }
      `;f+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pz=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,constantValue:o}=s;if(re(r.shape)===0){const u=i.map((c,h)=>c[0]+r.shape[h]+c[1]);return Bm({backend:n,attrs:{shape:u,value:o,dtype:r.dtype}})}const a=te().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new P2e(r.shape,i,o):new O2e(r.shape,i,o),l=[[o]];return n.runWebGLProgram(a,[r],r.dtype,l)},F2e={kernelName:sv,backendName:"webgl",kernelFunc:pz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L2e=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,M2e=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+cc+`
  return result;
`,V2e=os({opSnippet:L2e,packedOpSnippet:M2e}),z2e={kernelName:Jf,backendName:"webgl",kernelFunc:V2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=[],u=st(i,r.shape);let c=u;const h=on(c,a);let d=r;h!=null&&(d=Fs({inputs:{x:r},backend:n,attrs:{perm:h}}),c=xn(c.length,a),l.push(d)),rs("prod",c,a);let p;if(n.shouldExecuteOnCPU([d])){const f=n.texData.get(d.dataId).values,{outVals:m,outShape:v,outDtype:y}=Vge(d.shape,d.dtype,f,c);p=n.makeTensorInfo(v,y,m)}else{const[f,m]=Gn(d.shape,c),v=re(m),y=Ce({inputs:{x:d},backend:n,attrs:{shape:[-1,v]}}),w=RT(r.dtype),b=hc(y,w,"prod",n);p=Ce({inputs:{x:b},backend:n,attrs:{shape:f}}),l.push(y),l.push(b)}if(o){l.push(p);const f=wn(p.shape,u);p=Ce({inputs:{x:p},backend:n,attrs:{shape:f}})}return l.forEach(f=>n.disposeIntermediateTensorInfo(f)),p}const U2e={kernelName:iv,backendName:"webgl",kernelFunc:B2e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W2e(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(y=>n.readSync(y.dataId)),u=r.map(y=>y.shape),c=n.readSync(i.dataId),h=n.readSync(o.dataId),[d,p,f]=zge(l,u,c,i.shape,i.dtype,h,o.shape,a),m=d.map(y=>n.makeTensorInfo([y.length],"int32",y)),v=n.makeTensorInfo(f,i.dtype,p);return m.concat([v])}const j2e={kernelName:aT,backendName:"webgl",kernelFunc:W2e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G2e(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:i}=e,o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[u,c]=Bge(o,s.shape,s.dtype,a,r.shape,l,i.shape),h=n.makeTensorInfo([u.length],"int32",u),d=n.makeTensorInfo([c.length],s.dtype,c);return[h,d]}const H2e={kernelName:lT,backendName:"webgl",kernelFunc:G2e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q2e(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=n.readSync(r.dataId),c=n.readSync(i.dataId),h=n.readSync(o.dataId),d=a.map(v=>n.readSync(v.dataId)),p=a.map(v=>v.shape),[f,m]=Uge(u,r.shape,c,i.shape,i.dtype,h,o.shape,d,p,l);return n.makeTensorInfo(f,i.dtype,m)}const K2e={kernelName:uT,backendName:"webgl",kernelFunc:q2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fz=t=>{const{backend:e,attrs:n}=t,{start:s,stop:r,step:i,dtype:o}=n,a=Wge(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},X2e={kernelName:cT,backendName:"webgl",kernelFunc:fz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y2e="return 1.0 / x;",Q2e=gt({opSnippet:Y2e}),J2e={kernelName:Zf,backendName:"webgl",kernelFunc:Q2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z2e=mi+`
  return (x < 0.0) ? 0.0 : x;
`,ebe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,tbe=gt({opSnippet:Z2e,packedOpSnippet:ebe}),nbe={kernelName:em,backendName:"webgl",kernelFunc:tbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sbe=mi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,rbe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ibe=gt({opSnippet:sbe,packedOpSnippet:rbe}),obe={kernelName:tm,backendName:"webgl",kernelFunc:ibe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class abe{constructor(e,n,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s];let d;i?d="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lbe{constructor(e,n,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s];let d;i?d="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ube(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,c=te().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new lbe(r.shape,l,u,i,o):new abe(r.shape,l,u,i,o);return n.runWebGLProgram(c,[r],"float32")}const cbe={kernelName:lv,backendName:"webgl",kernelFunc:ube};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hbe{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,i]=n,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],c=l[0]/u[0],h=l[1]/u[1],d=1/c,p=1/h,f=Math.ceil(d)*2+2,m=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${p});

        const int winHeight = int(${f});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dbe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s,a=new hbe(i.shape,r.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const pbe={kernelName:pT,backendName:"webgl",kernelFunc:dbe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fbe{constructor(e,n,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s],d=r?"0.5":"0.0";let p;i?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mbe{constructor(e,n,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s],d=r?"0.5":"0.0";let p;i?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gbe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,c=te().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new mbe(r.shape,l,u,i,o):new fbe(r.shape,l,u,i,o);return n.runWebGLProgram(c,[r],r.dtype)}const ybe={kernelName:av,backendName:"webgl",kernelFunc:gbe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vbe{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,i]=n,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],c=l[0]/u[0],h=l[1]/u[1],d=1/c,p=1/h,f=Math.ceil(d)*2+2,m=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${p});

        const int winHeight = int(${f});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wbe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s,a=new vbe(i.shape,r.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const xbe={kernelName:dT,backendName:"webgl",kernelFunc:wbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bbe{constructor(e,n){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>r(l)).join(","),o=Dt(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ibe{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=Rs("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=Dt(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${u(r.slice())};
          }
          if(${o}) {
            result.b = ${c(r.slice())};
            if(${i}) {
              result.a = ${h(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(f){return d(f)}function u(f){return f[s-1]="("+f[s-1]+" + 1)",d(f)}function c(f){return f[s-2]="("+f[s-2]+" + 1)",d(f)}function h(f){return f[s-1]="("+f[s-1]+" + 1)",f[s-2]="("+f[s-2]+" + 1)",d(f)}function d(f){const m=e.map((w,b)=>p(b,f)),v=m.join(","),y=m.slice(-2).join(",");return`getChannel(getX(${v}), vec2(${y}))`}function p(f,m){return n.indexOf(f)!==-1&&e[f]!==1?`${e[f]} - ${m[f]} - 1`:`${m[f]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sbe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:i}=s,o=r.shape.length,a=st(i,r.shape);if(o===0)return br({inputs:{x:r},backend:n});const l=te().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ibe(r.shape,a):new bbe(r.shape,a);return n.runWebGLProgram(l,[r],r.dtype)}const Tbe={kernelName:uv,backendName:"webgl",kernelFunc:Sbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cbe{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof n=="number"?i=`float outputValue = ${n.toFixed(2)};`:i=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kbe={kernelName:$T,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:i,center:o}=e,a=n,l=new Cbe(s.shape,i),[u,c]=PC(o,s.shape[1],s.shape[2]),h=[[u,c,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ebe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,_be=gt({opSnippet:Ebe}),Nbe={kernelName:nm,backendName:"webgl",kernelFunc:_be};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $be="return inversesqrt(x);",Abe=gt({opSnippet:$be,cpuKernelImpl:jge}),Rbe={kernelName:sm,backendName:"webgl",kernelFunc:Abe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mk{constructor(e,n,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const u=Dt(i.length),c=Dt(o.length);let h="";s===1?h="i":s===2&&(h="i, j");const d=`getIndices(${h})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const f=`getUpdates(${p})`;let m="";l&&(m="coords[0], coords[1]");const v=`getDefaultValue(${m})`,y=n>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${f};
              found = true;
            }
          }
          setOutput(mix(${v}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dbe{constructor(e,n,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const u=Dt(i.length),c=Dt(o.length);let h="";s===1?h="i":s===2&&(h="i, j");const d=`getIndices(${h})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const f=`getUpdates(${p})`;let m="";l&&(m="coords[0], coords[1]");const v=`getDefaultValue(${m})`,y=n>1?"strides[j]":"strides",w=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${d});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${w};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${f};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${v}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Obe(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=ic(i,r,o),d=[h/u,u];if(h===0)return n.makeTensorInfo(o,r.dtype);const p=Ce({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),f=Ce({inputs:{x:i},backend:n,attrs:{shape:[l,u]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0]));let v;te().getBool("WEBGL_PACK")?v=new Dbe(l,a,p.shape.length,f.shape.length,c,d):v=new Mk(l,a,p.shape.length,f.shape.length,c,d);const y=n.runWebGLProgram(v,[f,p,m],f.dtype),w=Ce({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),w}const Pbe={kernelName:fT,backendName:"webgl",kernelFunc:Obe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fbe{constructor(e,n,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=te().getNumber("WEBGL_VERSION")===2?i:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lbe(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:i}=e,{side:o}=s,a=new Fbe(r.shape[0],r.shape[1],i.shape[1],o),l=[[r.shape[1]]];return n.runWebGLProgram(a,[r,i],"int32",l)}const Mbe={kernelName:gT,backendName:"webgl",kernelFunc:Lbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vbe{constructor(e,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let c=0;c<n.length;c++)u.push(`${a[c]}`),c<e&&l.push(`${a[c]}`);r=l.join(),i=u.join()}const o=Dt(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zbe(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:i}=e,o=new Vbe(s.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(o,[s,r,i],vr(r.dtype,i.dtype))}const Bbe={kernelName:cv,backendName:"webgl",kernelFunc:zbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ube=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Gv};
  float scale = ${Hv};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Wbe=gt({opSnippet:Ube}),jbe={kernelName:rm,backendName:"webgl",kernelFunc:Wbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gbe=od+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Hbe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,qbe=gt({opSnippet:Gbe,packedOpSnippet:Hbe,cpuKernelImpl:Hge}),Kbe={kernelName:lm,backendName:"webgl",kernelFunc:qbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xbe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Ybe=gt({opSnippet:Xbe}),Qbe={kernelName:am,backendName:"webgl",kernelFunc:Ybe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jbe=od+`
  return sin(x);
`,Zbe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${cc}
  return result;
`,eIe=gt({opSnippet:Jbe,packedOpSnippet:Zbe}),tIe={kernelName:im,backendName:"webgl",kernelFunc:eIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nIe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,sIe=gt({opSnippet:nIe}),rIe={kernelName:om,backendName:"webgl",kernelFunc:sIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iIe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,oIe=gt({opSnippet:iIe}),aIe={kernelName:um,backendName:"webgl",kernelFunc:oIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lIe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,paddings:o}=s;F(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((y,w)=>y*w),l=[[0,0]];l.push(...o);for(let y=1+i.length;y<r.shape.length;++y)l.push([0,0]);const u=[],c=pz({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),h=Cm(c.shape,i,a,!1),d=km(h.length,i.length,!1),p=Em(c.shape,i,a,!1),f=Ce({inputs:{x:c},backend:n,attrs:{shape:h}}),m=Fs({inputs:{x:f},backend:n,attrs:{perm:d}}),v=Ce({inputs:{x:m},backend:n,attrs:{shape:p}});return u.push(c),u.push(f),u.push(m),u.forEach(y=>n.disposeIntermediateTensorInfo(y)),v},uIe={kernelName:pv,backendName:"webgl",kernelFunc:lIe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cIe(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(s.dataId),l=n.readSync(r.dataId),u=n.readSync(i.dataId),c=n.readSync(o.dataId)[0],[h,d,p,f,m]=Kge(a,s.shape,s.dtype,l,r.dtype,u,c);return[n.makeTensorInfo(d,s.dtype,h),n.makeTensorInfo([d[0]],r.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(v=>Number(v)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const hIe={kernelName:yT,backendName:"webgl",kernelFunc:cIe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dIe(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(n.readSync(r.dataId)),a=n.readSync(s.dataId),l=Array.from(n.readSync(i.dataId)),[u,c,h]=Xge(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(c,s.dtype,u),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const pIe={kernelName:vT,backendName:"webgl",kernelFunc:dIe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fIe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[u,c]=M6(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(c,s.dtype,u)}const mIe={kernelName:wT,backendName:"webgl",kernelFunc:fIe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gIe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[u,c]=M6(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(c,s.dtype,u)}const yIe={kernelName:xT,backendName:"webgl",kernelFunc:gIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vIe(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:d}=ic(i,r,a),p=!1;if(i.dtype==="string"){const y=n.bufferSync(r),w=n.bufferSync(i),b=ll(n.readSync(o.dataId)[0]),I=Gge(y,w,a,d,c,u,l,h,b,p);return n.makeTensorInfo(a,I.dtype,I.values)}const f=new Mk(u,l,r.shape.length,i.shape.length,h,[d,1],p),m=n.runWebGLProgram(f,[i,r,o],i.dtype),v=Ce({inputs:{x:m},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(m),v}const wIe={kernelName:bT,backendName:"webgl",kernelFunc:vIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=st(o,r.shape)[0],l=YC(r,i,a),u=r.shape.length,c=new Array(u).fill(0),h=r.shape.slice();return l.map(d=>{const p=[...h];p[a]=d;const f=ad({inputs:{x:r},backend:n,attrs:{begin:c,size:p}});return c[a]+=d,f})}const bIe={kernelName:fv,backendName:"webgl",kernelFunc:xIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cA="return sqrt(x);",IIe=gt({opSnippet:cA,packedOpSnippet:cA,cpuKernelImpl:Yge}),SIe={kernelName:cm,backendName:"webgl",kernelFunc:IIe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TIe="return x * x;",CIe=gt({opSnippet:TIe}),kIe={kernelName:IT,backendName:"webgl",kernelFunc:CIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hA="return (a - b) * (a - b);",EIe=os({opSnippet:hA,packedOpSnippet:hA}),_Ie={kernelName:hm,backendName:"webgl",kernelFunc:EIe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=n.readSync(r.dataId),o=ia(i),a=Qge(o,"string",s);return n.makeTensorInfo(r.shape,"string",a)}const $Ie={kernelName:gv,backendName:"webgl",kernelFunc:NIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AIe({inputs:t,attrs:e,backend:n}){const{x:s}=t,r=mi+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new fo(s.shape,r);return n.runWebGLProgram(i,[s],s.dtype)}const RIe={kernelName:gm,backendName:"webgl",kernelFunc:AIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DIe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=Dt(s.length),o=Dt(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,c)=>(l++,s.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${l-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=s,{finalShapeSparse:p,finalShape:f,isIdentity:m,sliceDim0:v,isSimpleSlice:y,begin:w,end:b,strides:I}=RC(r.shape,i,o,a,l,u,c,h,d);let k;if(m)k=Ce({inputs:{x:r},backend:n,attrs:{shape:f}});else if(v||y){F(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const C=NC(w,b,I),T=ad({inputs:{x:r},backend:n,attrs:{begin:w,size:C}});k=Ce({inputs:{x:T},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(T)}else if(n.shouldExecuteOnCPU([r])){const T=n.readSync(r.dataId),N=tt(r.shape,r.dtype,T),$=Jge(p,N,I,w);k=n.makeTensorInfo(f,r.dtype,$.values)}else{const T=new DIe(w,I,p);k=n.runWebGLProgram(T,[r],r.dtype)}const R=Ce({inputs:{x:k},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(k),R}const PIe={kernelName:ST,backendName:"webgl",kernelFunc:OIe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FIe(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:c,dataSplits:h}=e,d=n.readSync(c.dataId),p=n.readSync(h.dataId),[f,m]=Zge(d,p,r,i,o,a,l,u);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",m)]}const LIe={kernelName:TT,backendName:"webgl",kernelFunc:FIe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MIe(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],[u,c,h]=eye(a,l,r),d=c.length;return[n.makeTensorInfo([d,2],"int32",u),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const VIe={kernelName:CT,backendName:"webgl",kernelFunc:MIe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zIe(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(i.dataId),a=tye(o,r);return n.makeTensorInfo(i.shape,"int32",a)}const BIe={kernelName:kT,backendName:"webgl",kernelFunc:zIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UIe="return tan(x);",WIe=gt({opSnippet:UIe}),jIe={kernelName:pm,backendName:"webgl",kernelFunc:WIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GIe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,HIe=gt({opSnippet:GIe}),qIe={kernelName:fm,backendName:"webgl",kernelFunc:HIe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KIe(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=ic(o,i,r.shape),d=[h/u,u];if(h===0)return n.makeTensorInfo(r.shape,i.dtype);const p=Ce({inputs:{x:i},backend:n,attrs:{shape:[l,a]}}),f=Ce({inputs:{x:o},backend:n,attrs:{shape:[l,u]}}),m=Ce({inputs:{x:r},backend:n,attrs:{shape:d}}),v=new Mk(l,a,p.shape.length,f.shape.length,c,d,!1,!0),y=n.runWebGLProgram(v,[f,p,m],m.dtype),w=Ce({inputs:{x:y},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),w}const XIe={kernelName:mT,backendName:"webgl",kernelFunc:KIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YIe{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*n[o];this.outputShape=s,this.rank=s.length;const r=Dt(this.rank),i=QIe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function QIe(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<t.length;r++)s.push(`imod(${n[r]}, ${t[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mz(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=n.readSync(r.dataId),u=r.dtype==="string"?l.map(d=>ll(d)):l,c=tt(r.shape,r.dtype,u),h=sye(c,i);return n.makeTensorInfo(h.shape,h.dtype,h.values)}const o=new YIe(r.shape,i);return n.runWebGLProgram(o,[r],r.dtype)}const JIe={kernelName:mm,backendName:"webgl",kernelFunc:mz};class ZIe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class eSe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xl(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function dA(t){let e=1;for(;e<t;)e*=2;return e}function tSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:i,sorted:o}=s,a=te().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=te().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,c=u[u.length-1];if(n.shouldExecuteOnCPU([r])||c<a||i>l){const $=n.readSync(r.dataId),[P,V]=rye($,u,r.dtype,i,o);return[n.makeTensorInfo(P.shape,P.dtype,P.values),n.makeTensorInfo(V.shape,V.dtype,V.values)]}if(i===0)return u[u.length-1]=0,[n.makeTensorInfo(u,r.dtype,[]),n.makeTensorInfo(u,"int32",[])];if(c===1)return[r,Bm({attrs:{shape:u,dtype:"int32",value:0},backend:n})];const h=n.texData.get(r.dataId),d=h!==null&&h.isPacked,p=d?n.unpackTensor(r):r,m=re(u)/c,v=Ce({inputs:{x:p},attrs:{shape:[m,c]},backend:n});d&&Xl(n,p);const y=dA(i),w=dA(c);let b=null;const I=()=>b===null?[v,v]:[v,b],k=($,P,V)=>{const O=I(),Q=new ZIe(V),ne=[[c],[b===null?1:0],[Number.NEGATIVE_INFINITY],[$],[P]],le=b;b=n.runWebGLProgram(Q,O,"int32",ne),Xl(n,le)};for(let $=1;$<y;$*=2){const P=$*2;for(let V=$;V>=1;V/=2)k(P,V,[m,w])}for(let $=w;$>y;$/=2){const P=I(),V=new eSe([m,$/2]),Q=[[c],[b===null?1:0],[y]],Z=b;b=n.runWebGLProgram(V,P,"int32",Q),Xl(n,Z);const ne=y/2,le=ne*2;for(let q=ne;q>=1;q/=2)k(le,q,b.shape)}let R=b;b=ad({inputs:{x:b},backend:n,attrs:{begin:0,size:[m,i]}}),Xl(n,R);let C=az({inputs:{x:v,indices:b},backend:n,attrs:{axis:1,batchDims:1}});Xl(n,v);const T=u.slice(0,-1);T.push(i),R=b,b=Ce({inputs:{x:b},attrs:{shape:T},backend:n}),Xl(n,R);const N=C;return C=Ce({inputs:{x:C},attrs:{shape:T},backend:n}),Xl(n,N),[C,b]}const nSe={kernelName:ET,backendName:"webgl",kernelFunc:tSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sSe{constructor(e,n,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rSe(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=s,[c,h,d,p]=r.shape,[f,m]=u??[h,d],v=[c,f,m,p],y=new sSe(h,d,o,a,l,v);return n.runWebGLProgram(y,[r,i],"float32")}const iSe={kernelName:_T,backendName:"webgl",kernelFunc:rSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oSe(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:i}=e;Mm(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:l,indices:u}=iye(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const aSe={kernelName:NT,backendName:"webgl",kernelFunc:oSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lSe(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],u=new Array(a-1);let c=0;for(let m=0;m<a;m++)m!==i&&(u[c++]=o.shape[m]);const h=[],d=new Array(a).fill(0),p=o.shape.slice();p[i]=1;const f=new Array(l);for(let m=0;m<f.length;m++){d[i]=m;const v=ad({inputs:{x:o},backend:n,attrs:{begin:d,size:p}}),y=Ce({inputs:{x:v},backend:n,attrs:{shape:u}});f[m]=y,h.push(v)}return h.forEach(m=>n.disposeIntermediateTensorInfo(m)),f}const uSe={kernelName:yv,backendName:"webgl",kernelFunc:lSe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cSe{constructor(e,n){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const l="0.0",u="sumValue",c=Math.floor(s/4)*4,h=s%4,d=`
        sumValue += dot(values, segFilter);
    `;let p="";i%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let f="";i%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${f}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${d}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${d}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${d}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${d}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let u=0;const c=on([u],a);let h=r;c!=null&&(h=Fs({inputs:{x:r},backend:n,attrs:{perm:c}}),l.push(h),u=xn(1,a)[0]);const d=qF(h.shape,u,o),p=re([h.shape[u]]),f=Ce({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}});l.push(f);const m=RT(r.dtype),v=(I,k,R,C,T)=>{const N=I.shape[0],$=I.shape[1],P=HF($,T),V={windowSize:P,inSize:$,batchSize:N,numSegments:T},O=new cSe(V,k),Q=n.compileAndRun(O,[I,R],C);if(l.push(Q),Q.shape[1]===T)return Q;const Z=fz({backend:n,attrs:{start:0,stop:T,step:1,dtype:"float32"}}),ne=mz({inputs:{x:Z},backend:n,attrs:{reps:[$/P]}});return l.push(Z),l.push(ne),v(Q,k,ne,C,T)},y=v(f,"unsortedSegmentSum",i,m,o),w=Ce({inputs:{x:y},backend:n,attrs:{shape:d}});let b=w;if(c!=null){l.push(w);const I=Nl(c);b=Fs({inputs:{x:b},backend:n,attrs:{perm:I}})}return l.forEach(I=>n.disposeIntermediateTensorInfo(I)),b}const dSe={kernelName:vv,backendName:"webgl",kernelFunc:hSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pSe=[Yye,Jye,t1e,r1e,o1e,u1e,h1e,p1e,y1e,w1e,I1e,C1e,_1e,R1e,P1e,L1e,V1e,W1e,G1e,q1e,Q1e,r0e,o0e,c0e,d0e,v0e,x0e,T0e,Dye,E0e,R0e,F0e,U0e,G0e,q0e,X0e,Q0e,tve,rve,ave,uve,hve,pve,gve,vve,Ive,Tve,Eve,$ve,Rve,Fve,zve,jve,qve,Yve,Qve,Zve,twe,swe,iwe,awe,hwe,fwe,ywe,wwe,Iwe,Cwe,Nwe,Dwe,Rye,Pwe,$0e,Mwe,Bwe,jwe,Pye,Kwe,Jwe,exe,rxe,axe,hxe,fxe,vxe,Ixe,Cxe,Exe,Axe,Dxe,Pxe,Vxe,Bxe,Wxe,Gxe,qxe,Qxe,t2e,i2e,p2e,Mye,y2e,x2e,S2e,k2e,f0e,N2e,A2e,D2e,F2e,z2e,Lye,U2e,j2e,H2e,K2e,X2e,m0e,u2e,J2e,nbe,obe,zye,cbe,pbe,ybe,xbe,Tbe,kbe,Nbe,Rbe,Pbe,Mbe,Bbe,jbe,Kbe,Qbe,tIe,rIe,n0e,h2e,aIe,uIe,hIe,pIe,mIe,yIe,wIe,bIe,SIe,kIe,_Ie,$Ie,RIe,PIe,LIe,VIe,BIe,c2e,qye,jIe,qIe,XIe,JIe,nSe,iSe,Kye,aSe,uSe,dSe,$2e];for(const t of pSe)pO(t);var fSe={};(function(){var t;function e(x){var _=0;return function(){return _<x.length?{done:!1,value:x[_++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(x,_,D){return x==Array.prototype||x==Object.prototype||(x[_]=D.value),x};function s(x){x=[typeof globalThis=="object"&&globalThis,x,typeof window=="object"&&window,typeof self=="object"&&self,typeof Oi=="object"&&Oi];for(var _=0;_<x.length;++_){var D=x[_];if(D&&D.Math==Math)return D}throw Error("Cannot find global object")}var r=s(this);function i(x,_){if(_)e:{var D=r;x=x.split(".");for(var M=0;M<x.length-1;M++){var B=x[M];if(!(B in D))break e;D=D[B]}x=x[x.length-1],M=D[x],_=_(M),_!=M&&_!=null&&n(D,x,{configurable:!0,writable:!0,value:_})}}i("Symbol",function(x){function _(X){if(this instanceof _)throw new TypeError("Symbol is not a constructor");return new D(M+(X||"")+"_"+B++,X)}function D(X,G){this.g=X,n(this,"description",{configurable:!0,writable:!0,value:G})}if(x)return x;D.prototype.toString=function(){return this.g};var M="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",B=0;return _}),i("Symbol.iterator",function(x){if(x)return x;x=Symbol("Symbol.iterator");for(var _="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),D=0;D<_.length;D++){var M=r[_[D]];typeof M=="function"&&typeof M.prototype[x]!="function"&&n(M.prototype,x,{configurable:!0,writable:!0,value:function(){return o(e(this))}})}return x});function o(x){return x={next:x},x[Symbol.iterator]=function(){return this},x}function a(x){var _=typeof Symbol<"u"&&Symbol.iterator&&x[Symbol.iterator];return _?_.call(x):{next:e(x)}}function l(x){if(!(x instanceof Array)){x=a(x);for(var _,D=[];!(_=x.next()).done;)D.push(_.value);x=D}return x}var u=typeof Object.create=="function"?Object.create:function(x){function _(){}return _.prototype=x,new _},c;if(typeof Object.setPrototypeOf=="function")c=Object.setPrototypeOf;else{var h;e:{var d={a:!0},p={};try{p.__proto__=d,h=p.a;break e}catch{}h=!1}c=h?function(x,_){if(x.__proto__=_,x.__proto__!==_)throw new TypeError(x+" is not extensible");return x}:null}var f=c;function m(x,_){if(x.prototype=u(_.prototype),x.prototype.constructor=x,f)f(x,_);else for(var D in _)if(D!="prototype")if(Object.defineProperties){var M=Object.getOwnPropertyDescriptor(_,D);M&&Object.defineProperty(x,D,M)}else x[D]=_[D];x.na=_.prototype}function v(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.u=this.o=0,this.j=null}function y(x){if(x.l)throw new TypeError("Generator is already running");x.l=!0}v.prototype.s=function(x){this.h=x};function w(x,_){x.j={da:_,ea:!0},x.g=x.o||x.u}v.prototype.return=function(x){this.j={return:x},this.g=this.u};function b(x,_,D){return x.g=D,{value:_}}function I(x){this.g=new v,this.h=x}function k(x,_){y(x.g);var D=x.g.i;return D?R(x,"return"in D?D.return:function(M){return{value:M,done:!0}},_,x.g.return):(x.g.return(_),C(x))}function R(x,_,D,M){try{var B=_.call(x.g.i,D);if(!(B instanceof Object))throw new TypeError("Iterator result "+B+" is not an object");if(!B.done)return x.g.l=!1,B;var X=B.value}catch(G){return x.g.i=null,w(x.g,G),C(x)}return x.g.i=null,M.call(x.g,X),C(x)}function C(x){for(;x.g.g;)try{var _=x.h(x.g);if(_)return x.g.l=!1,{value:_.value,done:!1}}catch(D){x.g.h=void 0,w(x.g,D)}if(x.g.l=!1,x.g.j){if(_=x.g.j,x.g.j=null,_.ea)throw _.da;return{value:_.return,done:!0}}return{value:void 0,done:!0}}function T(x){this.next=function(_){return y(x.g),x.g.i?_=R(x,x.g.i.next,_,x.g.s):(x.g.s(_),_=C(x)),_},this.throw=function(_){return y(x.g),x.g.i?_=R(x,x.g.i.throw,_,x.g.s):(w(x.g,_),_=C(x)),_},this.return=function(_){return k(x,_)},this[Symbol.iterator]=function(){return this}}function N(x){function _(M){return x.next(M)}function D(M){return x.throw(M)}return new Promise(function(M,B){function X(G){G.done?M(G.value):Promise.resolve(G.value).then(_,D).then(X,B)}X(x.next())})}function $(x){return N(new T(new I(x)))}i("Promise",function(x){function _(G){this.h=0,this.i=void 0,this.g=[],this.s=!1;var se=this.j();try{G(se.resolve,se.reject)}catch(ce){se.reject(ce)}}function D(){this.g=null}function M(G){return G instanceof _?G:new _(function(se){se(G)})}if(x)return x;D.prototype.h=function(G){if(this.g==null){this.g=[];var se=this;this.i(function(){se.l()})}this.g.push(G)};var B=r.setTimeout;D.prototype.i=function(G){B(G,0)},D.prototype.l=function(){for(;this.g&&this.g.length;){var G=this.g;this.g=[];for(var se=0;se<G.length;++se){var ce=G[se];G[se]=null;try{ce()}catch(ve){this.j(ve)}}}this.g=null},D.prototype.j=function(G){this.i(function(){throw G})},_.prototype.j=function(){function G(ve){return function(Re){ce||(ce=!0,ve.call(se,Re))}}var se=this,ce=!1;return{resolve:G(this.D),reject:G(this.l)}},_.prototype.D=function(G){if(G===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(G instanceof _)this.H(G);else{e:switch(typeof G){case"object":var se=G!=null;break e;case"function":se=!0;break e;default:se=!1}se?this.A(G):this.o(G)}},_.prototype.A=function(G){var se=void 0;try{se=G.then}catch(ce){this.l(ce);return}typeof se=="function"?this.I(se,G):this.o(G)},_.prototype.l=function(G){this.u(2,G)},_.prototype.o=function(G){this.u(1,G)},_.prototype.u=function(G,se){if(this.h!=0)throw Error("Cannot settle("+G+", "+se+"): Promise already settled in state"+this.h);this.h=G,this.i=se,this.h===2&&this.G(),this.B()},_.prototype.G=function(){var G=this;B(function(){if(G.C()){var se=r.console;typeof se<"u"&&se.error(G.i)}},1)},_.prototype.C=function(){if(this.s)return!1;var G=r.CustomEvent,se=r.Event,ce=r.dispatchEvent;return typeof ce>"u"?!0:(typeof G=="function"?G=new G("unhandledrejection",{cancelable:!0}):typeof se=="function"?G=new se("unhandledrejection",{cancelable:!0}):(G=r.document.createEvent("CustomEvent"),G.initCustomEvent("unhandledrejection",!1,!0,G)),G.promise=this,G.reason=this.i,ce(G))},_.prototype.B=function(){if(this.g!=null){for(var G=0;G<this.g.length;++G)X.h(this.g[G]);this.g=null}};var X=new D;return _.prototype.H=function(G){var se=this.j();G.M(se.resolve,se.reject)},_.prototype.I=function(G,se){var ce=this.j();try{G.call(se,ce.resolve,ce.reject)}catch(ve){ce.reject(ve)}},_.prototype.then=function(G,se){function ce(We,Fe){return typeof We=="function"?function(Ze){try{ve(We(Ze))}catch(at){Re(at)}}:Fe}var ve,Re,He=new _(function(We,Fe){ve=We,Re=Fe});return this.M(ce(G,ve),ce(se,Re)),He},_.prototype.catch=function(G){return this.then(void 0,G)},_.prototype.M=function(G,se){function ce(){switch(ve.h){case 1:G(ve.i);break;case 2:se(ve.i);break;default:throw Error("Unexpected state: "+ve.h)}}var ve=this;this.g==null?X.h(ce):this.g.push(ce),this.s=!0},_.resolve=M,_.reject=function(G){return new _(function(se,ce){ce(G)})},_.race=function(G){return new _(function(se,ce){for(var ve=a(G),Re=ve.next();!Re.done;Re=ve.next())M(Re.value).M(se,ce)})},_.all=function(G){var se=a(G),ce=se.next();return ce.done?M([]):new _(function(ve,Re){function He(Ze){return function(at){We[Ze]=at,Fe--,Fe==0&&ve(We)}}var We=[],Fe=0;do We.push(void 0),Fe++,M(ce.value).M(He(We.length-1),Re),ce=se.next();while(!ce.done)})},_});function P(x,_){x instanceof String&&(x+="");var D=0,M=!1,B={next:function(){if(!M&&D<x.length){var X=D++;return{value:_(X,x[X]),done:!1}}return M=!0,{done:!0,value:void 0}}};return B[Symbol.iterator]=function(){return B},B}var V=typeof Object.assign=="function"?Object.assign:function(x,_){for(var D=1;D<arguments.length;D++){var M=arguments[D];if(M)for(var B in M)Object.prototype.hasOwnProperty.call(M,B)&&(x[B]=M[B])}return x};i("Object.assign",function(x){return x||V}),i("Object.is",function(x){return x||function(_,D){return _===D?_!==0||1/_===1/D:_!==_&&D!==D}}),i("Array.prototype.includes",function(x){return x||function(_,D){var M=this;M instanceof String&&(M=String(M));var B=M.length;for(D=D||0,0>D&&(D=Math.max(D+B,0));D<B;D++){var X=M[D];if(X===_||Object.is(X,_))return!0}return!1}}),i("String.prototype.includes",function(x){return x||function(_,D){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(_ instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(_,D||0)!==-1}}),i("Array.prototype.keys",function(x){return x||function(){return P(this,function(_){return _})}});var O=this||self;function Q(x,_){x=x.split(".");var D=O;x[0]in D||typeof D.execScript>"u"||D.execScript("var "+x[0]);for(var M;x.length&&(M=x.shift());)x.length||_===void 0?D[M]&&D[M]!==Object.prototype[M]?D=D[M]:D=D[M]={}:D[M]=_}function Z(){throw Error("Invalid UTF8")}function ne(x,_){return _=String.fromCharCode.apply(null,_),x==null?_:x+_}var le,q=typeof TextDecoder<"u",J,ie=typeof TextEncoder<"u",he={},de=null;function pe(x){var _;_===void 0&&(_=0),Ie(),_=he[_];for(var D=Array(Math.floor(x.length/3)),M=_[64]||"",B=0,X=0;B<x.length-2;B+=3){var G=x[B],se=x[B+1],ce=x[B+2],ve=_[G>>2];G=_[(G&3)<<4|se>>4],se=_[(se&15)<<2|ce>>6],ce=_[ce&63],D[X++]=ve+G+se+ce}switch(ve=0,ce=M,x.length-B){case 2:ve=x[B+1],ce=_[(ve&15)<<2]||M;case 1:x=x[B],D[X]=_[x>>2]+_[(x&3)<<4|ve>>4]+ce+M}return D.join("")}function xe(x){var _=x.length,D=3*_/4;D%3?D=Math.floor(D):"=.".indexOf(x[_-1])!=-1&&(D="=.".indexOf(x[_-2])!=-1?D-2:D-1);var M=new Uint8Array(D),B=0;return ye(x,function(X){M[B++]=X}),B!==D?M.subarray(0,B):M}function ye(x,_){function D(ce){for(;M<x.length;){var ve=x.charAt(M++),Re=de[ve];if(Re!=null)return Re;if(!/^[\s\xa0]*$/.test(ve))throw Error("Unknown base64 encoding at char: "+ve)}return ce}Ie();for(var M=0;;){var B=D(-1),X=D(0),G=D(64),se=D(64);if(se===64&&B===-1)break;_(B<<2|X>>4),G!=64&&(_(X<<4&240|G>>2),se!=64&&_(G<<6&192|se))}}function Ie(){if(!de){de={};for(var x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),_=["+/=","+/","-_=","-_.","-_"],D=0;5>D;D++){var M=x.concat(_[D].split(""));he[D]=M;for(var B=0;B<M.length;B++){var X=M[B];de[X]===void 0&&(de[X]=B)}}}}var $e=typeof Uint8Array=="function";function ze(x){return $e&&x!=null&&x instanceof Uint8Array}var Me;function Ue(x){if(this.L=x,x!==null&&x.length===0)throw Error("ByteString should be constructed with non-empty values")}var Ke=typeof Uint8Array.prototype.slice=="function",Je=0,nt=0;function _t(x,_){if(x.constructor===Uint8Array)return x;if(x.constructor===ArrayBuffer)return new Uint8Array(x);if(x.constructor===Array)return new Uint8Array(x);if(x.constructor===String)return xe(x);if(x.constructor===Ue)return!_&&(_=x.L)&&_.constructor===Uint8Array?_:(_=x.L,_=_==null||ze(_)?_:typeof _=="string"?xe(_):null,(x=x.L=_)?new Uint8Array(x):Me||(Me=new Uint8Array(0)));if(x instanceof Uint8Array)return new Uint8Array(x.buffer,x.byteOffset,x.byteLength);throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, or Array of numbers")}function yt(x,_){return Error("Invalid wire type: "+x+" (at position "+_+")")}function ht(){return Error("Failed to read varint, encoding is invalid.")}function Nt(x,_){_=_===void 0?{}:_,_=_.v===void 0?!1:_.v,this.h=null,this.g=this.i=this.j=0,this.v=_,x&&St(this,x)}function St(x,_){x.h=_t(_,x.v),x.j=0,x.i=x.h.length,x.g=x.j}Nt.prototype.reset=function(){this.g=this.j};function Ot(x){if(x.g>x.i)throw Error("Tried to read past the end of the data "+x.g+" > "+x.i)}function Pt(x){var _=x.h,D=_[x.g],M=D&127;if(128>D)return x.g+=1,Ot(x),M;if(D=_[x.g+1],M|=(D&127)<<7,128>D)return x.g+=2,Ot(x),M;if(D=_[x.g+2],M|=(D&127)<<14,128>D)return x.g+=3,Ot(x),M;if(D=_[x.g+3],M|=(D&127)<<21,128>D)return x.g+=4,Ot(x),M;if(D=_[x.g+4],x.g+=5,M|=(D&15)<<28,128>D)return Ot(x),M;if(128<=_[x.g++]&&128<=_[x.g++]&&128<=_[x.g++]&&128<=_[x.g++]&&128<=_[x.g++])throw ht();return Ot(x),M}var tr=[];function Ln(){this.g=[]}Ln.prototype.length=function(){return this.g.length},Ln.prototype.end=function(){var x=this.g;return this.g=[],x};function Mn(x,_){for(;127<_;)x.g.push(_&127|128),_>>>=7;x.g.push(_)}function Hn(x){var _={},D=_.W===void 0?!1:_.W;this.l={v:_.v===void 0?!1:_.v},this.W=D,_=this.l,tr.length?(D=tr.pop(),_&&(D.v=_.v),x&&St(D,x),x=D):x=new Nt(x,_),this.g=x,this.j=this.g.g,this.h=this.i=-1}Hn.prototype.reset=function(){this.g.reset(),this.j=this.g.g,this.h=this.i=-1};function Vs(x){var _=x.g;if(_.g==_.i)return!1;x.j=x.g.g;var D=Pt(x.g)>>>0;if(_=D>>>3,D&=7,!(0<=D&&5>=D))throw yt(D,x.j);if(1>_)throw Error("Invalid field number: "+_+" (at position "+x.j+")");return x.i=_,x.h=D,!0}function Tt(x){switch(x.h){case 0:if(x.h!=0)Tt(x);else e:{x=x.g;for(var _=x.g,D=_+10;_<D;)if(!(x.h[_++]&128)){x.g=_,Ot(x);break e}throw ht()}break;case 1:x=x.g,x.g+=8,Ot(x);break;case 2:x.h!=2?Tt(x):(_=Pt(x.g)>>>0,x=x.g,x.g+=_,Ot(x));break;case 5:x=x.g,x.g+=4,Ot(x);break;case 3:_=x.i;do{if(!Vs(x))throw Error("Unmatched start-group tag: stream EOF");if(x.h==4){if(x.i!=_)throw Error("Unmatched end-group tag");break}Tt(x)}while(!0);break;default:throw yt(x.h,x.j)}}var $t=[];function zs(){this.i=[],this.h=0,this.g=new Ln}function Bs(x,_){_.length!==0&&(x.i.push(_),x.h+=_.length)}function fa(x,_){if(_=_.ba){Bs(x,x.g.end());for(var D=0;D<_.length;D++)Bs(x,_[D])}}var Qi=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol(void 0):void 0;function Ji(x,_){Object.isFrozen(x)||(Qi?x[Qi]|=_:x.N!==void 0?x.N|=_:Object.defineProperties(x,{N:{value:_,configurable:!0,writable:!0,enumerable:!1}}))}function Zi(x){var _;return Qi?_=x[Qi]:_=x.N,_??0}function eo(x){return Ji(x,1),x}function gi(x){return Array.isArray(x)?!!(Zi(x)&2):!1}function ld(x){if(!Array.isArray(x))throw Error("cannot mark non-array as immutable");Ji(x,2)}function Um(x){return x!==null&&typeof x=="object"&&!Array.isArray(x)&&x.constructor===Object}var ma=Object.freeze(eo([]));function ud(x){if(gi(x.m))throw Error("Cannot mutate an immutable Message")}var cd=typeof Symbol<"u"&&typeof Symbol.hasInstance<"u";function ga(x){return{value:x,configurable:!1,writable:!1,enumerable:!1}}function Us(x,_,D){return _===-1?null:_>=x.i?x.g?x.g[_]:void 0:D!==void 0&&D&&x.g&&(D=x.g[_],D!=null)?D:x.m[_+x.h]}function an(x,_,D,M){M=M===void 0?!1:M,ud(x),_<x.i&&!M?x.m[_+x.h]=D:(x.g||(x.g=x.m[x.i+x.h]={}))[_]=D}function to(x,_,D,M){D=D===void 0?!0:D,M=M===void 0?!1:M;var B=Us(x,_,M);return B==null&&(B=ma),gi(x.m)?D&&(ld(B),Object.freeze(B)):(B===ma||gi(B))&&(B=eo(B.slice()),an(x,_,B,M)),B}function Cr(x,_,D){return x=Us(x,_),x=x==null?x:+x,x??(D===void 0?0:D)}function Ro(x,_,D,M){x.j||(x.j={});var B=gi(x.m),X=x.j[D];if(!X){M=to(x,D,!0,M===void 0?!1:M),X=[],B=B||gi(M);for(var G=0;G<M.length;G++)X[G]=new _(M[G]),B&&ld(X[G].m);B&&(ld(X),Object.freeze(X)),x.j[D]=X}return X}function hd(x,_,D,M,B){var X=X===void 0?!1:X;return ud(x),X=Ro(x,D,_,X),D=M||new D,x=to(x,_),B!=null?(X.splice(B,0,D),x.splice(B,0,D.m)):(X.push(D),x.push(D.m)),D}function ya(x,_){return x=Us(x,_),x??0}function dd(x,_){return x=Us(x,_),x??""}function as(x){switch(typeof x){case"number":return isFinite(x)?x:String(x);case"object":if(x&&!Array.isArray(x)){if(ze(x))return pe(x);if(x instanceof Ue){var _=x.L;return _=_==null||typeof _=="string"?_:$e&&_ instanceof Uint8Array?pe(_):null,(x.L=_)||""}}}return x}function pd(x){var _=cw;return _=_===void 0?hw:_,wa(x,_)}function va(x,_){if(x!=null){if(Array.isArray(x))x=wa(x,_);else if(Um(x)){var D={},M;for(M in x)D[M]=va(x[M],_);x=D}else x=_(x);return x}}function wa(x,_){for(var D=x.slice(),M=0;M<D.length;M++)D[M]=va(D[M],_);return Array.isArray(x)&&Zi(x)&1&&eo(D),D}function cw(x){return x&&typeof x=="object"&&x.toJSON?x.toJSON():(x=as(x),Array.isArray(x)?pd(x):x)}function hw(x){return ze(x)?new Uint8Array(x):x}function yi(x,_,D){x||(x=Wm),Wm=null;var M=this.constructor.h;x||(x=M?[M]:[]),this.h=(M?0:-1)-(this.constructor.g||0),this.j=void 0,this.m=x;e:{if(M=this.m.length,x=M-1,M&&(M=this.m[x],Um(M))){this.i=x-this.h,this.g=M;break e}_!==void 0&&-1<_?(this.i=Math.max(_,x+1-this.h),this.g=void 0):this.i=Number.MAX_VALUE}if(D)for(_=0;_<D.length;_++)if(x=D[_],x<this.i)x+=this.h,(M=this.m[x])?Array.isArray(M)&&eo(M):this.m[x]=ma;else{M=this.g||(this.g=this.m[this.i+this.h]={});var B=M[x];B?Array.isArray(B)&&eo(B):M[x]=ma}}yi.prototype.toJSON=function(){return pd(this.m)},yi.prototype.toString=function(){return this.m.toString()};var Wm;function dc(){yi.apply(this,arguments)}if(m(dc,yi),cd){var Fl={};Object.defineProperties(dc,(Fl[Symbol.hasInstance]=ga(function(){throw Error("Cannot perform instanceof checks for MutableMessage")}),Fl))}function fd(x,_,D){if(D){var M={},B;for(B in D){var X=D[B],G=X.ha;G||(M.F=X.la||X.fa.P,X.aa?(M.U=md(X.aa),G=function(se){return function(ce,ve,Re){return se.F(ce,ve,Re,se.U)}}(M)):X.ca?(M.T=gd(X.X.g,X.ca),G=function(se){return function(ce,ve,Re){return se.F(ce,ve,Re,se.T)}}(M)):G=M.F,X.ha=G),G(_,x,X.X),M={F:M.F,U:M.U,T:M.T}}}fa(_,x)}var xa=Symbol();function Ll(x,_,D){return x[xa]||(x[xa]=function(M,B){return _(M,B,D)})}function vi(x){var _=x[xa];if(!_){var D=gc(x);_=function(M,B){return yc(M,B,D)},x[xa]=_}return _}function jm(x){var _=x.aa;if(_)return vi(_);if(_=x.ka)return Ll(x.X.g,_,x.ca)}function Gm(x){var _=jm(x),D=x.X,M=x.fa.O;return _?function(B,X){return M(B,X,D,_)}:function(B,X){return M(B,X,D)}}function pc(x,_,D,M,B,X){x=x();var G=0;for(x.length&&typeof x[0]!="number"&&(D(_,x[0]),G++);G<x.length;){D=x[G++];for(var se=G+1;se<x.length&&typeof x[se]!="number";)se++;var ce=x[G++];switch(se-=G,se){case 0:M(_,D,ce);break;case 1:M(_,D,ce,x[G++]);break;case 2:B(_,D,ce,x[G++],x[G++]);break;case 3:se=x[G++];var ve=x[G++],Re=x[G++];Array.isArray(Re)?B(_,D,ce,se,ve,Re):X(_,D,ce,se,ve,Re);break;case 4:X(_,D,ce,x[G++],x[G++],x[G++],x[G++]);break;default:throw Error("unexpected number of binary field arguments: "+se)}}return _}var ba=Symbol();function md(x){var _=x[ba];if(!_){var D=no(x);_=function(M,B){return vd(M,B,D)},x[ba]=_}return _}function gd(x,_){var D=x[ba];return D||(D=function(M,B){return fd(M,B,_)},x[ba]=D),D}var Hm=Symbol();function fc(x,_){x.push(_)}function qm(x,_,D){x.push(_,D.P)}function yd(x,_,D,M,B){var X=md(B),G=D.P;x.push(_,function(se,ce,ve){return G(se,ce,ve,M,X)})}function Ml(x,_,D,M,B,X){var G=gd(M,X),se=D.P;x.push(_,function(ce,ve,Re){return se(ce,ve,Re,M,G)})}function no(x){var _=x[Hm];return _||pc(x,x[Hm]=[],fc,qm,yd,Ml)}var mc=Symbol();function dw(x,_){x[0]=_}function Km(x,_,D,M){var B=D.O;x[_]=M?function(X,G,se){return B(X,G,se,M)}:B}function Xm(x,_,D,M,B,X){var G=D.O,se=vi(B);x[_]=function(ce,ve,Re){return G(ce,ve,Re,M,se,X)}}function Ym(x,_,D,M,B,X,G){var se=D.O,ce=Ll(M,B,X);x[_]=function(ve,Re,He){return se(ve,Re,He,M,ce,G)}}function gc(x){var _=x[mc];return _||pc(x,x[mc]={},dw,Km,Xm,Ym)}function yc(x,_,D){for(;Vs(_)&&_.h!=4;){var M=_.i,B=D[M];if(!B){var X=D[0];X&&(X=X[M])&&(B=D[M]=Gm(X))}if((!B||!B(_,x,M))&&(B=_,M=x,X=B.j,Tt(B),!B.W)){var G=B.g.h;B=B.g.g,B=X===B?Me||(Me=new Uint8Array(0)):Ke?G.slice(X,B):new Uint8Array(G.subarray(X,B)),(X=M.ba)?X.push(B):M.ba=[B]}}return x}function vc(x,_,D){if($t.length){var M=$t.pop();x&&(St(M.g,x),M.i=-1,M.h=-1),x=M}else x=new Hn(x);try{return yc(new _,x,gc(D))}finally{_=x.g,_.h=null,_.j=0,_.i=0,_.g=0,_.v=!1,x.i=-1,x.h=-1,100>$t.length&&$t.push(x)}}function vd(x,_,D){for(var M=D.length,B=M%2==1,X=B?1:0;X<M;X+=2)(0,D[X+1])(_,x,D[X]);fd(x,_,B?D[0]:void 0)}function wd(x,_){var D=new zs;vd(x,D,no(_)),Bs(D,D.g.end()),x=new Uint8Array(D.h),_=D.i;for(var M=_.length,B=0,X=0;X<M;X++){var G=_[X];x.set(G,B),B+=G.length}return D.i=[x],x}function Vl(x,_){return{O:x,P:_}}var nr=Vl(function(x,_,D){if(x.h!==5)return!1;x=x.g;var M=x.h[x.g],B=x.h[x.g+1],X=x.h[x.g+2],G=x.h[x.g+3];return x.g+=4,Ot(x),B=(M<<0|B<<8|X<<16|G<<24)>>>0,x=2*(B>>31)+1,M=B>>>23&255,B&=8388607,an(_,D,M==255?B?NaN:1/0*x:M==0?x*Math.pow(2,-149)*B:x*Math.pow(2,M-150)*(B+Math.pow(2,23))),!0},function(x,_,D){if(_=Us(_,D),_!=null){Mn(x.g,8*D+5),x=x.g;var M=_;M=(D=0>M?1:0)?-M:M,M===0?0<1/M?Je=nt=0:(nt=0,Je=2147483648):isNaN(M)?(nt=0,Je=2147483647):34028234663852886e22<M?(nt=0,Je=(D<<31|2139095040)>>>0):11754943508222875e-54>M?(M=Math.round(M/Math.pow(2,-149)),nt=0,Je=(D<<31|M)>>>0):(_=Math.floor(Math.log(M)/Math.LN2),M*=Math.pow(2,-_),M=Math.round(8388608*M),16777216<=M&&++_,nt=0,Je=(D<<31|_+127<<23|M&8388607)>>>0),D=Je,x.g.push(D>>>0&255),x.g.push(D>>>8&255),x.g.push(D>>>16&255),x.g.push(D>>>24&255)}}),Qm=Vl(function(x,_,D){if(x.h!==0)return!1;for(var M=x.g,B=128,X=0,G=x=0;4>G&&128<=B;G++)B=M.h[M.g++],Ot(M),X|=(B&127)<<7*G;if(128<=B&&(B=M.h[M.g++],Ot(M),X|=(B&127)<<28,x|=(B&127)>>4),128<=B)for(G=0;5>G&&128<=B;G++)B=M.h[M.g++],Ot(M),x|=(B&127)<<7*G+3;if(128>B)M=X>>>0,B=x>>>0,(x=B&2147483648)&&(M=~M+1>>>0,B=~B>>>0,M==0&&(B=B+1>>>0)),M=4294967296*B+(M>>>0);else throw ht();return an(_,D,x?-M:M),!0},function(x,_,D){if(_=Us(_,D),_!=null&&_!=null){Mn(x.g,8*D),x=x.g;var M=_;for(D=0>M,M=Math.abs(M),_=M>>>0,M=Math.floor((M-_)/4294967296),M>>>=0,D&&(M=~M>>>0,_=(~_>>>0)+1,4294967295<_&&(_=0,M++,4294967295<M&&(M=0))),Je=_,nt=M,D=Je,_=nt;0<_||127<D;)x.g.push(D&127|128),D=(D>>>7|_<<25)>>>0,_>>>=7;x.g.push(D)}}),pw=Vl(function(x,_,D){return x.h!==0?!1:(an(_,D,Pt(x.g)),!0)},function(x,_,D){if(_=Us(_,D),_!=null&&_!=null)if(Mn(x.g,8*D),x=x.g,D=_,0<=D)Mn(x,D);else{for(_=0;9>_;_++)x.g.push(D&127|128),D>>=7;x.g.push(1)}}),so=Vl(function(x,_,D){if(x.h!==2)return!1;var M=Pt(x.g)>>>0;x=x.g;var B=x.g;x.g+=M,Ot(x),x=x.h;var X;if(q)(X=le)||(X=le=new TextDecoder("utf-8",{fatal:!0})),X=X.decode(x.subarray(B,B+M));else{M=B+M;for(var G=[],se=null,ce,ve,Re;B<M;)ce=x[B++],128>ce?G.push(ce):224>ce?B>=M?Z():(ve=x[B++],194>ce||(ve&192)!==128?(B--,Z()):G.push((ce&31)<<6|ve&63)):240>ce?B>=M-1?Z():(ve=x[B++],(ve&192)!==128||ce===224&&160>ve||ce===237&&160<=ve||((X=x[B++])&192)!==128?(B--,Z()):G.push((ce&15)<<12|(ve&63)<<6|X&63)):244>=ce?B>=M-2?Z():(ve=x[B++],(ve&192)!==128||(ce<<28)+(ve-144)>>30||((X=x[B++])&192)!==128||((Re=x[B++])&192)!==128?(B--,Z()):(ce=(ce&7)<<18|(ve&63)<<12|(X&63)<<6|Re&63,ce-=65536,G.push((ce>>10&1023)+55296,(ce&1023)+56320))):Z(),8192<=G.length&&(se=ne(se,G),G.length=0);X=ne(se,G)}return an(_,D,X),!0},function(x,_,D){if(_=Us(_,D),_!=null){var M=!1;if(M=M===void 0?!1:M,ie){if(M&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(_))throw Error("Found an unpaired surrogate");_=(J||(J=new TextEncoder)).encode(_)}else{for(var B=0,X=new Uint8Array(3*_.length),G=0;G<_.length;G++){var se=_.charCodeAt(G);if(128>se)X[B++]=se;else{if(2048>se)X[B++]=se>>6|192;else{if(55296<=se&&57343>=se){if(56319>=se&&G<_.length){var ce=_.charCodeAt(++G);if(56320<=ce&&57343>=ce){se=1024*(se-55296)+ce-56320+65536,X[B++]=se>>18|240,X[B++]=se>>12&63|128,X[B++]=se>>6&63|128,X[B++]=se&63|128;continue}else G--}if(M)throw Error("Found an unpaired surrogate");se=65533}X[B++]=se>>12|224,X[B++]=se>>6&63|128}X[B++]=se&63|128}}_=X.subarray(0,B)}Mn(x.g,8*D+2),Mn(x.g,_.length),Bs(x,x.g.end()),Bs(x,_)}}),Ur=Vl(function(x,_,D,M,B){if(x.h!==2)return!1;_=hd(_,D,M),D=x.g.i,M=Pt(x.g)>>>0;var X=x.g.g+M,G=X-D;if(0>=G&&(x.g.i=X,B(_,x),G=X-x.g.g),G)throw Error("Message parsing ended unexpectedly. Expected to read "+(M+" bytes, instead read "+(M-G)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return x.g.g=X,x.g.i=D,!0},function(x,_,D,M,B){if(_=Ro(_,M,D),_!=null)for(M=0;M<_.length;M++){var X=x;Mn(X.g,8*D+2);var G=X.g.end();Bs(X,G),G.push(X.h),X=G,B(_[M],x),G=x;var se=X.pop();for(se=G.h+G.g.length()-se;127<se;)X.push(se&127|128),se>>>=7,G.h++;X.push(se),G.h++}});function ls(){dc.apply(this,arguments)}if(m(ls,dc),cd){var zl={};Object.defineProperties(ls,(zl[Symbol.hasInstance]=ga(Object[Symbol.hasInstance]),zl))}function Ia(x){ls.call(this,x)}m(Ia,ls);function Ft(){return[1,pw,2,nr,3,so,4,so]}function Sa(x){ls.call(this,x,-1,Ul)}m(Sa,ls),Sa.prototype.addClassification=function(x,_){return hd(this,1,Ia,x,_),this};function Bl(){return[1,Ur,Ia,Ft]}var Ul=[1];function wc(x){ls.call(this,x)}m(wc,ls);function xd(){return[1,nr,2,nr,3,nr,4,nr,5,nr]}function Jm(x){ls.call(this,x,-1,mw)}m(Jm,ls);function fw(){return[1,Ur,wc,xd]}var mw=[1];function bd(x){ls.call(this,x)}m(bd,ls);function Ta(){return[1,nr,2,nr,3,nr,4,nr,5,nr,6,Qm]}var wi=[[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]],Id=[[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]],Sd=[[276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]],Td=[[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]],Do=[[46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]],Zm=[[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]],gw=[].concat(l(wi),l(Id),l(Sd),l(Td),l(Do),l(Zm));function eg(x,_,D){if(D=x.createShader(D===0?x.VERTEX_SHADER:x.FRAGMENT_SHADER),x.shaderSource(D,_),x.compileShader(D),!x.getShaderParameter(D,x.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+x.getShaderInfoLog(D));return D}function ro(x){return Ro(x,Ia,1).map(function(_){return{index:ya(_,1),ga:Cr(_,2),label:Us(_,3)!=null?dd(_,3):void 0,displayName:Us(_,4)!=null?dd(_,4):void 0}})}function yw(x){return{x:Cr(x,1),y:Cr(x,2),z:Cr(x,3),visibility:Us(x,4)!=null?Cr(x,4):void 0}}function Cd(x,_){this.h=x,this.g=_,this.l=0}function Wl(x,_,D){return xc(x,_),typeof x.g.canvas.transferToImageBitmap=="function"?Promise.resolve(x.g.canvas.transferToImageBitmap()):D?Promise.resolve(x.g.canvas):typeof createImageBitmap=="function"?createImageBitmap(x.g.canvas):(x.i===void 0&&(x.i=document.createElement("canvas")),new Promise(function(M){x.i.height=x.g.canvas.height,x.i.width=x.g.canvas.width,x.i.getContext("2d",{}).drawImage(x.g.canvas,0,0,x.g.canvas.width,x.g.canvas.height),M(x.i)}))}function xc(x,_){var D=x.g;if(x.o===void 0){var M=eg(D,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),B=eg(D,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),X=D.createProgram();if(D.attachShader(X,M),D.attachShader(X,B),D.linkProgram(X),!D.getProgramParameter(X,D.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+D.getProgramInfoLog(X));M=x.o=X,D.useProgram(M),B=D.getUniformLocation(M,"sampler0"),x.j={K:D.getAttribLocation(M,"aVertex"),J:D.getAttribLocation(M,"aTex"),ma:B},x.u=D.createBuffer(),D.bindBuffer(D.ARRAY_BUFFER,x.u),D.enableVertexAttribArray(x.j.K),D.vertexAttribPointer(x.j.K,2,D.FLOAT,!1,0,0),D.bufferData(D.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),D.STATIC_DRAW),D.bindBuffer(D.ARRAY_BUFFER,null),x.s=D.createBuffer(),D.bindBuffer(D.ARRAY_BUFFER,x.s),D.enableVertexAttribArray(x.j.J),D.vertexAttribPointer(x.j.J,2,D.FLOAT,!1,0,0),D.bufferData(D.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),D.STATIC_DRAW),D.bindBuffer(D.ARRAY_BUFFER,null),D.uniform1i(B,0)}M=x.j,D.useProgram(x.o),D.canvas.width=_.width,D.canvas.height=_.height,D.viewport(0,0,_.width,_.height),D.activeTexture(D.TEXTURE0),x.h.bindTexture2d(_.glName),D.enableVertexAttribArray(M.K),D.bindBuffer(D.ARRAY_BUFFER,x.u),D.vertexAttribPointer(M.K,2,D.FLOAT,!1,0,0),D.enableVertexAttribArray(M.J),D.bindBuffer(D.ARRAY_BUFFER,x.s),D.vertexAttribPointer(M.J,2,D.FLOAT,!1,0,0),D.bindFramebuffer(D.DRAW_FRAMEBUFFER?D.DRAW_FRAMEBUFFER:D.FRAMEBUFFER,null),D.clearColor(0,0,0,0),D.clear(D.COLOR_BUFFER_BIT),D.colorMask(!0,!0,!0,!0),D.drawArrays(D.TRIANGLE_FAN,0,4),D.disableVertexAttribArray(M.K),D.disableVertexAttribArray(M.J),D.bindBuffer(D.ARRAY_BUFFER,null),x.h.bindTexture2d(0)}function tg(x){this.g=x}var jl=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Gl(x,_){return _+x}function kd(x,_){window[x]=_}function Ed(x){var _=document.createElement("script");return _.setAttribute("src",x),_.setAttribute("crossorigin","anonymous"),new Promise(function(D){_.addEventListener("load",function(){D()},!1),_.addEventListener("error",function(){D()},!1),document.body.appendChild(_)})}function en(){return $(function(x){switch(x.g){case 1:return x.o=2,b(x,WebAssembly.instantiate(jl),4);case 4:x.g=3,x.o=0;break;case 2:return x.o=0,x.j=null,x.return(!1);case 3:return x.return(!0)}})}function _d(x){if(this.g=x,this.listeners={},this.j={},this.H={},this.o={},this.u={},this.I=this.s=this.Z=!0,this.D=Promise.resolve(),this.Y="",this.C={},this.locateFile=x&&x.locateFile||Gl,typeof window=="object")var _=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")_=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.$=_,x.options){_=a(Object.keys(x.options));for(var D=_.next();!D.done;D=_.next()){D=D.value;var M=x.options[D].default;M!==void 0&&(this.j[D]=typeof M=="function"?M():M)}}}t=_d.prototype,t.close=function(){return this.i&&this.i.delete(),Promise.resolve()};function vw(x){var _,D,M,B,X,G,se,ce,ve,Re,He;return $(function(We){switch(We.g){case 1:return x.Z?(_=x.g.files===void 0?[]:typeof x.g.files=="function"?x.g.files(x.j):x.g.files,b(We,en(),2)):We.return();case 2:if(D=We.h,typeof window=="object")return kd("createMediapipeSolutionsWasm",{locateFile:x.locateFile}),kd("createMediapipeSolutionsPackedAssets",{locateFile:x.locateFile}),G=_.filter(function(Fe){return Fe.data!==void 0}),se=_.filter(function(Fe){return Fe.data===void 0}),ce=Promise.all(G.map(function(Fe){var Ze=Hl(x,Fe.url);if(Fe.path!==void 0){var at=Fe.path;Ze=Ze.then(function(Lt){return x.overrideFile(at,Lt),Promise.resolve(Lt)})}return Ze})),ve=Promise.all(se.map(function(Fe){return Fe.simd===void 0||Fe.simd&&D||!Fe.simd&&!D?Ed(x.locateFile(Fe.url,x.$)):Promise.resolve()})).then(function(){var Fe,Ze,at;return $(function(Lt){if(Lt.g==1)return Fe=window.createMediapipeSolutionsWasm,Ze=window.createMediapipeSolutionsPackedAssets,at=x,b(Lt,Fe(Ze),2);at.h=Lt.h,Lt.g=0})}),Re=function(){return $(function(Fe){return x.g.graph&&x.g.graph.url?Fe=b(Fe,Hl(x,x.g.graph.url),0):(Fe.g=0,Fe=void 0),Fe})}(),b(We,Promise.all([ve,ce,Re]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return M=_.filter(function(Fe){return Fe.simd===void 0||Fe.simd&&D||!Fe.simd&&!D}).map(function(Fe){return x.locateFile(Fe.url,x.$)}),importScripts.apply(null,l(M)),B=x,b(We,createMediapipeSolutionsWasm(Module),6);case 6:B.h=We.h,x.l=new OffscreenCanvas(1,1),x.h.canvas=x.l,X=x.h.GL.createContext(x.l,{antialias:!1,alpha:!1,ja:typeof WebGL2RenderingContext<"u"?2:1}),x.h.GL.makeContextCurrent(X),We.g=4;break;case 7:if(x.l=document.createElement("canvas"),He=x.l.getContext("webgl2",{}),!He&&(He=x.l.getContext("webgl",{}),!He))return alert("Failed to create WebGL canvas context when passing video frame."),We.return();x.G=He,x.h.canvas=x.l,x.h.createContext(x.l,!0,!0,{});case 4:x.i=new x.h.SolutionWasm,x.Z=!1,We.g=0}})}function ng(x){var _,D,M,B,X,G,se,ce;return $(function(ve){if(ve.g==1){if(x.g.graph&&x.g.graph.url&&x.Y===x.g.graph.url)return ve.return();if(x.s=!0,!x.g.graph||!x.g.graph.url){ve.g=2;return}return x.Y=x.g.graph.url,b(ve,Hl(x,x.g.graph.url),3)}for(ve.g!=2&&(_=ve.h,x.i.loadGraph(_)),D=a(Object.keys(x.C)),M=D.next();!M.done;M=D.next())B=M.value,x.i.overrideFile(B,x.C[B]);if(x.C={},x.g.listeners)for(X=a(x.g.listeners),G=X.next();!G.done;G=X.next())se=G.value,xi(x,se);ce=x.j,x.j={},x.setOptions(ce),ve.g=0})}t.reset=function(){var x=this;return $(function(_){x.i&&(x.i.reset(),x.o={},x.u={}),_.g=0})},t.setOptions=function(x,_){var D=this;if(_=_||this.g.options){for(var M=[],B=[],X={},G=a(Object.keys(x)),se=G.next();!se.done;X={R:X.R,S:X.S},se=G.next()){var ce=se.value;ce in this.j&&this.j[ce]===x[ce]||(this.j[ce]=x[ce],se=_[ce],se!==void 0&&(se.onChange&&(X.R=se.onChange,X.S=x[ce],M.push(function(ve){return function(){var Re;return $(function(He){if(He.g==1)return b(He,ve.R(ve.S),2);Re=He.h,Re===!0&&(D.s=!0),He.g=0})}}(X))),se.graphOptionXref&&(ce={valueNumber:se.type===1?x[ce]:0,valueBoolean:se.type===0?x[ce]:!1,valueString:se.type===2?x[ce]:""},se=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),se.graphOptionXref),ce),B.push(se))))}(M.length!==0||B.length!==0)&&(this.s=!0,this.B=(this.B===void 0?[]:this.B).concat(B),this.A=(this.A===void 0?[]:this.A).concat(M))}};function sg(x){var _,D,M,B,X,G,se;return $(function(ce){switch(ce.g){case 1:if(!x.s)return ce.return();if(!x.A){ce.g=2;break}_=a(x.A),D=_.next();case 3:if(D.done){ce.g=5;break}return M=D.value,b(ce,M(),4);case 4:D=_.next(),ce.g=3;break;case 5:x.A=void 0;case 2:if(x.B){for(B=new x.h.GraphOptionChangeRequestList,X=a(x.B),G=X.next();!G.done;G=X.next())se=G.value,B.push_back(se);x.i.changeOptions(B),B.delete(),x.B=void 0}x.s=!1,ce.g=0}})}t.initialize=function(){var x=this;return $(function(_){return _.g==1?b(_,vw(x),2):_.g!=3?b(_,ng(x),3):b(_,sg(x),0)})};function Hl(x,_){var D,M;return $(function(B){return _ in x.H?B.return(x.H[_]):(D=x.locateFile(_,""),M=fetch(D).then(function(X){return X.arrayBuffer()}),x.H[_]=M,B.return(M))})}t.overrideFile=function(x,_){this.i?this.i.overrideFile(x,_):this.C[x]=_},t.clearOverriddenFiles=function(){this.C={},this.i&&this.i.clearOverriddenFiles()},t.send=function(x,_){var D=this,M,B,X,G,se,ce,ve,Re,He;return $(function(We){switch(We.g){case 1:return D.g.inputs?(M=1e3*(_??performance.now()),b(We,D.D,2)):We.return();case 2:return b(We,D.initialize(),3);case 3:for(B=new D.h.PacketDataList,X=a(Object.keys(x)),G=X.next();!G.done;G=X.next())if(se=G.value,ce=D.g.inputs[se]){e:{var Fe=x[se];switch(ce.type){case"video":var Ze=D.o[ce.stream];if(Ze||(Ze=new Cd(D.h,D.G),D.o[ce.stream]=Ze),Ze.l===0&&(Ze.l=Ze.h.createTexture()),typeof HTMLVideoElement<"u"&&Fe instanceof HTMLVideoElement)var at=Fe.videoWidth,Lt=Fe.videoHeight;else typeof HTMLImageElement<"u"&&Fe instanceof HTMLImageElement?(at=Fe.naturalWidth,Lt=Fe.naturalHeight):(at=Fe.width,Lt=Fe.height);Lt={glName:Ze.l,width:at,height:Lt},at=Ze.g,at.canvas.width=Lt.width,at.canvas.height=Lt.height,at.activeTexture(at.TEXTURE0),Ze.h.bindTexture2d(Ze.l),at.texImage2D(at.TEXTURE_2D,0,at.RGBA,at.RGBA,at.UNSIGNED_BYTE,Fe),Ze.h.bindTexture2d(0),Ze=Lt;break e;case"detections":for(Ze=D.o[ce.stream],Ze||(Ze=new tg(D.h),D.o[ce.stream]=Ze),Ze.data||(Ze.data=new Ze.g.DetectionListData),Ze.data.reset(Fe.length),Lt=0;Lt<Fe.length;++Lt){at=Fe[Lt];var At=Ze.data,Xt=At.setBoundingBox,Ws=Lt,us=at.boundingBox,mt=new bd;if(an(mt,1,us.xCenter),an(mt,2,us.yCenter),an(mt,3,us.height),an(mt,4,us.width),an(mt,5,us.rotation),an(mt,6,us.rectId),us=wd(mt,Ta),Xt.call(At,Ws,us),at.landmarks)for(At=0;At<at.landmarks.length;++At){mt=at.landmarks[At];var fn=!!mt.visibility;Xt=Ze.data,Ws=Xt.addNormalizedLandmark,us=Lt,mt=Object.assign(Object.assign({},mt),{visibility:fn?mt.visibility:0}),fn=new wc,an(fn,1,mt.x),an(fn,2,mt.y),an(fn,3,mt.z),mt.visibility&&an(fn,4,mt.visibility),mt=wd(fn,xd),Ws.call(Xt,us,mt)}if(at.V)for(At=0;At<at.V.length;++At)Xt=Ze.data,Ws=Xt.addClassification,us=Lt,mt=at.V[At],fn=new Ia,an(fn,2,mt.ga),mt.index&&an(fn,1,mt.index),mt.label&&an(fn,3,mt.label),mt.displayName&&an(fn,4,mt.displayName),mt=wd(fn,Ft),Ws.call(Xt,us,mt)}Ze=Ze.data;break e;default:Ze={}}}switch(ve=Ze,Re=ce.stream,ce.type){case"video":B.pushTexture2d(Object.assign(Object.assign({},ve),{stream:Re,timestamp:M}));break;case"detections":He=ve,He.stream=Re,He.timestamp=M,B.pushDetectionList(He);break;default:throw Error("Unknown input config type: '"+ce.type+"'")}}return D.i.send(B),b(We,D.D,4);case 4:B.delete(),We.g=0}})};function bc(x,_,D){var M,B,X,G,se,ce,ve,Re,He,We,Fe,Ze,at,Lt;return $(function(At){switch(At.g){case 1:if(!D)return At.return(_);for(M={},B=0,X=a(Object.keys(D)),G=X.next();!G.done;G=X.next())se=G.value,ce=D[se],typeof ce!="string"&&ce.type==="texture"&&_[ce.stream]!==void 0&&++B;1<B&&(x.I=!1),ve=a(Object.keys(D)),G=ve.next();case 2:if(G.done){At.g=4;break}if(Re=G.value,He=D[Re],typeof He=="string")return at=M,Lt=Re,b(At,rg(x,Re,_[He]),14);if(We=_[He.stream],He.type==="detection_list"){if(We){for(var Xt=We.getRectList(),Ws=We.getLandmarksList(),us=We.getClassificationsList(),mt=[],fn=0;fn<Xt.size();++fn){var kr=vc(Xt.get(fn),bd,Ta);kr={boundingBox:{xCenter:Cr(kr,1),yCenter:Cr(kr,2),height:Cr(kr,3),width:Cr(kr,4),rotation:Cr(kr,5,0),rectId:ya(kr,6)},landmarks:Ro(vc(Ws.get(fn),Jm,fw),wc,1).map(yw),V:ro(vc(us.get(fn),Sa,Bl))},mt.push(kr)}Xt=mt}else Xt=[];M[Re]=Xt,At.g=7;break}if(He.type==="proto_list"){if(We){for(Xt=Array(We.size()),Ws=0;Ws<We.size();Ws++)Xt[Ws]=We.get(Ws);We.delete()}else Xt=[];M[Re]=Xt,At.g=7;break}if(We===void 0){At.g=3;break}if(He.type==="float_list"){M[Re]=We,At.g=7;break}if(He.type==="proto"){M[Re]=We,At.g=7;break}if(He.type!=="texture")throw Error("Unknown output config type: '"+He.type+"'");return Fe=x.u[Re],Fe||(Fe=new Cd(x.h,x.G),x.u[Re]=Fe),b(At,Wl(Fe,We,x.I),13);case 13:Ze=At.h,M[Re]=Ze;case 7:He.transform&&M[Re]&&(M[Re]=He.transform(M[Re])),At.g=3;break;case 14:at[Lt]=At.h;case 3:G=ve.next(),At.g=2;break;case 4:return At.return(M)}})}function rg(x,_,D){var M;return $(function(B){return typeof D=="number"||D instanceof Uint8Array||D instanceof x.h.Uint8BlobList?B.return(D):D instanceof x.h.Texture2dDataOut?(M=x.u[_],M||(M=new Cd(x.h,x.G),x.u[_]=M),B.return(Wl(M,D,x.I))):B.return(void 0)})}function xi(x,_){for(var D=_.name||"$",M=[].concat(l(_.wants)),B=new x.h.StringList,X=a(_.wants),G=X.next();!G.done;G=X.next())B.push_back(G.value);X=x.h.PacketListener.implement({onResults:function(se){for(var ce={},ve=0;ve<_.wants.length;++ve)ce[M[ve]]=se.get(ve);var Re=x.listeners[D];Re&&(x.D=bc(x,ce,_.outs).then(function(He){He=Re(He);for(var We=0;We<_.wants.length;++We){var Fe=ce[M[We]];typeof Fe=="object"&&Fe.hasOwnProperty&&Fe.hasOwnProperty("delete")&&Fe.delete()}He&&(x.D=He)}))}}),x.i.attachMultiListener(B,X),B.delete()}t.onResults=function(x,_){this.listeners[_||"$"]=x},Q("Solution",_d),Q("OptionType",{BOOL:0,NUMBER:1,ia:2,0:"BOOL",1:"NUMBER",2:"STRING"});function Nd(x){var _=this;x=x||{};var D={url:"face_detection_short.binarypb"},M={type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"facedetectionshortrangegpu__facedetectionshortrangecommon__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}};this.g=new _d({locateFile:x.locateFile,files:[{data:!0,url:"face_detection_short.binarypb"},{data:!0,url:"face_detection_short_range.tflite"},{simd:!0,url:"face_detection_solution_simd_wasm_bin.js"},{simd:!1,url:"face_detection_solution_wasm_bin.js"}],graph:D,listeners:[{wants:["detections","image_transformed"],outs:{image:"image_transformed",detections:{type:"detection_list",stream:"detections"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},model:{type:0,onChange:function(B){var X,G,se,ce,ve,Re;return $(function(He){switch(He.g){case 1:X=B==="short"?["face_detection_short_range.tflite"]:["face_detection_full_range_sparse.tflite"],G=a(X),se=G.next();case 2:if(se.done){He.g=4;break}return ce=se.value,ve="third_party/mediapipe/modules/face_detection/"+ce,b(He,Hl(_.g,ce),5);case 5:Re=He.h,_.g.overrideFile(ve,Re),se=G.next(),He.g=2;break;case 4:return D.url=B==="short"?"face_detection_short.binarypb":"face_detection_full.binarypb",M.graphOptionXref.calculatorName=B==="short"?"facedetectionshortrangegpu__facedetectionshortrangecommon__TensorsToDetectionsCalculator":"facedetectionfullrangegpu__facedetectionfullrangecommon__TensorsToDetectionsCalculator",He.return(!0)}})}},minDetectionConfidence:M}})}t=Nd.prototype,t.close=function(){return this.g.close(),Promise.resolve()},t.onResults=function(x){this.g.onResults(x)},t.initialize=function(){var x=this;return $(function(_){return b(_,x.g.initialize(),0)})},t.reset=function(){this.g.reset()},t.send=function(x){var _=this;return $(function(D){return b(D,_.g.send(x),0)})},t.setOptions=function(x){this.g.setOptions(x)},Q("FaceDetection",Nd),Q("FACEDETECTION_LIPS",wi),Q("FACEDETECTION_LEFT_EYE",Id),Q("FACEDETECTION_LEFT_EYEBROW",Sd),Q("FACEDETECTION_RIGHT_EYE",Td),Q("FACEDETECTION_RIGHT_EYEBROW",Do),Q("FACEDETECTION_FACE_OVAL",Zm),Q("FACEDETECTION_CONTOURS",gw),Q("FACEDETECTION_TESSELATION",[[127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]]),Q("VERSION","0.4.1646425229")}).call(Oi);/**
    * @license
    * Copyright 2024 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */var vl=function(){return vl=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},vl.apply(this,arguments)};function oa(t,e,n,s){return new(n||(n=Promise))(function(r,i){function o(u){try{l(s.next(u))}catch(c){i(c)}}function a(u){try{l(s.throw(u))}catch(c){i(c)}}function l(u){var c;u.done?r(u.value):(c=u.value,c instanceof n?c:new n(function(h){h(c)})).then(o,a)}l((s=s.apply(t,[])).next())})}function aa(t,e){var n,s,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(l){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,s&&(r=2&c[0]?s.return:c[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,c[1])).done)return r;switch(s=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,s=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(r=o.trys,!((r=r.length>0&&r[r.length-1])||c[0]!==6&&c[0]!==2)){o=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(c[0]===6&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(h){c=[6,h],s=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([l,u])}}}var gz=["rightEye","leftEye","noseTip","mouthCenter","rightEarTragion","leftEarTragion"],Cx={modelType:"short",runtime:"mediapipe",maxFaces:1},mSe=function(){function t(e){var n=this;this.width=0,this.height=0,this.selfieMode=!1,this.faceDetectorSolution=new fSe.FaceDetection({locateFile:function(s,r){if(e.solutionPath){var i=e.solutionPath.replace(/\/+$/,"");return"".concat(i,"/").concat(s)}return"".concat(r,"/").concat(s)}}),this.faceDetectorSolution.setOptions({selfieMode:this.selfieMode,model:e.modelType}),this.faceDetectorSolution.onResults(function(s){if(n.height=s.image.height,n.width=s.image.width,n.faces=[],s.detections!==null)for(var r=0,i=s.detections;r<i.length;r++){var o=i[r];n.faces.push(n.normalizedToAbsolute(o.landmarks,(a=o.boundingBox,l=void 0,u=void 0,c=void 0,l=a.xCenter-a.width/2,u=l+a.width,c=a.yCenter-a.height/2,{xMin:l,xMax:u,yMin:c,yMax:c+a.height,width:a.width,height:a.height})))}var a,l,u,c})}return t.prototype.normalizedToAbsolute=function(e,n){var s=this;return{keypoints:e.map(function(r,i){return{x:r.x*s.width,y:r.y*s.height,name:gz[i]}}),box:{xMin:n.xMin*this.width,yMin:n.yMin*this.height,xMax:n.xMax*this.width,yMax:n.yMax*this.height,width:n.width*this.width,height:n.height*this.height}}},t.prototype.estimateFaces=function(e,n){return oa(this,void 0,void 0,function(){var s,r;return aa(this,function(i){switch(i.label){case 0:return n&&n.flipHorizontal&&n.flipHorizontal!==this.selfieMode&&(this.selfieMode=n.flipHorizontal,this.faceDetectorSolution.setOptions({selfieMode:this.selfieMode})),e instanceof Mt?(r=ImageData.bind,[4,cne(e)]):[3,2];case 1:return s=new(r.apply(ImageData,[void 0,i.sent(),e.shape[1],e.shape[0]])),[3,3];case 2:s=e,i.label=3;case 3:return e=s,[4,this.faceDetectorSolution.send({image:e})];case 4:return i.sent(),[2,this.faces]}})})},t.prototype.dispose=function(){this.faceDetectorSolution.close()},t.prototype.reset=function(){this.faceDetectorSolution.reset(),this.width=0,this.height=0,this.faces=null,this.selfieMode=!1},t.prototype.initialize=function(){return this.faceDetectorSolution.initialize()},t}();function gSe(t){return oa(this,void 0,void 0,function(){var e,n;return aa(this,function(s){switch(s.label){case 0:return e=function(r){if(r==null)return vl({},Cx);var i=vl({},r);return i.runtime="mediapipe",i.modelType==null&&(i.modelType=Cx.modelType),i.maxFaces==null&&(i.maxFaces=Cx.maxFaces),i}(t),[4,(n=new mSe(e)).initialize()];case 1:return s.sent(),[2,n]}})})}function ySe(t,e,n,s){var r=t.width,i=t.height,o=1,a=Math.cos(t.rotation),l=Math.sin(t.rotation),u=t.xCenter,c=t.yCenter,h=1/e,d=1/n,p=new Array(16);return p[0]=r*a*o*h,p[1]=-i*l*h,p[2]=0,p[3]=(-.5*r*a*o+.5*i*l+u)*h,p[4]=r*l*o*d,p[5]=i*a*d,p[6]=0,p[7]=(-.5*i*a-.5*r*l*o+c)*d,p[8]=0,p[9]=0,p[10]=r*h,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,function(f){if(f.length!==16)throw new Error("Array length must be 16 but got ".concat(f.length));return[[f[0],f[1],f[2],f[3]],[f[4],f[5],f[6],f[7]],[f[8],f[9],f[10],f[11]],[f[12],f[13],f[14],f[15]]]}(p)}function yz(t){return t instanceof Mt?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}}function vz(t){return t instanceof Mt?t:hne(t)}function kx(t,e){F(t.width!==0,function(){return"".concat(e," width cannot be 0.")}),F(t.height!==0,function(){return"".concat(e," height cannot be 0.")})}function vSe(t,e){var n=function(s,r,i,o){var a=r-s,l=o-i,u=l/a;return{scale:u,offset:i-s*u}}(0,255,e[0],e[1]);return Y(function(){return fe(W(t,n.scale),n.offset)})}function wSe(t,e,n){var s=e.outputTensorSize,r=e.keepAspectRatio,i=e.borderMode,o=e.outputTensorFloatRange,a=yz(t),l=function(d,p){return{xCenter:.5*d.width,yCenter:.5*d.height,width:d.width,height:d.height,rotation:0}}(a),u=function(d,p,f){if(f===void 0&&(f=!1),!f)return{top:0,left:0,right:0,bottom:0};var m=p.height,v=p.width;kx(p,"targetSize"),kx(d,"roi");var y,w,b=m/v,I=d.height/d.width,k=0,R=0;return b>I?(y=d.width,w=d.width*b,R=(1-I/b)/2):(y=d.height/b,w=d.height,k=(1-b/I)/2),d.width=y,d.height=w,{top:R,left:k,right:k,bottom:R}}(l,s,r),c=ySe(l,a.width,a.height),h=Y(function(){var d=vz(t),p=gu(function(v,y,w){return kx(w,"inputResolution"),[1/w.width*v[0][0]*y.width,1/w.height*v[0][1]*y.width,v[0][3]*y.width,1/w.width*v[1][0]*y.height,1/w.height*v[1][1]*y.height,v[1][3]*y.height,0,0]}(c,a,s),[1,8]),f=i==="zero"?"constant":"nearest",m=Ar.transform(Xn(Se(d,"float32")),p,"bilinear",f,0,[s.height,s.width]);return o!=null?vSe(m,o):m});return{imageTensor:h,padding:u,transformationMatrix:c}}function pA(t){t.reduceBoxesInLowestLayer==null&&(t.reduceBoxesInLowestLayer=!1),t.interpolatedScaleAspectRatio==null&&(t.interpolatedScaleAspectRatio=1),t.fixedAnchorSize==null&&(t.fixedAnchorSize=!1);for(var e=[],n=0;n<t.numLayers;){for(var s=[],r=[],i=[],o=[],a=n;a<t.strides.length&&t.strides[a]===t.strides[n];){var l=fA(t.minScale,t.maxScale,a,t.strides.length);if(a===0&&t.reduceBoxesInLowestLayer)i.push(1),i.push(2),i.push(.5),o.push(.1),o.push(l),o.push(l);else{for(var u=0;u<t.aspectRatios.length;++u)i.push(t.aspectRatios[u]),o.push(l);if(t.interpolatedScaleAspectRatio>0){var c=a===t.strides.length-1?1:fA(t.minScale,t.maxScale,a+1,t.strides.length);o.push(Math.sqrt(l*c)),i.push(t.interpolatedScaleAspectRatio)}}a++}for(var h=0;h<i.length;++h){var d=Math.sqrt(i[h]);s.push(o[h]/d),r.push(o[h]*d)}var p=0,f=0;if(t.featureMapHeight.length>0)p=t.featureMapHeight[n],f=t.featureMapWidth[n];else{var m=t.strides[n];p=Math.ceil(t.inputSizeHeight/m),f=Math.ceil(t.inputSizeWidth/m)}for(var v=0;v<p;++v)for(var y=0;y<f;++y)for(var w=0;w<s.length;++w){var b={xCenter:(y+t.anchorOffsetX)/f,yCenter:(v+t.anchorOffsetY)/p,width:0,height:0};t.fixedAnchorSize?(b.width=1,b.height=1):(b.width=r[w],b.height=s[w]),e.push(b)}n=a}return e}function fA(t,e,n,s){return s===1?.5*(t+e):t+(e-t)*n/(s-1)}function mA(t,e){var n=e[0],s=e[1];return[n*t[0]+s*t[1]+t[3],n*t[4]+s*t[5]+t[7]]}function xSe(t){return Y(function(){var e=function(r){return Y(function(){return[je(r,[0,0,0],[1,-1,1]),je(r,[0,0,1],[1,-1,-1])]})}(t),n=e[0],s=e[1];return{boxes:mn(s),logits:mn(n)}})}function bSe(t,e,n,s){return oa(this,void 0,void 0,function(){var r,i,o,a,l;return aa(this,function(u){switch(u.label){case 0:return t.sort(function(c,h){return Math.max.apply(Math,h.score)-Math.max.apply(Math,c.score)}),r=gu(t.map(function(c){return[c.locationData.relativeBoundingBox.yMin,c.locationData.relativeBoundingBox.xMin,c.locationData.relativeBoundingBox.yMax,c.locationData.relativeBoundingBox.xMax]})),i=Tn(t.map(function(c){return c.score[0]})),[4,Ar.nonMaxSuppressionAsync(r,i,e,n)];case 1:return[4,(o=u.sent()).array()];case 2:return a=u.sent(),l=t.filter(function(c,h){return a.indexOf(h)>-1}),Ye([r,i,o]),[2,l]}})})}function ISe(t,e,n){return oa(this,void 0,void 0,function(){var s,r,i,o,a;return aa(this,function(l){switch(l.label){case 0:return s=t[0],r=t[1],i=function(u,c,h){return Y(function(){var d,p,f,m;h.reverseOutputOrder?(p=mn(je(u,[0,h.boxCoordOffset+0],[-1,1])),d=mn(je(u,[0,h.boxCoordOffset+1],[-1,1])),m=mn(je(u,[0,h.boxCoordOffset+2],[-1,1])),f=mn(je(u,[0,h.boxCoordOffset+3],[-1,1]))):(d=mn(je(u,[0,h.boxCoordOffset+0],[-1,1])),p=mn(je(u,[0,h.boxCoordOffset+1],[-1,1])),f=mn(je(u,[0,h.boxCoordOffset+2],[-1,1])),m=mn(je(u,[0,h.boxCoordOffset+3],[-1,1]))),p=fe(W(_e(p,h.xScale),c.w),c.x),d=fe(W(_e(d,h.yScale),c.h),c.y),h.applyExponentialOnBoxSize?(f=W(Ps(_e(f,h.hScale)),c.h),m=W(Ps(_e(m,h.wScale)),c.w)):(f=W(_e(f,h.hScale),c.h),m=W(_e(m,h.wScale),c.h));var v=Ne(d,_e(f,2)),y=Ne(p,_e(m,2)),w=fe(d,_e(f,2)),b=fe(p,_e(m,2)),I=hn([H(v,[h.numBoxes,1]),H(y,[h.numBoxes,1]),H(w,[h.numBoxes,1]),H(b,[h.numBoxes,1])],1);if(h.numKeypoints)for(var k=0;k<h.numKeypoints;++k){var R=h.keypointCoordOffset+k*h.numValuesPerKeypoint,C=void 0,T=void 0;h.reverseOutputOrder?(C=mn(je(u,[0,R],[-1,1])),T=mn(je(u,[0,R+1],[-1,1]))):(T=mn(je(u,[0,R],[-1,1])),C=mn(je(u,[0,R+1],[-1,1])));var N=fe(W(_e(C,h.xScale),c.w),c.x),$=fe(W(_e(T,h.yScale),c.h),c.y);I=hn([I,H(N,[h.numBoxes,1]),H($,[h.numBoxes,1])],1)}return I})}(r,e,n),o=Y(function(){var u=s;return n.sigmoidScore?(n.scoreClippingThresh!=null&&(u=Qs(s,-n.scoreClippingThresh,n.scoreClippingThresh)),u=Mi(u)):u}),[4,SSe(i,o,n)];case 1:return a=l.sent(),Ye([i,o]),[2,a]}})})}function SSe(t,e,n){return oa(this,void 0,void 0,function(){var s,r,i,o,a,l,u,c,h,d,p,f;return aa(this,function(m){switch(m.label){case 0:return s=[],[4,t.data()];case 1:return r=m.sent(),[4,e.data()];case 2:for(i=m.sent(),o=0;o<n.numBoxes;++o)if(!(n.minScoreThresh!=null&&i[o]<n.minScoreThresh||(a=o*n.numCoords,l=TSe(r[a+0],r[a+1],r[a+2],r[a+3],i[o],n.flipVertically,o),(u=l.locationData.relativeBoundingBox).width<0||u.height<0))){if(n.numKeypoints>0)for((c=l.locationData).relativeKeypoints=[],h=n.numKeypoints*n.numValuesPerKeypoint,d=0;d<h;d+=n.numValuesPerKeypoint)p=a+n.keypointCoordOffset+d,f={x:r[p+0],y:n.flipVertically?1-r[p+1]:r[p+1]},c.relativeKeypoints.push(f);s.push(l)}return[2,s]}})})}function TSe(t,e,n,s,r,i,o){return{score:[r],ind:o,locationData:{relativeBoundingBox:{xMin:e,yMin:i?1-n:t,xMax:s,yMax:i?1-t:n,width:s-e,height:n-t}}}}var CSe={reduceBoxesInLowestLayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:4,minScale:.1484375,maxScale:.75,inputSizeHeight:128,inputSizeWidth:128,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,16,16],aspectRatios:[1],fixedAnchorSize:!0},kSe={reduceBoxesInLowestLayer:!1,interpolatedScaleAspectRatio:0,featureMapHeight:[],featureMapWidth:[],numLayers:1,minScale:.1484375,maxScale:.75,inputSizeHeight:192,inputSizeWidth:192,anchorOffsetX:.5,anchorOffsetY:.5,strides:[4],aspectRatios:[1],fixedAnchorSize:!0},Ex={runtime:"tfjs",modelType:"short",maxFaces:1,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/face_detection/short/1"},ESe={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:896,numCoords:16,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:6,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:128,yScale:128,hScale:128,wScale:128,minScoreThresh:.5},_Se={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2304,numCoords:16,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:6,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:192,yScale:192,hScale:192,wScale:192,minScoreThresh:.6},NSe=.3,$Se={outputTensorSize:{width:128,height:128},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},ASe={outputTensorSize:{width:192,height:192},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},L1,RSe=function(){function t(e,n,s){this.detectorModel=n,this.maxFaces=s,e==="full"?(this.imageToTensorConfig=ASe,this.tensorsToDetectionConfig=_Se,this.anchors=pA(kSe)):(this.imageToTensorConfig=$Se,this.tensorsToDetectionConfig=ESe,this.anchors=pA(CSe));var r=Tn(this.anchors.map(function(l){return l.width})),i=Tn(this.anchors.map(function(l){return l.height})),o=Tn(this.anchors.map(function(l){return l.xCenter})),a=Tn(this.anchors.map(function(l){return l.yCenter}));this.anchorTensor={x:o,y:a,w:r,h:i}}return t.prototype.dispose=function(){this.detectorModel.dispose(),Ye([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h])},t.prototype.reset=function(){},t.prototype.detectFaces=function(e,n){return n===void 0&&(n=!1),oa(this,void 0,void 0,function(){var s,r,i,o,a,l,u,c,h,d,p;return aa(this,function(f){switch(f.label){case 0:return e==null?(this.reset(),[2,[]]):(s=Y(function(){var m=Se(vz(e),"float32");return n&&(m=mn(Ar.flipLeftRight(Xn(m,0)),[0])),m}),r=wSe(s,this.imageToTensorConfig),i=r.imageTensor,o=r.transformationMatrix,a=this.detectorModel.execute(i,"Identity:0"),l=xSe(a),u=l.boxes,[4,ISe([c=l.logits,u],this.anchorTensor,this.tensorsToDetectionConfig)]);case 1:return(h=f.sent()).length===0?(Ye([s,i,a,c,u]),[2,h]):[4,bSe(h,this.maxFaces,NSe)];case 2:return d=f.sent(),p=function(m,v){m===void 0&&(m=[]);var y,w=(y=v,[].concat.apply([],y));return m.forEach(function(b){var I=b.locationData;I.relativeKeypoints.forEach(function($){var P=mA(w,[$.x,$.y]),V=P[0],O=P[1];$.x=V,$.y=O});var k=I.relativeBoundingBox,R=Number.MAX_VALUE,C=Number.MAX_VALUE,T=Number.MIN_VALUE,N=Number.MIN_VALUE;[[k.xMin,k.yMin],[k.xMin+k.width,k.yMin],[k.xMin+k.width,k.yMin+k.height],[k.xMin,k.yMin+k.height]].forEach(function($){var P=mA(w,$),V=P[0],O=P[1];R=Math.min(R,V),T=Math.max(T,V),C=Math.min(C,O),N=Math.max(N,O)}),I.relativeBoundingBox={xMin:R,xMax:T,yMin:C,yMax:N,width:T-R,height:N-C}}),m}(d,o),Ye([s,i,a,c,u]),[2,p]}})})},t.prototype.estimateFaces=function(e,n){return oa(this,void 0,void 0,function(){var s,r;return aa(this,function(i){return s=yz(e),r=!!n&&n.flipHorizontal,[2,this.detectFaces(e,r).then(function(o){return o.map(function(a){for(var l=a.locationData.relativeKeypoints.map(function(f,m){return vl(vl({},f),{x:f.x*s.width,y:f.y*s.height,name:gz[m]})}),u=a.locationData.relativeBoundingBox,c=0,h=["width","xMax","xMin"];c<h.length;c++)u[h[c]]*=s.width;for(var d=0,p=["height","yMax","yMin"];d<p.length;d++)u[p[d]]*=s.height;return{keypoints:l,box:u}})})]})})},t}();function DSe(t){return oa(this,void 0,void 0,function(){var e,n,s;return aa(this,function(r){switch(r.label){case 0:return e=function(i){if(i==null)return vl({},Ex);var o=vl({},i);return o.modelType==null&&(o.modelType=Ex.modelType),o.maxFaces==null&&(o.maxFaces=Ex.maxFaces),o.detectorModelUrl==null&&(o.modelType==="full"?o.detectorModelUrl="https://tfhub.dev/mediapipe/tfjs-model/face_detection/full/1":o.detectorModelUrl="https://tfhub.dev/mediapipe/tfjs-model/face_detection/short/1"),o}(t),n=typeof e.detectorModelUrl=="string"&&e.detectorModelUrl.indexOf("https://tfhub.dev")>-1,[4,Kae(e.detectorModelUrl,{fromTFHub:n})];case 1:return s=r.sent(),[2,new RSe(e.modelType,s,e.maxFaces)]}})})}function OSe(t,e){return oa(this,void 0,void 0,function(){var n,s;return aa(this,function(r){if(t===L1.MediaPipeFaceDetector){if(s=void 0,(n=e)!=null){if(n.runtime==="tfjs")return[2,DSe(n)];if(n.runtime==="mediapipe")return[2,gSe(n)];s=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' "+"or 'mediapipe', but got ".concat(s))}throw new Error("".concat(t," is not a supported model name."))})})}(function(t){t.MediaPipeFaceDetector="MediaPipeFaceDetector"})(L1||(L1={}));function PSe(){const t=kt.useRef(null),[e,n]=kt.useState(!1),[s,r]=kt.useState(null),[i,o]=kt.useState(null),[a,l]=kt.useState(null),[u,c]=kt.useState(!1);kt.useEffect(()=>((async()=>{try{await FK(),await PK("webgl");const p=await OSe(L1.MediaPipeFaceDetector,{runtime:"tfjs",modelType:"short"});l(p)}catch(p){console.error("Error loading face detection model:",p),o("Failed to load face detection model. Please refresh the page.")}})(),()=>{a&&Ye()}),[]);const h=kt.useCallback(async()=>{if(!(!t.current||!a)){n(!0),o(null);try{const d=t.current.getScreenshot();if(!d)throw new Error("Failed to capture image from webcam");const p=new Image;if(p.src=d,await p.decode(),(await a.detectFaces(p)).length>0){const m=["happy","sad","neutral","excited","tired"],v=m[Math.floor(Math.random()*m.length)];r(v),c(!0)}else o("No face detected. Please ensure your face is visible in the camera.")}catch(d){console.error("Error analyzing mood:",d),o("Failed to analyze mood. Please try again.")}finally{n(!1)}}},[a]);return i?oe.jsx("div",{className:"max-w-2xl mx-auto p-6",children:oe.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[oe.jsx("p",{className:"text-red-700",children:i}),oe.jsx("button",{onClick:()=>{o(null),window.location.reload()},className:"mt-2 text-sm text-red-600 hover:text-red-500",children:"Try again"})]})}):u&&s?oe.jsx(FSe,{mood:s,onReset:()=>{c(!1),r(null)}}):oe.jsx("div",{className:"max-w-2xl mx-auto p-6",children:oe.jsxs("div",{className:"relative",children:[oe.jsx(Uq,{ref:t,screenshotFormat:"image/jpeg",className:"w-full rounded-lg shadow-lg",mirrored:!0,videoConstraints:{width:640,height:480,facingMode:"user"}}),oe.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 space-x-4",children:oe.jsx("button",{onClick:h,disabled:e||!a,className:"bg-purple-600 text-white px-6 py-3 rounded-full shadow-lg hover:bg-purple-700 transition-colors flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:e?oe.jsxs(oe.Fragment,{children:[oe.jsx(TN,{className:"h-5 w-5 animate-spin"}),oe.jsx("span",{children:"Analyzing..."})]}):a?oe.jsxs(oe.Fragment,{children:[oe.jsx(Rq,{className:"h-5 w-5"}),oe.jsx("span",{children:"Capture Mood"})]}):oe.jsxs(oe.Fragment,{children:[oe.jsx(TN,{className:"h-5 w-5 animate-spin"}),oe.jsx("span",{children:"Loading model..."})]})})})]})})}function FSe({mood:t,onReset:e}){const[n,s]=kt.useState("music");return oe.jsx("div",{className:"max-w-4xl mx-auto p-6",children:oe.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[oe.jsxs("div",{className:"text-center mb-8",children:[oe.jsxs("h2",{className:"text-3xl font-bold text-gray-800",children:["Your Mood: ",oe.jsx("span",{className:"text-purple-600 capitalize",children:t})]}),oe.jsx("p",{className:"text-gray-600 mt-2",children:"Here are some personalized recommendations for you"})]}),oe.jsxs("div",{className:"flex justify-center space-x-4 mb-8",children:[oe.jsx(_x,{active:n==="music",onClick:()=>s("music"),icon:oe.jsx(Lq,{className:"h-5 w-5"}),label:"Music"}),oe.jsx(_x,{active:n==="movies",onClick:()=>s("movies"),icon:oe.jsx(Dq,{className:"h-5 w-5"}),label:"Movies"}),oe.jsx(_x,{active:n==="activities",onClick:()=>s("activities"),icon:oe.jsx(Aq,{className:"h-5 w-5"}),label:"Activities"})]}),oe.jsxs("div",{className:"mt-8",children:[n==="music"&&oe.jsx(LSe,{mood:t}),n==="movies"&&oe.jsx(MSe,{mood:t}),n==="activities"&&oe.jsx(VSe,{mood:t})]}),oe.jsx("div",{className:"mt-8 text-center",children:oe.jsx("button",{onClick:e,className:"text-purple-600 hover:text-purple-700 font-medium",children:"← Try Another Capture"})})]})})}function _x({active:t,onClick:e,icon:n,label:s}){return oe.jsxs("button",{onClick:e,className:`flex items-center space-x-2 px-6 py-3 rounded-lg transition-colors ${t?"bg-purple-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[n,oe.jsx("span",{children:s})]})}function LSe({mood:t}){const n={happy:[{title:"Bollywood Party Hits",description:"Upbeat Bollywood songs to keep you dancing",link:"https://open.spotify.com/playlist/37i9dQZF1DX0XUfTFmNBRM",platform:"Spotify"},{title:"Punjabi Beats",description:"High-energy Punjabi music",link:"https://www.youtube.com/playlist?list=PLvlw_ICcAI4c7xX_Y_8RtGYr1wHgY6ZO3",platform:"YouTube"}],sad:[{title:"Soulful Hindi Melodies",description:"Emotional and touching Bollywood songs",link:"https://open.spotify.com/playlist/37i9dQZF1DX6cg4h2PoN9y",platform:"Spotify"},{title:"Classical Indian Music",description:"Calming ragas and classical pieces",link:"https://www.youtube.com/playlist?list=PLvlw_ICcAI4d_f-E-YuRRvY1KpJ1EW1w1",platform:"YouTube"}],neutral:[{title:"Indie India",description:"Contemporary Indian indie artists",link:"https://open.spotify.com/playlist/37i9dQZF1DX5q67ZpWyRrZ",platform:"Spotify"},{title:"Sufi & Folk",description:"Soulful Sufi and folk music",link:"https://www.youtube.com/playlist?list=PLvlw_ICcAI4f_oQPv7Y-lUJBXWXz4qgBd",platform:"YouTube"}],excited:[{title:"Desi EDM Mix",description:"Indian fusion with electronic beats",link:"https://open.spotify.com/playlist/37i9dQZF1DX7ZUug1ANKRP",platform:"Spotify"},{title:"Bollywood Workout",description:"High-energy Bollywood hits for exercise",link:"https://www.youtube.com/playlist?list=PLvlw_ICcAI4e_sG8Y-4s-tXH-xXz4qgBl",platform:"YouTube"}],tired:[{title:"Peaceful Sanskrit Chants",description:"Calming mantras and spiritual music",link:"https://open.spotify.com/playlist/37i9dQZF1DWZd79rJ6a7lp",platform:"Spotify"},{title:"Indian Instrumental",description:"Soothing instrumental versions of Indian classics",link:"https://www.youtube.com/playlist?list=PLvlw_ICcAI4c_f-E-YuRRvY1KpJ1EW1w1",platform:"YouTube"}]}[t]||[];return oe.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:n.map((s,r)=>oe.jsxs("a",{href:s.link,target:"_blank",rel:"noopener noreferrer",className:"block p-6 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[oe.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:s.title}),oe.jsx("p",{className:"text-gray-600 mb-4",children:s.description}),oe.jsxs("div",{className:"flex items-center text-purple-600",children:[oe.jsxs("span",{className:"font-medium",children:["Listen on ",s.platform]}),oe.jsx(IS,{className:"h-4 w-4 ml-2"})]})]},r))})}function MSe({mood:t}){const n={happy:[{title:"3 Idiots",genre:"Comedy, Drama",description:"A heartwarming tale of friendship and following your dreams",link:"https://www.netflix.com/title/70121522"},{title:"Zindagi Na Milegi Dobara",genre:"Adventure, Comedy, Drama",description:"A joyful celebration of life and friendship",link:"https://www.amazon.com/Zindagi-Na-Milegi-Dobara-Akhtar/dp/B07CQKX1YH"}],sad:[{title:"Taare Zameen Par",genre:"Drama, Family",description:"An emotional journey of a child and his teacher",link:"https://www.netflix.com/title/70087087"},{title:"Kal Ho Naa Ho",genre:"Romance, Drama",description:"A touching story about living life to the fullest",link:"https://www.amazon.com/Kal-Ho-Naa-Shah-Khan/dp/B07C24MXPQ"}],neutral:[{title:"Lunchbox",genre:"Drama, Romance",description:"A heartwarming story of unexpected connection",link:"https://www.amazon.com/Lunchbox-Irrfan-Khan/dp/B00JFKX5YW"},{title:"Piku",genre:"Comedy, Drama",description:"A slice-of-life story about family relationships",link:"https://www.netflix.com/title/80037004"}],excited:[{title:"Dhoom 3",genre:"Action, Thriller",description:"High-octane action and thrilling sequences",link:"https://www.amazon.com/Dhoom-3-Aamir-Khan/dp/B00JZKX3CW"},{title:"RRR",genre:"Action, Drama",description:"Epic action drama with stunning visuals",link:"https://www.netflix.com/title/81476453"}],tired:[{title:"Barfi!",genre:"Comedy, Drama, Romance",description:"A heartwarming and peaceful love story",link:"https://www.netflix.com/title/70242034"},{title:"English Vinglish",genre:"Drama, Family",description:"A gentle and inspiring story of self-discovery",link:"https://www.amazon.com/English-Vinglish-Sridevi/dp/B00GXKF8BQ"}]}[t]||[];return oe.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:n.map((s,r)=>oe.jsxs("a",{href:s.link,target:"_blank",rel:"noopener noreferrer",className:"block p-6 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[oe.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:s.title}),oe.jsx("p",{className:"text-purple-600 text-sm mb-2",children:s.genre}),oe.jsx("p",{className:"text-gray-600 mb-4",children:s.description}),oe.jsxs("div",{className:"flex items-center text-purple-600",children:[oe.jsx("span",{className:"font-medium",children:"Watch Now"}),oe.jsx(IS,{className:"h-4 w-4 ml-2"})]})]},r))})}function VSe({mood:t}){const[e,n]=kt.useState(!1),r={happy:[{title:"Creative Expression",description:"Channel your positive energy",tasks:["Learn a Bollywood dance routine","Try your hand at rangoli art","Practice mehendi designs","Cook your favorite Indian dish"]},{title:"Social Connection",description:"Share your joy with others",tasks:["Plan a chai time with friends","Organize a festive gathering","Join a garba/dandiya class","Share family recipes"]}],sad:[{title:"Mindful Activities",description:"Find peace and balance",tasks:["Practice yoga asanas","Try pranayama breathing","Listen to bhajans","Visit a nearby temple"]},{title:"Self-Care Routine",description:"Nurture yourself",tasks:["Make a cup of masala chai","Oil massage (abhyanga)","Practice meditation","Write in your journal"]}],neutral:[{title:"Productivity Boost",description:"Make the most of your time",tasks:["Learn Sanskrit shlokas","Practice classical music","Study Vedic mathematics","Read Indian literature"]},{title:"Skill Development",description:"Learn something new",tasks:["Try a new Indian recipe","Learn classical dance basics","Practice calligraphy","Study Ayurveda basics"]}],excited:[{title:"Energy Channel",description:"Make use of your high spirits",tasks:["Join a Bhangra class","Learn Bollywood choreography","Practice tabla or drums","Plan a cultural event"]},{title:"Creative Pursuits",description:"Express your energy",tasks:["Create fusion music","Design Indian fashion","Paint madhubani art","Make DIY festival decorations"]}],tired:[{title:"Gentle Movement",description:"Restore your energy",tasks:["Practice gentle yoga","Do simple stretches","Walk in a garden","Feed birds (a traditional activity)"]},{title:"Restorative Practice",description:"Find peace and rest",tasks:["Listen to Sanskrit chants","Practice meditation","Try aromatherapy with Indian essences","Read spiritual texts"]}]}[t]||[];return e?oe.jsx(zSe,{mood:t,onBack:()=>n(!1)}):oe.jsxs("div",{children:[oe.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:r.map((i,o)=>oe.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[oe.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:i.title}),oe.jsx("p",{className:"text-gray-600 mb-4",children:i.description}),oe.jsx("ul",{className:"space-y-2",children:i.tasks.map((a,l)=>oe.jsxs("li",{className:"flex items-center text-gray-700",children:[oe.jsx("span",{className:"w-2 h-2 bg-purple-600 rounded-full mr-2"}),a]},l))})]},o))}),oe.jsx("div",{className:"text-center",children:oe.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:["Take a Mood Quiz",oe.jsx(IS,{className:"h-4 w-4 ml-2"})]})})]})}function zSe({mood:t,onBack:e}){const[n,s]=kt.useState(0),[r,i]=kt.useState(0),[o,a]=kt.useState(!1),u={happy:[{question:"How likely are you to share your happiness with others?",options:["Very likely","Somewhat likely","Not sure","Not likely"]},{question:"What activity would you most enjoy right now?",options:["Dancing","Calling friends","Creating art","Relaxing alone"]},{question:"How energetic do you feel?",options:["Very energetic","Moderately energetic","Slightly energetic","Not very energetic"]}],sad:[{question:"What would help you feel better right now?",options:["Talking to someone","Being alone","Physical activity","Creative expression"]},{question:"How do you prefer to process your emotions?",options:["Writing","Meditation","Exercise","Music"]},{question:"What type of support would be most helpful?",options:["Friend's company","Professional guidance","Self-reflection time","Physical activity"]}],neutral:[{question:"What would you like to accomplish today?",options:["Learn something new","Complete tasks","Relax and recharge","Connect with others"]},{question:"How would you like to spend your energy?",options:["Productive tasks","Creative projects","Social activities","Personal development"]},{question:"What would make your day better?",options:["Achievement","Connection","Relaxation","Adventure"]}],excited:[{question:"How would you like to channel your excitement?",options:["Physical activity","Creative projects","Social interaction","Goal pursuit"]},{question:"What type of activity appeals to you most?",options:["High-energy exercise","Creative expression","Social gathering","Learning something new"]},{question:"How would you like to share your energy?",options:["Group activities","Individual pursuits","Helping others","Creative projects"]}],tired:[{question:"What type of rest do you need most?",options:["Physical rest","Mental rest","Emotional rest","Social rest"]},{question:"What would help you recharge?",options:["Quiet time alone","Gentle movement","Nature sounds","Light socializing"]},{question:"What activity feels most manageable?",options:["Meditation","Gentle stretching","Reading","Listening to music"]}]}[t]||[],c=h=>{const d=3-h;i(r+d),n<u.length-1?s(n+1):a(!0)};if(o){const h=u.length*3,d=r/h*100;return oe.jsxs("div",{className:"text-center",children:[oe.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Quiz Results"}),oe.jsxs("div",{className:"mb-6",children:[oe.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-2",children:oe.jsx("div",{className:"bg-purple-600 h-4 rounded-full",style:{width:`${d}%`}})}),oe.jsx("p",{className:"text-gray-600",children:d>=75?"You're making great choices for your current mood!":d>=50?"You're on the right track with managing your mood.":"Consider trying some of our recommended activities to boost your mood."})]}),oe.jsx("button",{onClick:e,className:"text-purple-600 hover:text-purple-700 font-medium",children:"← Back to Activities"})]})}return oe.jsxs("div",{children:[oe.jsxs("div",{className:"text-center mb-8",children:[oe.jsxs("h3",{className:"text-2xl font-bold text-gray-800 mb-2",children:["Question ",n+1," of ",u.length]}),oe.jsx("p",{className:"text-gray-600",children:u[n].question})]}),oe.jsx("div",{className:"space-y-4",children:u[n].options.map((h,d)=>oe.jsx("button",{onClick:()=>c(d),className:"w-full p-4 text-left rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:h},d))}),oe.jsx("div",{className:"mt-8 text-center",children:oe.jsx("button",{onClick:e,className:"text-purple-600 hover:text-purple-700 font-medium",children:"← Back to Activities"})})]})}function BSe(){const{user:t,setUser:e,signOut:n}=rO();return kt.useEffect(()=>{const s=r8(cy,r=>{e(r)});return()=>s()},[e]),t?oe.jsxs("div",{className:"min-h-screen bg-gray-50",children:[oe.jsx("nav",{className:"bg-white shadow-sm",children:oe.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:oe.jsxs("div",{className:"flex justify-between h-16 items-center",children:[oe.jsx("h1",{className:"text-2xl font-bold text-purple-600",children:"Mood Analyzer"}),oe.jsxs("button",{onClick:n,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",children:[oe.jsx(Fq,{className:"h-5 w-5 mr-2"}),"Sign Out"]})]})})}),oe.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:oe.jsx(PSe,{})})]}):oe.jsx(zq,{})}_R(document.getElementById("root")).render(oe.jsx(kt.StrictMode,{children:oe.jsx(BSe,{})}));
